
/* Smart UI v9.1.1 (2021-Feb) 
Copyright (c) 2011-2021 jQWidgets. 
License: https://htmlelements.com/license/ */ //

!function(e){var t={};function a(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=e,a.c=t,a.d=function(e,t,s){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(a.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(s,r,function(t){return e[t]}.bind(null,r));return s},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=70)}({70:function(e,t){Smart("smart-kanban",class extends Smart.DataView{static get properties(){return{addNewColumn:{value:!1,type:"boolean"},allowDrag:{value:!0,type:"boolean",defaultReflectToAttribute:!0},allowDrop:{value:!0,type:"boolean",defaultReflectToAttribute:!0},autoLoadState:{value:!1,type:"boolean"},autoSaveState:{value:!1,type:"boolean"},currentUser:{value:null,type:"any"},dataSourceMap:{value:{checklist:"checklist",color:"color",comments:"comments",dueDate:"dueDate",id:"id",priority:"priority",progress:"progress",startDate:"startDate",status:"status",swimlane:"swimlane",tags:"tags",text:"text",userId:"userId"},type:"any",reflectToAttribute:!1},dragOffset:{value:"auto",type:"any"},formatStringDate:{value:"d",type:"string"},formatStringTime:{value:"MMM d, HH:mm",type:"string"},hierarchy:{value:"columns",allowedValues:["columns","tabs"],type:"string"},messages:{value:{en:{actionsIcon:"Actions icon",addNewStatus:"New status",addNewTask:"Add new task",addSubtask:"Add subtask",assignedTo:"Assigned to",checklist:"Checklist",color:"Color",commentsIcon:"Comments icon",copy:"Copy",customize:"Customize tasks",dueDate:"Due date",edit:"Edit",editTask:'Edit task "{{taskId}}"',high:"High",low:"Low",newComment:"New comment",newSubtask:"New subtask",normal:"Normal",priority:"Priority",priorityIcon:"Priority icon",progress:"Progress",promptComment:"Are you sure you want to remove this comment?",promptTask:'Are you sure you want to remove the task "{{taskText}}"?',remove:"Remove",removeSubtask:"Remove subtask",send:"Send",startDate:"Start date",status:"Status",swimlane:"Swimlane",tags:"Tags",text:"Text",userId:"User ID",userIcon:"User icon"}}},selectionMode:{value:"zeroOrOne",allowedValues:["zeroOrOne","zeroOrManyExtended"],type:"string"},swimlanes:{value:[],type:"array",reflectToAttribute:!1},swimlanesFrom:{value:0,type:"number"},swimlanesTo:{value:null,type:"number?"},tags:{value:[],type:"array"},taskActions:{value:!1,type:"boolean"},taskComments:{value:!1,type:"boolean"},taskDue:{value:!1,type:"boolean"},taskPosition:{value:"all",allowedValues:["all","leaf"],type:"string"},taskPriority:{value:!0,type:"boolean",defaultReflectToAttribute:!0},taskProgress:{value:!1,type:"boolean"},taskTags:{value:!0,type:"boolean",defaultReflectToAttribute:!0},taskUserIcon:{value:!0,type:"boolean",defaultReflectToAttribute:!0},textTemplate:{value:null,type:"any"},userList:{value:!1,type:"boolean"},users:{value:[],type:"array",reflectToAttribute:!1}}}static get listeners(){return{"body.focusin":"_bodyFocusinHandler","container.click":"_containerClickHandler","container.down":"_containerDownHandler","container.keydown":"_containerKeydownHandler","container.touchmove":"_scrollViewerTouchmoveHandler"}}template(){const e=this._tabindex;return`<div id="container" role="presentation">\n                    <div id="header" class="smart-data-view-header" role="toolbar">\n                        <div id="customizeButton" class="smart-data-view-header-button smart-data-view-customize-button smart-unselectable"${e} role="button" aria-expanded="false" aria-haspopup="dialog" aria-label="Customize tasks"><div role="presentation"></div></div>\n                        <div id="filterButton" class="smart-data-view-header-button smart-data-view-filter-button smart-unselectable"${e} role="button" aria-expanded="false" aria-haspopup="dialog" aria-label="Filter"><div role="presentation"></div></div>\n                        <div id="sortButton" class="smart-data-view-header-button smart-data-view-sort-button smart-unselectable"${e} role="button" aria-expanded="false" aria-haspopup="dialog" aria-label="Sort"><div role="presentation"></div></div>\n                        <div id="searchButton" class="smart-data-view-header-button smart-data-view-search-button smart-unselectable"${e} role="button" aria-expanded="false" aria-haspopup="dialog" aria-label="Search"></div>\n                        <div id="headerDropDown" class="smart-data-view-header-drop-down smart-visibility-hidden" role="dialog">\n                            <div id="customize" class="smart-hidden" role="presentation"></div>\n                            <div id="filter" class="smart-hidden" role="presentation"></div>\n                            <div id="sort" class="smart-hidden" role="presentation"></div>\n                            <div id="search" class="smart-data-view-search-box smart-hidden" role="presentation">\n                                <input type="text" id="searchInput" spellcheck="false" aria-label="Search" />\n                                <div id="searchLabel" class="smart-data-view-search-label smart-unselectable"></div>\n                                <div id="searchPrev" class="smart-data-view-search-prev"${e} role="button" aria-label="Previous"></div>\n                                <div id="searchNext" class="smart-data-view-search-next"${e} role="button" aria-label="Next"></div>\n                                <div id="searchClose" class="smart-data-view-search-close"${e} role="button" aria-label="Close search box"></div>\n                            </div>\n                        </div>\n                    </div>\n                    <div id="body" class="smart-kanban-body" role="presentation"></div>\n                </div>`}render(){const e=this;Object.defineProperty(e,"dataSource",{get:function(){return e.context===e?e.properties.dataSource.value:e._getCurrentDataSource()},set(t){e.updateProperty(e,e._properties.dataSource,t)}}),e._render(),super.render()}_render(){const e=this,t=getComputedStyle(e);e.$.body.innerHTML="",e._autoScrollCoefficient=Smart.Utilities.Core.Browser.Firefox?4:Smart.Utilities.Core.Browser.Edge?8:2,e._kanbanTaskMinWidth=parseFloat(t.getPropertyValue("--smart-kanban-task-min-width")),e._dataViewPadding=parseFloat(t.getPropertyValue("--smart-data-view-padding")),e._allColumns=[],e._customTags=[],e._selectedTasks=[],e._dblclickObject={numberOfClicks:0},e._appliedFiltering={filterGroups:[],filters:[],operator:"and"},e._appliedSorting={dataFields:[],dataTypes:[],orderBy:[]},e._sortPanelDataSource=[{label:e.localize("text"),dataField:"text",dataType:"string"},{label:e.localize("userId"),dataField:"userId",dataType:"string"},{label:e.localize("tags"),dataField:"tags",dataType:"string"},{label:e.localize("priority"),dataField:"priority",dataType:"string"},{label:e.localize("progress"),dataField:"progress",dataType:"number"},{label:e.localize("startDate"),dataField:"startDate",dataType:"date"},{label:e.localize("dueDate"),dataField:"dueDate",dataType:"date"}],e._validateDataSourceMap(),e._getInnerElementMessages(),e._localizeHeader(),e._handleHeaderPosition(e.$.body),e._validateSwimlanes(),e._renderColumns(),e._handleSwimlanes();let a=!1;e.autoLoadState&&(a=e.loadState()),a||e._processDataSource(),e._getCurrentUser(),e._setUserList(),e._setActionsList(),e._setCommentsList(),e._autoSaveState()}attached(){const e=this;super.attached(),e.isCompleted&&e._dialog&&(e._addDialogHandlers(),e.getShadowRootOrBody().appendChild(e._dialog))}detached(){if(super.detached(),!this._dialog)return;const e=this._dialog;e.removeEventListener("open",this._dialogEventHandler),e.removeEventListener("closing",this._dialogEventHandler),e.removeEventListener("close",this._dialogEventHandler),e.removeEventListener("click",this._dialogClickHandler),e.remove()}addTask(e={}){const t=this,a=t.columns;if("object"!=typeof e||0===a.length||!t._currentUser.allowAdd)return;const s=t.dataSourceMap;void 0===e[s.status]&&(e[s.status]=a[0].dataField),t.dataSource&&t.dataSource.virtualDataSource?t._requestVirtualDataSource("add",e,(function(e){return e})):(t._createTask(e,!0),t._autoSaveState("dataSource"))}addSort(e,t){const a=this,s=a.dataSource;let r;function l(e,s){const l=a._sortPanelDataSource.find(t=>t.dataField===e);if(l){let a=Array.isArray(t)?t[s]:"string"==typeof t?t:"ascending";r.dataFields.push(e),r.dataTypes.push(l.dataType),a=a&&-1!==a.indexOf("desc")?"descending":"ascending",r.orderBy.push(a)}}if(0!==arguments.length&&s&&0!==s.length){if(a.closePanel(),1===arguments.length&&"object"==typeof e)r=e;else if(r={dataFields:[],dataTypes:[],orderBy:[]},Array.isArray(e))e.forEach(l);else{if("string"!=typeof e)return;l(e,0)}super.addSort(r)}}beginEdit(e){this._currentUser.allowEdit&&!this.disabled&&(e=this._validateTaskArgument(e))&&this._openDialog(e,"edit")}cancelEdit(){const e=this._dialog;e&&e.opened&&e.classList.contains("edit")&&e.close()}collapse(e){const t=this;if(!t.collapsible)return;if(!(e=t._validateColumnArgument(e))||e.collapsed||!e.collapsible)return;const a=t._columnToElement.get(e),s=a.siblingColumns;let r=0;if(e.collapsed=!0,a.classList.add("collapsed"),s.forEach(e=>e.collapsed&&r++),r===s.length){const a=0!==s.indexOf(e)?0:1,r=s[a],l=t._columnToElement.get(r);r.collapsed=!1,l.classList.remove("collapsed"),t._updateColumnWidths(s,l.parentElement)}else t._updateColumnWidths(s,a.parentElement);t._allColumns.forEach(e=>t._refreshScrollViewer(e)),t._autoSaveState("collapsed"),t._handleSwimlanes(!0)}copyTask(e){const t=this;if(!t._currentUser.allowAdd)return;if(!(e=t._validateTaskArgument(e)))return;const a=Object.assign({},e.data);t.dataSource&&t.dataSource.virtualDataSource?t._requestVirtualDataSource("add",a,(function(e){return e})):(a[t.dataSourceMap.id]=Math.floor(9e4*Math.random()+1e4),t._createTask(a,!0),t._autoSaveState("dataSource"))}endEdit(){const e=this._dialog;e&&e.opened&&e.classList.contains("edit")&&(e.ok=!0,e.close())}ensureVisible(e){if(!(e=this._validateTaskArgument(e))||e.filteredOut)return;const t=e.closest("smart-scroll-viewer");if(0===t.scrollHeight)return e;const a=t.scrollTop,s=e.offsetTop;return a<=s&&a+t.offsetHeight>=s+e.offsetHeight||(t.scrollTop=s),e}expand(e){const t=this;if(!(e=t._validateColumnArgument(e))||!e.collapsed)return;const a=t._columnToElement.get(e);e.collapsed=!1,a.classList.remove("collapsed"),t._updateColumnWidths(a.siblingColumns,a.parentElement),t._allColumns.forEach(e=>t._refreshScrollViewer(e)),t._autoSaveState("collapsed"),t._handleSwimlanes(!0)}expandAll(){const e=this;e._allColumns.forEach(t=>{t.collapsed=!1,e._columnToElement.get(t).classList.remove("collapsed")}),e._allColumns.forEach(t=>e._refreshScrollViewer(t)),e._columnContainers.forEach(t=>e._updateColumnWidths(t.children,t)),e._autoSaveState("collapsed"),e._handleSwimlanes(!0)}exportData(e,t,a){const s=this,r=getComputedStyle(s),l=r.borderRightColor,o=s.swimlanes,n=new Smart.Utilities.DataExporter,i=s._getCurrentDataSource(),c=s.dataSourceMap,d=[{id:"Task ID",text:"Text",status:"Status",swimlane:"Swimlane",asignee:"Asignee",priority:"Priority",progress:"Progress",startDate:"Start date",dueDate:"Due date",subTasks:"Completed sub-tasks",tags:"Tags"}],u={},m={},h={};n.style={border:"1px solid "+l,borderCollapse:"collapse",backgroundColor:r.backgroundColor,color:r.color,fontFamily:"Helvetica",header:{border:"1px solid "+l,fontWeight:"bold"},columns:{border:"1px solid "+l,progress:{format:"p0"},startDate:{format:s.formatStringDate},dueDate:{format:s.formatStringDate}},rows:{}},0===o.length&&delete d[0].swimlane;for(let e=0;e<i.length;e++){const t=i[e];let a=t[c.status],r=t[c.swimlane],l=t[c.userId],p=t[c.progress];u[a]?a=u[a]:(a=s._allColumns.find(e=>e.dataField===a).label,u[t[c.status]]=a),null===l?l="":h[l]?l=h[l]:(l=s.users.find(e=>e.id===l).name,h[t[c.userId]]=l),null===p?p="":p/=100;const b={id:t[c.id],text:t[c.text],status:a,asignee:l,priority:t[c.priority],progress:p,startDate:t[c.startDate]||"",dueDate:t[c.dueDate]||"",subTasks:s._getCompletedSubTasks(t[c.checklist]),tags:t[c.tags]};o.length&&(r?m[r]?r=m[r]:(r=o.find(e=>e.dataField===r).label,m[t[c.swimlane]]=r):r="",b.swimlane=r),d.push(b),t[c.color]&&(n.style.rows[e]={backgroundColor:t[c.color]})}return n.exportData(d,e,t,a)}getState(){const e=this,t=e.dataSourceMap,a={},s={collapsed:a,dataSource:e._getCurrentDataSource(),filtering:e._appliedFiltering,selection:{selected:e._selectedTasks.map(e=>e.data[t.id]),selectionStart:e._selectionStart?e._selectionStart.data[t.id]:null},sorting:e._appliedSorting,tabs:e._selectedTabs,visibility:{taskActions:e.taskActions,taskComments:e.taskComments,taskDue:e.taskDue,taskPriority:e.taskPriority,taskProgress:e.taskProgress,taskTags:e.taskTags,taskUserIcon:e.taskUserIcon}};let r=null,l=null;return e._selectionInView&&(r=e._selectionInView.closest(".smart-kanban-column").column.dataField,l=e._selectionInView.getAttribute("swimlane")),s.selection.selectionInColumn=r,s.selection.swimlane=l,e._allColumns.forEach(e=>a[e.dataField]=e.collapsed),s}loadState(e){const t=this;if(!e&&!(e=window.localStorage.getItem("smartKanban"+t.id)))return!1;"string"==typeof e&&(e=JSON.parse(e,(e,t)=>t&&-1!==["startDate","dueDate","time"].indexOf(e)?new Date(t):t)),t._selectedTasks=[],delete t._selectionStart,delete t._selectionInView,t.expandAll(),Array.from(t.$.container.querySelectorAll("smart-scroll-viewer.smart-kanban-column-content-tasks")).forEach(e=>e.clearContent()),t._allColumns.forEach(a=>{e.collapsed[a.dataField]&&t.collapse(a)});for(let a in e.visibility)t[a]=e.visibility[a];if(t.dataSource=e.dataSource,t._processDataSource(),t.addFilter(t._constructFilterGroups(e.filtering),e.filtering.operator),t.addSort(e.sorting),t._autoSaveState(e),e.selection.selected.forEach(e=>{const a=t.$.container.querySelector(`.smart-kanban-task[data-id="${e}"]`);a&&(a.setAttribute("selected",""),t._selectedTasks.push(a))}),e.selection.selectionStart&&(t._selectionStart=t.$.container.querySelector(`.smart-kanban-task[data-id="${e.selection.selectionStart}"]`)),e.selection.selectionInColumn){const a=t._columnToElement.get(t._allColumns.find(t=>t.dataField===e.selection.selectionInColumn));e.selection.swimlane?t._selectionInView=a.querySelector(`smart-scroll-viewer[swimlane=${e.selection.swimlane}]`):t._selectionInView=a.querySelector("smart-scroll-viewer")}if(e.tabs){const a="tabs"===t.hierarchy;t._allColumns.forEach(s=>{if(void 0!==s.selected){const r=t._columnToElement.get(s),l=-1!==e.tabs.indexOf(s.dataField);s.selected=l,a&&(r.classList.toggle("smart-hidden",!l),r.tab.classList.toggle("selected",l),r.tab.setAttribute("aria-selected",l))}})}return!0}moveTask(e,t){const a=this;if(a.disabled||!t)return;const s=a.dataSourceMap;if(!(e=a._validateTaskArgument(e))||!a._updateTaskInProgress&&e.data[s.status]===t)return;const r=a._allColumns.find(e=>e.dataField===t);function l(){const l=e.closest("smart-scroll-viewer"),o=a._columnToElement.get(r),n=e.data,i=a.getTaskScrollViewer(o,n);n[s.status]=t,i.appendChild(e),a._dialog&&a._dialog.ok||(a.textTemplate&&a._renderTask(e),a._autoSaveState("dataSource")),a._refreshScrollViewer(l,!0),a._refreshScrollViewer(i,!0),e.hasAttribute("selected")&&(e.removeAttribute("selected"),a._selectedTasks=a._selectedTasks.filter(t=>t!==e),a._autoSaveState("selection")),e.removeAttribute("focus"),(a.shadowRoot||a.getRootNode()).activeElement===l&&a._focusTask(a._getFirstItem(l.$.content))}r&&(a.dataSource&&a.dataSource.virtualDataSource&&!a._ignoreVirtualDataSource?a._requestVirtualDataSource("update",Object.assign({},e.data,{status:t}),(function(e){return e&&l(),e})):l())}openCustomizePanel(){const e=this,t=e.dataSource;if(!t||0===t.length||e.disabled||"none"===e.headerPosition)return;const a=e.$.customize,s=[{label:e.localize("actionsIcon"),dataField:"taskActions",visible:e.taskActions},{label:e.localize("commentsIcon"),dataField:"taskComments",visible:e.taskComments},{label:e.localize("dueDate"),dataField:"taskDue",visible:e.taskDue},{label:e.localize("priorityIcon"),dataField:"taskPriority",visible:e.taskPriority},{label:e.localize("progress"),dataField:"taskProgress",visible:e.taskProgress},{label:e.localize("tags"),dataField:"taskTags",visible:e.taskTags},{label:e.localize("userIcon"),dataField:"taskUserIcon",visible:e.taskUserIcon}];let r;e._closeDialog(),e.$.headerDropDown.classList.add("customize-panel"),e.$.headerDropDown.classList.remove("filter-panel","sort-panel","search-panel"),a.classList.remove("smart-hidden"),e.$.filter.classList.add("smart-hidden"),e.$.sort.classList.add("smart-hidden"),e.$.search.classList.add("smart-hidden"),e._closeSearchPanel(),e._customizePartCreated?(r=a.firstElementChild,r.set("dataSource",s),r.propertyChangedHandler("dataSource",void 0,s),r.rightToLeft=e.rightToLeft):(r=document.createElement("smart-column-panel"),r.animation=e.animation,r.dataSource=s,r.locale=e.locale,r.messages=e._innerElementMessages.columnPanel,r.rightToLeft=e.rightToLeft,r.theme=e.theme,e.$.customize.appendChild(r),r.$.sortable.disabled=!0,e._customizePartCreated=!0),e._openHeaderDropDown(e.$.customizeButton)}openFilterPanel(){const e=this,t=[{label:e.localize("text"),dataField:"text",dataType:"string"},{label:e.localize("userId"),dataField:"userId",dataType:"string"},{label:e.localize("tags"),dataField:"tags",dataType:"string"},{label:e.localize("priority"),dataField:"priority",dataType:"enum",options:[{label:e.localize("high"),value:"high"},{label:e.localize("normal"),value:"normal"},{label:e.localize("low"),value:"low"}]},{label:e.localize("progress"),dataField:"progress",dataType:"number"},{label:e.localize("startDate"),dataField:"startDate",dataType:"date"},{label:e.localize("dueDate"),dataField:"dueDate",dataType:"date"}];super.openFilterPanel(t,(function(t,a){"progress"===a.dataField?(t.min=0,t.max=100,t.showUnit=!0,t.unit="%"):"date"===a.dataType&&(t.formatString=e.formatStringDate)}))}openSortPanel(){const e=this,t=e._sortPanelDataSource.map(t=>{const a=e._appliedSorting.dataFields.indexOf(t.dataField);return Object.assign({},t,{sortIndex:a,sortDirection:-1===a?"ascending":e._appliedSorting.orderBy[a]})});super.openSortPanel(t)}removeTask(e,t){const a=this;function s(){const t=e.closest("smart-scroll-viewer");e.remove(),a._refreshScrollViewer(t,!0),a._autoSaveState("dataSource")}a._currentUser.allowRemove&&(e=a._validateTaskArgument(e))&&(t?a._openDialog(e,"prompt"):a.dataSource&&a.dataSource.virtualDataSource?a._requestVirtualDataSource("remove",e.data,(function(e){return e&&s(),e})):s())}saveState(){const e=this.getState();return window.localStorage.setItem("smartKanban"+this.id,JSON.stringify(e)),e}updateTask(e,t){const a=this;if(!a._currentUser.allowEdit||!t)return;if(!(e=a._validateTaskArgument(e)))return;const s=a.dataSourceMap,r=e.data;function l(){if(e.data=t,t[s.status]!==r[s.status]&&(a._updateTaskInProgress=!0,a.moveTask(e,t[s.status]),delete a._updateTaskInProgress),t[s.swimlane]!==r[s.swimlane]){const l=e.closest(".smart-kanban-column");a._hasSwimlane(l.index)?(l.querySelector(`smart-scroll-viewer[swimlane=${t[s.swimlane]}]`).appendChild(e),r[s.swimlane]&&a._refreshScrollViewer(l.querySelector(`smart-scroll-viewer[swimlane=${r[s.swimlane]}]`))):delete t[s.swimlane]}a.textTemplate||t[s.text]!==r[s.text]||t[s.tags]!==r[s.tags]||t[s.priority]!==r[s.priority]?a._renderTask(e):(t[s.userId]!==r[s.userId]&&a._updateUserIcon(e),t[s.dueDate]!==r[s.dueDate]&&a._updateTaskDueDate(e),t[s.color]!==r[s.color]&&a._updateTaskColor(e),JSON.stringify(t[s.checklist])!==JSON.stringify(r[s.checklist])?(a._updateTaskChecked(e),a._updateTaskProgress(e)):parseFloat(t[s.progress])!==parseFloat(r[s.progress])&&a._updateTaskProgress(e)),a.$.fireEvent("change",{task:e,value:t,oldValue:r}),a._refreshScrollViewer(e.closest("smart-scroll-viewer")),a._autoSaveState("dataSource")}(t=Object.assign({},r,t))[s.checklist]&&0===t[s.checklist].length&&(t[s.checklist]=null),JSON.stringify(t)!==JSON.stringify(r)&&(a.dataSource&&a.dataSource.virtualDataSource?a._requestVirtualDataSource("update",t,(function(e){return e&&(a._ignoreVirtualDataSource=!0,l(),delete a._ignoreVirtualDataSource),e})):l())}propertyChangedHandler(e,t,a){const s=this,r=s._dialog;function l(){s.cancelEdit(),r&&r.close(),s._closeList(s._commentsList,"_commentSelectionFor"),s._getCurrentUser()}switch(super.propertyChangedHandler(e,t,a),e){case"addNewColumn":s._reset();break;case"allowDrag":s._getCurrentUser();break;case"animation":case"theme":{let t=Array.from(s.$.container.querySelectorAll("smart-column-panel, smart-multi-column-filter-panel, smart-sort-panel"));r&&(t.push(r),t=t.concat(Array.from(r.$.footer.children)),r.editPanelPopulated&&(t=t.concat(Array.from(r.$.container.querySelectorAll(".smart-element.editor"))))),t.forEach(t=>t[e]=a),Array.from(s.$.container.getElementsByClassName("smart-kanban-task")).forEach(e=>s._updateTaskColor(e));break}case"autoSaveState":s._autoSaveState();break;case"collapsible":a||s.expandAll();break;case"columns":s._render(),r&&r.editPanelPopulated&&(r.editors.status.dataSource=s._allColumns.map(e=>({label:e.label,value:e.dataField})));break;case"currentUser":l();break;case"dataSource":case"dataSourceMap":if("dataSourceMap"===e&&s._validateDataSourceMap(),s._customTags=[],s._selectedTasks=[],s.cancelEdit(),s.closePanel(),s._closeList(s._actionsList,"_actionSelectionFor"),s._closeList(s._commentsList,"_commentSelectionFor"),s._closeList(s._userList,"_userSelectionFor"),0===s.columns.length)return s._renderColumns(),s._handleSwimlanes(),void s._processDataSource();Array.from(s.$.container.querySelectorAll("smart-scroll-viewer.smart-kanban-column-content-tasks")).forEach(e=>e.clearContent()),s._processDataSource();break;case"disabled":s.cancelEdit(),s.closePanel(),s._closeList(s._actionsList,"_actionSelectionFor"),s._closeList(s._commentsList,"_commentSelectionFor"),s._closeList(s._userList,"_userSelectionFor"),s._setFocusable();break;case"formatStringDate":Array.from(s.$.container.getElementsByClassName("smart-kanban-task")).forEach(e=>s._updateTaskDueDate(e)),r&&(r.editors.startDate.formatString=a,r.editors.dueDate.formatString=a);break;case"formatStringTime":s._closeList(s._commentsList,"_commentSelectionFor");break;case"editable":s.cancelEdit(),s._actionsList.classList.contains("edit-comment")||s._closeList(s._actionsList,"_actionSelectionFor"),s._getCurrentUser();break;case"headerPosition":s._handleHeaderPosition(s.$.body),s._allColumns.forEach(e=>s._refreshScrollViewer(e));break;case"hierarchy":0===s.swimlanes.length&&s.columns.length!==s._allColumns.length&&s._reset();break;case"locale":case"messages":s.closePanel(),s._localizeHeader(),s._getInnerElementMessages(),s._closeList(s._actionsList,"_actionSelectionFor"),s._closeList(s._commentsList,"_commentSelectionFor"),s._setActionsList(),s._setCommentsList(),r&&(s.cancelEdit(),r.close(),r.$.footer.firstElementChild.innerHTML=s.localize("ok"),r.$.footer.children[1].innerHTML=s.localize("cancel"),r.editPanelPopulated&&(r.editors.priority.dataSource=[{label:s.localize("low"),value:"low"},{label:s.localize("normal"),value:"normal"},{label:s.localize("high"),value:"high"}],r.$.container.querySelector(".new-subtask").placeholder=s.localize("newSubtask"),r.$.container.querySelector("smart-button.add").title=s.localize("addSubtask"),Array.from(r.$.container.getElementsByClassName("editor-label")).forEach(e=>{let t=e.id.slice(s.id.length+5);t=t.slice(0,1).toLowerCase()+t.slice(1),e.innerHTML=s.localize(t)}))),s._customizePartCreated&&(s.$.customize.firstElementChild.messages=s._innerElementMessages.columnPanel,s.$.customize.firstElementChild.locale=s.locale),s._filterPartCreated&&(s.$.filter.firstElementChild.messages=s._innerElementMessages.multiColumnFilterPanel,s.$.filter.firstElementChild.locale=s.locale,s.$.filter.firstElementChild.editorPlaceholder=s.localize("filterValuePlaceholder")),s._sortPartCreated&&(s.$.sort.firstElementChild.messages=s._innerElementMessages.sortPanel,s.$.sort.firstElementChild.locale=s.locale);break;case"rightToLeft":s._reset(!0);break;case"selectionMode":if("zeroOrOne"===a&&s._selectedTasks.length>1){const e=s._selectionStart;s._selectedTasks.forEach(t=>t!==e&&t.removeAttribute("selected")),s._selectedTasks=[e]}break;case"swimlanes":if(s._validateSwimlanes(),JSON.stringify(s.swimlanes)===JSON.stringify(t))return;s._reset(),r&&r.editPanelPopulated&&(r.editors.swimlane.dataSource=s.swimlanes.map(e=>({label:e.label,value:e.dataField})));break;case"swimlanesFrom":case"swimlanesTo":{const e=s.swimlanesFrom,t=s.swimlanesTo;e<0&&(s.swimlanesFrom=0),null!==t&&e>t&&(s.swimlanesFrom=t),s.swimlanes.length>0&&s._reset();break}case"tags":case"textTemplate":Array.from(s.$.container.getElementsByClassName("smart-kanban-task")).forEach(e=>s._renderTask(e)),s._allColumns.forEach(e=>s._refreshScrollViewer(e));break;case"unfocusable":s._setFocusable();break;case"users":s._closeList(s._userList,"_userSelectionFor"),s._setUserList(),Array.from(s.$.container.getElementsByClassName("smart-kanban-task")).forEach(e=>s._updateUserIcon(e)),r&&r.editPanelPopulated&&(r.editors.userId.dataSource=s.users.map(e=>({label:e.name,value:e.id}))),l()}}_reset(e){const t=this,a=t.getState();t._allColumns=[],t._customTags=[],t._selectedTasks=[],t._dialog&&(t.cancelEdit(),e&&(t._dialog.remove(),delete t._dialog)),t.closePanel(),t._closeList(t._actionsList,"_actionSelectionFor"),t._closeList(t._commentsList,"_commentSelectionFor"),t._closeList(t._userList,"_userSelectionFor"),t.$.body.innerHTML="",Array.from(t.$.container.getElementsByClassName("swimlane")).forEach(e=>e.remove()),t._renderColumns(),t._handleSwimlanes(),t.loadState(a)}_containerClickHandler(e){const t=this,a=t.isInShadowDOM||t.shadowRoot?e.composedPath()[0]:e.target;if(t.$.header.contains(a))return void t._headerClickHandler(a,t.$.body);const s=a.closest(".smart-kanban-column-header");if(s){const e=s.parentElement.column;if(a instanceof HTMLInputElement)return;if(a.closest(".smart-kanban-column-header-add"))return void t._openDialog(e,"add","column");if(t.collapsible&&e.collapsible)return void t[e.collapsed?"expand":"collapse"](e)}const r=a.closest(".smart-kanban-tab");if(r){if(r.classList.contains("selected"))return;const e=r.parentElement.querySelector(".selected");return e.classList.remove("selected"),e.setAttribute("aria-selected",!1),e.columnElement.classList.add("smart-hidden"),e.columnElement.column.selected=!1,r.classList.add("selected"),r.setAttribute("aria-selected",!0),r.columnElement.classList.remove("smart-hidden"),r.columnElement.column.selected=!0,t._selectedTabs=t._allColumns.filter(e=>e.selected).map(e=>e.dataField),t._autoSaveState("tabs"),void t._allColumns.forEach(e=>t._refreshScrollViewer(e))}if(t.addNewColumn){if(a.closest(".smart-kanban-add-new-column"))return void t._addNewColumnDynamically()}const l=a.closest(".smart-kanban-list .item");if(l){const e=l.getAttribute("data-id"),a=t._userSelectionFor;if(a){const s=t.dataSourceMap,r=a.data[s.userId];return a.data[s.userId]=e,t._updateUserIcon(a),t._closeList(t._userList,"_userSelectionFor"),void(a.data[s.userId]!==r&&(t.dataSource&&t.dataSource.virtualDataSource&&t._requestVirtualDataSource("update",a.data,(function(e){return e||(a.data[s.userId]=r,t._updateUserIcon(a)),e})),t._autoSaveState("dataSource")))}const s=t._actionSelectionFor;if(s){switch(parseFloat(e)){case 0:t._actionsList.classList.contains("edit-comment")?(t._commentsList.textarea.value=s.comment.text,t._commentsList.textarea.focus(),t._commentsList.editing=s,s.parentElement.scrollTop=s.offsetTop):t.beginEdit(s);break;case 1:t.copyTask(s);break;case 2:t._actionsList.classList.contains("edit-comment")?t._openDialog(s,"prompt","comment"):t.removeTask(s,!0)}return void t._closeList(t._actionsList,"_actionSelectionFor")}}if(a.closest(".smart-kanban-list.comments")){const e=a.closest(".send");if(e){if(e.disabled)return;t._createComment(),t._commentsList.textarea.value="",e.disabled=!0}else if(a.classList.contains("remove-button")&&a.classList.contains("enabled")){const e=a.closest(".comment");t._actionSelectionFor&&(t._actionSelectionFor===e||t._actionSelectionFor.classList.contains("smart-kanban-task")||t._actionsList.parentElement&&!t._actionsList.classList.contains("smart-visibility-hidden"))||t._openActionsList(a,void 0,e)}return}const o=a.closest(".smart-kanban-task");o&&(a.classList.contains("smart-kanban-task-user")?!t.userList||!t._currentUser.allowEdit||t._userSelectionFor&&(t._userSelectionFor===o||t._userList.parentElement&&!t._userList.classList.contains("smart-visibility-hidden"))||t._openUserList(a,o):t.taskActions&&a.classList.contains("smart-kanban-task-actions")?t._actionSelectionFor&&(t._actionSelectionFor===o||t._actionSelectionFor.classList.contains("comment")||t._actionsList.parentElement&&!t._actionsList.classList.contains("smart-visibility-hidden"))||t._openActionsList(a,o):t.taskComments&&a.classList.contains("smart-kanban-task-comments")?t.users.length>0&&(!t._commentSelectionFor||t._commentSelectionFor!==o&&(!t._commentsList.parentElement||t._commentsList.classList.contains("smart-visibility-hidden")))&&t._openCommentsList(a,o):(t._preventSelection||t._selectTask(e,o),t._currentUser.allowEdit&&e.type&&(clearTimeout(t._dblclickObject.timeout),t._dblclickObject.numberOfClicks++,2===t._dblclickObject.numberOfClicks?(t._dblclickObject.numberOfClicks=0,t.beginEdit(o)):t._dblclickObject.timeout=setTimeout((function(){t._dblclickObject.numberOfClicks=0}),300))))}_selectTask(e,t){const a=this;function s(){a._selectedTasks.forEach(e=>e!==t&&e.removeAttribute("selected")),t.hasAttribute("selected")||(t.setAttribute("selected",""),a._selectedTasks=[t]),a._selectionStart=t,a._selectionInView=t.closest("smart-scroll-viewer"),a._autoSaveState("selection"),a._focusTask(t)}if("zeroOrOne"===a.selectionMode)a._selectedTasks.forEach(e=>e!==t&&e.removeAttribute("selected")),t.hasAttribute("selected")?(a._focusTask(t),t.removeAttribute("selected"),a._selectedTasks=[],delete a._selectionInView):(t.setAttribute("selected",""),a._selectedTasks=[t],a._selectionStart=t,a._selectionInView=t.closest("smart-scroll-viewer"),a._focusTask(t));else{if(!e.ctrlKey&&!e.shiftKey||0===a._selectedTasks.length||t.closest("smart-scroll-viewer")!==a._selectionInView)return void s();if(e.ctrlKey)t.hasAttribute("selected")?(t.removeAttribute("selected"),a._selectedTasks=a._selectedTasks.filter(e=>e!==t)):(t.setAttribute("selected",""),a._selectedTasks.push(t),a._selectionStart=t);else if(e.shiftKey){if(t===a._selectionStart)return void(a._selectedTasks.length>1&&s());const e=Array.from(t.parentElement.children);let r=e.indexOf(a._selectionStart),l=e.indexOf(t);const o=r;r=Math.min(r,l),l=Math.max(o,l),a._selectedTasks=[],e.forEach((e,t)=>{t>=r&&t<=l&&!e.filteredOut?(e.setAttribute("selected",""),a._selectedTasks.push(e)):e.removeAttribute("selected")})}a._focusTask(t)}a._autoSaveState("selection")}_processDataSource(){const e=this;let t=e.dataSource;if(0!==e.columns.length&&null!==t){if(t instanceof Smart.DataAdapter){if(t.virtualDataSource)return void e._requestVirtualDataSource("dataBind");t=t.dataSource}t.forEach(t=>{e._createTask(t)}),e.whenRendered(()=>e._allColumns.forEach(t=>e._refreshScrollViewer(t)))}}_requestVirtualDataSource(e,t,a){const s=this,r=s.dataSourceMap,l=[],o=[],n={},i=s._appliedFiltering;let c=null;if(i&&i.filterGroups.length>0&&(i.filterGroups.forEach(e=>o[e[0]]=e[1]),o.length=i.filterGroups.length,c=i.operator),s._appliedSorting&&s._appliedSorting.dataFields.length>0&&(s._appliedSorting.dataFields.forEach((e,t)=>{let a=s._appliedSorting.orderBy[t].replace("ending","");l[e]={sortOrder:a,sortIndex:t}}),l.length=s._appliedSorting.dataFields.length),void 0!==t){const e=Object.assign({},t);e[r.checklist]=JSON.stringify(e[r.checklist]),e[r.comments]=JSON.stringify(e[r.comments],(function(e,t){return"time"===e?new Date(t).toISOString().slice(0,19).replace("T"," "):t})),e[r.dueDate]&&(e[r.dueDate]=e[r.dueDate].toISOString().slice(0,10)),e[r.startDate]&&(e[r.startDate]=e[r.startDate].toISOString().slice(0,10)),n.row=e}s.dataSource.onVirtualDataSourceRequested((function(t){let r=!0;-1!==["add","update","remove"].indexOf(e)&&a&&(r=a(t.result),"add"!==e)||r&&(Array.from(s.$.container.querySelectorAll("smart-scroll-viewer.smart-kanban-column-content-tasks")).forEach(e=>e.clearContent()),s.dataSource.dataSource.forEach(e=>{s._createTask(e)}),s._allColumns.forEach(e=>s._refreshScrollViewer(e)),s._autoSaveState("dataSource"))}),{first:0,last:0,sorting:l,filtering:o,filterOperator:c,grouping:[],edit:n,action:e})}_setUserList(){const e=document.createElement("div");e.id=this.id+"UserList",e.className="smart-kanban-list users smart-visibility-hidden",e.setAttribute("role","listbox"),this.disabled||this.unfocusable||(e.tabIndex=0),this.users.forEach(t=>{const a=document.createElement("div");a.className="item",a.innerHTML=`<div class="icon" style="background-image: url('${t.image}')"></div><div class="name">${t.name}</div>`,a.setAttribute("data-id",t.id),a.setAttribute("role","option"),e.appendChild(a)}),this._userList=e}_openList(e,t,a){const s=this.$.container.getBoundingClientRect(),r=e.getBoundingClientRect();let l,o,n=r.left,i=r.top+e.offsetHeight;a=this.rightToLeft?!a:a,1===window.devicePixelRatio?(l=document.documentElement.clientWidth,o=document.documentElement.clientHeight):(l=window.innerWidth,o=window.innerHeight),this.$.container.appendChild(t),a&&(n=r.right-t.offsetWidth),n+t.offsetWidth>l&&(n=l-t.offsetWidth),i+t.offsetHeight>o&&(i=o-t.offsetHeight),t.style.left=Math.max(0,n)-s.left+"px",t.style.top=i-s.top+"px",t.classList.remove("smart-visibility-hidden"),e.setAttribute("aria-expanded",!0),e.setAttribute("aria-controls",t.id),this.unfocusable||requestAnimationFrame((function e(){0===t.getBoundingClientRect().height?requestAnimationFrame(e):t.focus()})),t.openedFrom=e}_openUserList(e,t){if(0===this.users.length)return;const a=t.data[this.dataSourceMap.userId],s=this._userList,r=s.querySelector(".selected");if(r&&(r.classList.remove("selected"),r.removeAttribute("aria-selected")),this._openList(e,s),null!==a){const e=Array.from(s.children).find(e=>e.getAttribute("data-id")===a.toString());e&&(e.classList.add("selected"),e.setAttribute("aria-selected",!0),s.scrollTop=e.offsetTop)}this._userSelectionFor=t}_closeList(e,t){const a=this;if(!e||!e.parentElement)return;const s=a.$.container.querySelector(`[aria-expanded="true"][aria-controls="${e.id}"]`);e.classList.add("smart-visibility-hidden"),requestAnimationFrame((function s(){e.classList.contains("smart-visibility-hidden")&&(e.getBoundingClientRect().height>0?requestAnimationFrame(s):(e.remove(),delete e.openedFrom,delete a[t]))})),s&&(s.removeAttribute("aria-expanded"),s.removeAttribute("aria-controls"))}_setActionsList(){const e=document.createElement("div");e.id=this.id+"ActionsList",e.className="smart-kanban-list actions smart-visibility-hidden",e.setAttribute("role","menu"),this.disabled||this.unfocusable||(e.tabIndex=0),e.innerHTML=`<div class="item" data-id="0" role="menuitem"><div class="name">${this.localize("edit")}</div></div>\n<div class="item" data-id="1" role="menuitem"><div class="name">${this.localize("copy")}</div></div>\n<div class="item" data-id="2" role="menuitem"><div class="name">${this.localize("remove")}</div></div>`,this._actionsList=e}_openActionsList(e,t,a){const s=this._currentUser,r=this._actionsList;this._openList(e,r,a),r.classList.toggle("edit-comment",!!a),this._actionSelectionFor=t||a,r.firstElementChild.toggleAttribute("disabled",!(!t||s.allowEdit)),r.children[1].toggleAttribute("disabled",!(!t||s.allowAdd)),r.children[2].toggleAttribute("disabled",!(!t||s.allowRemove)),Array.from(r.children).forEach(e=>e.classList.remove("selected"))}_setCommentsList(){const e=document.createElement("div");e.id=this.id+"CommentsList",e.className="smart-kanban-list comments smart-visibility-hidden",e.setAttribute("role","dialog"),this.disabled||this.unfocusable||(e.tabIndex=0),e.innerHTML=`<div class="smart-kanban-comments" role="list"></div>\n<div class="smart-kanban-new-comment" role="presentation">\n    <textarea placeholder="${this.localize("newComment")}"></textarea>\n    <smart-button class="send primary" disabled${this._rtlAttr}>${this.localize("send")}</smart-button>\n</div>`;const t=e.querySelector("textarea"),a=e.querySelector("smart-button");a.tabIndex=0,t.onfocus=()=>{e.classList.add("expanded"),a.disabled=""===t.value},t.onblur=t=>{a.contains(t.relatedTarget)||e.classList.remove("expanded")},t.onkeyup=()=>{a.disabled=""===t.value},t.oncut=()=>{a.disabled=""===t.value},t.onpaste=()=>{a.disabled=""===t.value},e.textarea=t,e.button=a,this._commentsList=e}_openCommentsList(e,t){const a=this,s=a._commentsList;s.classList.remove("expanded"),s.firstElementChild.innerHTML="",s.textarea.value="",s.textarea.disabled=!a._currentUser.allowComment,a.unfocusable?s.textarea.tabIndex=-1:s.textarea.removeAttribute("tabindex"),delete s.editing,t.data[a.dataSourceMap.comments].forEach(e=>a._createComment(e)),a._openList(e,s),a._commentSelectionFor=t}_createComment(e){const t=this,a=document.createElement("div");let s,r;function l(){const l=t._commentsList.firstElementChild;a.classList="comment",a.setAttribute("role","listitem"),a.innerHTML=`<div class="comment-indent" role="presentation">\n    <div class="user-icon" style="background-image: url('${r.image}');" role="img" aria-label="Icon of user ${r.name||r.id}"></div>\n</div>\n<div class="comment-main" role="presentation">\n    <div class="comment-header" role="presentation">\n        <div class="user-name" aria-label="User name">${r.name}</div>\n        <div class="time" aria-label="Comment time">${e.time?new Smart.Utilities.DateTime(e.time).toString(t.formatStringTime):""}</div>\n        <div class="remove-button${t._currentUser.info&&r.id===t._currentUser.info.id&&t._currentUser.allowComment?" enabled":""}"${t._tabindex} role="button" aria-haspopup="menu" aria-label="Comment settings"></div>\n    </div>\n    <div class="comment-body" aria-label="Comment text">${e.text||""}</div >\n</div>`,a.comment=e,l.appendChild(a),s&&(l.scrollTop=l.scrollHeight-l.offsetHeight)}if(e)r=t.users.find(t=>t.id===e.userId);else{const a=t.dataSourceMap,o=t.dataSource&&t.dataSource.virtualDataSource,n=t._commentsList.textarea.value,i=t._commentsList.editing,c=t._commentSelectionFor.data;if(i){if(o){const e=Object.assign({},c);e[a.comments]=e[a.comments].slice(0),e[a.comments][e[a.comments].indexOf(i.comment)]=Object.assign({},i.comment,{text:n}),t._requestVirtualDataSource("update",e,(function(a){return a&&(t._commentSelectionFor.data=e,i.querySelector(".comment-body").innerHTML=n),delete t._commentsList.editing,a}))}else i.querySelector(".comment-body").innerHTML=n,i.comment.text=n,delete t._commentsList.editing;return}if(s=!0,e={text:n,userId:t._currentUser.info.id,time:new Date},r=t._currentUser.info,o){const s=Object.assign({},c);s[a.comments]=s[a.comments].slice(0),s[a.comments].push(e),t._requestVirtualDataSource("update",s,(function(e){return e&&(t._commentSelectionFor.data=s,t._commentSelectionFor.querySelector(".smart-kanban-task-comments").setAttribute("num",s[a.comments].length||""),l()),e}))}else c[a.comments].push(e),t._commentSelectionFor.querySelector(".smart-kanban-task-comments").setAttribute("num",c[a.comments].length||"")}r&&(e.time instanceof Date==!1&&(e.time=new Date(e.time),e.time.setTime(e.time.getTime()-1*e.time.getTimezoneOffset()*60*1e3)),l())}_createTask(e,t){const a=this.dataSourceMap,s=this._allColumns.find(t=>t.dataField===e[a.status]);if(!s)return;const r=document.createElement("div"),l=this._columnToElement.get(s),o=this.getTaskScrollViewer(l,e);void 0===e[a.id]&&(e[a.id]=Math.floor(9e4*Math.random()+1e4)),r.className="smart-kanban-task smart-unselectable",r.setAttribute("role","listitem"),r.setAttribute("data-id",e[a.id]),r.data=e,this._renderTask(r),e.class&&"string"==typeof e.class&&r.classList.add(e.class),o.appendChild(r),this._updateTaskColor(r),t&&(s.collapsed?o.toRefresh=!0:o.refresh())}getTaskScrollViewer(e,t){const a=this,s=a.dataSourceMap;let r;return a._hasSwimlane(e.index)?void 0!==t[s.swimlane]&&a.swimlanes.find(e=>e.dataField===t[s.swimlane])?r=e.querySelector(`smart-scroll-viewer[swimlane="${t[s.swimlane]}"]`):(r=e.querySelector("smart-scroll-viewer"),t[s.swimlane]=r.getAttribute("swimlane")):(r=e.querySelector("smart-scroll-viewer"),delete t[s.swimlane]),r}_renderTask(e){const t=this;t._applyTaskTemplate(e),t._updateUserIcon(e),t._updateTaskChecked(e),t._updateTaskProgress(e),t._updateTaskDueDate(e),e.parentElement&&t._updateTaskColor(e)}_applyTaskTemplate(e){const t=this,a=t.dataSourceMap,s=t.tags,r=e.data,l=t._tabindex;let o=r[a.text],n=r[a.tags],i="";void 0===o&&(o="",r[a.text]=""),o=t._applyTextTemplate(o,r,e),n&&"string"==typeof n?(n=n.replace(/\s+/g,"").split(","),s.length>0?(n=n.filter(e=>-1!==s.indexOf(e)),r[a.tags]=n.join(", ")):n.forEach(e=>{-1===t._customTags.indexOf(e)&&t._customTags.push(e)}),i=n.map(e=>`<span class="smart-kanban-task-tag" role="listitem">${e}</span>`).join("")):r[a.tags]="","string"==typeof r[a.priority]&&(r[a.priority]=r[a.priority].toLowerCase()),"high"!==r[a.priority]&&"low"!==r[a.priority]&&(r[t.dataSourceMap.priority]="normal"),r[a.comments]&&Array.isArray(r[a.comments])||(r[a.comments]=[]),e.innerHTML=`<div class="smart-kanban-task-content" role="presentation">\n    <div class="smart-kanban-task-text ${r[a.priority]}">${o}</div>\n    <div class="smart-kanban-task-user"${l} role="button" aria-haspopup="listbox"></div>\n</div>\n<div class="smart-kanban-task-info" role="presentation">\n    <div class="smart-kanban-task-progress-container">\n        <div class="smart-kanban-task-progress" role="progressbar" aria-label="Task progress" aria-valuemin="0" aria-valuemax="100"></div>\n        <div class="smart-kanban-task-checked" aria-label="Completed sub-tasks"></div>\n    </div>\n    <div class="smart-kanban-task-due" aria-label="Task due date"></div>\n</div>\n<div class="smart-kanban-task-footer" role="toolbar" aria-label="Task footer">\n    <div class="smart-kanban-task-tags" role="list" aria-label="Tags list">${i}</div>\n    <div class="smart-kanban-task-actions"${l} role="button" aria-haspopup="menu" aria-label="Open actions list"></div>\n    <div class="smart-kanban-task-comments"${l} num="${r[a.comments].length||""}" role="button" aria-haspopup="dialog" aria-label="Open comments list"></div>\n</div>`,e.setAttribute("aria-label",r[a.text])}_applyTextTemplate(e,t,a){const s=this;let r=this.textTemplate;if(!r)return e;let l="";if("function"==typeof r){const s={data:t,task:a,text:e,template:null};if(r(s),e=s.text,null===s.template)return e;r=s.template}if(r.startsWith("#")){const a=document.querySelector(r);if(a&&a instanceof HTMLTemplateElement){const r=a.content.cloneNode(!0),o=document.createElement("div");return o.appendChild(r),e=(e=(e=e.toString()).replace(/'/gi,"\\'")).replace(/"/gi,'\\"'),l=o.innerHTML.replace(/{{text}}/gi,e).replace(/{{id}}/gi,t[s.dataSourceMap.id]),l.indexOf("{{text=")>=0&&(e?(l=l.substring(0,l.indexOf("{{text="))+e+l.substring(l.indexOf("}")),l=l.replace(/}/gi,""),l=l.replace(/{/gi,"")):(l=l.replace(/{{text=/gi,""),l=l.replace(/}}/gi,""))),l}}return l=r.replace(/{{text}}/gi,e).replace(/{{id}}/gi,t[s.dataSourceMap.id]),l}_updateUserIcon(e){const t=this.dataSourceMap,a=e.data,s=e.getElementsByClassName("smart-kanban-task-user")[0];if(void 0!==a[t.userId]&&null!==a[t.userId]){const e=this.users.find(e=>e.id.toString()===a[t.userId].toString());if(e)return a[t.userId]!==e.id&&(a[t.userId]=e.id),s.classList.remove("empty"),s.style.backgroundImage='url("'+e.image+'")',void s.setAttribute("aria-label","Icon of user "+(e.name||e.id))}a[t.userId]=null,s.classList.add("empty"),s.style.backgroundImage=null,s.setAttribute("aria-label","Empty user icon")}_updateTaskProgress(e){const t=this.dataSourceMap,a=e.data,s=e.querySelector(".smart-kanban-task-progress");let r=a[t.progress];return void 0===r?(a[t.progress]=null,void s.setAttribute("aria-valuenow",0)):(r=parseFloat(r),isNaN(r)?(a[t.progress]=null,void s.setAttribute("aria-valuenow",0)):(r=Math.max(0,Math.min(parseFloat(r),100)),a[t.progress]=r,s.style.width=r+"%",s.classList.toggle("bottom",null!==a[t.checklist]),void s.setAttribute("aria-valuenow",r)))}_updateTaskChecked(e){const t=this.dataSourceMap,a=e.data,s=a[t.checklist],r=e.querySelector(".smart-kanban-task-checked");s&&Array.isArray(s)&&s.length>0?r.innerHTML=this._getCompletedSubTasks(s):(a[t.checklist]=null,r.innerHTML="")}_getCompletedSubTasks(e){if(null===e)return"";let t=0;return e.forEach(e=>e.completed&&t++),t+"/"+e.length}_updateTaskDueDate(e){const t=this.dataSourceMap;let a=e.data,s=a[t.dueDate],r=e.querySelector(".smart-kanban-task-due");"string"==typeof s&&(s=new Date(s),s.setTime(s.getTime()-1*s.getTimezoneOffset()*60*1e3),a[t.dueDate]=s),s?(r.innerHTML=new Smart.Utilities.DateTime(s).toString(this.formatStringDate),r.classList.toggle("overdue",s.getTime()<(new Date).getTime()&&100!==a[t.progress])):(a[t.dueDate]=null,r.innerHTML="",r.classList.remove("overdue")),a[t.startDate]?"string"==typeof a[t.startDate]&&(a[t.startDate]=new Date(a[t.startDate]),a[t.startDate].setTime(a[t.startDate].getTime()-1*a[t.startDate].getTimezoneOffset()*60*1e3)):a[t.startDate]=null}_updateTaskColor(e){const t=this,a=t.dataSourceMap,s=e.data,r=e.querySelector(".smart-kanban-task-progress-container"),l=e.querySelector(".smart-kanban-task-progress"),o=t.rightToLeft?"borderRightColor":"borderLeftColor";function n(e){let t=parseFloat(e).toString(16);return t="0".repeat(2-t.length)+t,t.toUpperCase()}if(e.style.borderLeftColor=null,e.style.borderRightColor=null,s[a.color]){e.style[o]=s[a.color];const c=getComputedStyle(e)[o],d="dark"===t.theme?.4:.1;s[a.color]=(i=(i=c).match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/))?"#"+n(i[1])+n(i[2])+n(i[3]):null,r.style.backgroundColor=`rgba(${c.slice(4,c.length-1)}, ${d})`,l.style.backgroundColor=c}else s[a.color]=null,r.style.backgroundColor=null,l.style.backgroundColor=null;var i}_validateSwimlanes(){const e=this,t=e.swimlanesFrom,a=e.swimlanesTo,s=[];t<0&&(e.swimlanesFrom=0),null!==a&&t>a&&(e.swimlanesFrom=a),e.swimlanes.forEach(e=>{"string"==typeof e&&(e={dataField:e,label:e}),(e.dataField||e.label)&&(e.label||(e.label=e.dataField),e.dataField||(e.dataField=e.label),s.push(e))}),e.swimlanes=s}_handleSwimlanes(e){const t=this,a=t.swimlanes;if(0===a.length||0===t.columns.length)return;const s=t.columns,r=parseFloat(getComputedStyle(t).getPropertyValue("--smart-kanban-header-size")),l=t.$.container,o=t.$.container.getBoundingClientRect(),n=t.$.container.querySelectorAll(".smart-kanban-column.has-swimlane");let i=n[0],c=n[n.length-1];if(t.rightToLeft){let e=i;i=c,c=e}const d=i.getBoundingClientRect(),u=n.length>1?c.getBoundingClientRect():d,m=Array.from(i.getElementsByTagName("smart-scroll-viewer"));let h,p,b,g,f=!1,_=!0,v=t.swimlanesTo;null===v&&(v=s.length-1),e&&(h=l.getElementsByClassName("swimlane")),i.column.collapsed&&(i.classList.remove("collapsed"),f=!0);for(let e=t.swimlanesFrom;e<=v;e++)_=_&&s[e].collapsed;_||(p=u.right-d.left+"px",b=d.left-o.left+"px",g=m.map(e=>e.getBoundingClientRect().top-o.top-r-t._dataViewPadding+"px")),a.forEach((t,a)=>{let s;e?s=h[a]:(s=document.createElement("div"),s.innerHTML=`<div class="swimlane-label">${t.label}</div>`,s.className="swimlane",s.setAttribute("role","heading"),s.setAttribute("aria-level",2),t.color&&(s.style.backgroundColor=t.color)),s.classList.toggle("smart-visibility-hidden",_),_||(s.style.width=p,s.style.left=b,s.style.top=g[a]),e||l.appendChild(s)}),f&&i.classList.add("collapsed")}_renderColumns(){const e=this,t=e.collapsible,a=[],s=e.$.body,r=document.createDocumentFragment();let l=e.columns;if(e._columnToElement=new Map,e._columnContainers=[],0===l.length){const t=e.dataSource;t&&0!==t.length&&(l=[],t.forEach(t=>{const a=t[e.dataSourceMap.status];a&&-1===l.indexOf(a)&&l.push(a)}))}!function e(a,s,r){const l=[];let o=0;if(a.forEach(a=>{"string"==typeof a&&(a={dataField:a,label:a}),(a.dataField||a.label)&&(a.label||(a.label=a.dataField),a.dataField||(a.dataField=a.label),"horizontal"!==a.orientation&&(a.orientation="vertical"),!1!==a.collapsible&&(a.collapsible=!0),a.collapsed&&t&&a.collapsible?o++:a.collapsed=!1,!1!==a.addNewButton&&(a.addNewButton=!0),0===r?delete a.selected:!0===a.selected?l.push(a):a.selected=!1,a.columns&&(a.validColumns=[],e(a.columns,a.validColumns,r+1),a.columns=a.validColumns,delete a.validColumns),s.push(a))}),o&&o===s.length&&(s[0].collapsed=!1),l.length>1)for(let e=l.length-2;e>=0;e--)l[e].selected=!1;else r>0&&0===l.length&&s.length>0&&(s[0].selected=!0)}(l,a,0),e.columns=a,0===e.swimlanes.length?"columns"===e.hierarchy?e._createColumnElements(a,r,s,1):e._createColumnElementsTabs(a,r,s):e._createColumnElementsSwimlanes(a,r,s),s.appendChild(r),e._selectedTabs=e._allColumns.filter(e=>e.selected).map(e=>e.dataField),e._autoSaveState("tabs")}_createColumnElements(e,t,a,s){const r=this,l=r.id,o=[],n=[];let i=0;return e.forEach((a,c)=>{const d=document.createElement("div");let u=`${r._getColumnHeader(a,c<e.length-1,s)}\n                <div class="smart-kanban-column-contentAAA" role="presentation">\n                    <smart-scroll-viewer class="smart-kanban-column-content-tasks"${r._rtlAttr}${r._tabindex} role="list"></smart-scroll-viewer>BBB\n                </div>`,m=0;if(a.columns?(u=u.replace("AAA",""),u=u.replace("BBB",'<div class="smart-kanban-column-content-columns" role="presentation"></div>')):(u=u.replace("AAA"," no-sub-columns"),u=u.replace("BBB","")),d.className="smart-kanban-column",d.setAttribute("role","group"),d.setAttribute("aria-labelledby",`${l}ColumnHeaderLabel${a.dataField}`),d.setAttribute("orientation",a.orientation),a.collapsible&&d.setAttribute("collapsible",""),a.addNewButton&&d.setAttribute("add-new-button",""),d.innerHTML=u,d.siblingColumns=e,t.appendChild(d),d.column=a,d.index=c,r._columnToElement.set(a,d),a.columns){const e=d.querySelector(".smart-kanban-column-content-columns");m=r._createColumnElements(a.columns,e,e,s+1),i+=m}else i+=1;const h=(m||1)+"fr";a.collapsed?(d.classList.add("collapsed"),o.push("auto")):o.push(h),n.push(h),r._allColumns.push(a)}),1===s&&r.addNewColumn&&(r._appendAddNewColumn(t),o.push("var(--smart-kanban-add-new-column-width)")),a.style.gridTemplateColumns=o.join(" "),a.fractions=n,r._columnContainers.push(a),i}_createColumnElementsTabs(e,t,a,s){const r=this,l=r.id,o=[],n=[];e.forEach((a,i)=>{const c=document.createElement("div");let d=`<div class="smart-kanban-column-contentAAA" role="presentation">\n                    <smart-scroll-viewer class="smart-kanban-column-content-tasks"${r._rtlAttr}${r._tabindex} role="list"></smart-scroll-viewer>BBB\n                </div>`;if(a.columns?(d=d.replace("AAA",""),d=d.replace("BBB",'<div class="smart-kanban-column-content-columns has-tabs" role="presentation"></div>')):(d=d.replace("AAA"," no-sub-columns"),d=d.replace("BBB","")),c.className="smart-kanban-column",c.setAttribute("orientation",a.orientation),a.collapsible&&c.setAttribute("collapsible",""),a.addNewButton&&c.setAttribute("add-new-button",""),s){const e=document.createElement("div"),t=`${l}Tab${a.dataField}`,o=`${l}Column${a.dataField}`;e.id=t,e.className="smart-kanban-tab smart-unselectable",r.disabled||r.unfocusable||(e.tabIndex=0),e.setAttribute("role","tab"),e.setAttribute("aria-controls",o),e.innerHTML=`<div class="smart-kanban-tab-label">${a.label}</div>`,e.columnElement=c,c.id=o,c.setAttribute("role","tabpanel"),c.setAttribute("aria-labelledby",t),c.tab=e,s.appendChild(e),a.selected?e.classList.add("selected"):c.classList.add("smart-hidden"),e.setAttribute("aria-selected",a.selected)}else d=r._getColumnHeader(a,i<e.length-1)+d,c.setAttribute("role","group"),c.setAttribute("aria-labelledby",`${l}ColumnHeaderLabel${a.dataField}`);if(c.innerHTML=d,c.siblingColumns=e,t.appendChild(c),c.column=a,c.index=i,r._columnToElement.set(a,c),a.columns){const e=c.querySelector(".smart-kanban-column-content-columns"),t=document.createElement("div");t.className="smart-kanban-tab-strip",t.setAttribute("role","tablist"),e.appendChild(t),r._createColumnElementsTabs(a.columns,e,e,t)}s||(a.collapsed?(c.classList.add("collapsed"),o.push("auto")):o.push("1fr"),n.push("1fr")),r._allColumns.push(a)}),s||(r.addNewColumn&&(r._appendAddNewColumn(t),o.push("var(--smart-kanban-add-new-column-width)")),a.style.gridTemplateColumns=o.join(" "),a.fractions=n,r._columnContainers.push(a))}_createColumnElementsSwimlanes(e,t,a){const s=this,r=s.id,l=s.swimlanes,o=[],n=[];e.forEach((a,i)=>{const c=document.createElement("div");let d=`${s._getColumnHeader(a,i<e.length-1)}\n                <div class="smart-kanban-column-content no-sub-columns" role="presentation"></div>`;c.className="smart-kanban-column",c.setAttribute("role","group"),c.setAttribute("aria-labelledby",`${r}ColumnHeaderLabel${a.dataField}`),c.setAttribute("orientation",a.orientation),a.collapsible&&c.setAttribute("collapsible",""),a.addNewButton&&c.setAttribute("add-new-button",""),c.innerHTML=d,c.siblingColumns=e;const u=c.children[1];let m="";if(s._hasSwimlane(i)){let e=[];for(let t=0;t<l.length;t++)m+=`<smart-scroll-viewer class="smart-kanban-column-content-tasks" swimlane="${l[t].dataField}"${s._rtlAttr}${s._tabindex} role="list"></smart-scroll-viewer>`,e.push("1fr");c.classList.add("has-swimlane"),u.classList.add("has-swimlane"),u.style.gridTemplateRows=e.join(" ")}else m=`<smart-scroll-viewer class="smart-kanban-column-content-tasks"${s._rtlAttr}${s._tabindex} role="list"></smart-scroll-viewer>`;u.innerHTML=m,t.appendChild(c),c.column=a,c.index=i,s._columnToElement.set(a,c),a.collapsed?(c.classList.add("collapsed"),o.push("auto")):o.push("1fr"),n.push("1fr"),s._allColumns.push(a)}),s.addNewColumn&&(s._appendAddNewColumn(t),o.push("var(--smart-kanban-add-new-column-width)")),a.style.gridTemplateColumns=o.join(" "),a.fractions=n,s._columnContainers.push(a)}_getColumnHeader(e,t,a=1){const s=this._tabindex;return`<div class="smart-kanban-column-header smart-unselectable"${s} role="heading" aria-level=${a}>\n                    <div class="smart-kanban-column-header-add"${s} role="button" aria-label="Add new task"></div>\n                    <div id="${this.id}ColumnHeaderLabel${e.dataField}" class="smart-kanban-column-header-label">${e.label}</div>\n                    <div class="smart-arrow smart-arrow-${t?"left":"right"}" aria-hidden="true"></div>\n                </div>`}_hasSwimlane(e){const t=this;if(0===t.swimlanes.length)return!1;const a=t.swimlanesFrom;let s=t.swimlanesTo;return null===s&&(s=t.columns.length-1),e>=a&&e<=s}_updateColumnWidths(e,t){const a=t.fractions,s=[];for(let t=0;t<e.length;t++)s.push(e[t].collapsed?"auto":a[t]);t===this.$.body&&this.addNewColumn&&s.push("var(--smart-kanban-add-new-column-width)"),t.style.gridTemplateColumns=s.join(" ")}_validateColumnArgument(e){if(!isNaN(e))return this.columns[e];const t=this._allColumns;return"string"==typeof e?t.find(t=>t.dataField===e):"object"==typeof e?t.find(t=>t===e):null}_resizeHandler(){this.refresh("resize")}refresh(e){const t=this;"resize"===e?(clearTimeout(t._resizeTimeout),t._resizeTimeout=setTimeout((function(){t._allColumns.forEach(e=>t._refreshScrollViewer(e))}),50),t._handleSwimlanes(!0)):(t.closePanel(),t._closeList(t._actionsList,"_actionSelectionFor"),t._closeList(t._commentsList,"_commentSelectionFor"),t._closeList(t._userList,"_userSelectionFor"),t._render())}_refreshScrollViewer(e,t){const a=this,s=e instanceof HTMLElement?e:this._columnToElement.get(e);function r(r,l){(t||""!==r.$.scrollViewerContentContainer.innerHTML.trim())&&(e.collapsed?r.toRefresh=!0:(delete r.toRefresh,requestAnimationFrame(()=>{r.refresh(),0===l&&"horizontal"===e.orientation&&(r.$.content.offsetWidth<=2*a._kanbanTaskMinWidth+a._dataViewPadding?s.setAttribute("orientation","vertical"):"vertical"===s.getAttribute("orientation")&&s.setAttribute("orientation","horizontal"))})))}e instanceof Smart.ScrollViewer?r(e):this.swimlanes.length>0?Array.from(s.querySelectorAll("smart-scroll-viewer")).forEach((e,t)=>r(e,t)):r(s.querySelector("smart-scroll-viewer"),0)}_containerDownHandler(e){const t=this,a=(t.isInShadowDOM||t.shadowRoot?e.originalEvent.composedPath()[0]:e.originalEvent.target).closest(".smart-kanban-task");delete t._preventSelection,a&&(t._focusTask(a),t._startDragging(a,e))}_containerKeydownHandler(e){const t=this;if(t._dragDetails)return;const a=e.key,s=t.isInShadowDOM||t.shadowRoot?e.composedPath()[0]:e.target;function r(a=s){delete t._preventSelection,t._documentUpHandler({originalEvent:{target:a}}),t._containerClickHandler({target:a,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey}),e.preventDefault()}if(s.closest(".smart-kanban-column, .smart-kanban-add-new-column"))return s.classList.contains("smart-kanban-column-content-tasks")?void t._selectViaKeyboard(s.$.content,e,r):void("Enter"!==a&&" "!==a||s instanceof HTMLInputElement!=!1||r());if(t.$.headerDropDown.contains(s))"Escape"===a&&(t.closePanel(),t.$[/\s?([a-z]+)-panel/g.exec(t.$.headerDropDown.className)[1]+"Button"].focus());else if(!(s.classList.contains("smart-data-view-header-button")||s.closest(".smart-data-view-search-box")||s.classList.contains("remove-button"))||"Enter"!==a&&" "!==a||r(),s.classList.contains("smart-kanban-list")){const l=s;switch(a){case"ArrowDown":t._selectListItem(t._getNextItem(l));break;case"ArrowUp":t._selectListItem(t._getPrevItem(l));break;case"Home":t._selectListItem(t._getFirstItem(l));break;case"End":t._selectListItem(t._getLastItem(l));break;case"Escape":l.openedFrom.focus(),t._closeList(l,l===t._actionsList?"_actionSelectionFor":l===t._commentsList?"_commentSelectionFor":"_userSelectionFor");break;case"Enter":case" ":{const e=t._getSelectedItem(l);e&&r(e);break}default:return}e.preventDefault()}else;}_selectViaKeyboard(e,t,a){const s=this;let r=t.key;switch(s.rightToLeft&&("ArrowRight"===r?r="ArrowLeft":"ArrowLeft"===r&&(r="ArrowRight")),r){case"ArrowDown":case"ArrowRight":s._focusTask(s._getNextItem(e,!0));break;case"ArrowUp":case"ArrowLeft":s._focusTask(s._getPrevItem(e,!0));break;case"Home":s._focusTask(s._getFirstItem(e));break;case"End":s._focusTask(s._getLastItem(e));break;case"Enter":case" ":case"F2":case"Delete":{const t=s._getSelectedItem(e,!0);t&&("F2"===r?s.beginEdit(t):"Delete"===r?s.removeTask(t,!0):a(t));break}default:return}t.preventDefault()}_getFirstItem(e){const t=e.children;for(let e=0;e<t.length;e++){const a=t[e];if(!a.hasAttribute("disabled")&&"none"!==getComputedStyle(a).display)return a}}_getLastItem(e){const t=e.children;for(let e=t.length-1;e>=0;e--){const a=t[e];if(!a.hasAttribute("disabled")&&"none"!==getComputedStyle(a).display)return a}}_getPrevItem(e,t){const a=this._getSelectedItem(e,t);let s=a?a.previousElementSibling:this._getLastItem(e);for(;s;){if(!s.hasAttribute("disabled")&&"none"!==getComputedStyle(s).display)return s;s=s.previousElementSibling}}_getNextItem(e,t){const a=this._getSelectedItem(e,t);let s=a?a.nextElementSibling:this._getFirstItem(e);for(;s;){if(!s.hasAttribute("disabled")&&"none"!==getComputedStyle(s).display)return s;s=s.nextElementSibling}}_getSelectedItem(e,t){return t?e.querySelector("[focus]"):e.querySelector(".selected")}_selectListItem(e){if(!e)return;const t=e.parentElement,a=t.querySelector(".selected");a&&(a.classList.remove("selected"),a.removeAttribute("aria-selected")),e.classList.add("selected"),e.setAttribute("aria-selected",!0),t.scrollTop=e.offsetTop}_focusTask(e){if(!e)return;Array.from(e.parentElement.querySelectorAll("[focus]")).forEach(e=>e.removeAttribute("focus")),e.setAttribute("focus",""),this.ensureVisible(e)}_setFocusable(){const e=this,t=e.$.container,a=e.disabled||e.unfocusable;let s=[e.$.customizeButton,e.$.filterButton,e.$.sortButton,e.$.searchButton,e.$.searchPrev,e.$.searchNext,e.$.searchClose,e._actionsList,e._userList];if(s=s.concat(Array.from(t.querySelectorAll(".smart-kanban-column-header, .smart-kanban-column-header-add, .smart-kanban-tab, .smart-kanban-column-content-tasks, .smart-kanban-task-user, .smart-kanban-task-actions, .smart-kanban-task-comments, .smart-kanban-add-new-column"))),s.forEach(e=>{a?e.removeAttribute("tabindex"):(null===e.getAttribute("tabindex")||e.getAttribute("tabindex")<0)&&e.setAttribute("tabindex",0)}),e._dialog&&e._dialog.editPanelPopulated){const t=Array.from(e._dialog.$.container.querySelectorAll(".text-editor, .new-subtask"));a?t.forEach(e=>e.tabIndex=-1):t.forEach(e=>e.removeAttribute("tabindex")),Array.from(e._dialog.$.container.querySelectorAll(".smart-element.editor, smart-button.add, smart-button.ok, smart-button.cancel")).forEach(e=>e.unfocusable=a),e._dialog.unfocusable=a}}_startDragging(e,t){const a=this;if(!a._currentUser.allowDrag)return;const s=e.closest("smart-scroll-viewer"),r=e.getBoundingClientRect();let l=e.hasAttribute("selected")?Array.from(e.parentElement.querySelectorAll("[selected]")):[e];a._dragDetails={StartPosition:{left:t.pageX,top:t.pageY},Items:l,Item:e,FeedbackShown:!1,OriginalEvent:t,PointerOffset:[r.x-t.clientX,r.y-t.clientY],ScrollViewer:s,StartTime:new Date,Dragging:!0},Smart.Kanban.kanbanTaskDragged=!0,s._scrollView.disableSwipeScroll=!0,a.allowDrop&&(Smart.Kanban.hoveredKanban=a,Smart.Kanban.hoveredItem=e)}_documentMoveHandler(e){const t=this,a=t._dragDetails;function s(){delete t._dragDetails,delete Smart.Kanban.kanbanTaskDragged,delete Smart.Kanban.hoveredKanban,delete Smart.Kanban.hoveredItem,a.ScrollViewer._scrollView.disableSwipeScroll=!1}if(!a)return;if(!a.FeedbackShown){const r=(new Date).getTime()-a.StartTime.getTime()>500,l=Math.abs(a.StartPosition.left-e.pageX)>5||Math.abs(a.StartPosition.top-e.pageY)>5;if(!l||!(!t._isMobile||t._isMobile&&r))return void(t._isMobile&&l&&!r&&s());if(t.$.fireEvent("dragStart",{item:a.Item,items:a.Items,data:a,container:t,previousContainer:t,originalEvent:a.OriginalEvent}).defaultPrevented)return void s();t.closePanel(),t._hideBodyOverflow(),a.Feedback=t._addDragFeedback(),a.FeedbackShown=!0,a.Items.forEach(e=>e.classList.add("dragged"))}let r,l=t.dragOffset;if(l="auto"!==l&&Array.isArray(l)?l:a.PointerOffset,t.$.fireEvent("dragging",{item:a.Item,items:a.Items,data:a,originalEvent:e}),a.Feedback.style.left=e.pageX+(l[0]||0)+"px",a.Feedback.style.top=e.pageY+(l[1]||0)+"px",Smart.Kanban.hoveredKanban&&(clearInterval(Smart.Kanban.hoveredKanban._dragInterval),delete Smart.Kanban.hoveredKanban),Smart.Kanban.hoveredItem&&(Smart.Kanban.hoveredItem.classList.remove("drop-target"),Smart.Kanban.hoveredItem.classList.remove("before","after"),delete Smart.Kanban.hoveredItem),r=t._isMobile?(t.shadowRoot||t.getRootNode()).elementFromPoint(e.clientX,e.clientY):t.isInShadowDOM||t.shadowRoot?e.originalEvent.composedPath()[0]:e.originalEvent.target,!r)return;const o=(t.shadowRoot?r.getRootNode().host:r).closest("smart-kanban");if(!o||!o.allowDrop)return;const n=r.closest(".smart-kanban-column-content-tasks");if(Smart.Kanban.hoveredKanban=o,!n)return;const i=n.parentElement.parentElement.getAttribute("orientation"),c=Array.from(n.$.content.children);let d=0;if(c.forEach(e=>e.filteredOut&&d++),0===c.length||c.length===d)return Smart.Kanban.hoveredItem=n.$.scrollViewerContainer,void Smart.Kanban.hoveredItem.classList.add("drop-target");n.scrollHeight>0&&(o._dragInterval=setInterval((function(){const a=n.getBoundingClientRect();a.left<=e.clientX&&a.left+a.width>=e.clientX?e.clientY>=a.top&&e.clientY<=a.top+20?n.scrollTop-=t._autoScrollCoefficient:e.clientY>=a.top+a.height-20&&e.clientY<=a.top+a.height?n.scrollTop+=t._autoScrollCoefficient:clearInterval(o._dragInterval):clearInterval(o._dragInterval)}),2));let u=r.closest(".smart-kanban-task");if(u&&-1===a.Items.indexOf(u)){const t=u.getBoundingClientRect();"vertical"===i&&e.clientY-t.top<=t.height/2||"horizontal"===i&&e.clientX-t.left<=t.width/2?u.classList.add("before"):u.classList.add("after")}else{if(u&&1===c.length)return;u=u&&1===a.Items.length?t[`_${i}ClosestTaskToHover`]([u.previousElementSibling,u.nextElementSibling],e,!0):t[`_${i}ClosestTaskToHover`](c,e,u||r===n.$.content)}u&&(u.classList.add("drop-target"),Smart.Kanban.hoveredItem=u)}_hideBodyOverflow(){const e=(document.scrollingElement||document.documentElement).scrollHeight>document.documentElement.clientHeight,t=(document.scrollingElement||document.documentElement).scrollWidth>document.documentElement.clientWidth,a=this.isInShadowDOM?this.getRootNode().host:document.body;this._originalBodyOverflow={overflowX:a.style.overflowX,overflowY:a.style.overflowY,overflow:a.style.overflow},a.classList.add("smart-dragging"),a.style.overflow=a.style.overflowX=a.style.overflowY="",e&&!t?a.style.overflowX="hidden":t&&!e?a.style.overflowY="hidden":t||e||(a.style.overflow="hidden")}_verticalClosestTaskToHover(e,t,a){const s=this._dragDetails.Items,r=t.clientY;let l,o,n=1/0,i=0,c=e.length-1,d=1;for(a||(i=c,c=0,d=-1);i!==c+d;){const t=e[i];if(i+=d,!t||t.filteredOut||-1!==s.indexOf(t))continue;if(!a){l=t,o="after";break}const c=t.getBoundingClientRect(),u=c.top+c.height/2,m=Math.abs(r-u);if(!(m<n))break;n=m,l=t,o=r<=u?"before":"after"}return l&&l.classList.add(o),l}_horizontalClosestTaskToHover(e,t){const a=this._dragDetails.Items,s=t.clientY,r=t.clientX;let l,o,n;return e.forEach(e=>{if(!e||e.filteredOut||-1!==a.indexOf(e))return;const t=e.getBoundingClientRect(),i=Math.abs(s-t.top),c=Math.abs(s-t.bottom),d=Math.min(i,c),u=Math.abs(r-t.left),m=Math.abs(r-t.right),h=Math.min(u,m),p=Math.sqrt(Math.pow(h,2)+Math.pow(d,2));(void 0===o||p<o)&&(l=e,o=p,n=u<m?"before":"after")}),l&&l.classList.add(n),l}_scrollViewerTouchmoveHandler(e){this._dragDetails&&(this.isInShadowDOM||this.shadowRoot?e.composedPath()[0]:e.target).closest("smart-scroll-viewer")&&e.cancelable&&(e.preventDefault(),e.stopPropagation())}_documentUpHandler(e){const t=this,a=t._dragDetails;if(t.$.container.hasAttribute("modal"))return;const s=t.isInShadowDOM||t.shadowRoot?e.originalEvent.composedPath()[0]:e.originalEvent.target,r=t.$.header;if(t._userSelectionFor&&!t._userList.contains(s)&&t._closeList(t._userList,"_userSelectionFor"),t._actionSelectionFor&&!t._actionsList.contains(s)&&t._closeList(t._actionsList,"_actionSelectionFor"),t._commentSelectionFor){const e=t._commentsList;(t.shadowRoot||t.getRootNode()).activeElement!==e.textarea&&(t._actionSelectionFor||e.contains(s)?!e.classList.contains("expanded")||s===e.textarea||e.button.contains(s)||s.classList.contains("remove-button")||e.classList.remove("expanded"):t._closeList(e,"_commentSelectionFor"))}if(!("none"===t.headerPosition||t.$.headerDropDown.classList.contains("smart-visibility-hidden")||t.$.headerDropDown.classList.contains("search-panel")||s!==r&&r.contains(s))){const e=s.closest("smart-scroll-viewer"),a=s.closest(".smart-drop-down");e&&r.contains(e.ownerElement)||a&&(!a.ownerElement||r.contains(a.ownerElement))||t.closePanel()}if(!a)return;const l=Smart.Kanban.hoveredKanban,o=Smart.Kanban.hoveredItem;if(delete t._dragDetails,delete Smart.Kanban.kanbanTaskDragged,delete Smart.Kanban.hoveredKanban,delete Smart.Kanban.hoveredItem,a.ScrollViewer._scrollView.disableSwipeScroll=!1,!a.FeedbackShown)return;const n=l||(t.shadowRoot||t.getRootNode()).elementFromPoint(e.clientX,e.clientY);t._preventSelection=!0;const i=t.isInShadowDOM?t.getRootNode().host:document.body;i.classList.remove("smart-dragging"),i.style.overflow=t._originalBodyOverflow.overflow,i.style.eoverflowX=t._originalBodyOverflow.overflowX,i.style.overflowY=t._originalBodyOverflow.overflowY,delete t._originalBodyOverflow,a.Feedback.remove(),l&&clearInterval(l._dragInterval);const c=a.Item,d=a.Items;if(d.forEach(e=>e.classList.remove("dragged")),!n)return;if(!o)return void t.$.fireEvent("dragEnd",{item:c,items:d,target:n,data:a,previousContainer:t,container:n,originalEvent:e});if(!l||!l.allowDrop||l.disabled)return;let u=!1;if(o.classList.remove("drop-target"),o.classList.contains("before")?o.classList.remove("before"):o.classList.contains("after")&&(o.classList.remove("after"),u=!0),a.DropDetails={item:o,after:u},t.$.fireEvent("dragEnd",{item:c,items:d,target:o,data:a,previousContainer:t,container:l,originalEvent:e}).defaultPrevented)return;function m(e,s){t._requestVirtualDataSource("update",Object.assign({},e.data,{status:s}),(function(s){return s&&t._moveDraggedItems(Object.assign({},a,{Item:e,Items:[e]})),s}))}const h=o.closest(".smart-kanban-column").column.dataField;if(t.dataSource&&t.dataSource.virtualDataSource&&h!==c.data[t.dataSourceMap.status])if(u)for(let e=d.length-1;e>=0;e--)m(d[e],h);else for(const e of d)m(e,h);else t._moveDraggedItems(a)}_addDragFeedback(){const e=this,t=e._dragDetails.Item,a=e._dragDetails.Items.length,s=document.createElement("div"),r=t.cloneNode(!0),l=t.offsetWidth+"px",o=t.offsetHeight+"px";if(r.style.width=l,r.style.height=o,s.className="smart-kanban-feedback",s.setAttribute("parent-kanban-id",e.id),e.theme&&s.setAttribute("theme",e.theme),["rightToLeft","taskActions","taskComments","taskDue","taskPriority","taskProgress","taskTags","taskUserIcon"].forEach(t=>{e[t]&&s.setAttribute(Smart.Utilities.Core.toDash(t),"")}),s.appendChild(r),a>1){const e=document.createElement("div");e.style.width=l,e.style.height=o,e.className="smart-kanban-feedback-additional",s.insertBefore(e,r),r.setAttribute("num",a),a>2&&e.classList.add("multiple")}return e.getShadowRootOrBody().appendChild(s),s}_moveDraggedItems(e){const t=this,a=t.dataSourceMap;let s,r=e.DropDetails,l=r.item,o=l.closest(".smart-kanban-column"),n=e.Item.closest("smart-scroll-viewer"),i=o.column;if(l.classList.contains("smart-kanban-task")?(s=l.parentElement,r.after&&(l=l.nextElementSibling),e.Items.forEach(e=>{s.insertBefore(e,l),e.data[a.status]=i.dataField})):(s=l.firstElementChild,e.Items.forEach(e=>{s.appendChild(e),e.data[a.status]=i.dataField})),s=s.closest("smart-scroll-viewer"),t.swimlanes.length>0){const t=s.getAttribute("swimlane");t?e.Items.forEach(e=>e.data[a.swimlane]=t):e.Items.forEach(e=>delete e.data[a.swimlane])}t._focusTask(e.Item),n!==s&&(s.focus(),t.textTemplate&&e.Items.forEach(e=>t._renderTask(e)),e.Item.hasAttribute("selected")&&(e.Items.forEach(e=>e.removeAttribute("selected")),t._selectedTasks=[],t._autoSaveState("selection")),t._refreshScrollViewer(n,!0),t._refreshScrollViewer(s,!0)),t._autoSaveState("dataSource")}_getCurrentDataSource(){const e=Array.from(this.$.container.getElementsByClassName("smart-kanban-task")),t=[];for(let a=0;a<e.length;a++)t.push(e[a].data);return t}_validateTaskArgument(e){const t=this;return e instanceof HTMLElement&&t.$.container.contains(e)&&e.classList.contains("smart-kanban-task")?e:null===e||"number"!=typeof e&&"string"!=typeof e?void 0:t.$.container.querySelector(`.smart-kanban-task[data-id="${e}"]`)}_openDialog(e,t,a="task"){const s=this,r={purpose:t};if(r[a]=e,s.$.fireEvent("opening",r).defaultPrevented)return;s._dialog||s._createDialog();const l=s._dialog,o="prompt"===t;if(l.openedFrom=(s.shadowRoot||s.getRootNode()).activeElement,l.classList.toggle("prompt",o),l.classList.toggle("edit",!o),l.taskOrComment=e,o){const t="task"===a?s.localize("promptTask",{taskText:e.data[s.dataSourceMap.text]}):s.localize("promptComment");l.setAttribute("aria-label",t),l.headerPosition="none",l.$.container.querySelector(".prompt").innerHTML=t}else{let a=!0;l.removeAttribute("aria-label"),l.headerPosition="top",l.editPanelPopulated||(s._populateEditPanel(),a=!1),"edit"===t?s._beginEdit(e):"add"===t&&(l.label=s.localize("addNewTask"),delete l.taskOrComment,a&&s._clearEditors(),l.editors.status.value=e.label,l.editors.status.$.input.dataValue=e.dataField)}s.$.container.setAttribute("modal",""),l.open()}_createDialog(){const e=document.createElement("smart-window"),t=document.createElement("template"),a=` animation="${this.animation}"${this._rtlAttr} theme="${this.theme}"${this.unfocusable?" unfocusable":""}`;t.innerHTML=`<smart-button class="ok primary"${a}>${this.localize("ok")}</smart-button>\n<smart-button class="cancel"${a}>${this.localize("cancel")}</smart-button>`,e.animation=this.animation,e.footerTemplate=t,e.headerButtons=["close"],e.rightToLeft=this.rightToLeft,e.theme=this.theme,e.className="smart-kanban-window",e.innerHTML='<div class="prompt"></div>\n<div class="edit"></div>',e.ownerElement=this,this._dialog=e,this._addDialogHandlers(),this.getShadowRootOrBody().appendChild(e)}_addDialogHandlers(){const e=this._dialog;e.addEventListener("open",this._dialogEventHandler),e.addEventListener("closing",this._dialogEventHandler),e.addEventListener("close",this._dialogEventHandler),e.addEventListener("click",this._dialogClickHandler)}_dialogEventHandler(e){const t=this,a=t.ownerElement,s=e.type,r=a.context;if((t.isInShadowDOM||t.shadowRoot?e.composedPath()[0]:e.target)===t){if(a.context=a,"open"===s)a.$.fireEvent("open"),t.classList.contains("edit")&&(a.hasAnimation?t.addEventListener("transitionend",(function(){requestAnimationFrame(()=>t.editors.text.focus())}),{once:!0}):requestAnimationFrame(()=>t.editors.text.focus()));else if("closing"===s){a.$.fireEvent("closing").defaultPrevented&&(e.preventDefault(),delete t.ok)}else"close"===s&&(a.$.fireEvent("close"),a._dialogCloseHandler(e));a.context=r}}_dialogClickHandler(e){const t=this,a=t.isInShadowDOM||t.shadowRoot?e.composedPath()[0]:e.target;if(a.closest(".ok"))t.ok=!0,t.close();else if(a.closest(".cancel"))t.close();else if(a.closest(".add")){const e=t.editors.newSubtask,a=e.value;if(""===a)return;const s=t.editors.checklist;s.insert(s.items.length,{label:a}),e.value="",t.$.content.scrollTop=t.$.content.scrollHeight-t.$.content.offsetHeight}else a.classList.contains("remove-subtask")&&t.editors.checklist.removeChild(a.closest("smart-list-item"))}_dialogCloseHandler(){const e=this,t=e.dataSourceMap,a=e._dialog;function s(s){a.taskOrComment.remove(),s.querySelector(".smart-kanban-task-comments").setAttribute("num",s.data[t.comments].length||""),e._commentsList.editing&&(e._commentsList.textarea.value="",delete e._commentsList.editing)}if(e.$.container.removeAttribute("modal"),a.ok){if(a.classList.contains("prompt")){const r=e._commentSelectionFor;if(r){const l=r.data;if(e.dataSource&&e.dataSource.virtualDataSource){const o=Object.assign({},l);o[t.comments]=o[t.comments].filter(e=>e!==a.taskOrComment.comment),e._requestVirtualDataSource("update",o,(function(e){return e&&(r.data=o,s(r)),e}))}else l[t.comments]=l[t.comments].filter(e=>e!==a.taskOrComment.comment),s(r)}else e.removeTask(a.taskOrComment)}else e._endEdit();delete a.ok}a.openedFrom&&requestAnimationFrame(()=>{e.getRootNode().contains(a.openedFrom)&&a.openedFrom.focus&&a.openedFrom.focus(),delete a.openedFrom}),delete a.taskOrComment}_closeDialog(){const e=this;e._dialog&&e._dialog.close()}_populateEditPanel(){const e=this.id,t=this._dialog,a=t.$.container.querySelector(".edit"),s=this.users.map(e=>({label:e.name,value:e.id})),r=this._allColumns.map(e=>({label:e.label,value:e.dataField})),l=[{label:this.localize("low"),value:"low"},{label:this.localize("normal"),value:"normal"},{label:this.localize("high"),value:"high"}],o=this.swimlanes.map(e=>({label:e.label,value:e.dataField})),n=document.createElement("template"),i=` animation="${this.animation}"${this._rtlAttr} theme="${this.theme}"${this.unfocusable?" unfocusable":""}`;n.innerHTML=`<div class="smart-kanban-sub-task"><span class="label">{{label}}</span><span class="remove-subtask" aria-label="Remove subtask" title="${this.localize("removeSubtask")}"></span></div>`,n.id=this.id+"ChecklistTemplate",t.$.container.appendChild(n),a.innerHTML=`<div id="${e}LabelText" class="editor-label">${this.localize("text")}</div>\n<textarea class="editor text-editor" aria-labelledby="${e}LabelText"></textarea>\n<div id="${e}LabelTags" class="editor-label">${this.localize("tags")}</div>\n<smart-combo-box class="editor tags-editor" selection-mode="zeroOrMany" selection-display-mode="tokens"${i} aria-labelledby="${e}LabelTags"></smart-combo-box>\n<div class="editor-container">\n    <div id="${e}LabelStatus" class="editor-label">${this.localize("status")}</div>\n    <div id="${e}LabelSwimlane" class="editor-label">${this.localize("swimlane")}</div>\n    <smart-input class="editor status-editor" data-source='${JSON.stringify(r)}' drop-down-button-position="right" readonly${i} aria-labelledby="${e}LabelStatus"></smart-input>\n    <smart-input class="editor swimlane-editor" data-source='${JSON.stringify(o)}'${0===o.length?" disabled":""} drop-down-button-position="right" readonly${i} aria-labelledby="${e}LabelSwimlane"></smart-input>\n</div>\n<div class="editor-container">\n    <div id="${e}LabelAssignedTo" class="editor-label">${this.localize("assignedTo")}</div>\n    <div id="${e}LabelProgress" class="editor-label">${this.localize("progress")}</div>\n    <smart-input class="editor asignee-editor" data-source='${JSON.stringify(s)}'${0===s.length?" disabled":""} drop-down-button-position="right"${i} aria-labelledby="${e}LabelAssignedTo"></smart-input>\n    <smart-numeric-text-box class="editor progress-editor" input-format="floatingPoint" min="0" max="100" show-unit unit="%"${i} aria-labelledby="${e}LabelProgress"></smart-numeric-text-box>\n</div>\n<div class="editor-container">\n    <div id="${e}LabelStartDate" class="editor-label">${this.localize("startDate")}</div>\n    <div id="${e}LabelDueDate" class="editor-label">${this.localize("dueDate")}</div>\n    <smart-date-time-picker class="editor start-date-editor" calendar-button drop-down-append-to="body" drop-down-display-mode="calendar" format-string="${this.formatStringDate}" nullable${i} value="null" aria-labelledby="${e}LabelStartDate"></smart-date-time-picker>\n    <smart-date-time-picker class="editor due-date-editor" calendar-button drop-down-append-to="body" drop-down-display-mode="calendar" format-string="${this.formatStringDate}" nullable${i} value="null" aria-labelledby="${e}LabelDueDate"></smart-date-time-picker>\n</div>\n<div class="editor-container">\n    <div id="${e}LabelPriority" class="editor-label">${this.localize("priority")}</div>\n    <div id="${e}LabelColor" class="editor-label">${this.localize("color")}</div>\n    <smart-input class="editor priority-editor" data-source='${JSON.stringify(l)}' drop-down-button-position="right" readonly${i} aria-labelledby="${e}LabelPriority"></smart-input>\n    <smart-color-input class="editor color-editor" drop-down-button-position="right"${i} aria-labelledby="${e}LabelColor"></smart-color-input>\n</div>\n<div id="${e}LabelChecklist" class="editor-label">${this.localize("checklist")}</div>\n<div class="new-container">\n    <input type="text" class="new-subtask" placeholder="${this.localize("newSubtask")}" />\n    <smart-button class="add primary" title="${this.localize("addSubtask")}" aria-label="Add subtask"${i}>+</smart-button>\n</div>\n<smart-list-box class="editor checklist-editor" item-template="${n.id}" selection-mode="checkBox"${i} aria-labelledby="${e}LabelChecklist"></smart-list-box>`,t.editors={text:a.querySelector(".text-editor"),tags:a.querySelector(".tags-editor"),userId:a.querySelector(".asignee-editor"),status:a.querySelector(".status-editor"),swimlane:a.querySelector(".swimlane-editor"),startDate:a.querySelector(".start-date-editor"),dueDate:a.querySelector(".due-date-editor"),progress:a.querySelector(".progress-editor"),priority:a.querySelector(".priority-editor"),color:a.querySelector(".color-editor"),newSubtask:a.querySelector(".new-subtask"),checklist:a.querySelector(".checklist-editor")},t.editPanelPopulated=!0}_beginEdit(e){const t=this,a=t.dataSourceMap,s=e.data,r=t._dialog,l=r.editors,o=t.tags.length>0?t.tags:t._customTags,n=t._allColumns.find(e=>e.dataField===s[a.status]);r.label=t.localize("editTask",{taskId:s[a.id]}),l.text.value=s[a.text],l.tags.dataSource=o,l.tags.disabled=0===o.length,s[a.tags]?l.tags.selectedValues=s[a.tags].replace(/\s+/g,"").split(","):l.tags.selectedValues=[],l.userId.value=null!==s[a.userId]?t.users.find(e=>e.id===s[a.userId]).name:"",delete l.userId.$.input.dataValue,l.status.value=n.label,delete l.status.$.input.dataValue,t._hasSwimlane(t.columns.indexOf(n))?l.swimlane.value=t.swimlanes.find(e=>e.dataField===s[a.swimlane]).label:l.swimlane.value="",delete l.swimlane.$.input.dataValue,l.startDate.value=s[a.startDate]||null,l.dueDate.value=s[a.dueDate]||null,l.progress.value=parseFloat(s[a.progress])||0,l.priority.value=t.localize(s[a.priority]),delete l.priority.$.input.dataValue,l.color.value=s[a.color]||"";const i=[],c=[];(s[a.checklist]||[]).forEach((e,t)=>{e.completed&&i.push(t),c.push({label:e.text,selected:!0===e.completed})}),l.newSubtask.value="",l.checklist.dataSource=c,l.checklist.selectedIndexes=i}_endEdit(){const e=this,t=e.dataSourceMap,a=e._dialog,s=a.editors,r=a.taskOrComment,l=r?r.data:void 0,o=Object.assign({},l);let n=s.startDate.value,i=s.dueDate.value;o[t.text]=s.text.value,o[t.tags]=s.tags.selectedValues.join(", "),o[t.progress]=parseFloat(s.progress.value),o[t.color]=s.color.value,o[t.color]||delete o[t.color],void 0!==s.userId.$.input.dataValue&&(o[t.userId]=parseFloat(s.userId.$.input.dataValue)),s.status.$.input.dataValue&&(o[t.status]=s.status.$.input.dataValue),s.swimlane.$.input.dataValue&&(o[t.swimlane]=s.swimlane.$.input.dataValue),n&&(n=n.toDate()),i&&(i=i.toDate()),o[t.startDate]=n,o[t.dueDate]=i,s.priority.$.input.dataValue&&(o[t.priority]=s.priority.$.input.dataValue),o[t.checklist]=s.checklist.items.map(e=>({text:e.label,completed:e.selected})),r?e.updateTask(r,o):e.addTask(o)}_clearEditors(){const e=this._dialog.editors,t=this.tags.length>0?this.tags:this._customTags;e.text.value="",e.tags.dataSource=t,e.tags.disabled=0===t.length,e.tags.selectedValues=[],e.status.value="",delete e.status.$.input.dataValue,e.swimlane.value="",delete e.swimlane.$.input.dataValue,e.userId.value="",delete e.userId.$.input.dataValue,e.progress.value=0,e.startDate.value=null,e.dueDate.value=null,e.priority.value=this.localize("normal"),e.priority.$.input.dataValue="normal",e.color.value="",e.newSubtask.value="",e.checklist.dataSource=[],e.checklist.selectedIndexes=[]}_getCurrentUser(){const e=this.users;let t=this.currentUser,a=!0,s=!1,r=this.allowDrag,l=this.editable,o=!0;e&&null!==t&&(t=e.find(e=>e.id===t),t&&(a=!1!==t.allowAdd,s=!1!==t.allowComment,r=r&&!1!==t.allowDrag,l=l&&!1!==t.allowEdit,o=!1!==t.allowRemove)),this._currentUser={allowAdd:a,allowComment:s,allowDrag:r,allowEdit:l,allowRemove:o,info:t}}_autoSaveState(e){const t=this;if(t.autoSaveState)if("object"!=typeof e)if(e&&t._autoSavedState){switch(e){case"collapsed":t._allColumns.forEach(e=>t._autoSavedState.collapsed[e.dataField]=e.collapsed);break;case"dataSource":t._autoSavedState.dataSource=t._getCurrentDataSource();break;case"filtering":t._autoSavedState.filtering=t._appliedFiltering;break;case"selection":{const e=t.dataSourceMap;let a=null,s=null;t._selectionInView&&(a=t._selectionInView.closest(".smart-kanban-column").column.dataField,s=t._selectionInView.getAttribute("swimlane")),t._autoSavedState.selection={selected:t._selectedTasks.map(t=>t.data[e.id]),selectionStart:t._selectionStart?t._selectionStart.data[e.id]:null,selectionInColumn:a,swimlane:s};break}case"sorting":t._autoSaveState.sorting=t._appliedSorting;break;case"tabs":t._autoSaveState.tabs=t._selectedTabs;break;case"visibility":t._autoSavedState.visibility={taskActions:t.taskActions,taskComments:t.taskComments,taskDue:t.taskDue,taskPriority:t.taskPriority,taskProgress:t.taskProgress,taskTags:t.taskTags,taskUserIcon:t.taskUserIcon}}window.localStorage.setItem("smartKanban"+t.id,JSON.stringify(t._autoSavedState))}else t._autoSavedState=t.saveState();else t._autoSavedState=e}_applyFilter(e,t){const a=this;if(a.dataSource&&a.dataSource.virtualDataSource)return a._requestVirtualDataSource("filter"),void a._autoSaveState("filtering");const s=new Smart.DataAdapter({dataSource:a._getCurrentDataSource(),dataFields:["text: string","tags: string","priority: string","progress: number","startDate: date","dueDate: date","userId: string"],id:"id"});try{s._filter(e,t)}catch(e){return}const r=Array.from(a.$.container.getElementsByClassName("smart-kanban-task"));for(let e=0;e<s.length;e++){const t=r[e],a=!s[e].$.filtered;t.classList.toggle("smart-hidden",a),t.filteredOut=a}a._allColumns.forEach(e=>a._refreshScrollViewer(e)),a._autoSaveState("filtering")}_applyHandler(e){const t=this,a=t.isInShadowDOM||t.shadowRoot?e.composedPath()[0]:e.target,s=e.detail;t.$.customize.contains(a)?(s.value.forEach(e=>t[e.dataField]=e.visible),t._allColumns.forEach(e=>t._refreshScrollViewer(e)),t._autoSaveState("visibility")):t.$.filter.contains(a)?t.addFilter(s.filters,s.operator,s.value):t.$.sort.contains(a)&&t.addSort(s.sortByInfo),t.closePanel()}_applySort(){const e=this,t=e._appliedSorting;e._autoSaveState("sorting"),e.dataSource&&e.dataSource.virtualDataSource?e._requestVirtualDataSource("sort"):0!==t.dataFields.length&&e._allColumns.forEach(a=>{const s=e._columnToElement.get(a).querySelector(".smart-scroll-viewer-content-container"),r=Array.from(s.children),l=[];if(r.length<2)return;r.forEach((t,a)=>{const s=e.dataSourceMap,r=Object.assign({taskIndex:a},t.data);"low"===r[s.priority]&&(r[s.priority]="z"),l.push(r)});const o=new Smart.DataAdapter({dataSource:l,dataFields:["taskIndex: number","text: string","tags: string","priority: string","progress: number","startDate: date","dueDate: date","userId: string"],id:"id"});o.sortBy(t.dataFields,t.dataTypes,t.orderBy);for(let e=0;e<o.length;e++)s.appendChild(r[o[e].taskIndex])})}_closeSearchPanel(){const e=this;e._searchInfo&&(Array.from(e.$.container.querySelectorAll(".smart-kanban-task.smart-data-view-found, .smart-kanban-task.smart-data-view-highlighted")).forEach(e=>e.classList.remove("smart-data-view-found","smart-data-view-highlighted")),delete e._searchInfo)}_constructFilterGroups(e){const t={text:"string",tags:"string",priority:"string",progress:"number",startDate:"date",dueDate:"date"},a={},s=[];e.filters.forEach(s=>{const r=s[0],l=t[r];let o=s[2],n=a[r];void 0===n&&(n=new Smart.Utilities.FilterGroup,a[r]=n),"date"===l&&"string"==typeof o&&(o=new Date(o));const i=n.createFilter(l,o,s[1]);n.addFilter(e.operator,i)});for(let e in a)s.push([e,a[e]]);return s}_openSearchPanel(){const e=this;e.$.headerDropDown.classList.add("search-panel"),e.$.headerDropDown.classList.remove("customize-panel","filter-panel","sort-panel"),e.$.search.classList.remove("smart-hidden"),e.$.customize.classList.add("smart-hidden"),e.$.filter.classList.add("smart-hidden"),e.$.sort.classList.add("smart-hidden"),e._openHeaderDropDown(e.$.searchButton),e._searchInfo={source:e._getCurrentDataSource(),stringDataFields:["text","tags"]},""!==e.$.searchInput.value&&e._search(e.$.searchInput.value,!1)}_search(e,t=!0){const a=this;if(a._searchInfo.query=e,Array.from(a.$.container.querySelectorAll(".smart-kanban-task.smart-data-view-found, .smart-kanban-task.smart-data-view-highlighted")).forEach(e=>e.classList.remove("smart-data-view-found","smart-data-view-highlighted")),""===e)return a.$.search.classList.remove("matches","no-matches"),delete a._searchInfo.foundIdsArray,delete a._searchInfo.foundIdsObject,void delete a._searchInfo.highlighted;const s=new Smart.DataAdapter({dataSource:a._searchInfo.source,dataFields:["text: string","tags: string"],id:"id"}),r=[],l=[],o={};a._searchInfo.stringDataFields.forEach(t=>{const a=new Smart.Utilities.FilterGroup,s=a.createFilter("string",e,"CONTAINS");a.addFilter("or",s),r.push([t,a])}),s._filter(r,"or");for(let e=0;e<s.length;e++){const t=s[e];!1!==t.$.filtered&&(l.push(t.$.id),o[t.$.id]=!0)}if(a._searchInfo.foundIdsArray=l,a._searchInfo.foundIdsObject=o,Array.from(a.$.container.getElementsByClassName("smart-kanban-task")).forEach(e=>{const s=e.data[a.dataSourceMap.id];if(o[s]){if(e.filteredOut)return l.splice(l.indexOf(s),1),void delete o[s];t&&l[0]===s&&e.classList.add("smart-data-view-highlighted"),e.classList.add("smart-data-view-found")}}),l.length>0){if(t){let e=l[0];a._searchInfo.highlighted=e,a.ensureVisible(e)}return a.$.search.classList.remove("no-matches"),a.$.search.classList.add("matches"),void(a.$.searchLabel.innerHTML=a.localize("found",{nth:t?1:0,n:l.length}))}a.$.search.classList.remove("matches"),a.$.search.classList.add("no-matches"),a.$.searchLabel.innerHTML=a.localize("found",{nth:0,n:0})}_bodyFocusinHandler(e){const t=this;let a=t.isInShadowDOM||t.shadowRoot?e.composedPath()[0]:e.target;if(!a.classList.contains("smart-kanban-column-content-tasks"))return;a=a.$.content,t._getSelectedItem(a,!0)||t._focusTask(t._getFirstItem(a))}get _rtlAttr(){return this.rightToLeft?" right-to-left":""}get _tabindex(){return this.disabled||this.unfocusable?"":' tabindex="0"'}_appendAddNewColumn(e){const t=document.createElement("div");t.classList.add("smart-kanban-add-new-column","smart-unselectable"),t.innerHTML=`<div class="smart-kanban-add-new-column-label">+ ${this.localize("addNewStatus")}</div>`,this.disabled||this.unfocusable||t.setAttribute("tabindex",0),e.appendChild(t)}_addNewColumnDynamically(){const e=this,t=e._dialog,a=Math.floor(9e4*Math.random()+1e4),s={label:e.localize("addNewStatus")+" "+a,dataField:"newStatus"+a,addNewButton:!0,collapsed:!1,collapsible:!0,orientation:"vertical"};e.columns.push(s),e._reset();const r=Array.from(e.$.body.getElementsByClassName("smart-kanban-column")).find(e=>e.column.dataField===s.dataField).querySelector(".smart-kanban-column-header-label"),l=document.createElement("input");function o(){let a=l.value;!1===/^\s*$/.test(a)&&(a=a.trim(),s.label=a,s.dataField=Smart.Utilities.Core.toCamelCase(a.replace(/ /g,"-")),r.innerHTML=a),r.classList.remove("pending"),l.remove(),t&&t.editPanelPopulated&&(t.editors.status.dataSource=e._allColumns.map(e=>({label:e.label,value:e.dataField})))}r.classList.add("pending"),r.appendChild(l),l.focus(),l.addEventListener("blur",o),l.addEventListener("change",o)}_validateDataSourceMap(){this.dataSourceMap=Object.assign({},{checklist:"checklist",color:"color",comments:"comments",dueDate:"dueDate",id:"id",priority:"priority",progress:"progress",startDate:"startDate",status:"status",swimlane:"swimlane",tags:"tags",text:"text",userId:"userId"},this.dataSourceMap)}})}});