
/* Smart UI v9.0.0 (2020-Dec) 
Copyright (c) 2011-2021 jQWidgets. 
License: https://htmlelements.com/license/ */ //

!function(e){var t={};function a(l){if(t[l])return t[l].exports;var i=t[l]={i:l,l:!1,exports:{}};return e[l].call(i.exports,i,i.exports,a),i.l=!0,i.exports}a.m=e,a.c=t,a.d=function(e,t,l){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:l})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var l=Object.create(null);if(a.r(l),Object.defineProperty(l,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)a.d(l,i,function(t){return e[t]}.bind(null,i));return l},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=89)}({89:function(e,t){Smart("smart-pivot-table",class extends Smart.Table{static get properties(){return{columnTotals:{value:!1,type:"boolean"},columnTotalsPosition:{value:"near",allowedValues:["near","far"],type:"string"},defaultSortByRowGroups:{value:!1,type:"boolean"},designer:{value:!1,type:"boolean"},designerPosition:{value:"far",allowedValues:["near","far"],type:"string"},drillDown:{value:!1,type:"boolean"},getDefaultSummaryFunction:{value:null,type:"function?"},grandTotal:{value:!1,type:"boolean"},groupLayout:{value:"default",allowedValues:["default","classic"],type:"string"},hideCellSelectionTooltip:{value:!1,type:"boolean"},hideEmptyRows:{value:!1,type:"boolean"},messages:{value:{en:{average:"Average",calculation:"Calculation",center:"center",clear:"Clear",columns:"Columns",columnSettings:"Column settings",count:"Count",decimalPlaces:"Decimal places",decimalSeparator:"Decimal separator",details:"Details",dragHereRowGroups:"Drag here to set row groups",dragHereSummaries:"Drag here to set summaries",dragHerePivots:"Drag here to set pivots",fields:"Fields",filter:"Filter",filters:"Filters",grandTotal:"Grand Total",groupHeader:"Group",left:"left",moveTo:"Move to",negativesInBrackets:"Negatives in brackets",numberAlignment:"Number alignment",numberFormat:"Number format",numberPrefix:"Number prefix",notApplicable:"N/A",pivots:"Pivots",right:"right",row:"Row",rowGroups:"Row Groups",sameSummaryFunctionRequired:'smartPivotTable: When "columnTotals" is enabled, all summary columns must have the same "summary" function set (e.g. \'{{example}}\').',search:"Search...",showRows:"Show records where:",sum:"Sum",summaries:"Summaries",summaryRequired:'smartPivotTable: At least one column with "summary" is required.',textAlignment:"Text alignment",total:"Total",thousandsSeparator:"Thousands separator"}},type:"object",extend:!0},nullDefaultValue:{value:null,type:"number?"},rowSort:{value:!1,type:"boolean"},rowTotals:{value:!1,type:"boolean"},rowTotalsPosition:{value:"near",allowedValues:["near","far"],type:"string"},selectionMode:{value:"many",type:"string",allowedValues:["many","extended","cell"]},toolbar:{value:!1,type:"boolean"}}}static get listeners(){return{resize:"_overriddenTableHandler","designerContainer.change":"_designerChangeHandler","designerContainer.clear":"_designerFilterHandler","designerContainer.filter":"_designerFilterHandler","fieldsButton.click":"_fieldsButtonClickHandler","tableContainer.change":"_overriddenTableHandler","tableContainer.keyup":"_overriddenTableHandler","tableContainer.touchmove":"_tableContainerTouchmoveHandler","toolbar.close":"_breadcrumbCloseHandler","toolbar.dragEnd":"_breadcrumbDragEndHandler","toolbar.dragging":"_breadcrumbDraggingHandler"}}template(){return'<div id="container" class="smart-container" role="presentation">\n                    <div id="toolbar" class="smart-pivot-table-toolbar" role="toolbar">\n                        <smart-breadcrumb id="rowGroupBreadcrumb" class="smart-pivot-table-row-group-breadcrumb" allow-drag allow-drop animation="[[animation]]" close-buttons right-to-left="[[rightToLeft]]" theme="[[theme]]"></smart-breadcrumb>\n                        <smart-breadcrumb id="pivotBreadcrumb" class="smart-pivot-table-pivot-breadcrumb" allow-drag allow-drop animation="[[animation]]" close-buttons right-to-left="[[rightToLeft]]" theme="[[theme]]"></smart-breadcrumb>\n                        <smart-button id="conditionalFormattingButton" class="smart-table-toolbar-button conditional-formatting" animation="[[animation]]" right-to-left="[[rightToLeft]]" theme="[[theme]]" aria-label="Conditional Formatting"></smart-button>\n                        <smart-button id="fieldsButton" class="smart-table-toolbar-button fields" animation="[[animation]]" right-to-left="[[rightToLeft]]" theme="[[theme]]" aria-label="Fields"></smart-button>\n                    </div>\n                    <div id="main" class="smart-pivot-table-main-container">\n                        <table id="tableContainer" class="smart-table-container"></table>\n                    </div>\n                    <div id="designerContainer" class="smart-pivot-table-designer-container"></div>\n                </div>'}clearFilters(){this._filterInfo.appliedFilters&&(this._clearSortByRow(!0),delete this._filterInfo.appliedFilters,this._clearDesignerFilters(),this.dataSource.clearFilter(),this.refresh(!0),this._originalDynamicColumnsOrder=this._dynamicColumns.map(e=>e.id),this.$.fireEvent("filter",{action:"remove"}))}clearSelection(){const e=this;"cell"===e.selectionMode?e._clearCellSelection(!0):super.clearSelection()}exportData(e,t,a){const l=this,i=getComputedStyle(l),o=i.borderRightColor,r={hierarchical:!0},n={},s=l._dynamicColumns;let d=[];if(s&&0!==s.length){if(r.style={border:"1px solid "+o,borderCollapse:"collapse",backgroundColor:i.backgroundColor,color:i.color,fontFamily:"Helvetica",header:{border:"1px solid "+o,fontWeight:"bold"},columns:{border:"1px solid "+o}},-1!==["csv","json","tsv","xml"].indexOf(e)){for(let e=0;e<s.length;e++){const t=s[e];t.group?n[t.id]=t.label:n[t.id]=t.dataFields.map(e=>e.label).join(" -> ")}d.push(n)}else{const e=[],t=[];for(let a=0;a<s.length;a++){const i=s[a],o=i.id,n={},d={};if(l._getColumnExportFormat(i,n,d),r.style.columns[o]=d,r.style.header[o]=n,i.group){n.width=1.25*l._cellWidth+"px",e.push({label:i.label,dataField:o});continue}n.width=l._cellWidth+"px";const c=i.dataFields,u={label:c[c.length-1].label,dataField:o};if(e.push(u),1!==c.length)for(let e=c.length-2;e>=0;e--){const a=c[e].label,l=c.slice(0,e+1).map(e=>e.label).join("_").replace(/[ ,]/g,"_");if(e===c.length-2&&(u.columnGroup=l),t.find(e=>e.name===l))continue;const i={label:a,name:l};c[e-1]&&(i.parentGroup=c[e-1].label.replace(/[ ,]/g,"_")),t.push(i)}}n.columns=e,n.columngroups=t,r.header=n}for(let t=0;t<l.rows.length;t++){const a=l.rows[t],i={};for(let t in a){if(-1!==["$","children","count","expanded","leaf","level","parent","sortOrder","tr"].indexOf(t))continue;if("id"===t){i._keyDataField=a.id;continue}if("parentid"===t){i._parentDataField=a.parentid;continue}const l=a[t];i[t]=null!==l?l:"pdf"===e?" ":""}!0!==a.leaf&&(i._expanded=!0===a.expanded),d.push(i)}return new Smart.Utilities.DataExporter(r).exportData(d,e,t,a)}}getDynamicColumns(){return this._dynamicColumns}getSelection(){const e=this;return"cell"===e.selectionMode?e._selectedCells.collection.map(e=>({dataField:e.dataField,rowId:e.rowData.$.id})):super.getSelection()}select(e,t){const a=this;a.selection&&("cell"!==a.selectionMode?super.select(e):a._toggleCellSelectionProgrammatically(e,t,!0))}sortBy(e,t){const a=this;let l;if(e){if(-1===a._dynamicColumns.indexOf(e)||0===a._rowGroupColumns.length)return;if(!1===e.dataFields[e.dataFields.length-1].originalColumn.allowSort)return;l=e.id}a._sortBy({column:e,columnDataField:l,sortOrder:t,dataFields:a._dynamicDataFields,columnByDataField:"_getDynamicColumnById"})}unselect(e,t){const a=this;a.selection&&("cell"!==a.selectionMode?super.unselect(e):a._toggleCellSelectionProgrammatically(e,t,!1))}propertyChangedHandler(e,t,a){const l=this;function i(){l._dynamicColumns.filter(e=>e.rowTotal).forEach(e=>{delete l._getDynamicColumnById[e.id],l._dynamicDataFields=l._dynamicDataFields.filter(t=>t.name!==e.id)}),l._dynamicColumns=l._dynamicColumns.filter(e=>!0!==e.rowTotal)}switch(e){case"animation":case"rightToLeft":case"theme":super.propertyChangedHandler(e,t,a),l._designer&&(l._designer[e]=a,"rightToLeft"===e&&(l._designer.inverted=l.designer&&("near"===l.designerPosition&&!a||"far"===l.designerPosition&&a))),"rightToLeft"===e&&l.selection&&"cell"===l.selectionMode&&l._showSelectionDetails(!0);break;case"columns":l._conditionalFormatting&&delete l._conditionalFormatting,l._updateColumns(),l._formattingPanel&&(l._formattingPanel.columns=l._aggregateColumns.map(e=>({label:`${e.summary}(${e.label})`,dataField:e.dataField,dataType:"number"})));break;case"columnTotals":l._clearSortByRow(!0),l.refresh(!0),l._originalDynamicColumnsOrder=l._dynamicColumns.map(e=>e.id);break;case"columnTotalsPosition":{if(!l.columnTotals)return;l._clearSortByRow(!0,!0),i();const e=l._dynamicColumns.filter(e=>e.columnTotal&&0===e.pivotLevel),t=l._dynamicColumns.filter(e=>e.group),o=[];!function e(t,l){for(let i=0;i<t.length;i++){const o=t[i];"far"===a&&o.columnTotal&&e(o.children,l),l.push(o),"near"===a&&o.columnTotal&&e(o.children,l)}}(e,o),t.push(...o),l._dynamicColumns=t,l._addRowTotalsDynamicColumnDefinitions(),l.refresh(void 0,l._getCurrentDataStructure()),l._originalDynamicColumnsOrder=l._dynamicColumns.map(e=>e.id);break}case"conditionalFormatting":l._applyInitialConditionalFormatting(l.rows),l.refresh(void 0,l._getCurrentDataStructure());break;case"dataSource":delete l._dataSourceSortedByDefault,delete l._filterInfo.appliedFilters,l._sortColumns=[],l._clearSortByRow(!0),l._clearDesignerFilters(),l._validateDataSource(),l.refresh(!0),l._originalDynamicColumnsOrder=l._dynamicColumns.map(e=>e.id);break;case"designer":a&&(l._designer?(l._dialog&&l._dialog.classList.contains("fields")&&l._dialog.close(),l._designer.inverted="near"===l.designerPosition&&!l.rightToLeft||"far"===l.designerPosition&&l.rightToLeft,l.$.designerContainer.appendChild(l._designer)):l._initDesigner(l.$.designerContainer));break;case"designerPosition":l.designer&&(l._designer.inverted="near"===a&&!l.rightToLeft||"far"===a&&l.rightToLeft);break;case"disabled":case"unfocusable":case"keyboardNavigation":super.propertyChangedHandler(e,t,a),l._designer&&(l._designer.unfocusable=l.disabled||l.unfocusable||!l.keyboardNavigation);break;case"filtering":a||l.clearFilters();break;case"grandTotal":a?(l.footerRow="footer",l.freezeFooter=!0,l._createGrandTotalRow(l.rows.boundHierarchy,!0)):(l.footerRow=null,l.freezeFooter=!1,l.$.tableContainer.querySelector("tfoot").remove());break;case"groupLayout":l.refresh(void 0,l._getCurrentDataStructure());break;case"hideCellSelectionTooltip":if(!l.selection||"cell"!==l.selectionMode)return;if(a){const e=l.$.tableContainer.querySelector("[selection-detail]");e&&(e.removeAttribute("selection-detail"),e.removeAttribute("detail-position-x"),e.removeAttribute("detail-position-y"))}else l._showSelectionDetails();break;case"hideEmptyRows":l._rowGroupColumns.length>0&&l.refresh(!0,l._getCurrentDataStructure());break;case"locale":case"messages":if(super.propertyChangedHandler(e,t,a),l._rowGroupColumns){const e=l.$.tableContainer.querySelectorAll(".smart-pivot-table-grouping-header");e[e.length-1].innerHTML=l.localize("groupHeader")}l.columnTotals&&l._dynamicColumns.forEach(e=>{e.columnTotal&&(e.cell.textContent=`${l._totalSummaryFunction}(${l.localize("total")})`)}),l._designer&&(l._designer[e]=l[e]),l.selection&&"cell"===l.selectionMode&&l._showSelectionDetails();break;case"nullDefaultValue":l.refresh(!0,l._getCurrentDataStructure());break;case"rowSort":!a&&l._sortRow&&l._clearSortByRow();break;case"rowTotals":case"rowTotalsPosition":{if(0===l._pivotColumns.length||"rowTotalsPosition"===e&&!l.rowTotals)return;let t=!1;l._clearSortByRow(!0,!0),"rowTotals"===e?a?(t=!0,l._addRowTotalsDynamicColumnDefinitions()):i():"rowTotalsPosition"===e&&(i(),l._addRowTotalsDynamicColumnDefinitions()),l.refresh(t,l._getCurrentDataStructure()),l._originalDynamicColumnsOrder=l._dynamicColumns.map(e=>e.id);break}case"selection":{const e="cell"!==l.selectionMode;e&&l.refresh(void 0,l._getCurrentDataStructure()),a?(l.$.tableContainer.setAttribute("aria-multiselectable",!0),e?l._updateSelectAllState():(l._selectedCells.collection.forEach(e=>e.element.classList.add("selected")),l._showSelectionDetails(),l.$.main.onscroll=l._mainContainerOnscroll.bind(l))):(l.$.tableContainer.removeAttribute("aria-multiselectable"),e||(l._clearCellSelection(),l.$.main.onscroll=null));break}case"selectionMode":if(super.propertyChangedHandler(e,t,a),"many"===t&&"extended"===a||"many"===a&&"extended"===t)return;"cell"===a?l._selectedIds=[]:l._selectedCells={collection:[]},l.selection&&(l.refresh(void 0,l._getCurrentDataStructure()),l.$.main.onscroll="cell"===a?l._mainContainerOnscroll.bind(l):null);break;default:super.propertyChangedHandler(e,t,a)}}_updateColumns(e){const t=this,a=t._filterInfo.appliedFilters;if(delete t._filterInfo.appliedFilters,t._sortColumns=[],t._clearSortByRow(!0),t._initColumns(),t._designerFiltersApplied)if(e){t._applyingDesignerFilters=!0,t._restoringFilters=!0;for(const e in a)t.addFilter(e,a[e]);delete t._applyingDesignerFilters,delete t._restoringFilters}else t._clearDesignerFilters();t.refresh(!0),t._originalDynamicColumnsOrder=t._dynamicColumns.map(e=>e.id)}_createElement(){const e=this;e.classList.add("smart-table"),e._cellWidth=parseFloat(getComputedStyle(e.$.container).getPropertyValue("--smart-pivot-table-cell-width")),e._autoScrollCoefficient*=2,e._filterInfo={},e._selectedCells={collection:[]},e.$.header={offsetHeight:0},e.$.pager={offsetHeight:0},e.grandTotal&&(e.footerRow="footer",e.freezeFooter=!0),e.selection&&"cell"===e.selectionMode&&(e.$.main.onscroll=e._mainContainerOnscroll.bind(e)),e._setMainContainerMaxHeight(),e._localize(),e._validateDataSource(),e._initColumns(),e.refresh(!0),e.designer&&e._initDesigner(e.$.designerContainer),e._originalDynamicColumnsOrder=(e._dynamicColumns||[]).map(e=>e.id)}_setMainContainerMaxHeight(){const e=getComputedStyle(this.$.container).maxHeight;isNaN(parseFloat(e))||(this.$.main.style.maxHeight=`calc(${e} - 2 * var(--smart-border-width)`)}_validateDataSource(){const e=this,t=e.dataSource;if(!(t instanceof Smart.DataAdapter))if(Array.isArray(e.dataSource)){let a;if(t.length>0){const e=t[0];a=[];for(let t in e){const l=e[t];"number"==typeof l?a.push({name:t,dataType:"number"}):"boolean"==typeof l?a.push({name:t,dataType:"boolean"}):l instanceof Date?a.push({name:t,dataType:"date"}):a.push({name:t,dataType:"string"})}}e.dataSource=new Smart.DataAdapter({dataSource:e.dataSource,dataFields:a})}else e.dataSource=new Smart.DataAdapter({dataSource:[]})}_processPivotColumns(){const e=this,t=e.columnTotals,a=[],l=[],i=[],o=[],r=[];let n,s=e.dataSource;if(0===e._columns.length)return!1;for(let s=0;s<e._columns.length;s++){const d=e._columns[s];d.pivot&&d.allowPivot&&(a.push(d),o.push(d.dataField)),d.rowGroup&&d.allowRowGroup&&(l.push(d),r.push(d.dataField)),d.summary&&(i.push(d),n?t&&n!==d.summary&&e.error(e.localize("sameSummaryFunctionRequired",{example:n})):n=d.summary)}return 0===i.length&&e.error(e.localize("summaryRequired")),e._groupByPrimary=o,e._groupBySecondary=r,e._pivotColumns=a,e._rowGroupColumns=l,e._aggregateColumns=i,e._totalSummaryFunction=n,e.defaultSortByRowGroups&&!e._dataSourceSortedByDefault&&l.length>0&&(s=new Smart.DataAdapter({dataSource:e._defaultSortByRowGroups(s),dataFields:s.dataFields}),e.dataSource=s),s.groupBy=o,s.refreshHierarchy(),e._primaryHierarchy=s.boundHierarchy,e.$.rowGroupBreadcrumb.dataSource=l.map(e=>({label:e.label,value:e})),e.$.pivotBreadcrumb.dataSource=a.map(e=>({label:e.label,value:e})),!0}refresh(e,t){const a=this,l=a.isRendered;if(a.columns.canNotify=!1,l&&!t&&(a.$.tableContainer.innerHTML=""),t){const e=a.$.tableContainer.firstElementChild,l=document.createDocumentFragment();e.innerHTML="",a._createHeaderCells(t,l),e.appendChild(l)}else{if(!a._processPivotColumns())return;a._createHeader()}a._hideColumnTotalsBorder(),e&&(a._selectedCells={collection:[]},a._createAggregatesSource(),a._applyInitialConditionalFormatting(a.rows)),a._createDataRows(!t);const i=a._sortColumns;l&&(e||t)&&i&&(delete a._sortColumns,i.forEach(e=>{const t=a._getDynamicColumnById[e.dataField];t&&(delete t.sortOrder,a.sortBy(t,e.direction))})),a.columns.canNotify=!0}_createHeader(){const e=this,t=e.columnTotals,a=e.columnTotalsPosition,l=document.createElement("thead"),i=document.createDocumentFragment(),o=e._pivotColumns.length,r=[];function n(a,l,i){if(t)for(let t=0;t<=o;t++)t<a?r[t].push(l[t]):t===a?r[t].push(i.label):t===o?r[t].push(`TL="${a}"${e._totalSummaryFunction}(${e.localize("total")})`):r[t].push("")}function s(a){const l=e._aggregateColumns;return t&&0===a&&r[0].push(`TL="0"${e._totalSummaryFunction}(${e.localize("total")})`),l.forEach(e=>{r[a].push(`${e.summary}(${e.label})`)}),l.length}for(let e=0;e<=o;e++)r.push([]);o>0?function t(l,i,o){let d=0;for(let c=0;c<l.length;c++){const u=l[c];let m=0;e._filterInfo.appliedFilters&&!e._areChildrenFiltered(void 0,u.children)||("near"===a&&n(i,o,u),u.children&&u.children.length>0&&!0!==u.children[0].leaf?m+=t(u.children,i+1,o.concat([u.label])):m+=s(i+1),"far"===a&&n(i,o,u),r[i].push(...Array(m).fill(u.label)),d+=m)}return d}(e._primaryHierarchy,0,[]):s(0),e._createDynamicColumnDefinitions(r),e._createHeaderCells(r,i),l.appendChild(i),e.$.tableContainer.appendChild(l)}_createDynamicColumnDefinitions(e){const t=this,a=e[e.length-1].length,l=[],i=[],o={};let r=-1;t._dynamicColumns=l,t._dynamicDataFields=i,t._getDynamicColumnById=o;for(let n=0;n<a;n++){const a=e[e.length-1][n];if(t._createTotalColumnDefinition(a,e,n))continue;const s={dataFields:[]},d=[];r++;for(let a=0;a<e.length-1;a++){const l=e[a][n],i=t._pivotColumns[a],o={originalColumn:i,label:l,dataField:i.dataField};s.dataFields.push(o),d.push(l),e[a][n]={label:l,columnDefinition:s,info:o}}const c=t._aggregateColumns[r%t._aggregateColumns.length],u={originalColumn:c,label:a,dataField:c.dataField,summary:c.summary};s.dataFields.push(u),d.push(c.dataField),e[e.length-1][n]={label:a,columnDefinition:s,info:u},s.id=d.join(",").replace(/[ ,]/g,"_"),l.push(s),i.push({name:s.id,dataType:"any"}),o[s.id]=s}if(t._rowGroupColumns.length>0){const e=t.localize("groupHeader"),a={dataFields:t._rowGroupColumns.map(t=>({originalColumn:t,label:e})),id:"group",label:e,group:!0};let r;l.unshift(a),o.group=a;for(let e=0;e<a.dataFields.length&&(r=a.dataFields[e].originalColumn.dataType,"string"!==r);e++);i.push({name:"group",dataType:r}),i.push({name:"count",dataType:"number"})}t._setColumnTotalsRelations(),t._addRowTotalsDynamicColumnDefinitions(),t.$.tableContainer.removeAttribute("aria-colcount")}_createTotalColumnDefinition(e,t,a){const l=this,i=/TL="(\d+)"/.exec(e);if(!i)return!1;const o=parseFloat(i[1]),r={dataFields:[]},n=[];e=e.replace(/TL="(\d+)"/,"");for(let e=0;e<t.length-1;e++){if(e>o){t[e][a]=Object.assign({},t[e-1][a],{label:""});continue}const i=t[e][a],s=l._pivotColumns[e],d={originalColumn:s,label:i,dataField:s.dataField};r.dataFields.push(d),n.push(i),t[e][a]={label:i,columnDefinition:r,info:d}}return n.push("TOTAL"),r.columnTotal=!0,r.emptyCells=[],r.expanded=!1,r.id=n.join(",").replace(/[ ,]/g,"_"),r.pivotLevel=o,t[t.length-1][a]={label:e,columnDefinition:r,info:{originalColumn:{},label:e,dataField:"TOTAL"}},l._dynamicColumns.push(r),l._dynamicDataFields.push({name:r.id,dataType:"any"}),l._getDynamicColumnById[r.id]=r,!0}_setColumnTotalsRelations(){const e=this;if(!e.columnTotals)return;const t=e._dynamicColumns;for(let a=0;a<e._dynamicColumns.length;a++){const l=e._dynamicColumns[a];if(!l.columnTotal)continue;const i=l.id.replace("_TOTAL","");let o;0===e._pivotColumns.length?(l.expanded=!0,o=t.filter(e=>{if(!e.columnTotal&&!e.group)return e.parent=l,!0})):o=l.pivotLevel===e._pivotColumns.length-1?t.filter(e=>{if(!e.columnTotal&&0===e.id.indexOf(i))return e.parent=l,!0}):t.filter(e=>{if(e.columnTotal&&e.pivotLevel===l.pivotLevel+1&&0===e.id.indexOf(i))return e.parent=l,!0}),l.children=o}}_addRowTotalsDynamicColumnDefinitions(){const e=this;if(!e.rowTotals||0===e._pivotColumns.length)return;const t=[];e._aggregateColumns.forEach(a=>{const l=a.dataField,i="TOTAL_"+l,o={dataFields:[{originalColumn:a,label:`${a.summary}(${a.label})`,dataField:l,summary:a.summary}],id:i,rowTotal:!0};t.push(o),e._getDynamicColumnById[i]=o,e._dynamicDataFields.push({name:i,dataType:"any"})}),"near"===e.rowTotalsPosition?e._dynamicColumns.splice(0+Number(e._rowGroupColumns.length>0),0,...t):e._dynamicColumns.push(...t)}_createHeaderCells(e,t){const a=this,l=e[e.length-1].length,i=a.columnTotals,o=a.selection&&"cell"!==a.selectionMode,r=a.onColumnRender,n=a.rowTotalsPosition,s=a._rowGroupColumns.length>0,d=a._cellWidth;function c(t,a){if(0===a)return!0;let l=t,i=!1;for(;l>=0&&!i;){const t=e[l][a-1],o=e[l][a];i=t.label!==o.label||JSON.stringify(t.info)!==JSON.stringify(o.info),l--}return i}for(let u=0;u<e.length;u++){const m=document.createElement("tr"),p=e[u];if(o)if(u===e.length-1)m.innerHTML='<th class="smart-pivot-table-selection-header smart-table-select-all freeze-near"><div role="checkbox" aria-checked="false" aria-label="Toggle selection of all rows"></div></th>';else{const e=document.createElement("th");0===u&&(e.style.width=getComputedStyle(a.$.container).getPropertyValue("--smart-table-row-height")),e.classList.add("smart-pivot-table-selection-header","freeze-near"),m.appendChild(e)}s&&a._createGroupHeaderCells(u,e,m),"near"===n&&a._createRowTotalsHeaders(u,e,m);const h={};for(let t=0;t<l;t++){let o=p[t],n=o.label,s=o.columnDefinition;if(void 0===n)break;const f=document.createElement("th");if(c(u,t)){if(h.cell&&!i&&(h.span>1&&(h.cell.colSpan=h.span),0===u&&(h.cell.style.width=d*h.span+"px")),t===l-1&&0===u?i||(f.style.width=d+"px"):(h.cell=f,h.span=1),f.columnDefinition=s,s.columnTotal&&""===n)s.emptyCells.push(f),f.classList.add("empty");else if(r){const e={text:n,cell:f,column:o.info,fullDefinition:s};a.onColumnRender(e),n=e.text}u===e.length-1&&(a._addSortingCapability(f,s),n=`<div class="wrapper" role="presentation"><div class="label">${n}</div></div>`),o.info.originalColumn.align&&f.classList.add("align-"+o.info.originalColumn.align),f.innerHTML=n,i&&a._processColumnTotalsHeaderCells(f,s,u),m.appendChild(f)}else h.span++,t!==l-1||i||(h.cell.colSpan=h.span,0===u&&(h.cell.style.width=d*h.span+"px"))}"far"===n&&a._createRowTotalsHeaders(u,e,m),t.appendChild(m)}}_createGroupHeaderCells(e,t,a){const l=this,i="classic"===l.groupLayout,o=i?l._rowGroupColumns.length:1;for(let r=0;r<o;r++){const o=document.createElement("th");if(o.classList.add("smart-pivot-table-grouping-header"),e===t.length-1){const e=l._dynamicColumns[0];let t=i?e.dataFields[r].originalColumn.label:l.localize("groupHeader");if(l.onColumnRender){const a={text:t,cell:o,column:e.dataFields[0],fullDefinition:e};l.onColumnRender(a),t=a.text}0===r&&(l._addSortingCapability(o,e),t=`<div class="wrapper" role="presentation"><div class="label">${t}</div></div>`),o.innerHTML=t}a.appendChild(o)}}_processColumnTotalsHeaderCells(e,t,a){const l=this,i=l.columnTotalsPosition;if(a<l._pivotColumns.length&&!e.classList.contains("empty")){const o=document.createElement("div");if(o.className="total-arrow smart-arrow smart-arrow-right",o.setAttribute("role","button"),o.setAttribute("aria-label","Toggle column"),!l.keyboardNavigation||l.disabled||l.unfocusable||(o.tabIndex=0),e.appendChild(o),"far"!==i||t.columnTotal)e.controller=t;else{let i=l._pivotColumns.length,o=t;for(;i>a;)o=o.parent,i--;e.controller=o}e.controller.arrowCell=e,l._getColumnTotalColspan(e)}const o=function e(t){return!!t.parent&&(!t.parent.expanded||e(t.parent))}(t);t.hidden=o,"near"===i?(e.classList.toggle("smart-hidden",o),e.classList.toggle("expanded",t.expanded)):(e.controller&&t!==e.controller||e.classList.toggle("smart-hidden",o),t.arrowCell&&t.arrowCell!==e&&(t.arrowCell.classList.toggle("smart-hidden",o),t.arrowCell.classList.toggle("expanded",t.expanded)))}_getColumnTotalColspan(e){const t=function e(t){let a=1;if(t.expanded)for(let l=0;l<t.children.length;l++){const i=t.children[l];i.columnTotal?a+=e(i):a+=1}return a}(e.controller);t>1?e.colSpan=t:e.removeAttribute("colspan"),e.style.width=this._cellWidth*t+"px"}_createRowTotalsHeaders(e,t,a){const l=this;if(l.rowTotals&&0!==l._pivotColumns.length)for(let i=0;i<l._aggregateColumns.length;i++){const o=l._getDynamicColumnById["TOTAL_"+l._aggregateColumns[i].dataField],r=document.createElement("th");if(r.classList.add("smart-pivot-table-total-header"),e===t.length-1){let e=o.dataFields[0].label;if(l.onColumnRender){const t={text:e,cell:r,column:o.dataFields[0],fullDefinition:o};l.onColumnRender(t),e=t.text}r.innerHTML=`<div class="wrapper" role="presentation"><div class="label">${e}</div></div>`,l._addSortingCapability(r,o)}a.appendChild(r)}}_createAggregatesSource(){const e=this,t=e.dataSource,a=e.hideEmptyRows,l=e.nullDefaultValue,i=e._aggregateColumns,o=[],r=[],n={id:0,totals:[]},s=[],d=e._selectedIds.slice(0);let c;for(let e=0;e<i.length;e++){const t=i[e],a={};a[t.dataField]=[t.summary],r.push(a)}function u(t,a){for(let l=e._groupByPrimary.length-1;l>=0;l--){const i=t[e._groupByPrimary[l]],o=a[e._groupByPrimary[l]];if(i instanceof Date){if(i.getTime()!==o.getTime())return!1}else if(i!==o)return!1}return!0}if(e._originalRecords={},0===e._rowGroupColumns.length?(!function a(l,i){if(0!==e._pivotColumns.length)for(let o=0;o<l.length;o++){const s=l[o];if(s.children&&s.children.length>0){const l=i.concat([s.label]);if(!0!==s.children[0].leaf)a(s.children,l);else{const a=s.children.filter(e=>!1!==e.$.filtered);if(0===a.length)continue;const i=t.summarize(r,a);e._setRowValue(n,l,i,a)}}}else{const a=e.dataSource.toArray().filter(e=>!1!==e.$.filtered);if(0===a.length)return;const l=t.summarize(r,a);e._setRowValue(n,i,l,a)}}(e._primaryHierarchy,[]),o.push(n),s.push(n.id)):(c=e._groupByPrimary[e._groupByPrimary.length-1],function l(i,n,d){let m=e._getSecondaryHierarchy(i);if(n)for(let e=0;e<d.length;e++)m=m[d[e]].children;m.forEach((m,p)=>{let h=m.children.length;if(e._filterInfo.appliedFilters&&(h=e._areChildrenFiltered(void 0,m.children),!1===m.data.$.filtered&&!h))return;const f={},g=new Smart.DataAdapter({dataSource:m.children,dataFields:t.dataFields,groupBy:e._groupByPrimary});if(n&&(f.parentid=n.id),f.id=(n?n.id:"")+m.label+i,f.level=i,f.totals=[],s.push(f.id),function a(l,i,o,n){if(0!==e._pivotColumns.length)for(let s=0;s<l.length;s++){const d=l[s];if(d.children&&d.children.length>0&&!0!==d.children[0].leaf)a(d.children,i,o,n.concat([d.label]));else{const a=i.children.filter(e=>!1!==e.$.filtered&&(!c||u(d.data,e)));if(0===a.length)continue;const l=n.concat([d.label]).filter(e=>void 0!==e),s=t.summarize(r,a);e._setRowValue(o,l,s,a)}}else{const a=i.children.filter(e=>!1!==e.$.filtered);if(a.length>0){const l=t.summarize(r,a);e._setRowValue(o,n,l,a)}}}(g.boundHierarchy||g,m,f,[]),a){let e=!0;for(const t in f){if(-1!==["children","count","expanded","group","id","level","parent","parentid","totals","tr"].indexOf(t))continue;const a=f[t];if(0!==a&&null!==a){e=!1;break}}if(e)return void(n&&(n.hiddenChildren?n.hiddenChildren++:n.hiddenChildren=1))}o.push(f),i<e._groupBySecondary.length-1&&l(i+1,f,d.concat([p])),f.hiddenChildren&&(h-=f.hiddenChildren,delete f.hiddenChildren),f[e._dynamicColumns[0].id]=m.label,f.count=h})}(0,void 0,[])),e._setRowTotalsSource(o,r),e._setColumnTotalsSource(o),null!==l)for(const t of o)for(const a of e._dynamicDataFields)void 0===t[a.name]&&(t[a.name]=l);if(e.rows=new Smart.DataAdapter({dataSource:o,id:"id",keyDataField:"id",parentDataField:"parentid",dataFields:e._dynamicDataFields}),!e.isRendered&&e.onInit&&e.onInit(),d.length>0){const t=[];for(let e=0;e<d.length;e++)-1!==s.indexOf(d[e])&&t.push(d[e]);e._selectedIds=t}delete e._selectionStart,e.selection&&"cell"!==e.selectionMode&&e._updateSelectAllState()}_setRowValue(e,t,a,l){const i=this;let o=[];i._aggregateColumns.forEach(r=>{const n=r.dataField,s=a[n][r.summary],d=t.concat([n]).join(",").replace(/[ ,]/g,"_");e[d]=s,i._originalRecords[e.id+d]=l,o.push({dataPoint:s})}),e.totals=e.totals.concat(l)}_setRowTotalsSource(e,t){const a=this;if(!a.rowTotals||0===a._pivotColumns.length)return;const l=new Smart.DataAdapter({dataSource:[],dataFields:a.dataSource._dataFields});for(let i=0;i<e.length;i++){const o=e[i],r=o.id,n=o.totals,s=l.summarize(t,n);for(let e in s)o["TOTAL_"+e]=Object.values(s[e])[0],a._originalRecords[r+"TOTAL_"+e]=n;delete o.totals}}_setColumnTotalsSource(e){const t=this;if(!t.columnTotals)return;const a=t._dynamicColumns.filter(e=>e.columnTotal),l=new Smart.DataAdapter({dataSource:[],dataFields:[{name:"dataPoint"}]});for(let i=0;i<e.length;i++){const o=e[i],r=o.id;for(let e=0;e<a.length;e++){const i=a[e],n=t._getColumnTotalsOriginalRecords(i,r);0!==n.length&&(t._originalRecords[r+i.id]=n,o[i.id]=t._getTotalSummary(n,l))}}}_getTotalSummary(e,t){const a=[];return this._aggregateColumns.forEach(t=>{e.forEach(e=>{a.push({dataPoint:e[t.dataField]})})}),t.summarize([{dataPoint:[this._totalSummaryFunction]}],a).dataPoint[this._totalSummaryFunction]}_getSecondaryHierarchy(e){const t=this.dataSource;return t.groupBy=this._groupBySecondary.slice(0,e+1),t.refreshHierarchy(),t.boundHierarchy}_createDataRows(e){const t=this,a=t.rows.boundHierarchy,l=document.createDocumentFragment(),i={collection:[]};let o,r;a&&a.length>0&&("default"===t.groupLayout?t._createRowElements(a,l,i):(t._expanded=[],t._hidden={},t._rowGroupColumns.forEach((e,a)=>{t._expanded.push([]),t._hidden[a]=!1}),t._createRowElementsClassic(a,l,i))),l.appendChild(t._createLastRow()),e?(o=document.createElement("tbody"),t.$.tableContainer.appendChild(o)):(o=t.$.tableContainer.querySelector("tbody"),o.innerHTML=""),o.appendChild(l),t._createGrandTotalRow(a,e),"classic"===t.groupLayout&&t._updateGroupColumnsVisibility(),t._selectedCells=i,t.selection&&"cell"===t.selectionMode&&(r=!0,t._showSelectionDetails()),t.getRootNode().activeElement===t.$.tableContainer&&(r&&i.start?super._focusCell(i.start.element):t._tableContainerFocusHandler())}_createRowElements(e,t,a){const l=this,i=l.selection&&"cell"!==l.selectionMode,o=l._dynamicColumns;for(let r=0;r<e.length;r++){const n=document.createElement("tr"),s=e[r],d=s.level;if(s.tr=n,n.data=s,i){const e=document.createElement("td"),t=-1!==l._selectedIds.indexOf(s.$.id);e.className=`smart-table-select-row freeze-near${t?" selected":""}`,e.innerHTML=`<div class="selection-checkbox" role="checkbox" aria-checked="${t}" aria-label="Toggle row selection"></div>`,n.appendChild(e),n.setAttribute("aria-selected",t)}for(let e=0;e<o.length;e++){const t=document.createElement("td"),i=o[e],r=s[i.id];let c,u,m=r;if(l._restoreSelectedCells(t,i,s,m,a),0===e&&i.group){const e=s.leaf;c=i.dataFields[d].originalColumn,m=l._formatCellValue(s,c,t,m),m=`${m}<span class="group-label-count"> (${s.count})</span>`,e||(t.classList.add("tree-cell"),u=!0),d>0&&(t.classList.add("outline-level-"+d),e&&t.classList.add("tree-leaf")),c.align&&t.classList.add("align-"+c.align),s.sortOrder&&(t.classList.add("sort-by",s.sortOrder),t.setAttribute("aria-sort",s.sortOrder+"ending"))}else c=i.columnTotal?l._aggregateColumns[0]:i.dataFields[i.dataFields.length-1].originalColumn,m=l._formatSummaryValue(s,c,t,m);l.onCellRender&&l.onCellRender(s,i,r,t),l._applyConditionalFormattingToCell(t,i.id,s.$.index),t.setAttribute("data-field",i.id),t.classList.toggle("smart-hidden",!0===i.hidden),l._setCellContent(t,m,u),n.appendChild(t)}s.expanded&&(n.setAttribute("aria-expanded",!0),n.classList.add("expanded")),d>0&&l._isCollapsed(s)&&(n.setAttribute("aria-hidden",!0),n.classList.add("collapsed","smart-hidden")),n.setAttribute("row-id",s.$.id),t.appendChild(n),s.children&&s.children.length>0&&l._createRowElements(s.children,t,a)}}_restoreSelectedCells(e,t,a,l,i){const o=this._selectedCells;if(0===o.collection.length)return;if(!o.collection.find(e=>e.dataField===t.id&&e.rowData.$.id===a.$.id))return;const r={dataField:t.id,element:e,row:a.tr,rowData:a,value:l};i.collection.push(r),r.dataField===o.start.dataField&&r.rowData.$.id===o.start.rowData.$.id&&(i.start=r),r.dataField===o.end.dataField&&r.rowData.$.id===o.end.rowData.$.id&&(i.end=r),this.selection&&e.classList.add("selected")}_createRowElementsClassic(e,t,a){const l=this,i=l.selection&&"cell"!==l.selectionMode,o=l._dynamicColumns;for(let r=0;r<e.length;r++){const n=e[r],s=n.level;if(s>0&&0===r){n.expanded&&l._expanded[s].push(n),n.children&&n.children.length>0&&l._createRowElementsClassic(n.children,t,a);continue}const d=document.createElement("tr");let c=l._getRecordToDisplay(n);if(n.tr=d,d.data=n,n.expanded&&(d.setAttribute("aria-expanded",!0),d.classList.add("expanded"),l._expanded[s].push(n)),s>0&&l._isCollapsed(n)&&(d.setAttribute("aria-hidden",!0),d.classList.add("collapsed","smart-hidden")),i){const e=document.createElement("td"),t=-1!==l._selectedIds.indexOf(n.$.id);e.className=`smart-table-select-row freeze-near${t?" selected":""}`,e.innerHTML=`<div class="selection-checkbox" role="checkbox" aria-checked="${t}" aria-label="Toggle row selection"></div>`,d.appendChild(e),d.setAttribute("aria-selected",t)}for(let e=0;e<o.length;e++){const t=o[e];let i,r=n[t.id],s=r;if(0===e&&t.group){l._createGroupCellsClassic(d,n,t,r,a);continue}const u=document.createElement("td");r=c[t.id],s=r,l._restoreSelectedCells(u,t,n,s,a),i=t.columnTotal?l._aggregateColumns[0]:t.dataFields[t.dataFields.length-1].originalColumn,s=l._formatSummaryValue(c,i,u,s),l.onCellRender&&l.onCellRender(c,t,r,u),l._applyConditionalFormattingToCell(u,t.id,c.$.index),u.setAttribute("data-field",t.id),u.classList.toggle("smart-hidden",!0===t.hidden),l._setCellContent(u,s),d.appendChild(u)}d.setAttribute("row-id",n.$.id),t.appendChild(d),n.children&&n.children.length>0&&l._createRowElementsClassic(n.children,t,a)}}_updateGroupColumnsVisibility(){const e=this,t=e._expanded;function a(e){return!e.parent||!!e.parent.expanded&&a(e.parent)}if(!(t.length<2)){for(let l=0;l<t.length-1;l++){const i=t[l],o=l+1;let r=0;if(i.forEach(e=>r+=Number(a(e))),0===r&&!e._hidden[o]||r>0&&e._hidden[o]||e._hidden[l]&&!e._hidden[o]){e._hidden[o]=!e._hidden[o],Array.from(e.$.tableContainer.querySelectorAll(`.smart-pivot-table-grouping-header:nth-child(${o+1+Number(e.selection&&"cell"!==e.selectionMode)})`)).concat(Array.from(e.$.tableContainer.querySelectorAll(`td[data-field="group${o}"]`))).forEach(t=>t.classList.toggle("smart-hidden",e._hidden[o]))}}if(e._focusedCell&&e._focusedCell.classList.contains("smart-hidden")&&-1!==e._focusedCell.getAttribute("data-field").indexOf("group")){let t=e._focusedCell.previousElementSibling;for(;t.classList.contains("smart-hidden");)t=t.previousElementSibling;e._focusCell(t)}}}_getRecordToDisplay(e){return e.leaf||!e.expanded?e:this._getRecordToDisplay(e.children[0])}_getFirstChildAtLevel(e,t){let a=t.children[0];for(;a.children&&a.level!==e;)a=a.children[0];return a}_createGroupCellsClassic(e,t,a,l,i){const o=this,r=o._rowGroupColumns.length,n=t.level;for(let s=0;s<r;s++){const r=document.createElement("td");if(o._restoreSelectedCells(r,a,t,l,i),r.setAttribute("data-field","group"+s),e.appendChild(r),s<n)continue;let d,c=t,u=a.dataFields[s].originalColumn;s>n?(c=o._getFirstChildAtLevel(s,t),l=c[a.id]):r.classList.add("main"),c.sortOrder&&(r.classList.add("sort-by",c.sortOrder),r.setAttribute("aria-sort",c.sortOrder+"ending"));let m=l;m=o._formatCellValue(c,u,r,m),m=`${m}<span class="group-label-count"> (${c.count})</span>`,c.leaf||(r.data=c,d=!0,r.classList.add("tree-cell"),c.expanded&&r.classList.add("expanded","main")),u.align&&r.classList.add("align-"+u.align),o.onCellRender&&o.onCellRender(c,a,l,r),o._applyConditionalFormattingToCell(r,a.id,t.$.index),o._setCellContent(r,m,d)}}_createGrandTotalRow(e,t){const a=this;if(!a.grandTotal||0===a._rowGroupColumns.length||!e)return;const l=a.columnTotals,i=a._dynamicColumns,o=l?new Smart.DataAdapter({dataSource:[],dataFields:[{name:"dataPoint"}]}):void 0,r=document.createElement("tr"),n={grandTotal:!0};let s;function d(e){const t=[{}],i=e.dataFields[e.dataFields.length-1],o=i.dataField;return t[0][o]=[l?a._totalSummaryFunction:i.summary],t}if(a.selection&&"cell"!==a.selectionMode){const e=document.createElement("td");e.className="freeze-near",r.appendChild(e)}for(let t=0;t<i.length;t++){const l=document.createElement("td"),s=i[t];let c,u,m;if(0===t&&s.group)c=a.localize("grandTotal"),u=c,a._sortRow&&a._sortRow.grandTotal&&(n.sortOrder=a._sortRow.sortOrder,a._sortRow=n,l.classList.add("sort-by",n.sortOrder),l.setAttribute("aria-sort",n.sortOrder+"ending"));else{const t=s.columnTotal?a._aggregateColumns[0]:s.dataFields[s.dataFields.length-1].originalColumn;let i=[];for(let t=0;t<e.length;t++){const l=a._originalRecords[e[t].id+s.id];l&&(i=i.concat(l))}0!==i.length&&(s.columnTotal?(m=a._getTotalSummary(i,o),c=m):(m=a.rows.summarize(d(s),i),c=Object.values(Object.values(m)[0])[0]),a._originalRecords["GRAND_TOTAL"+s.id]=i),u=c,void 0!==m&&void 0!==u&&(u=a._formatSummaryValue(m,t,l,u))}if(a.onCellRender&&a.onCellRender(m,s,c,l),n[s.id]=void 0!==c?c:0,l.setAttribute("data-field",s.id),l.classList.toggle("smart-hidden",!0===s.hidden),a._setCellContent(l,u),r.appendChild(l),0===t&&s.group&&"classic"===a.groupLayout){l.setAttribute("data-field","group0");for(let e=1;e<a._rowGroupColumns.length;e++){const t=document.createElement("td");t.setAttribute("data-field","group"+e),r.appendChild(t)}}}r.classList.add("grand-total"),r.data=n,t?(s=document.createElement("tfoot"),a.$.tableContainer.appendChild(s)):(s=a.$.tableContainer.querySelector("tfoot"),s.innerHTML=""),s.appendChild(r)}_formatSummaryValue(e,t,a,l){const i=this;let o=t.summarySettings;if(t.formatFunction||!o)return i._formatCellValue(e,t,a,l);if(o.align&&a.classList.add("align-"+o.align),isNaN(l)||""===l|null===l)return i._formatCellValue(e,t,a,l);let r=l;if(void 0!==o.decimalPlaces||void 0!==o.thousandsSeparator&&""!==o.thousandsSeparator||void 0!==o.decimalSeparator){const e=new Smart.Utilities.NumberRenderer(l);let t="F";void 0!==o.thousandsSeparator&&""!==o.thousandsSeparator&&(e.localizationObject.thousandsseparator=o.thousandsSeparator,t="N"),void 0!==o.decimalSeparator&&(e.localizationObject.decimalseparator=o.decimalSeparator),isNaN(o.decimalPlaces)&&(o.decimalPlaces=e.localizationObject.defaultPrecision),r=e.formatNumber(l,t+o.decimalPlaces)}return!0===o.negativesInBrackets&&l<0&&(r=`(${r.toString().replace("-","")})`),void 0!==o.prefix&&(r=o.prefix.toString()+r),i._formatCellValue(e,t,a,r)}_overriddenTableHandler(){}_hierarchyArrowClickHandler(e,t,a){const l=this;let i,o,r;if("classic"===l.groupLayout){for(t=t&&t.data?t:Array.from(e.querySelectorAll('td[data-field^="group"]')).find(e=>e.data);!t.classList.contains("main")&&!t.previousElementSibling.classList.contains("expanded");)t=t.previousElementSibling;i=t.data;const a=i.level;r=i.children,o=!i.expanded,i.expanded=o,0===a?(e.setAttribute("aria-expanded",o),e.classList.toggle("expanded",o)):a>0&&i===i.parent.children[0]&&t.classList.toggle("main",o);let n=i.children[0],s=t.nextElementSibling;for(;n&&!n.leaf&&n.expanded;)s.classList.toggle("main",o),n=n.children[0],s=t.nextElementSibling;t.classList.toggle("expanded",o),o?l._expanded[a].push(i):l._expanded[a]=l._expanded[a].filter(e=>e!==i),l._updateDisplayedRecord(i,e),l._updateGroupColumnsVisibility()}else i=e.data,r=i.children,o=!i.expanded,i.expanded=o,e.setAttribute("aria-expanded",o),e.classList.toggle("expanded",o);if(o?(requestAnimationFrame(()=>function e(t){t.forEach(t=>{const a=t.children;l._expandSingleChildRow(t.tr),a&&t.expanded&&requestAnimationFrame(()=>e(a))})}(r)),l.$.fireEvent("expand",{record:i})):(!function e(t){t.forEach(t=>{const a=t.children;l._collapseSingleChildRow(t.tr),a&&e(a)})}(r),l.$.fireEvent("collapse",{record:i})),a&&"cell"===l.selectionMode){const e=l._selectedCells.collection;e.length>1&&(l._selectedCells.isDirty=!0),e.forEach((t,a)=>{e[a]=l._getCellInfo(t.element)}),l._selectedCells.start&&(l._selectedCells.start=l._getCellInfo(l._selectedCells.start.element)),l._selectedCells.end&&(l._selectedCells.end=l._getCellInfo(l._selectedCells.end.element)),"none"!==l.animation?l.$.tableContainer.ontransitionend=function(){requestAnimationFrame(l._showSelectionDetails.bind(l)),l.$.tableContainer.ontransitionend=null}:requestAnimationFrame(l._showSelectionDetails.bind(l))}}_updateDisplayedRecord(e,t){const a=this;if("classic"!==a.groupLayout)return;const l=a._getRecordToDisplay(e);for(let e=0;e<a._dynamicColumns.length;e++){const i=a._dynamicColumns[e],o=i.id;if("group"===o)continue;const r=t.querySelector('td[data-field="'+o+'"]'),n=i.columnTotal?a._aggregateColumns[0]:i.dataFields[i.dataFields.length-1].originalColumn;let s=l[i.id];s=a._formatSummaryValue(l,n,r,s),r.style.backgroundColor=null,r.style.color=null,r.style.fontFamily=null,r.style.fontSize=null,a._applyConditionalFormattingToCell(r,i.id,l.$.index),a._setCellContent(r,s)}}_addSortingCapability(e,t){const a=this;t.cell=e,"group"!==t.id&&e.setAttribute("data-field",t.id),0!==a._rowGroupColumns.length&&(t.headerCellElement=e,e.onclick=function(){const l=t.dataFields[t.dataFields.length-1].originalColumn;a.$.fireEvent("columnClick",{columnDefinition:t,dataField:l.dataField}),"none"===a.sortMode||!1===l.allowSort||a._preventClickSort||(a._addSortIconContainer(t),e.sortIconContainerElement.classList.contains("asc")?a.sortBy(t,"desc"):e.sortIconContainerElement.classList.contains("desc")?a.sortBy(t,null):a.sortBy(t,"asc"))})}_sortCallback(e,t,a){const l=this.rows;l._sort(l.boundSource,e,t,a),l.refreshHierarchy(),this._createDataRows()}_selectAllCheckboxClickHandler(e){super._selectAllCheckboxClickHandler(e,this.rows)}_updateSelectAllState(){super._updateSelectAllState(this.rows.length)}_refreshFilters(e){const t=this,a=[];for(const e in t._filterInfo.appliedFilters){let l=t._filterInfo.appliedFilters[e];a.push([e,l])}0!==a.length?(t.dataSource._filter(a,t._applyingDesignerFilters?"and":"or"),t._applyingDesignerFilters||t.refresh(!0),t._restoringFilters&&t.$.fireEvent("filter",{action:e,filters:a})):t.clearFilters()}_areChildrenFiltered(e,t){if(1===arguments.length&&(t=e.children),!t||0===t.length)return;let a=0;for(let e=0;e<t.length;e++)!1===t[e].leaf?a+=this._areChildrenFiltered(void 0,t[e].children)?1:0:!1!==t[e].$.filtered&&a++;return a}_localize(){this.$.rowGroupBreadcrumb.placeholder=this.localize("dragHereRowGroups"),this.$.pivotBreadcrumb.placeholder=this.localize("dragHerePivots"),this.$.conditionalFormattingButton.setAttribute("tooltip",this.localize("conditionalFormatting")),this.$.fieldsButton.setAttribute("tooltip",this.localize("fields"))}_columnNotify(e){const t=this,a=e.propertyName,l=e.target;switch(a){case"allowFilter":{const a=t._designer;if(a&&a._filtersViewInitialized){const i=Array.from(a.$.filtersView.querySelectorAll("smart-filter-panel")).find(e=>e.column.dataField===l.dataField);i&&(!1===e.newValue?(i.closest("smart-accordion-item.filtered")&&(t._clearDesignerFilters(l.dataField),t._designerFilterHandler({target:i})),i.disabled=!0):i.disabled=!1)}break}case"allowPivot":if(!0!==l.pivot)return;break;case"allowRowGroup":if(!0!==l.rowGroup)return;break;case"pivot":if(!0!==l.allowPivot)return;break;case"rowGroup":if(!0!==l.allowRowGroup)return;break;case"summary":if(!e.newValue&&e.oldValue&&1===t._aggregateColumns.length||t.columnTotals&&e.newValue!==t._totalSummaryFunction)return void(l.summary=e.oldValue)}t._refreshColumns()}_refreshColumns(){const e=this;e._columns=e.columns._array,e.columnByDataField=[],e._columns.forEach(t=>e.columnByDataField[t.dataField]=t),e.refresh(!0),e._designer&&(e._designer.columns=JSON.parse(JSON.stringify(e._columns)))}_initDesigner(e){const t=this.rightToLeft,a=document.createElement("smart-pivot-panel");a.animation=this.animation,a.columns=JSON.parse(JSON.stringify(this._columns)),a.dataSource=this.dataSource.toArray(),a.inverted=e===this.$.designerContainer&&("near"===this.designerPosition&&!t||"far"===this.designerPosition&&t),a.locale=this.locale,a.messages=this.messages,a.rightToLeft=t,a.theme=this.theme,a.unfocusable=!this.keyboardNavigation||this.disabled||this.unfocusable,a.ownerElement=this,this._designer=a,e&&e.appendChild(a)}_designerChangeHandler(e){(this.isInShadowDOM?e.composedPath()[0]:e.target)instanceof Smart.PivotPanel!=!1&&(this.columns=e.detail.columns,this._updateColumns(!0))}_designerFilterHandler(){const e=this,t=Array.from(e._designer.$.filtersView.querySelectorAll("smart-filter-panel")),a=[];if(t.forEach(e=>{const t=e.column,l=e.getFilter();l.filters.length>0&&a.push([t.dataField,l])}),e._filterInfo.appliedFilters){if(0===a.length)return void e.clearFilters();delete e._filterInfo.appliedFilters,e.dataSource.clearFilter()}e._applyingDesignerFilters=!0,a.forEach(t=>e.addFilter(...t)),delete e._applyingDesignerFilters,e.refresh(!0),e._designerFiltersApplied=!0}_clearDesignerFilters(e){if(!this._designerFiltersApplied||this._applyingDesignerFilters)return;const t=this._designer,a=t.view,l=Array.from(t.$.filtersView.querySelectorAll("smart-filter-panel"));t.view="filters",l.forEach(t=>{e&&e!==t.column.dataField||(t._filterHandler.excelClear(),t.closest("smart-accordion-item").classList.remove("filtered"))}),t.view=a}_setFocusable(){const e=this,t=!e.keyboardNavigation||e.disabled||e.unfocusable;super._setFocusable(),e._designer&&(e._designer.unfocusable=t);const a=Array.from(e.$.tableContainer.getElementsByClassName("total-arrow"));t?a.forEach(e=>e.removeAttribute("tabindex")):a.forEach(e=>e.setAttribute("tabindex",0))}_addDragFeedback(){const e=this,t=e._dragDetails.Item,a=document.createElement("div");return a.className="smart-table-feedback",a.setAttribute("parent-table-id",e.id),a.innerHTML=t.columnDefinition.dataFields.map(e=>e.label).join("→"),e.theme&&a.setAttribute("theme",e.theme),document.body.appendChild(a),a}_applyColumnReorder(e,t){const a=this.rightToLeft,l=this._dynamicColumns,i=e.Item.columnDefinition,o=t.classList.contains("right"),r=this._dynamicColumns.filter(e=>e!==i),n=r.indexOf(t.columnDefinition);t.classList.remove("drop-column","left","right"),o&&!a||!o&&a?r.splice(n+1,0,i):r.splice(n,0,i),l.map(e=>e.id).join(",")!==r.map(e=>e.id).join(",")&&(this._clearSortByRow(!0),this._dynamicColumns=r,this.refresh(void 0,this._getCurrentDataStructure()))}_getCurrentDataStructure(){const e=this,t=e._dynamicColumns,a=[],l=`${e._totalSummaryFunction}(${e.localize("total")})`;let i=Number(e._rowGroupColumns.length>0),o=0;if(e.rowTotals&&e._pivotColumns.length>0){const t=e._aggregateColumns.length;"near"===e.rowTotalsPosition?i+=t:o=t}const r=t.find(e=>!e.rowTotal&&!e.columnTotal&&!e.group).dataFields.length;for(let e=0;e<r;e++)for(let n=i;n<t.length-o;n++){void 0===a[e]&&(a[e]=[]);const i=t[n];if(i.columnTotal){const t=i.dataFields[e];e===r-1?a[e].push({label:l,columnDefinition:i,info:{dataField:"TOTAL",label:l,originalColumn:{}}}):t?a[e].push({label:t.label,columnDefinition:i,info:t}):a[e].push({label:"",columnDefinition:i,info:i.dataFields[e-1]})}else a[e].push({label:i.dataFields[e].label,columnDefinition:i,info:i.dataFields[e]})}return a}_breadcrumbCloseHandler(e){const t=this.columns.find(t=>t.dataField===e.detail.item.value.dataField);t&&((this.isInShadowDOM?e.composedPath()[0]:e.target===this.$.rowGroupBreadcrumb)?t.rowGroup=void 0:t.pivot=void 0)}_breadcrumbDragEndHandler(e){const t=this,a=t.isInShadowDOM?e.composedPath()[0]:e.target,l=a===t.$.rowGroupBreadcrumb,i=t._breadcrumbOperation;let o=t.columns.find(t=>t.dataField===e.detail.item.data.value.dataField);if("forbidden"===i)return void(a.dataSource=l?t._rowGroupColumns.map(e=>({label:e.label,value:e})):t._pivotColumns.map(e=>({label:e.label,value:e})));const r=t.columns;if("remove"!==i){if("reorder"===i){const a=e.detail.target;if(!a)return;const l=a.data.value;if(void 0===o||void 0===l||o.dataField===l.dataField)return;const i=e.detail.droppedBeforeTarget?"top":"bottom",n=r.findIndex(e=>e.dataField===o.dataField);let s=r.findIndex(e=>e.dataField===l.dataField);if(n>s&&"bottom"===i||n<s&&"top"===i)return;r.canNotify=!1,r.splice(n,1),s=r.findIndex(e=>e.dataField===l.dataField),"bottom"===i?r.splice(s+1,0,o):r.splice(s,0,o),t.columns=r,r.canNotify=!0}else i instanceof HTMLElement&&(i.$.container.classList.remove("drop-target"),r.canNotify=!1,i===t.$.rowGroupBreadcrumb||t._designer&&i===t._designer.$.rowGroupsTree?(o.pivot=void 0,o.rowGroup=!0):t._designer&&i===t._designer.$.summariesTree?(o[l?"rowGroup":"pivot"]=void 0,o.summary=t._getDefaultSummaryFunction(o)):(i===t.$.pivotBreadcrumb||t._designer&&i===t._designer.$.pivotsTree)&&(o.rowGroup=void 0,o.pivot=!0),r.canNotify=!0);t._refreshColumns()}else l?o.rowGroup=void 0:o.pivot=void 0}_getDefaultSummaryFunction(e){const t=this;return t.columnTotals?t._totalSummaryFunction:t.getDefaultSummaryFunction?t.getDefaultSummaryFunction(e):"count"}_breadcrumbDraggingHandler(e){const t=this,a=t.isInShadowDOM?e.composedPath()[0]:e.target,l=a._dragDrop.dragDetails.feedback,i=e.detail.item.data.value,o=e.detail.originalEvent,r=t._isMobile?t.getRootNode().elementFromPoint(o.clientX,o.clientY):t.isInShadowDOM?o.composedPath()[0]:o.target;let n,s;if(l){if(l.classList.remove("cancel","delete","row-group","summary","pivot"),t._breadcrumbOperation&&t._breadcrumbOperation instanceof HTMLElement&&t._breadcrumbOperation.$.container.classList.remove("drop-target"),a.contains(r))s="reorder";else if(r===document)n="delete",s="remove";else{const e=t._designer;if(s=r.closest("smart-breadcrumb, smart-tree"),s&&s instanceof Smart.Breadcrumb)s===t.$.rowGroupBreadcrumb&&!i.allowRowGroup||s===t.$.pivotBreadcrumb&&!i.allowPivot?(n="cancel",s="forbidden"):n=s===t.$.rowGroupBreadcrumb?"row-group":"pivot";else if(s&&e&&s!==e.$.columnsTree)switch(s){case e.$.rowGroupsTree:a===t.$.rowGroupBreadcrumb?(n="row-group",s="forbidden"):i.allowRowGroup?n="row-group":(n="cancel",s="forbidden");break;case e.$.summariesTree:n="summary";break;case e.$.pivotsTree:a===t.$.pivotBreadcrumb?(n="pivot",s="forbidden"):i.allowPivot?n="pivot":(n="cancel",s="forbidden")}else n="delete",s="remove"}n&&l.classList.add(n),t._breadcrumbOperation=s,s instanceof HTMLElement&&s.$.container.classList.add("drop-target")}}_tableContainerClickHandler(e){const t=this,a=t.isInShadowDOM?e.composedPath()[0]:e.target;if(a.classList.contains("total-arrow"))t._totalArrowClickHandler(a);else{if(t.rowSort&&!a.classList.contains("hierarchy-arrow")){const e=a.closest('td[data-field^="group"]');if(e){if("classic"===t.groupLayout&&(""===e.textContent||e.closest('td:not(.expanded)+td[data-field^="group"]:not(.main), td.expanded:not(.main)+td[data-field^="group"]:not(.main)')))return;return void t._sortByRow(e)}}super._tableContainerClickHandler(e)}}_tableContainerKeydownHandler(e){const t=this,a=t.getRootNode().activeElement;"Enter"===e.key&&a.classList.contains("total-arrow")?t._totalArrowClickHandler(a):"F2"===e.key&&t._focusedCell?t._drillDown({cell:t._focusedCell,dataField:t._focusedCell.getAttribute("data-field"),rowElement:t._focusedCell.parentElement}):super._tableContainerKeydownHandler(e)}_totalArrowClickHandler(e){const t=this,a=e.parentElement,l=a.controller;l.expanded?(l.expanded=!1,function e(a){if(a.children)for(let l=0;l<a.children.length;l++){const i=a.children[l];Array.from(t.$.tableContainer.querySelectorAll(`td[data-field="${i.id}"]`)).forEach(e=>e.classList.add("smart-hidden")),e(i),i.hidden=!0,i.cell.classList.add("smart-hidden"),i.columnTotal&&(i.arrowCell.classList.add("smart-hidden"),i.emptyCells.forEach(e=>e.classList.add("smart-hidden")))}}(l),t.$.fireEvent("collapseTotalColumn",{columnDefinition:l})):(l.expanded=!0,function e(a){if(a.children)for(let l=0;l<a.children.length;l++){const i=a.children[l];Array.from(t.$.tableContainer.querySelectorAll(`td[data-field="${i.id}"]`)).forEach(e=>e.classList.remove("smart-hidden")),i.expanded&&e(i),i.hidden=!1,i.cell.classList.remove("smart-hidden"),i.columnTotal&&(i.arrowCell.classList.remove("smart-hidden"),i.emptyCells.forEach(e=>e.classList.remove("smart-hidden")))}}(l),t.$.fireEvent("expandTotalColumn",{columnDefinition:l})),a.classList.toggle("expanded",l.expanded),function e(a){const l=a.controller;t._getColumnTotalColspan(a),l.parent&&e(l.parent.arrowCell)}(a),t._hideColumnTotalsBorder(),"cell"===t.selectionMode&&t._selectedCells.collection.length>1&&(t._selectedCells.isDirty=!0)}_hideColumnTotalsBorder(){if(!this.columnTotals)return;const e=this.$.tableContainer.firstElementChild;Array.from(e.querySelectorAll(".last-visible")).forEach(e=>e.classList.remove("last-visible"));for(let t=1;t<e.childElementCount;t++){const a=e.children[t].querySelectorAll("th:not(.smart-hidden)");a[a.length-1].classList.add("last-visible")}}_getColumnExportFormat(e,t,a){if(e.columnTotal)return;const l=e.dataFields[e.dataFields.length-1].originalColumn;if(l.align&&(e.group?a.textAlign=l.align:t.textAlign=l.align),e.group||!l.summarySettings)return;const i=l.summarySettings;let o="#.",r=!1;i.align&&(a.textAlign=i.align),void 0!==i.thousandsSeparator&&""!==i.thousandsSeparator&&(o="#"+i.thousandsSeparator+o,r=!0),void 0!==i.decimalPlaces&&(o+="0".repeat(i.decimalPlaces),r=!0),void 0!==i.prefix&&(o=i.prefix.toString()+o,r=!0),i.negativesInBrackets&&(o=`${o};(${o})`,r=!0),r&&(a.format=o)}_beginEdit(e){this._drillDown(e)}_drillDown(e){const t=this,a=e.dataField;if(/^group\d*$/g.test(a))return;const l=e.rowElement,i=e.cell,o=document.createElement("div"),r=document.createElement("smart-table"),n=t._dynamicColumns.find(e=>e.id===a),s=[],d=JSON.parse(JSON.stringify(t._columns)),c=t.localize("total");let u,m,p,h,f=l.data;if(f&&!l.classList.contains("grand-total"))if("classic"===t.groupLayout&&(f=t._getRecordToDisplay(f)),u=f.$.id,f.group){for(m=[f.group.replace(/ \(\d+\)/,"")],h=f.parent;h;)m.push(h.group.replace(/ \(\d+\)/,"")),h=h.parent;m=m.reverse().join("→")}else m=t.localize("notApplicable");else u="GRAND_TOTAL",m=t.localize("grandTotal");if(n.rowTotal)s.push(c);else if(n.columnTotal){for(let e=0;e<=n.dataFields.length-1;e++)s.push(n.dataFields[e].label);s.push(c),p=`${t._totalSummaryFunction}(${c})`}else for(let e=0;e<n.dataFields.length-1;e++)s.push(n.dataFields[e].label);const g=t._originalRecords[u+n.id];g&&0!==g.length&&(o.innerHTML=`<div class="drill-down-details">\n                <span>${t.localize("row")}:</span><strong>${m}</strong>\n                <span>${t.localize("column")}</span><strong>${s.join("→")||t.localize("notApplicable")}</strong>\n                <span>${p||n.dataFields[n.dataFields.length-1].label}:</span><strong>${i.textContent}</strong>\n            </div>`,o.appendChild(r),d.forEach(e=>e.width=t._cellWidth),r.columns=d,r.dataSource=new window.Smart.DataAdapter({dataSource:g,dataFields:t.dataSource._dataFields}),r.freezeHeader=!0,r.keyboardNavigation=t.keyboardNavigation,t._openDialog(t.localize("details"),o,"drill-down"))}_getColumnTotalsOriginalRecords(e,t){const a=this;let l=[];for(let i=0;i<e.children.length;i++){const o=e.children[i];if(!o.columnTotal){const e=a._originalRecords[t+o.id];e&&(l=e);break}l=l.concat(a._getColumnTotalsOriginalRecords(o,t))}return l}_conditionalFormattingButtonClickHandler(e){const t=this._aggregateColumns.map(e=>({label:`${e.summary}(${e.label})`,dataField:e.dataField,dataType:"number"}));super._conditionalFormattingButtonClickHandler(e,t,this.rows)}_applyConditionalFormatting(){const e=this,t=e._conditionalFormatting;e._conditionalFormatting=e._formattingPanel.apply(),e.conditionalFormatting=e._formattingPanel.getItems(),e._conditionalFormatting!==t&&e.refresh(void 0,e._getCurrentDataStructure())}_fieldsButtonClickHandler(){const e=this;e._designer?e._designer.inverted=!1:e._initDesigner(),e._openDialog(e.localize("fields"),e._designer,"fields")}_addDialogHandlers(){const e=this._dialog;e.addEventListener("change",this._dialogEventHandler),e.addEventListener("clear",this._dialogEventHandler),e.addEventListener("filter",this._dialogEventHandler),super._addDialogHandlers()}_dialogEventHandler(e){const t=e.type;if(-1===["change","clear","filter"].indexOf(t))return void super._dialogEventHandler(e);const a=this.ownerElement;if(!(this.isInShadowDOM?e.composedPath()[0]:e.target).closest("smart-pivot-panel"))return;const l=a.context;a.context=a,"change"===t?a._designerChangeHandler(e):a._designerFilterHandler(e),a.context=l}_sortByRow(e){const t=this,a=t.columnTotalsPosition,l=t._originalDynamicColumnsOrder,i=e.parentElement,o=i.data;let r=o;function n(e){"asc"===r.sortOrder?e.sort((function(e,t){return e.value-t.value})):e.sort((function(e,t){return t.value-e.value}))}if("classic"===t.groupLayout&&(r=e.data?e.data:t._getRecordToDisplay(o)),r.sortOrder?"asc"===r.sortOrder?r.sortOrder="desc":delete r.sortOrder:r.sortOrder="asc",t._sortRow&&t._sortRow!==r&&delete t._sortRow.sortOrder,r.sortOrder){if(t.columnTotals){const e=[];if(function e(l,i){const o=[];for(const e of l)o.push({dynamicColumnName:e.id,value:r[e.id]});n(o);for(const l of o){const o=t._getDynamicColumnById[l.dynamicColumnName];"near"===a&&i.push(o),o.children&&e(o.children,i),"far"===a&&i.push(o)}}(t._dynamicColumns.filter(e=>e.columnTotal&&0===e.pivotLevel),e),t._rowGroupColumns.length>0&&e.unshift(t._dynamicColumns[0]),t.rowTotals){const a=t._dynamicColumns.filter(e=>e.rowTotal);"near"===t.rowTotalsPosition?e.splice(1,0,...a):e.push(...a)}t._dynamicColumns=e}else{let e=[];Object.keys(r).filter(e=>-1===["$","children","count","expanded","group","id","leaf","level","parent","parentid","sortOrder","tr"].indexOf(e)).forEach(t=>{e.push({dynamicColumnName:t,value:r[t]})}),n(e),t._dynamicColumns=t._dynamicColumns.sort((function(a,l){return a.group||a.rowTotal||l.group||l.rowTotal?t._dynamicColumns.indexOf(a)-t._dynamicColumns.indexOf(l):e.findIndex(e=>e.dynamicColumnName===a.id)-e.findIndex(e=>e.dynamicColumnName===l.id)}))}t._sortRow=r}else t._dynamicColumns=t._dynamicColumns.sort((function(e,t){return l.findIndex(t=>t===e.id)-l.findIndex(e=>e===t.id)})),delete t._sortRow;t.refresh(void 0,t._getCurrentDataStructure()),t._focusCell(t.$.tableContainer.querySelector(`tr[row-id="${i.getAttribute("row-id")}"] td[data-field="${e.getAttribute("data-field")}"]`))}_clearSortByRow(e,t){const a=this;if(!a._sortRow)return;if(delete a._sortRow.sortOrder,delete a._sortRow,e&&!t)return;const l=a._originalDynamicColumnsOrder;a._dynamicColumns=a._dynamicColumns.sort((function(e,t){return l.findIndex(t=>t===e.id)-l.findIndex(e=>e===t.id)})),e||a.refresh(void 0,a._getCurrentDataStructure())}_defaultSortByRowGroups(e){const t=this,a=t._rowGroupColumns,l=a.find(e=>-1!==e.dataField.toLowerCase().indexOf("month")&&"string"===e.dataType),i=new Smart.DataAdapter({dataSource:e,dataFields:e.dataFields}),o=[],r=[],n=[];let s;if(a.forEach(e=>{o.push(e.dataField),r.push("asc"),n.push(e.dataType)}),l){const e=new Intl.DateTimeFormat(t.locale,{month:"long"}),a=[0,1,2,3,4,5,6,7,8,9,10,11].map(t=>e.format(new Date(2e3,t,1)));s=function(e,t,o,r){e.sort((function(e,i){for(let n=0;n<t.length;n++){if(l.dataField===t[n])return a.indexOf(e.month)-a.indexOf(i.month);const s=r[n](e[t[n]],i[t[n]]);if(0===s){if(t[n+1])continue;return void 0!==e.$.index?(e.$.index-i.$.index)*("asc"===o[n]?1:-1):0}return s*("asc"===o[n]?1:-1)}}));for(let t=0;t<e.length;t++)i[t]=e[t]}}return i._sort(i.boundSource,o,r,n,s),t._dataSourceSortedByDefault=!0,i.toArray()}_tableContainerDownHandler(e){const t=this;if(super._tableContainerDownHandler(e),"cell"!==t.selectionMode)return;clearTimeout(t._mobileScrollTimeout),delete t._selectDrag;const a=(t.isInShadowDOM?e.originalEvent.composedPath()[0]:e.originalEvent.target).closest("tbody td[data-field]");if(!a)return;const l=t._selectedCells;if((e.ctrlKey||e.metaKey)&&l.collection.length>0){const e=l.collection.findIndex(e=>e.element===a);if(-1===e)a.classList.add("selected"),l.collection.push(t._getCellInfo(a));else{a.classList.remove("selected"),l.collection.splice(e,1);const t=l.start&&l.start.element===a,i=l.end&&l.end.element===a;(t||i)&&(delete l.start,delete l.end)}return l.collection.length>0&&(l.isDirty=!0),t._showSelectionDetails(),void t.$.fireEvent("change",{type:"interaction"})}if(e.shiftKey&&l.start)return void t._selectTo(e);const i=(new Date).getTime();let o;function r(){const e=l.collection.slice(0);l.collection.forEach(e=>e.element.classList.remove("selected")),a.classList.add("selected"),delete l.isDirty,l.start=t._getCellInfo(a),l.end=l.start,l.collection=[l.start],l.time=i,t._selectDrag=!0,t._showSelectionDetails(),1===e.length&&e[0].element===a||t.$.fireEvent("change",{type:"interaction"})}t._isMobile&&(o=a.getBoundingClientRect()),t._isMobile?(clearTimeout(t._mobileScrollTimeout),t._mobileScrollTimeout=setTimeout((function(){const e=a.getBoundingClientRect();Math.abs(o.top-e.top)<5&&Math.abs(o.left-e.left)<5&&r()}),500)):r()}_getCellInfo(e){const t=this,a=e.parentElement,l=e.getAttribute("data-field");let i=a.data,o=i[l];return"classic"===this.groupLayout&&(i=t._getRecordToDisplay(i),o=/^group\d*$/.test(l)?i.group:i[l]),{dataField:l,element:e,row:a,rowData:i,value:o}}_documentMoveHandler(e){!this._selectDrag||e.ctrlKey||e.metaKey?super._documentMoveHandler(e):this._selectTo(e)}_selectTo(e){const t=this,a=t._selectedCells;let l;if(l=t._isMobile?t.getRootNode().elementFromPoint(e.originalEvent.clientX,e.originalEvent.clientY):t.isInShadowDOM?e.originalEvent.composedPath()[0]:e.originalEvent.target,!l)return;const i=l.closest("tbody td[data-field]");if(!i||i===a.end.element)return;a.collection.forEach(e=>e.element.classList.remove("selected")),a.collection=[],a.end=t._getCellInfo(i);let o=Array.from(t.$.tableContainer.querySelectorAll("tbody>tr:not(.smart-hidden)")),r=o.indexOf(a.start.row),n=a.start.row===a.end.row?r:o.indexOf(a.end.row),s=t._getDynamicColumnsForCellSelection(),d=s.findIndex(e=>e.id===a.start.dataField),c=a.start.dataField===a.end.dataField?d:s.findIndex(e=>e.id===a.end.dataField);for(let e=Math.min(r,n);e<=Math.max(r,n);e++){const t=o[e],l=t.data;for(let e=Math.min(d,c);e<=Math.max(d,c);e++){const i=s[e].id,o=t.querySelector(`td[data-field="${i}"]`);a.collection.push({dataField:i,element:o,row:t,rowData:l,value:l[i]}),o.classList.add("selected")}}t._showSelectionDetails(),t.$.fireEvent("change",{type:"interaction"}),"down"===e.type&&(t._selectDrag=!0,super._focusCell(a.start.element))}_getDynamicColumnsForCellSelection(){const e=this;let t=e._dynamicColumns.filter(e=>!0!==e.hidden);if(e._rowGroupColumns.length>0&&"classic"===e.groupLayout){const a=t.splice(0,1)[0];for(let l=e._rowGroupColumns.length-1;l>=0;l--)t.unshift(Object.assign({},a,{id:"group"+l}))}return t}_tableContainerTouchmoveHandler(e){const t=this;t._selectDrag&&t._isMobile&&(t._isMobile&&(new Date).getTime()-t._selectedCells.time<500?delete t._selectDrag:(t.$.main.classList.add("prevent-scroll"),e.preventDefault()))}_showSelectionDetails(e){const t=this;if(t.hideCellSelectionTooltip)return;const a=t._selectedCells.collection,l=t.$.tableContainer.querySelector("[selection-detail]");let i;if(l&&(e&&(i=l.getAttribute("selection-detail")),l.removeAttribute("selection-detail"),l.removeAttribute("detail-position-x"),l.removeAttribute("detail-position-y")),!(a.length<=1)){if(void 0===i){let e=0,l=0;for(const t of a)null===t.value||/^group\d*$/.test(t.dataField)||(e++,l+=t.value);if(e<=1)return;let o=l/e;const r=t._aggregateColumns.find(e=>e.summarySettings);if(r){const e=document.createElement("td"),a={summarySettings:r.summarySettings};l=t._formatSummaryValue(void 0,a,e,l),o=t._formatSummaryValue(void 0,a,e,o)}i=`${t.localize("average")}: ${o}; ${t.localize("count")}: ${e}; ${t.localize("sum")}: ${l}`}t._positionTooltipOnLastVisible(a,i)}}_positionTooltipOnLastVisible(e,t){const a=this,l=a.rightToLeft,i=a._getDynamicColumnsForCellSelection(),o=a.getRootNode(),r=a.$.main,n=a.$.tableContainer,s=Array.from(n.children[1].querySelectorAll("tr:not(.smart-hidden):not(.last-visible)")),d=parseFloat(getComputedStyle(a).getPropertyValue("--smart-pivot-table-cell-width")),c=a.grandTotal?n.lastElementChild.offsetHeight:0,u=r.getBoundingClientRect(),m=u.left,p=u.top,h=r.clientWidth,f=r.clientHeight;let g=n.firstElementChild.offsetHeight,_=1,b=1,v=0;a.freezeHeader||(g=Math.max(0,g-r.scrollTop)),a._rowGroupColumns.length>0&&"classic"===a.groupLayout&&(l?(b=.7,v=Math.max(0,r.offsetWidth-h)):_=.7);const y=o.elementFromPoint(m-d*_+5,p+g+5),C=o.elementFromPoint(m+h+d*b-5,p+g+5);let w,T=o.elementFromPoint(m+5,p+g+5),S=o.elementFromPoint(m+h-5,p+g+5);if(y!==T?(T=o.elementFromPoint(m+d*_-5,p+g+5),w=o.elementFromPoint(m+d*_-5,p+f-c-a._rowHeight-5)):w=o.elementFromPoint(m+5,p+f-c-a._rowHeight-5),T||(T=s[0].querySelector("td:not(.smart-hidden)")),w&&"td"===w.tagName.toLowerCase()||(w=s[s.length-1].querySelector(`td[data-field="${T.getAttribute("data-field")}"]`)),C!==S&&(S=o.elementFromPoint(m+h-d*b+v,p+g+5)),!S){const e=s[0].querySelectorAll("td:not(.smart-hidden)");S=e[e.length-1]}const $=s.indexOf(T.parentElement),F=s.indexOf(w.parentElement);let D,L,x,A=i.findIndex(e=>e.id===T.getAttribute("data-field")),E=i.findIndex(e=>e.id===S.getAttribute("data-field"));if(l){const e=A;A=E,E=e}for(const t of e){if(t.row.classList.contains("smart-hidden"))continue;let e,a;if(void 0===t.rowIndex?(e=s.indexOf(t.row),t.rowIndex=e):e=t.rowIndex,void 0===t.columnIndex?(a=i.findIndex(e=>e.id===t.dataField),t.columnIndex=a):a=t.columnIndex,a>=A&&a<=E)if(e>=$&&e<=F){const l=D,i=L;(!D||D.temp||e>=D.rowIndex&&a>=D.columnIndex)&&(D=t),(!L||e>=L.rowIndex&&a<=L.columnIndex)&&(L=t),l&&l.temp&&delete l.temp,i&&i.temp&&delete i.temp}else e>F&&((!D||D.temp&&e<=D.rowIndex&&a>=D.columnIndex)&&(D=t,t.temp=!0),(!L||L.temp&&e<=D.rowIndex&&a<=L.columnIndex)&&(L=t,t.temp=!0))}D&&(Math.abs(D.columnIndex-A)>Math.abs(D.columnIndex-E)?(x=D,l||x.element.setAttribute("detail-position-x","right")):(x=L,l&&x.element.setAttribute("detail-position-x","right")),x.temp&&(x.element.setAttribute("detail-position-y","top"),delete x.temp),x.element.setAttribute("selection-detail",t))}_mainContainerOnscroll(){const e=this;e._selectedCells.collection.length>1&&e._showSelectionDetails(!0)}_focusCell(e,t,a){const l=this;if(!a||"cell"!==l.selectionMode||!l.selection)return void super._focusCell(e,t);const i=l._selectedCells,o=a&&a.shiftKey&&0===a.key.indexOf("Arrow");if(i.isDirty||!o||0===i.collection.length){if(!1===super._focusCell(e,t))return;i.collection.forEach(e=>e.element.classList.remove("selected")),e.classList.add("selected"),i.start=l._getCellInfo(e),i.end=i.start,i.collection=[i.start],delete i.isDirty,l.$.fireEvent("change",{type:"interaction"})}else l._shiftArrowSelection(a);l._showSelectionDetails()}_shiftArrowSelection(e){const t=this,a=t._selectedCells,l=t._getDynamicColumnsForCellSelection(),i=e.key,o=Array.from(t.$.tableContainer.children[1].querySelectorAll("tr:not(.smart-hidden):not(.last-visible)")),r=o.indexOf(a.start.row),n=o.indexOf(a.end.row),s=l.findIndex(e=>e.id===a.start.dataField),d=l.findIndex(e=>e.id===a.end.dataField);if("ArrowUp"===i||"ArrowDown"===i){if("ArrowUp"===i&&n<r||"ArrowDown"===i&&n>r||n===r){if("ArrowUp"===i&&0===n||"ArrowDown"===i&&n===o.length-1)return;const e=o[n+1*("ArrowUp"===i?-1:1)];for(let i=Math.min(s,d);i<=Math.max(s,d);i++){const o=e.querySelector(`td[data-field="${l[i].id}"]`),r=t._getCellInfo(o);a.end.dataField===r.dataField&&(a.end=r,super._focusCell(o,!0)),a.collection.push(r),o.classList.add("selected")}}else if("ArrowDown"===i&&n<r||"ArrowUp"===i&&n>r){const e=o[n+1*(n>r?-1:1)];a.collection.filter(e=>e.row===a.end.row).forEach(e=>e.element.classList.remove("selected")),a.collection=a.collection.filter(e=>e.row!==a.end.row);const t=a.collection.find(t=>t.row===e&&t.dataField===a.end.dataField);a.end=t,super._focusCell(t.element,!0)}}else{let e="ArrowRight",c="ArrowLeft";if(t.rightToLeft&&(e="ArrowLeft",c="ArrowRight"),i===c&&d<s||i===e&&d>s||d===s){if(i===c&&0===d||i===e&&d===l.length-1)return;const s=l[d+1*(i===c?-1:1)];for(let e=Math.min(r,n);e<=Math.max(r,n);e++){const l=o[e].querySelector(`td[data-field="${s.id}"]`),i=t._getCellInfo(l);a.end.row===i.row&&(a.end=i,super._focusCell(l,!0)),a.collection.push(i),l.classList.add("selected")}}else if(i===e&&d<s||i===c&&d>s){const e=l[d+1*(d>s?-1:1)];a.collection.filter(e=>e.dataField===a.end.dataField).forEach(e=>e.element.classList.remove("selected")),a.collection=a.collection.filter(e=>e.dataField!==a.end.dataField);const t=a.collection.find(t=>t.dataField===e.id&&t.row===a.end.row);a.end=t,super._focusCell(t.element,!0)}}t.$.fireEvent("change",{type:"interaction"})}_clearCellSelection(e){const t=this,a=t.$.tableContainer.querySelector("[selection-detail]");a&&(a.removeAttribute("selection-detail"),a.removeAttribute("detail-position-x"),a.removeAttribute("detail-position-y")),t._selectedCells.collection.forEach(e=>e.element.classList.remove("selected")),e&&(t._selectedCells={collection:[]})}_toggleCellSelectionProgrammatically(e,t,a){const l=this,i=l._getDynamicColumnsForCellSelection(),o=l.rows.dataItemById[e];"group"===t&&"classic"===l.groupLayout&&(t="group0");const r=i.find(e=>e.id===t);if(!o||!r)return;const n=l._selectedCells,s=n.collection.find(e=>e.rowData.$.id===o.$.id&&e.dataField===t);if(a){if(s)return;const e=l.$.tableContainer.querySelector(`tr[row-id="${o.$.id}"]>td[data-field="${t}"]`),a=l._getCellInfo(e);e.classList.add("selected"),super._focusCell(e,!0),n.collection.push(a),1===n.collection.length?(n.start=a,n.end=a,delete n.isDirty):n.isDirty=!0}else{if(!s)return;const e=n.start&&n.start.rowData.$.id===o.$.id&&n.start.dataField===t,a=n.end&&n.end.rowData.$.id===o.$.id&&n.end.dataField===t;s.element.classList.remove("selected"),n.collection.splice(n.collection.indexOf(s),1),n.isDirty=!0,(e||a)&&(delete n.start,delete n.end)}l._showSelectionDetails(),l.$.fireEvent("change",{type:"programmatic"})}}),Smart("smart-pivot-panel",class extends Smart.BaseElement{static get properties(){return{columns:{value:[],type:"any",reflectToAttribute:!1},dataSource:{value:[],type:"any?",reflectToAttribute:!1},inverted:{value:!1,type:"boolean"},messages:{value:{en:{calculation:"Calculation",cancel:"Cancel",center:"center",clear:"Clear",columns:"Columns",columnSettings:"Column settings",decimalPlaces:"Decimal places",decimalSeparator:"Decimal separator",dragHereRowGroups:"Drag here to set row groups",dragHereSummaries:"Drag here to set summaries",dragHerePivots:"Drag here to set pivots",filter:"Filter",filters:"Filters",left:"left",moveTo:"Move to",negativesInBrackets:"Negatives in brackets",numberAlignment:"Number alignment",numberFormat:"Number format",numberPrefix:"Number prefix",ok:"OK",pivots:"Pivots",right:"right",rowGroups:"Row Groups",search:"Search...",showRows:"Show records where:",summaries:"Summaries",textAlignment:"Text alignment",thousandsSeparator:"Thousands separator"}},type:"object",extend:!0},view:{value:"columns",allowedValues:["columns","filters"],type:"string"}}}static get listeners(){return{keydown:"_keydownHandler","columnsView.click":"_settingsIconClickHandler","columnsView.dragEnd":"_dragEndHandler","columnsView.dragging":"_draggingHandler","filtersView.clear":"_filterPanelFilterHandler","filtersView.expanding":"_accordionItemExpandingHandler","filtersView.filter":"_filterPanelFilterHandler","summariesTree.dragStart":"_summariesTreeDragStartHandler","tabs.click":"_tabsClickHandler"}}template(){return'<div id="container" role="presentation">\n                    <div id="main" role="presentation">\n                        <div id="columnsView" class="smart-pivot-panel-columns-view" role="tabpanel">\n                            <div id="columns" class="smart-pivot-panel-columns-container" role="presentation">\n                                <smart-tree id="columnsTree" allow-drag allow-drop animation="[[animation]]" filterable selection-mode="zeroOrOne" right-to-left="[[rightToLeft]]" theme="[[theme]]" unfocusable="[[unfocusable]]" aria-label="Columns"></smart-tree>\n                            </div>\n                            <div id="rowGroups" class="smart-pivot-panel-active-columns" role="presentation">\n                                <div id="rowGroupsLabel" class="smart-pivot-panel-row-groups-label smart-pivot-panel-label"><span class="icon" aria-hidden="true"></span><span></span></div>\n                                <smart-tree id="rowGroupsTree" allow-drag allow-drop animation="[[animation]]" selection-mode="zeroOrOne" right-to-left="[[rightToLeft]]" theme="[[theme]]" unfocusable="[[unfocusable]]"></smart-tree>\n                            </div>\n                            <div id="summaries" class="smart-pivot-panel-active-columns" role="presentation">\n                                <div id="summariesLabel" class="smart-pivot-panel-summaries-label smart-pivot-panel-label"><span class="icon" aria-hidden="true"></span><span></span></div>\n                                <smart-tree id="summariesTree" allow-drag allow-drop animation="[[animation]]" selection-mode="zeroOrOne" right-to-left="[[rightToLeft]]" theme="[[theme]]" unfocusable="[[unfocusable]]"></smart-tree>\n                            </div>\n                            <div id="pivots" class="smart-pivot-panel-active-columns" role="presentation">\n                                <div id="pivotsLabel" class="smart-pivot-panel-pivots-label smart-pivot-panel-label"><span class="icon" aria-hidden="true"></span><span></span></div>\n                                <smart-tree id="pivotsTree" allow-drag allow-drop animation="[[animation]]" selection-mode="zeroOrOne" right-to-left="[[rightToLeft]]" theme="[[theme]]" unfocusable="[[unfocusable]]"></smart-tree>\n                            </div>\n                        </div>\n                        <div id="filtersView" class="smart-pivot-panel-filters-view" role="tabpanel"></div>\n                    </div>\n                    <div id="tabs" class="smart-pivot-panel-tabs smart-unselectable">\n                        <div id="columnsTab" class="smart-pivot-panel-tab-item" role="tab" aria-selected="false"><span class="icon" aria-hidden="true"></span><span></span></div>\n                        <div id="filtersTab" class="smart-pivot-panel-tab-item" role="tab" aria-selected="false"><span class="icon" aria-hidden="true"></span><span></span></div>\n                    </div>\n                </div>'}render(){const e=this;e._isMobile=Smart.Utilities.Core.isMobile,e._initializedFilters={},e._cachedFilters={},e._setFocusable(),e._localize(),e._setAriaRelations(),e.dataSource instanceof Smart.DataAdapter&&(e.dataSource=e.dataSource.toArray()),"columns"===e.view?(e.$.columnsTab.classList.add("selected"),e.$.columnsTab.setAttribute("aria-selected",!0),e.$.filtersView.remove(),e._initializeColumnsView()):(e.$.filtersTab.classList.add("selected"),e.$.filtersTab.setAttribute("aria-selected",!0),e.$.columnsView.remove(),e._initializeFiltersView()),super.render()}attached(){const e=this;super.attached(),e.isCompleted&&e._dialog&&(e._addDialogHandlers(),e.getShadowRootOrBody().appendChild(e._dialog))}detached(){if(super.detached(),!this._dialog)return;const e=this._dialog;e.removeEventListener("close",this._dialogCloseHandler),e.removeEventListener("click",this._dialogClickHandler),e.remove()}propertyChangedHandler(e,t,a){super.propertyChangedHandler(e,t,a);const l=this;switch(e){case"animation":case"disabled":case"rightToLeft":case"theme":case"unfocusable":if("disabled"!==e&&"unfocusable"!==e||l._setFocusable(),l._columnsViewInitialized&&"filters"===l.view&&[l.$.columnsTree,l.$.rowGroupsTree,l.$.summariesTree,l.$.pivotsTree].forEach(t=>t[e]=a),l._filtersViewInitialized){Array.from(l.$.filtersView.querySelectorAll("smart-filter-panel")).forEach(t=>t[e]=a),"animation"!==e&&(l.$.filtersView.querySelector("smart-accordion")[e]=a)}if(l._dialog){Array.from(l._dialog.$.container.querySelectorAll(".editor, .ok, .cancel")).forEach(t=>t[e]=a),l._dialog[e]=a}break;case"columns":case"dataSource":if("dataSource"===e&&l.dataSource instanceof Smart.DataAdapter&&(l.dataSource=l.dataSource.toArray()),"columns"===e&&l._columnsViewInitialized&&(delete l._columnsViewInitialized,"columns"===l.view&&l._initializeColumnsView()),l._filtersViewInitialized)if("columns"!==e||t.map(e=>e.dataField).join(",")!==a.map(e=>e.dataField).join(",")){if("columns"===e){Array.from(l.$.filtersView.querySelectorAll("smart-accordion-item.filtered smart-filter-panel")).forEach(e=>{l._cachedFilters[e.column.dataField]=e.$.mainContainer.firstElementChild.selectedIndexes})}delete l._filtersViewInitialized,l._initializedFilters={},l.$.filtersView.innerHTML="","filters"===l.view&&l._initializeFiltersView()}else if("columns"===e){Array.from(l.$.filtersView.querySelectorAll("smart-accordion-item, smart-filter-panel")).forEach(e=>{e.column=a.find(t=>t.dataField===e.column.dataField)})}break;case"locale":case"messages":{const e=Array.from(l.$.filtersView.querySelectorAll("smart-filter-panel")),t=l._dialog;l._localize(),e.forEach(e=>{e.messages.en.clear=l.localize("clear"),e.messages.en.filter=l.localize("filter"),e.messages.en.showRows=l.localize("showRows"),e.propertyChangedHandler("messages")}),t&&(t.close(),t.removeEventListener("close",l._dialogCloseHandler),t.removeEventListener("click",l._dialogClickHandler),t.remove(),delete l._dialog);break}case"view":l._tabsClickHandler({target:l.$[a+"Tab"]})}}_localize(){this.$.columnsTab.children[1].innerHTML=this.localize("columns"),this.$.filtersTab.children[1].innerHTML=this.localize("filters"),this.$.columnsTree.filterInputPlaceholder=this.localize("search"),this.$.rowGroupsLabel.children[1].innerHTML=this.localize("rowGroups"),this.$.summariesLabel.children[1].innerHTML=this.localize("summaries"),this.$.pivotsLabel.children[1].innerHTML=this.localize("pivots")}_initializeColumnsView(){this._columnsViewInitialized||(this._columnsViewInitialized=!0,this._createColumnItems())}_initializeFiltersView(){const e=this;if(e._filtersViewInitialized)return;const t=e.columns,a=document.createElement("smart-accordion");e._filtersViewInitialized=!0;for(let l=0;l<t.length;l++){const i=t[l],o=document.createElement("smart-accordion-item");o.label=i.label,o.column=i,0===l&&e._initFilterPanel(o),e._cachedFilters[i.dataField]&&o.classList.add("filtered"),a.appendChild(o)}a.animation="none",a.expandMode="single",a.rightToLeft=e.rightToLeft,a.theme=e.theme,a.unfocusable=e.unfocusable,e.$.filtersView.appendChild(a)}_initFilterPanel(e){const t=this,a=e.column,l=a.dataField;if(t._initializedFilters[l]){const t=e.querySelector("smart-filter-panel");return void(0===t._filterHandler.filterObject.filters.length&&t._filterHandler.tree.select("0"))}const i=document.createElement("smart-filter-panel"),o=a.dataType;i.animation=t.animation,i.column=a,i.disabled=!1===a.allowFilter,i.filterType="number"===o?"numeric":o,i.mode="excel",i.data=t.dataSource,i.dataField=l,i.messages.en.clear=t.localize("clear"),i.messages.en.filter=t.localize("filter"),i.messages.en.showRows=t.localize("showRows"),i.rightToLeft=t.rightToLeft,i.theme=t.theme,i.unfocusable=t.unfocusable,e.isRendered?e.$.contentContainer.appendChild(i):e.appendChild(i),t._initializedFilters[l]=!0,t._cachedFilters[l]&&i.whenRendered((function(){i.$.mainContainer.firstElementChild.selectedIndexes=t._cachedFilters[l],i._filterHandler.excelFilter(),delete t._cachedFilters[l]}))}_accordionItemExpandingHandler(e){const t=this.isInShadowDOM?e.composedPath()[0]:e.target;if(t instanceof Smart.Accordion==!1)return;const a=t._items[e.detail.index];this._initFilterPanel(a)}_filterPanelFilterHandler(e){const t=(this.isInShadowDOM?e.composedPath()[0]:e.target).closest("smart-accordion-item");"clear"!==e.type||t.classList.contains("filtered")||e.stopPropagation(),t.classList.toggle("filtered","filter"===e.type)}_tabsClickHandler(e){const t=this,a=t.view,l=e.type&&t.isInShadowDOM?e.composedPath()[0]:e.target;if(t.$.columnsTab.contains(l)){if("columns"===a&&e.type)return;return t.view="columns",t.$.columnsTab.classList.add("selected"),t.$.columnsTab.setAttribute("aria-selected",!0),t.$.filtersTab.classList.remove("selected"),t.$.filtersTab.setAttribute("aria-selected",!1),t.$.filtersView.remove(),t.$.main.appendChild(t.$.columnsView),void t._initializeColumnsView()}if(t.$.filtersTab.contains(l)){if("filters"===a&&e.type)return;t.view="filters",t.$.filtersTab.classList.add("selected"),t.$.filtersTab.setAttribute("aria-selected",!0),t.$.columnsTab.classList.remove("selected"),t.$.columnsTab.setAttribute("aria-selected",!1),t.$.columnsView.remove(),t.$.main.appendChild(t.$.filtersView),t._initializeFiltersView()}}_createColumnItems(e){const t=this,a=t.columns,l=[],i=[],o=[],r=[];for(let t=0;t<a.length;t++){const n=a[t];n.allowPivot&&n.pivot&&l.push(n),n.allowRowGroup&&n.rowGroup&&i.push(n),n.summary&&o.push(n),!1!==e&&r.push({label:n.label,value:n})}function n(e,a){const l=[];for(let a=0;a<e.length;a++)l.push({label:t._getTreeItemLabel(e[a]),value:e[a]});a.dataSource=l}n(l,t.$.pivotsTree),n(i,t.$.rowGroupsTree),n(o,t.$.summariesTree),!1!==e&&(t.$.columnsTree.dataSource=r)}_summariesTreeDragStartHandler(e){const t=this.$.summariesTree;1===Object.keys(t.items).length&&e.preventDefault()}_draggingHandler(e){const t=this,a=e.detail.data.Feedback,l=e.detail.item.closest("smart-tree"),i=e.detail.originalEvent.originalEvent,o=t._isMobile?t.getRootNode().elementFromPoint(i.clientX,i.clientY):t.isInShadowDOM?i.composedPath()[0]:i.target,r=o.closest("smart-tree"),n=e.detail.item.value,s=t.ownerElement;if(t._breadcrumbTarget&&(t._breadcrumbTarget.$.container.classList.remove("drop-target"),delete t._breadcrumbTarget),s&&s.contains(o)){const e=o.closest("smart-breadcrumb");if(e)return a.classList.remove("forbidden"),e===s.$.rowGroupBreadcrumb?n.allowRowGroup?n.rowGroup||e.$.container.classList.add("drop-target"):a.classList.add("forbidden"):n.allowPivot?n.pivot||e.$.container.classList.add("drop-target"):a.classList.add("forbidden"),void(t._breadcrumbTarget=e)}l===t.$.columnsTree&&!r||r===t.$.rowGroupsTree&&!n.allowRowGroup||r===t.$.pivotsTree&&!n.allowPivot?a.classList.add("forbidden"):a.classList.remove("forbidden")}_dragEndHandler(e){const t=this,a=e.detail,l=a.previousContainer,i=a.container,o=a.item,r=t.columns.find(e=>e.dataField===o.value.dataField),n=a.target,s=a.data.DropDetails?a.data.DropDetails.position:void 0;function d(){switch(i){case t.$.rowGroupsTree:return!!r.allowRowGroup&&(r.rowGroup=!0,!0);case t.$.summariesTree:return r.summary||(r.summary=t._getDefaultSummaryFunction(r)),!0;case t.$.pivotsTree:return!!r.allowPivot&&(r.pivot=!0,!0)}}function c(){const e=document.createElement("smart-tree-item");return e.label=t._getTreeItemLabel(r),e.value=r,e}function u(){if(l!==i)switch(l){case t.$.rowGroupsTree:delete r.rowGroup;break;case t.$.summariesTree:delete r.summary;break;case t.$.pivotsTree:delete r.pivot}}function m(){if(n.value)return t.columns.find(e=>e.dataField===n.value.dataField)}if(t._breadcrumbTarget)t._breadcrumbDropHandler(r,l);else{if(l===t.$.columnsTree){if(i instanceof Smart.Tree==!1)return o.selected=!!(r.pivot||r.rowGroup||r.summary),void e.preventDefault();if(i===l){let e=!1;return(r.rowGroup&&Object.keys(t.$.rowGroupsTree.items).length>1||r.summary&&Object.keys(t.$.summariesTree.items).length>1||r.pivot&&Object.keys(t.$.pivotsTree.items).length>1)&&(e=!0),void requestAnimationFrame(()=>{const a=t.context;t.context=t,t.columns=t.$.columnsTree.dataSource.map(e=>e.value),e&&(t._createColumnItems(!1),t.$.fireEvent("change",{columns:JSON.parse(JSON.stringify(t.columns))})),t.context=a})}return Object.values(i._menuItems).find(e=>e.value===r)||(d()?(0===i.dataSource.length?i.insert({label:t._getTreeItemLabel(r),value:r}):("top"===s?i.addBefore(c(),n):i.addAfter(c(),n),t._reorder(r,m(),s)),t.$.fireEvent("change",{columns:JSON.parse(JSON.stringify(t.columns))})):o.selected=!!(r.pivot||r.rowGroup||r.summary)),void e.preventDefault()}if(i instanceof Smart.Tree==!1||i===t.$.columnsTree)return u(),l.removeItem(o),t.$.fireEvent("change",{columns:JSON.parse(JSON.stringify(t.columns))}),void e.preventDefault();d()?(u(),t._reorder(r,m(),s),t.$.fireEvent("change",{columns:JSON.parse(JSON.stringify(t.columns))})):e.preventDefault()}}_reorder(e,t,a){const l=this.columns,i=l.indexOf(e);let o=l.indexOf(t);void 0===e||void 0===t||i>o&&"bottom"===a||i<o&&"top"===a||(l.splice(i,1),o=l.indexOf(t),"bottom"===a?l.splice(o+1,0,e):l.splice(o,0,e),this.columns=l,this.$.columnsTree.dataSource=l.map(e=>({label:e.label,value:e,selected:!!(e.pivot||e.rowGroup||e.summary)})))}_breadcrumbDropHandler(e,t){const a=this,l=a._breadcrumbTarget,i=a.ownerElement,o=i.columns.find(t=>t.dataField===e.dataField),r=a.context;function n(){switch(a.context=document,i.columns.canNotify=!1,t){case a.$.rowGroupsTree:o.rowGroup=void 0;break;case a.$.summariesTree:o.summary=void 0;break;case a.$.pivotsTree:o.pivot=void 0}}if(l.$.container.classList.remove("drop-target"),delete a._breadcrumbTarget,l===i.$.rowGroupBreadcrumb){if(!e.allowRowGroup||e.rowGroup)return;n(),o.rowGroup=!0}else{if(!e.allowPivot||e.pivot)return;n(),o.pivot=!0}i._refreshColumns(),a.context=r,i.columns.canNotify=!0}_getTreeItemLabel(e){return'<span class="settings-icon"></span>'+e.label}_settingsIconClickHandler(e){const t=this.isInShadowDOM?e.composedPath()[0]:e.target;t.classList.contains("settings-icon")&&this._openDialog(t.closest("smart-tree-item"))}_openDialog(e){const t=this;t._dialog||t._createDialog();const a=t._dialog,l=e.value,i=!!l.summary,o=Array.from(a.$.container.querySelectorAll(".editor"));let r=l.align||"left";if(t.$.container.setAttribute("modal",""),t._editedItem=e,a.classList.toggle("summary",i),a.setAttribute("aria-controls",e.id),o[0].value="",o[0].$.input.dataValue="",o[0].disabled=e.menu===t.$.summariesTree&&1===Object.keys(e.menu.items).length,o[1].value=t.localize(r),o[1].$.input.dataValue=r,i){let e=Object.assign({align:"left",prefix:"",decimalPlaces:0,thousandsSeparator:"",decimalSeparator:".",negativesInBrackets:!1},l.summarySettings||{});o[2].value=l.summary,o[2].disabled=t.ownerElement&&t.ownerElement.columnTotals,o[3].value=t.localize(e.align),o[3].$.input.dataValue=e.align,o[4].value=e.prefix,o[5].value=e.decimalPlaces.toString(),o[6].value=e.thousandsSeparator,o[7].value=e.decimalSeparator,o[8].checked=e.negativesInBrackets}a.open()}_createDialog(){const e=this.id,t=document.createElement("smart-window"),a=document.createElement("template"),l=` animation=${this.animation} theme="${this.theme}"${this.rightToLeft?" right-to-left":""}${this.unfocusable?" unfocusable":""}`;a.innerHTML=`<smart-button class="ok primary"${l}>${this.localize("ok")}</smart-button>\n<smart-button class="cancel"${l}>${this.localize("cancel")}</smart-button>`;const i=JSON.stringify([{label:this.localize("columns"),value:"columns"},{label:this.localize("rowGroups"),value:"rowGroups"},{label:this.localize("summaries"),value:"summaries"},{label:this.localize("pivots"),value:"pivots"}]),o=JSON.stringify([{label:this.localize("left"),value:"left"},{label:this.localize("center"),value:"center"},{label:this.localize("right"),value:"right"}]),r=JSON.stringify(["min","max","sum","avg","stdev","stdevp","var","varp","product","count","median"]);t.animation=this.animation,t.footerTemplate=a,t.headerButtons=["close"],t.label=this.localize("columnSettings"),t.rightToLeft=this.rightToLeft,t.theme=this.theme,t.unfocusable=this.unfocusable,t.className="smart-pivot-window",t.innerHTML=`<div id="${e}MoveToLabel" class="label">${this.localize("moveTo")}</div>\n            <div><smart-input class="editor underlined move-to"${l} data-source='${i}' drop-down-button-position="right" readonly aria-labelledby="${e}MoveToLabel"></smart-input></div>\n            <div id="${e}TextAlignmentLabel" class="label">${this.localize("textAlignment")}</div>\n            <div><smart-input class="editor underlined text-alignment"${l} data-source='${o}' drop-down-button-position="right" readonly aria-labelledby="${e}TextAlignmentLabel"></smart-input></div>\n            <div id="${e}CalculationLabel" class="label summary">${this.localize("calculation")}</div>\n            <div class="summary"><smart-input class="editor underlined calculation"${l} data-source='${r}' drop-down-button-position="right" readonly aria-labelledby="${e}CalculationLabel"></smart-input></div>\n            <div class="label category summary">${this.localize("numberFormat")}</div>\n            <div id="${e}NumberAlignmentLabel" class="label summary">${this.localize("numberAlignment")}</div>\n            <div class="summary"><smart-input class="editor underlined number-alignment"${l} data-source='${o}' drop-down-button-position="right" readonly aria-labelledby="${e}NumberAlignmentLabel"></smart-input></div>\n            <div id="${e}NumberPrefixLabel" class="label summary">${this.localize("numberPrefix")}</div>\n            <div class="summary"><smart-input class="editor underlined number-prefix"${l} aria-labelledby="${e}NumberPrefixLabel"></smart-input></div>\n            <div id="${e}DecimalPlacesLabel" class="label summary">${this.localize("decimalPlaces")}</div>\n            <div class="summary"><smart-input class="editor underlined decimal-places"${l} aria-labelledby="${e}DecimalPlacesLabel"></smart-input></div>\n            <div id="${e}ThousandsSeparatorLabel" class="label summary">${this.localize("thousandsSeparator")}</div>\n            <div class="summary"><smart-input class="editor underlined thousands-separator"${l} aria-labelledby="${e}ThousandsSeparatorLabel"></smart-input></div>\n            <div id="${e}DecimalSeparatorLabel" class="label summary">${this.localize("decimalSeparator")}</div>\n            <div class="summary"><smart-input class="editor underlined decimal-separator"${l} aria-labelledby="${e}DecimalSeparatorLabel"></smart-input></div>\n            <div id="${e}NegativesInBracketsLabel" class="label summary">${this.localize("negativesInBrackets")}</div>\n            <div class="summary"><smart-check-box class="editor"${l} aria-labelledby="${e}NegativesInBracketsLabel"></smart-check-box></div>`,t.ownerElement=this,this._dialog=t,this._addDialogHandlers(),this.getShadowRootOrBody().appendChild(t),this.setAttribute("aria-owns",t.id)}_addDialogHandlers(){const e=this._dialog;e.addEventListener("close",this._dialogCloseHandler),e.addEventListener("click",this._dialogClickHandler)}_dialogClickHandler(e){const t=this,a=t.isInShadowDOM?e.composedPath()[0]:e.target;a.closest(".ok")?(t.ok=!0,t.close()):a.closest(".cancel")&&t.close()}_dialogCloseHandler(e){const t=this.ownerElement,a=t._dialog,l=t.context;if((a.isInShadowDOM?e.composedPath()[0]:e.target)!==a)return;const i=t._editedItem;if(t.context=t,t.$.container.removeAttribute("modal"),i.menu.focus(),a.ok){const e=i.value,l=Array.from(a.$.container.querySelectorAll(".editor")),o=l[0].$.input.dataValue,r=l[1].$.input.dataValue;let n=!1,s=!1;if(o&&!("rowGroups"===o&&(e.rowGroup||!e.allowRowGroup)||"summaries"===o&&e.summary||"pivots"===o&&(e.pivot||!e.allowPivot))){const a=i.menu;let l;switch(a.removeItem(i.path),a){case t.$.rowGroupsTree:delete e.rowGroup;break;case t.$.summariesTree:delete e.summary;break;case t.$.pivotsTree:delete e.pivot}switch(o){case"rowGroups":l=t.$.rowGroupsTree,e.rowGroup=!0;break;case"summaries":l=t.$.summariesTree,e.summary=t._getDefaultSummaryFunction(e),s=!0;break;case"pivots":l=t.$.pivotsTree,e.pivot=!0}if(l){const a=document.createElement("smart-tree-item");a.label=t._getTreeItemLabel(e),a.value=e,l.addTo(a),a.previousElementSibling&&t._reorder(e,a.previousElementSibling.value,"bottom")}n=!0}if((!e.align&&"left"!==r||e.align&&e.align!==r)&&(e.align=r,n=!0),e.summary&&!s){const t={align:"left",prefix:"",decimalPlaces:0,thousandsSeparator:"",decimalSeparator:".",negativesInBrackets:!1},a=e.summarySettings,i={align:l[3].$.input.dataValue,prefix:l[4].value,decimalPlaces:parseFloat(l[5].value),thousandsSeparator:l[6].value,decimalSeparator:l[7].value,negativesInBrackets:l[8].checked},o=l[2].value;if(isNaN(i.decimalPlaces)&&(i.decimalPlaces=a?a.decimalPlaces:0),o!==e.summary&&(e.summary=o,n=!0),a){const l=Object.assign({},t,a);Object.keys(l).forEach(t=>{l[t]!==i[t]&&(e.summarySettings[t]=i[t],n=!0)})}else JSON.stringify(t)!==JSON.stringify(i)&&(e.summarySettings=i,n=!0)}delete a.ok,n&&t.$.fireEvent("change",{columns:JSON.parse(JSON.stringify(t.columns))})}delete t._editedItem,t.context=l}_setFocusable(){const e=this;if(e.disabled||e.unfocusable)return e.$.columnsTab.removeAttribute("tabindex"),void e.$.filtersTab.removeAttribute("tabindex");const t=e.$.columnsTab.getAttribute("tabindex");(null===t||t<0)&&(e.$.columnsTab.setAttribute("tabindex",0),e.$.filtersTab.setAttribute("tabindex",0))}_keydownHandler(e){const t=this,a=e.key,l=t.getRootNode().activeElement;if("Enter"!==a&&" "!==a||l!==t.$.columnsTab&&l!==t.$.filtersTab){if("Enter"===a&&-1!==[t.$.rowGroupsTree,t.$.summariesTree,t.$.pivotsTree].indexOf(l)){const e=l.querySelector("[focus]");e&&this._openDialog(e)}}else t._tabsClickHandler({target:l})}_getDefaultSummaryFunction(e){const t=this.ownerElement;return t&&t._getDefaultSummaryFunction?t._getDefaultSummaryFunction(e):"count"}_setAriaRelations(){const e=this.id;this.setAttribute("role","tablist"),this.$.columnsView.id=e+"ColumnsView",this.$.columnsTab.id=e+"columnsTab",this.$.columnsTab.setAttribute("aria-controls",this.$.columnsView.id),this.$.columnsView.setAttribute("aria-labelledby",this.$.columnsTab.id),this.$.filtersView.id=e+"FiltersView",this.$.filtersTab.id=e+"FiltersTab",this.$.filtersTab.setAttribute("aria-controls",this.$.filtersView.id),this.$.filtersView.setAttribute("aria-labelledby",this.$.filtersTab.id),this.$.rowGroupsLabel.id=e+"RowGroupsLabel",this.$.rowGroupsTree.setAttribute("aria-labelledby",this.$.rowGroupsLabel.id),this.$.summariesLabel.id=e+"SummariesLabel",this.$.summariesTree.setAttribute("aria-labelledby",this.$.summariesLabel.id),this.$.pivotsLabel.id=e+"PivotsLabel",this.$.pivotsTree.setAttribute("aria-labelledby",this.$.pivotsLabel.id)}})}});