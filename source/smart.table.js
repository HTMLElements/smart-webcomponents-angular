
/* Smart UI v9.1.1 (2021-Feb) 
Copyright (c) 2011-2021 jQWidgets. 
License: https://htmlelements.com/license/ */ //

!function(e){var t={};function a(i){if(t[i])return t[i].exports;var l=t[i]={i:i,l:!1,exports:{}};return e[i].call(l.exports,l,l.exports,a),l.l=!0,l.exports}a.m=e,a.c=t,a.d=function(e,t,i){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var l in e)a.d(i,l,function(t){return e[t]}.bind(null,l));return i},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=103)}({103:function(e,t){Smart("smart-table",class extends Smart.ContentElement{static get properties(){return{autoLoadState:{value:!1,type:"boolean"},autoSaveState:{value:!1,type:"boolean"},columnGroups:{value:null,type:"array?"},columnMinWidth:{value:"50px",type:"any"},columnReorder:{value:!1,type:"boolean"},columnResize:{value:!1,type:"boolean"},columnResizeFeedback:{value:!1,type:"boolean"},columns:{value:[],type:"any?",reflectToAttribute:!1},columnSizeMode:{value:"default",allowedValues:["auto","default"],type:"string"},conditionalFormatting:{value:null,type:"array?",reflectToAttribute:!1},conditionalFormattingButton:{value:!1,type:"boolean"},dataRowId:{value:null,type:"string?"},dataSource:{value:null,type:"any?",reflectToAttribute:!1},dataSourceSettings:{value:{autoGenerateColumns:{value:!1,type:"boolean"},root:{value:"",type:"string"},record:{value:"",type:"string"},keyDataField:{value:"",type:"string"},parentDataField:{value:"",type:"string"},childrenDataField:{value:"",type:"string"},groupBy:{value:[],type:"array"},dataFields:{value:[],type:"array"},mapChar:{value:".",type:"string"},id:{value:"",type:"string"},virtualDataSource:{value:null,type:"any"},virtualDataSourceOnExpand:{value:null,type:"any"}},type:"object"},dataTransform:{value:null,type:"function?",reflectToAttribute:!1},editing:{value:!1,type:"boolean"},editMode:{value:"cell",allowedValues:["cell","row"],type:"string"},filtering:{value:!1,type:"boolean"},filterRow:{value:!1,type:"boolean"},filterTemplate:{value:null,type:"string?"},footerRow:{value:null,type:"string?"},formulas:{value:!1,type:"boolean"},freezeFooter:{value:!1,type:"boolean"},freezeHeader:{value:!1,type:"boolean"},grouping:{value:!1,type:"boolean"},groupFormatFunction:{value:null,type:"any"},headerRow:{value:null,type:"string?"},keyboardNavigation:{value:!1,type:"boolean"},loadColumnStateBehavior:{value:"implementationOnly",allowedValues:["stateOnly","implementationOnly","intersection"],type:"string"},messages:{value:{en:{add:"Add condition",all:"All columns",apply:"Apply",between:"Between",cancel:"Cancel",clearFilter:"Clear filter",close:"Close",column:"Column:",condition:"Condition:",conditionalFormatting:"Conditional Formatting",CONTAINS:"contains",CONTAINS_CASE_SENSITIVE:"contains (case sensitive)",DOES_NOT_CONTAIN:"does not contain",DOES_NOT_CONTAIN_CASE_SENSITIVE:"does not contain (case sensitive)",EMPTY:"empty",ENDS_WITH:"ends with",ENDS_WITH_CASE_SENSITIVE:"ends with (case sensitive)",EQUAL:"equal",equal:"Equal To",EQUAL_CASE_SENSITIVE:"equal (case sensitive)",filterCondition:"Filter condition",filterPlaceholder:"Filter",firstButton:"First",fontFamily:"Font family:",fontSize:"Font size:",format:"Format:",formatColumn:"Format Column",GREATER_THAN:"greater than",GREATER_THAN_OR_EQUAL:"greater than or equal",greaterThan:"Greater Than",highlight:"Highlight",invalidValue:"Invalid value",itemsPerPage:"Items per page:",lastButton:"Last",LESS_THAN:"less than",LESS_THAN_OR_EQUAL:"less than or equal",lessThan:"Less Than",nextButton:"Next",NOT_EMPTY:"not empty",NOT_EQUAL:"not equal",NOT_NULL:"not null",notEqual:"Not Equal To",NULL:"null",ok:"OK",previousButton:"Previous",remove:"Remove condition",secondValue:"Second value:",STARTS_WITH:"starts with",STARTS_WITH_CASE_SENSITIVE:"starts with (case sensitive)",summaryPrefix:"of",text:"Text",value:"Value:",with:"with",grouping:"Group field name is not found in the dataFields collection!"}},type:"object",extend:!0},onCellRender:{value:null,type:"function?",reflectToAttribute:!1},onColumnRender:{value:null,type:"function?",reflectToAttribute:!1},onInit:{value:null,type:"function?",reflectToAttribute:!1},pageSize:{value:10,allowedValues:[10,25,50],type:"int"},pageIndex:{value:0,type:"int"},paging:{value:!1,type:"boolean"},rowDetailTemplate:{value:null,type:"string?"},selected:{value:[],type:"array",reflectToAttribute:!1},selection:{value:!1,type:"boolean"},selectionMode:{value:"many",type:"string",allowedValues:["many","extended"]},sort:{value:null,type:"function?",reflectToAttribute:!1},sortMode:{value:"none",type:"string",allowedValues:["none","one","many"]},stateSettings:{value:["columns","expanded","filtered","grouped","selected","sorted"],type:"array"},tooltip:{value:!1,type:"boolean"},virtualization:{value:!1,type:"boolean"}}}static get listeners(){return{resize:"_resizeHandler","conditionalFormattingButton.click":"_conditionalFormattingButtonClickHandler","filterInput.keyup":"_filterInputKeyupHandler","pager.change":"_pagerChangeHandler","pager.pageSizeChanged":"_pagerPageSizeChanged","tableContainer.change":"_tableContainerChangeHandler","tableContainer.click":"_tableContainerClickHandler","tableContainer.down":"_tableContainerDownHandler","tableContainer.focus":"_tableContainerFocusHandler","tableContainer.pointerover":"_tableContainerPointeroverHandler","document.down":"_documentDownHandler","document.keydown":"_tableContainerKeydownHandler","document.keyup":"_tableContainerKeyupHandler","document.move":"_documentMoveHandler","document.up":"_documentUpHandler"}}template(){return this.virtualization?'<div id="container" class="smart-container" role="presentation">\n                        <div id="header" class="smart-table-header" role="toolbar">\n                            <smart-input id="filterInput" class="underlined" animation="[[animation]]" locale="[[locale]]" right-to-left="[[rightToLeft]]" theme="[[theme]]"></smart-input>\n                            <div id="filterTemplateContainer" class="smart-table-filter-template-container smart-hidden"></div>\n                            <smart-button id="conditionalFormattingButton" class="smart-table-toolbar-button conditional-formatting" animation="[[animation]]" right-to-left="[[rightToLeft]]" theme="[[theme]]" aria-label="Conditional Formatting"></smart-button>\n                        </div>\n                        <smart-scroll-viewer id="virtualizationContainer" class="smart-table-virtualization-container" right-to-left="[[rightToLeft]]" theme="[[theme]]">\n                            <table id="tableContainer" inner-h-t-m-l=\'[[innerHTML]]\' class="smart-table-container">\n                                <content></content>\n                            </table>\n                        </smart-scroll-viewer>\n                        <smart-pager id="pager" animation="[[animation]]" locale="[[locale]]" page-index="[[pageIndex]]" page-size="[[pageSize]]" pages-count="null" show-first-last-navigation-buttons show-page-size-selector show-prev-next-navigation-buttons show-summary right-to-left="[[rightToLeft]]" theme="[[theme]]"></smart-pager>\n                        <div id="loadingIndicatorContainer" class="smart-loader-container smart-hidden" aria-label="Loading">\n                            <span id="loadingIndicator" class="smart-loader" role="presentation"></span>\n                        </div>\n                    </div>':'<div id="container" class="smart-container" role="presentation">\n                    <div id="header" class="smart-table-header" role="toolbar">\n                        <smart-input id="filterInput" class="underlined" animation="[[animation]]" locale="[[locale]]" right-to-left="[[rightToLeft]]" theme="[[theme]]"></smart-input>\n                        <div id="filterTemplateContainer" class="smart-table-filter-template-container smart-hidden"></div>\n                        <smart-button id="conditionalFormattingButton" class="smart-table-toolbar-button conditional-formatting" animation="[[animation]]" right-to-left="[[rightToLeft]]" theme="[[theme]]" aria-label="Conditional Formatting"></smart-button>\n                    </div>\n                    <table id="tableContainer" inner-h-t-m-l=\'[[innerHTML]]\' class="smart-table-container">\n                        <content></content>\n                    </table>\n                    <smart-pager id="pager" animation="[[animation]]" locale="[[locale]]" page-index="[[pageIndex]]" page-size="[[pageSize]]" pages-count="null" show-first-last-navigation-buttons show-page-size-selector show-prev-next-navigation-buttons show-summary right-to-left="[[rightToLeft]]" theme="[[theme]]"></smart-pager>\n                    <div id="loadingIndicatorContainer" class="smart-loader-container smart-hidden" aria-label="Loading">\n                        <span id="loadingIndicator" class="smart-loader" role="presentation"></span>\n                    </div>\n                </div>'}render(){const e=this,t=getComputedStyle(e);if(e.setAttribute("role","presentation"),e.$.tableContainer.id=e.id+"TableContainer",e._cachedWidth=e.offsetWidth,e._cachedHeight=e.offsetHeight,e._defaults={fontFamily:t.fontFamily,fontSize:t.fontSize,text:e._toHex(t.color),highlight:e._toHex(t.backgroundColor)},e._isMobile=Smart.Utilities.Core.isMobile,e._autoScrollCoefficient=Smart.Utilities.Core.Browser.Firefox?8:Smart.Utilities.Core.Browser.Edge?16:4,e._dblclickObject={numberOfClicks:0},e._expandedIds=[],e._selectedIds=[],e._disabledSelection=[],e._selectableGroupRecords=[],e._state={expanded:[],selected:[],sorted:[]},e._rowHeight=parseFloat(t.getPropertyValue("--smart-table-row-height")),e._rowDetailHeight=parseFloat(t.getPropertyValue("--smart-table-row-detail-height")),e._setFocusable(),e.selection&&e.$.tableContainer.setAttribute("aria-multiselectable",!0),e.virtualization){const t=e.$.virtualizationContainer;t._verticalScrollbarHandler=e._onVerticalChange.bind(e),t.hasStyleObserver=!1,t.$.verticalScrollBar.hasStyleObserver=!1,t.$.horizontalScrollBar.hasStyleObserver=!1,e.freezeHeader=!0,e.freezeFooter=!0}e._createElement(),super.render()}attached(){const e=this;super.attached(),e.isCompleted&&e._dialog&&(e._addDialogHandlers(),e.getShadowRootOrBody().appendChild(e._dialog))}detached(){const e=this;if(super.detached(),e._focusedCell&&!e.$.tableContainer.contains(e._focusedCell)&&delete e._focusedCell,!e._dialog)return;const t=e._dialog;t.removeEventListener("change",e._dialogEventHandler),t.removeEventListener("clear",e._dialogEventHandler),t.removeEventListener("click",e._dialogEventHandler),t.removeEventListener("close",e._dialogEventHandler),t.removeEventListener("filter",e._dialogEventHandler),t.remove()}addFilter(e,t){const a=this,i=a.columnByDataField[e];i&&!1!==i.allowFilter&&t instanceof Smart.Utilities.FilterGroup!=!1&&(e=i.dataField,a._clearSortByRow&&a._clearSortByRow(!0),a._designerFiltersApplied&&a._clearDesignerFilters(),a._filterInfo.appliedFilters||(a._filterInfo.appliedFilters={}),a._filterInfo.appliedFilters[e]=t,a._refreshFilters("add"),a._originalDynamicColumnsOrder&&(a._originalDynamicColumnsOrder=a._dynamicColumns.map(e=>e.id)))}addGroup(e){const t=this;if(!t.grouping)return;const a=t.columnByDataField[e];if(!a||!1===a.allowGroup)return;const i=t.dataSource,l=i.groupBy;e=a.dataField,-1===l.indexOf(e)&&(l.push(e),i.refreshHierarchy(),t._getSelectableGroupRecords(),t._fullRefresh(),t._updateState("grouped"),t._doNotFireEvent||t.$.fireEvent("group",{action:"add",dataField:e}))}beginEdit(e,t){const a=this;if(!a.editing)return;const i=a.columnByDataField[t];if(t=i?i.dataField:void 0,"cell"===a.editMode&&!t||i&&!1===i.allowEdit)return;const l=a.rowById[e];if(!l)return;const r=l.data.$.id;a._editing&&a.endEdit(),a._beginEdit({rowId:r,rowObject:l,dataField:t})}cancelEdit(){const e=this,t=e._editing;if(t){for(let a=0;a<t.cells.length;a++){const i=t.cells[a];i.editor.contains(e.getRootNode().activeElement)&&e._focusCell(i.element),i.editor.remove(),e._setCellContent(i.element,e._formatCellValue(t.row,e.columnByDataField[i.dataField],i.element)),i.element.classList.remove("editing")}delete e._editing}}clearFilters(){const e=this,t=e._filterInfo;(t.inputFilters||t.rowFilters||t.appliedFilters)&&(e._clearFilterInput(),e._clearRowFilters(),delete e._filterInfo.appliedFilters,e.dataSource.virtualDataSource||e.dataSource.clearFilter(),e._fullRefresh("filter"),e._updateState("filtered"),e._doNotFireEvent||e.$.fireEvent("filter",{action:"remove"}))}clearGrouping(){const e=this.dataSource;0!==e.groupBy.length&&(e.groupBy=[],e.refreshHierarchy(),this._getSelectableGroupRecords(),this._fullRefresh(),this._updateState("grouped"),this.$.fireEvent("group",{action:"remove"}))}clearSelection(){this._clearSelection(!0)}collapseAllRows(){const e=this;e._isExpandCollapseForbidden()||function t(a){for(let i=0;i<a.length;i++){const l=a[i];l.leaf||(l.children&&t(l.children),l.expanded&&e.collapseRow(l.$.id))}}(e["smart-table"===e.nodeName.toLowerCase()?"dataSource":"rows"].boundHierarchy)}collapseGroup(e){const t=this;if(!t.grouping||0===t.dataSource.groupBy.length)return;const a=t._getGroupByIndex(e);if(!a||!a.expanded)return;const i=t.$.tableContainer.querySelector(`tr[row-id="${a.$.id}"]:not([unused])`);return i?t._isCollapsed(a)?(i.setAttribute("aria-expanded",!1),i.classList.remove("expanded"),void(a.expanded=!1)):void t._hierarchyArrowClickHandler(i):(a.expanded=!1,void t.$.fireEvent("group",{action:"collapse",dataField:a.groupDataField,label:a.label}))}collapseRow(e){const t=this;if(t._isExpandCollapseForbidden())return;const a=t.rowById?t.rowById[e]:t.rows.dataItemById[e],i=a.data||a;if(!a||i.leaf||!i.expanded)return;const l=t.$.tableContainer.querySelector(`tr[row-id="${e}"]:not([unused])`);return l?t._isCollapsed(i)?(l.setAttribute("aria-expanded",!1),l.classList.remove("expanded"),i.expanded=!1,t._expandedIds=t._expandedIds.filter(e=>e!==i.$.id),t._updateState("expanded"),void t.$.fireEvent("collapse",{record:i})):void t._hierarchyArrowClickHandler(l):(i.expanded=!1,t._expandedIds=t._expandedIds.filter(e=>e!==i.$.id),void t._updateState("expanded"))}collapseRowDetails(e){if(!this.rowDetailTemplate)return;const t=this.rowById?this.rowById[e]:this.rows.dataItemById[e],a=t.data||t;if(!t||!a)return;const i=this.$.tableContainer.querySelector(`tr[row-id="${e}"]:not([unused])`);if(!i)return;const l=i.nextElementSibling;l&&l.classList.contains("smart-table-row-detail")&&!l.classList.contains("collapsed")&&this._toggleRowDetail(i,a.$.id)}collapseAllRowDetails(){const e=this;if(!e.rowDetailTemplate||!e.dataSource)return;let t=e.dataSource.boundSource;t||(t=e.$.tableContainer.querySelectorAll("tr[row-id]:not([unused])"));for(let a=0;a<t.length;a++)e.collapseRowDetails(t[a].$.id)}expandAllRowDetails(){const e=this;if(!e.rowDetailTemplate||!e.dataSource)return;let t=e.dataSource.boundSource;t||(t=e.$.tableContainer.querySelectorAll("tr[row-id]:not([unused])"));for(let a=0;a<t.length;a++)e.expandRowDetails(t[a].$.id)}expandRowDetails(e){if(!this.rowDetailTemplate)return;const t=this.rowById?this.rowById[e]:this.rows.dataItemById[e],a=t.data||t;if(!t||!a)return;const i=this.$.tableContainer.querySelector(`tr[row-id="${e}"]:not([unused])`);if(!i)return;const l=i.nextElementSibling;!l&&!this.virtualization||l&&l.classList.contains("smart-table-row-detail")&&!l.classList.contains("collapsed")||this._toggleRowDetail(i,a.$.id)}endEdit(){const e=this,t=e._editing;if(!t)return;const a=t.row,i=a.data,l=[];let r=!0;for(let a=0;a<t.cells.length;a++){const i=t.cells[a],n=e.columnByDataField[i.dataField],o=i.element,s=i.editor;let d;if(n.editor&&n.editor.template?n.editor.getValue&&(d=n.editor.getValue(s)):(d=s.value,s instanceof HTMLInputElement&&("number"===s.type?d=parseFloat(d):"date"===s.type&&(d=new Date(d),isNaN(d.getTime())&&(d=null)))),n.validation){const t=n.validation(d),a=void 0!==t&&!0!==t;if(a){let a;a="object"==typeof t&&t.message?t.message:e.localize("invalidValue"),o.setAttribute("validation-message",a)}else o.removeAttribute("validation-message");o.classList.toggle("invalid",a),r=r&&!a}l.push({column:n,newValue:d})}if(r){if(e.dataSource.virtualDataSource){const a=Object.assign({},i);for(let e=0;e<t.cells.length;e++){const i=t.cells[e],r=l[e],n=r.column;a[i.dataField]=r.newValue,n.transform&&(a[n.dataField]=n.transform(r.newValue))}for(const t of e._columns)a[t.dataField]instanceof Date&&(a[t.dataField]=a[t.dataField].toISOString().slice(0,10));e._editing.row.data=a,e._requestVirtualDataSource("update",(function(t){return t?n(!1,a):(e._editing.row.data=i,e.cancelEdit()),t}))}else n(!0,i);delete e._editing}function n(i,r){for(let n=0;n<t.cells.length;n++){const o=t.cells[n],s=l[n],d=s.column,c=o.editor;c.contains(e.getRootNode().activeElement)&&e._focusCell(o.element),c.remove(),i&&(r[o.dataField]=s.newValue,d.transform&&(r[d.dataField]=d.transform(s.newValue))),e._setCellContent(o.element,e._formatCellValue(a,d,o.element)),o.element.classList.remove("editing"),e.$.fireEvent("cellEndEdit",{row:r,value:r[o.dataField],dataField:o.dataField})}e._updateCellsWithFormulas(),"row"===e.editMode&&e.$.fireEvent("rowEndEdit",{row:r})}}expandAllRows(){const e=this;e._isExpandCollapseForbidden()||function t(a){for(let i=0;i<a.length;i++){const l=a[i];l.leaf||(l.children&&t(l.children),l.expanded||e.expandRow(l.$.id))}}(e["smart-table"===e.nodeName.toLowerCase()?"dataSource":"rows"].boundHierarchy)}expandGroup(e){const t=this,a=t.dataSource;if(!t.grouping||0===a.groupBy.length)return;const i=t._getGroupByIndex(e);if(!i)return;const l=t._doNotFireEvent,r=t.animation,n=t.$.tableContainer.querySelector(`tr[row-id="${i.$.id}"]:not([unused])`);let o=!1;if(l&&(t.animation="none"),!n)return i.expanded=!0,void(i.expanded||l||t.$.fireEvent("group",{action:"expand",dataField:i.groupDataField,label:i.label}));if(t._isCollapsed(i))if(l)o=!0;else{let e=i.parent;e&&!e.expanded&&t.expandGroup(i.parent.$.id.replace("Item","").replace(/_/g,"."))}i.expanded||(o?(i.expanded=!0,n.setAttribute("aria-expanded",!0),n.classList.add("expanded")):t._hierarchyArrowClickHandler(n,l)),l&&requestAnimationFrame(()=>t.animation=r)}expandAllGroups(){const e=this;if(!e.grouping)return;const t=e.dataSource.boundHierarchy;for(let a=0;a<t.length;a++)e.expandGroup(a)}collapseAllGroups(){const e=this;if(!e.grouping)return;const t=e.dataSource.boundHierarchy;for(let a=0;a<t.length;a++)e.collapseGroup(a)}expandRow(e){const t=this;if(t._isExpandCollapseForbidden())return;const a=t.rowById?t.rowById[e]:t.rows.dataItemById[e],i=a.data||a;if(!a||i.leaf)return;const l=t.$.tableContainer.querySelector(`tr[row-id="${e}"]:not([unused])`);if(!l)return i.expanded=!0,-1===t._expandedIds.indexOf(i.$.id)&&t._expandedIds.push(i.$.id),t._updateState("expanded"),void t.$.fireEvent("expand",{record:i});if(t._isCollapsed(i)){let e=i.parent;e&&!e.expanded&&t.expandRow(e.$.id)}i.expanded||t._hierarchyArrowClickHandler(l)}exportData(e,t,a,i){const l=this,r=l._columns.filter(e=>!e.hidden),n=l.columnGroups,o=l.dataSource,s=getComputedStyle(l),d=s.borderRightColor,c=new Smart.Utilities.DataExporter(void 0,o.groupBy.toArray()),u={},f=l.$.tableContainer.firstElementChild.querySelectorAll("th");let h;if(o.virtualDataSource){h=[];for(let e=0;e<l.rows.length;e++)h.push(l.rows[e].data)}else o.boundHierarchy&&!l.grouping?(c.hierarchical=!0,h=function e(t){const i=[];return t.forEach(t=>{a&&!1===t.$.filtered||(i.push(t),t.leaf||(t._expanded=t.expanded,t.children&&(t.children=e(t.children),0===t.children.length&&(t._expanded=void 0,t.children=void 0,t.leaf=!0))))}),i}(JSON.parse(JSON.stringify(o.boundHierarchy,(e,t)=>{if("parent"!==e)return t})))):(h=Array.from(o.toArray()),a&&(h=h.filter(e=>!1!==e.$.filtered)));c.style={border:"1px solid "+d,borderCollapse:"collapse",backgroundColor:s.backgroundColor,color:s.color,fontFamily:"Helvetica",header:{border:"1px solid "+d,fontWeight:"bold"},columns:{border:"1px solid "+d}};for(let e=0;e<r.length;e++){const t=r[e],a={},i={};let l=f[e].offsetWidth+"px";u[t.dataField]=t.label,"date"===t.dataType&&(i.format="d"),a.width=l,c.style.header[t.dataField]=a,c.style.columns[t.dataField]=i}return n?c.header={columns:r,columngroups:n}:h.unshift(u),c.exportData(h,e,t,i)}getRowIndexById(e){const t=this.rowById[e];return this.dataSource&&t&&t.data&&t.data.$?t.data.$.index:-1}getSelection(){const e=this;return 0===e._selectableGroupRecords.length?e._selectedIds:e._selectedIds.filter(t=>-1===e._selectableGroupRecords.indexOf(t))}getState(){return JSON.parse(this._stringifyState())}getValue(e,t){const a=this.columnByDataField[t];if(!a)return;let i=this.rowById[e];return i?i.data[a.dataField]:(i=this.dataSource.dataItemById[e],i?i[a.dataField]:void 0)}loadState(e){const t=this;if(!e&&!(e=window.localStorage.getItem("smartTable"+t.id)))return;const a=t.stateSettings;let i=!1;if(t._loadingState=!0,"string"==typeof e&&(e=JSON.parse(e)),-1!==a.indexOf("columns")){const a=t.loadColumnStateBehavior,l=t._columns,r=[],n=e.columns;for(let e=0;e<n.length;e++){let t=Object.assign({},n[e]);const i=l.find(e=>e.dataField===t.dataField);if(!i){"implementationOnly"!==a&&r.push(t);continue}const o=i.label,s=["editor","formatFunction","templateElement","templateElementSettings","transform","validation"];"stateOnly"!==a&&s.push("label");for(let e in i)-1===s.indexOf(e)&&delete i[e];t=Object.assign(i,t),"stateOnly"!==a&&o&&(t.label=o),r.push(t)}if("stateOnly"!==a)for(let e=0;e<l.length;e++){const t=l[e];r.find(e=>e.dataField===t.dataField)||r.push(t)}t.columns=r,t._initColumns(!0),i=!0,t._formattingPanel&&(t._formattingPanel.columns=t._columns)}if(t.grouping){const a=t.dataSource,l=t.dataSource.groupBy;e.grouped=e.grouped||[],JSON.stringify(l._array)!==JSON.stringify(e.grouped)&&(t.dataSource.groupBy=e.grouped,a.refreshHierarchy(),i=!0)}else t.hasAttribute("hierarchy")&&-1!==a.indexOf("expanded")&&JSON.stringify(t._expandedIds.slice(0).sort())!==JSON.stringify(e.expanded.slice(0).sort())&&(t.collapseAllRows(),t._expandedIds=e.expanded,i=!0);-1!==a.indexOf("selected")&&JSON.stringify(t._selectedIds.slice(0).sort())!==JSON.stringify(e.selected.slice(0).sort())&&(t._selectedIds=e.selected,i=!0),i&&(t._initRows(),t.refresh());e:if(-1!==a.indexOf("filtered")){const a=t.filtering,i=e.filtered;if(t.clearFilters(),!i)break e;if(a&&t.filterRow&&i.rowFilters){const a=t.$.tableContainer.querySelector(".smart-table-filter-row"),i=Number(t.selection),l=e.filtered.filterRowValues;for(let e=0;e<t._columns.length;e++){const r=l[e];if(!r)continue;const n=t._columns[e].dataType,o=a.children[e+i].firstElementChild,s=t._filterInfo["string"===n?"stringConditions":"numberAndDateConditions"].find(e=>e.value===r.condition);if(-1===["EMPTY","NOT_EMPTY","NULL","NOT_NULL"].indexOf(s.value))if("date"===n){const e=new Date(r.value),t=(e.getMonth()+1).toString(),a=e.getDate().toString();o.children[0].value=`${e.getFullYear()}-${"0".repeat(2-t.length)}${t}-${"0".repeat(2-a.length)}${a}`}else o.children[0].value=r.value;o.children[1].value=s.label,o.children[1].$.input.dataValue=s.value}t._applyRowFilters()}else if(a&&i.inputFilters)t.$.filterInput.value=i.query,t._filterByAll(i.query);else if(i.appliedFilters){t._filterInfo.appliedFilters||(t._filterInfo.appliedFilters={});for(let e in i.appliedFilters){const a=i.appliedFilters[e],l=new window.Smart.Utilities.FilterGroup;a.filters.forEach((e,t)=>{const i=l.createFilter(e.type.replace("Filter",""),e.value,e.condition);l.addFilter(a.logicalOperators[t],i)}),t._filterInfo.appliedFilters[e]=l}t._refreshFilters("add")}}-1!==a.indexOf("sorted")&&(t.clearSort(),e.sorted.forEach(e=>{t.sortBy(e.dataField,e.direction)})),a.forEach(e=>t._updateState(e,!1)),t.autoSaveState&&window.localStorage.setItem("smartTable"+t.id,t._stringifyState()),delete t._loadingState}navigateTo(e){const t=this;if(isNaN(e)||null===e)return;const a=t.pageIndex;t.pageIndex=Math.max(Math.min(Math.round(e),t.$.pager.pagesCount-1),0),t.paging&&t.pageIndex!==a&&(t._fullRefresh("pageIndexChange"),t.$.fireEvent("page",{action:"pageIndexChange"}))}removeFilter(e){const t=this,a=t.columnByDataField[e];t._filterInfo.appliedFilters&&a&&(e=a.dataField,t._clearSortByRow&&t._clearSortByRow(!0),t._designerFiltersApplied&&t._clearDesignerFilters(e),delete t._filterInfo.appliedFilters[e],t._refreshFilters("remove"),t._originalDynamicColumnsOrder&&(t._originalDynamicColumnsOrder=t._dynamicColumns.map(e=>e.id)))}removeGroup(e){const t=this.columnByDataField[e];if(!this.grouping||!t)return;e=t.dataField;const a=this.dataSource,i=a.groupBy,l=i.indexOf(e);-1!==l&&(i.splice(l,1),a.refreshHierarchy(),this._getSelectableGroupRecords(),this._fullRefresh(),this._updateState("grouped"),this.$.fireEvent("group",{action:"remove",dataField:e}))}saveState(){const e=this._stringifyState();return window.localStorage.setItem("smartTable"+this.id,e),JSON.parse(e)}select(e){const t=this;t.selection&&(Array.isArray(e)?t._changeSelectionOfMultiple(e,"select"):t._selectSingle(e)&&(t._updateSelectAllState(),t._updateState("selected"),t.$.fireEvent("change",{type:t._interaction?"interaction":"programmatic"})))}setValue(e,t,a){const i=this,l=i.columnByDataField[t];if(!l)return;let r,n=i.rowById[e];if(n)r=n.data;else{if(n=i.dataSource.dataItemById[e],!n)return;r=n}t=l.dataField,i.dataSource._updating=!0,l.transform?(r[l.originalDataField]=a,r[t]=l.transform(a)):r[t]=a;const o=i.$.tableContainer.querySelector(`tr[row-id="${e}"]:not([unused]) td[data-field="${t}"]`);o&&i._setCellContent(o,i._formatCellValue(n,l,o),o.classList.contains("tree-cell")),i._updateCellsWithFormulas(),delete i.dataSource._updating}unselect(e){const t=this;t.selection&&(Array.isArray(e)?t._changeSelectionOfMultiple(e,"unselect"):t._unselectSingle(e)&&(t._updateSelectAllState(),t._updateState("selected"),t.$.fireEvent("change",{type:t._interaction&&-1===t._disabledSelection.indexOf(e)?"interaction":"programmatic"})))}propertyChangedHandler(e,t,a){super.propertyChangedHandler(e,t,a);const i=this;function l(e,t){const a=[];i._dialog&&a.push(i._dialog,i._dialog.$.footer.firstElementChild,i._dialog.$.footer.children[1]),i._formattingPanel&&a.push(i._formattingPanel),a.forEach(a=>a[e]=t)}switch(e){case"animation":case"theme":if("theme"===e){const e=getComputedStyle(i);i._defaults.text=i._toHex(e.color),i._defaults.highlight=i._toHex(e.backgroundColor)}if(i.filterRow){const t=i.$.tableContainer.querySelector(".smart-table-filter-row");Array.from(t.querySelectorAll("smart-input, smart-button")).forEach(t=>t[e]=a)}l(e,a);break;case"autoSaveState":a&&window.localStorage.setItem("smartTable"+i.id,i._stringifyState());break;case"columnGroups":a&&(i.columnResize&&(i.columnResize=!1),"auto"===i.columnSizeMode&&(i.removeAttribute("resize-max-reached"),i.columnSizeMode="default")),i.refresh();break;case"columnMinWidth":if(isNaN(parseFloat(a)))return void(i.columnMinWidth=t);i._handleAutoSizeMode(),i._handleFrozenColumnPositions(),i._refreshHorizontalScrollbar();break;case"columnResize":a&&i.columnGroups&&(i.columnResize=!1);break;case"columns":i._conditionalFormatting&&delete i._conditionalFormatting,i._clearFilterInput(),i._clearRowFilters(),delete i._filterInfo.appliedFilters,i._sortColumns=[],i._initColumns(!0),i.refresh(),i._formattingPanel&&(i._formattingPanel.columns=i._columns);break;case"columnSizeMode":if("auto"===a){if(i.columnGroups)return void(i.columnSizeMode="default");i._handleAutoSizeMode()}else i.removeAttribute("resize-max-reached"),i._columns.forEach(e=>{e.hidden||(e.headerCellElement.style.width=e.width||e._manualWidth?(e.width||e._manualWidth)+"px":null)});i._handleFrozenColumnPositions(),i._refreshHorizontalScrollbar();break;case"conditionalFormatting":i._applyInitialConditionalFormatting(i.dataSource),i._refreshDataRows();break;case"conditionalFormattingButton":i.$.header.classList.toggle("smart-hidden",(!i.filtering||i.filterRow)&&!a),!a&&i._dialog&&i._dialog.close();break;case"dataSource":{const e=i._sortColumns,a=i._filterInfo,l=t.groupBy._array.slice(0);if(i._dataBind(!0),i._doNotFireEvent=!0,l.length>0){const e=i._getExpandedGroups(t.boundHierarchy);l.forEach(e=>i.addGroup(e)),i._restoreExpandedGroups(e)}if(a.inputFilters?i._filterByAll(a.query):a.rowFilters?i._applyRowFilters():a.appliedFilters&&i._refreshFilters(),e&&(i._sortColumns=[],e.forEach(e=>{i.columnByDataField[e.dataField].sortOrder=null,i.sortBy(e.dataField,e.direction)})),i._selectedIds.length>0){const e=JSON.stringify(i._selectedIds.slice(0).sort()),t=i.dataSource;i._selectedIds=i._selectedIds.filter(e=>void 0!==t.dataItemById[e]||-1!==i._selectableGroupRecords.indexOf(e)),e!==JSON.stringify(i._selectedIds.slice(0).sort())&&(i._updateSelectAllState(),i._updateState("selected"),i.$.fireEvent("change",{type:"remove"}))}delete i._doNotFireEvent;break}case"disabled":case"unfocusable":case"keyboardNavigation":i._setFocusable(),l("unfocusable",i.disabled||i.unfocusable||!i.keyboardNavigation),"disabled"===e&&i._dialog&&i._dialog.close();break;case"editing":a?i.$.tableContainer.removeAttribute("aria-readonly"):i.$.tableContainer.setAttribute("aria-readonly",!0);break;case"filtering":i.$.header.classList.toggle("smart-hidden",(!a||i.filterRow)&&!i.conditionalFormattingButton),a&&i.filterRow?i._createFilterRow():!1===a&&(i.filterRow&&i.$.tableContainer.querySelector(".smart-table-filter-row").remove(),(i._filterInfo.query||i._filterInfo.rowFilters||i._filterInfo.appliedFilters)&&i.clearFilters());break;case"filterRow":if(i.$.header.classList.toggle("smart-hidden",(!i.filtering||a)&&!i.conditionalFormattingButton),!i.filtering)return;a?i._createFilterRow():(i.$.tableContainer.querySelector(".smart-table-filter-row").remove(),i._filterInfo.rowFilters&&i.clearFilters());break;case"filterTemplate":i._applyFilterTemplate();break;case"footerRow":{const e=i.$.tableContainer.querySelector("tfoot");e&&e.remove(),a&&i._createFooterRow();break}case"formulas":a?i._formulaParser=new Smart.FormulaParser(i):delete i._formulaParser,i._updateCellsWithFormulas(!0);break;case"freezeHeader":case"freezeFooter":i.virtualization&&(i[e]=!0);break;case"grouping":a||i.clearGrouping();break;case"headerRow":{const e=Array.from(i.$.tableContainer.firstElementChild.children);for(let t=1;t<e.length;t++)e[t].remove();a&&i._createCustomHeaderRow();break}case"locale":case"messages":{const e=i._dialog;if(i._localize(),i.filterRow){const e=i.$.tableContainer.querySelector(".smart-table-filter-row"),t=Array.from(e.querySelectorAll("smart-input.string-filter")),a=Array.from(e.querySelectorAll("smart-input.num-date-filter")),l=Array.from(e.querySelectorAll("smart-button"));t.concat(a).forEach(e=>e.title=i.localize("filterCondition")),t.forEach(e=>{e.dataSource=i._filterInfo.stringConditions,void 0===e.$.input.dataValue?e.value=i.localize("CONTAINS"):e.value=i._filterInfo.stringConditions.find(t=>t.value===e.$.input.dataValue).label}),a.forEach(e=>{e.dataSource=i._filterInfo.numberAndDateConditions,void 0===e.$.input.dataValue?e.value=i.localize("EQUAL"):e.value=i._filterInfo.numberAndDateConditions.find(t=>t.value===e.$.input.dataValue).label}),l.forEach(e=>e.title=i.localize("clearFilter"))}e&&(e.$.footer.firstElementChild.innerHTML=i.localize("ok"),e.$.footer.children[1].innerHTML=i.localize("cancel"),e.classList.contains("conditional-formatting")?e.label=i.localize("conditionalFormatting"):e.classList.contains("drill-down")&&(e.label=i.localize("details"))),i._formattingPanel&&(i._formattingPanel.messages=i.messages,i._formattingPanel.locale=i.locale),Array.from(i.$.tableContainer.querySelectorAll(".group-label-value>.placeholder")).forEach(e=>{e.textContent=i.localize("EMPTY")});break}case"pageIndex":i.pageIndex=Math.max(Math.min(Math.round(a),i.$.pager.pagesCount-1),0),i.paging&&i.pageIndex!==t&&(i._fullRefresh("pageIndexChange"),i.$.fireEvent("page",{action:"pageIndexChange"}));break;case"pageSize":i.paging&&(i._fullRefresh("pageSizeChange"),i.$.fireEvent("page",{action:"pageSizeChange"}));break;case"paging":if(!1===a){if(i.dataSource.virtualDataSource)return void(i.paging=!0);if(1===i.$.pager.pagesCount)return}i._fullRefresh();break;case"rightToLeft":Array.from(i.$.tableContainer.querySelectorAll(".freeze-near, .freeze-far")).forEach(e=>{e.style.left=null,e.style.right=null,e.style.zIndex=null}),i._handleFrozenColumnPositions(),l("rightToLeft",a);break;case"selected":{const e=i._selectedIds.slice(0);i._clearSelection(),i._changeSelectionOfMultiple(a,"select","programmatic",e);break}case"selection":if(i.filterRow){const e=i.$.tableContainer.querySelector(".smart-table-filter-row");a?e.insertBefore(document.createElement("td"),e.firstElementChild):e.firstElementChild.remove()}i.refresh(),a?(i.$.tableContainer.setAttribute("aria-multiselectable",!0),i._updateSelectAllState()):i.$.tableContainer.removeAttribute("aria-multiselectable");break;case"selectionMode":i.$.tableContainer.classList.remove("smart-unselectable");break;case"sortMode":"none"===a&&i.clearSort();break;case"tooltip":if(!a){const e=i.$.tableContainer.querySelector(".tooltip");e&&(e.classList.remove("tooltip"),e.removeAttribute("title"))}break;case"virtualization":i.virtualization=t}}_createElement(){const e=this;e._expandedRowDetailIds=[],e._editors={},isNaN(parseFloat(e.columnMinWidth))&&(e.columnMinWidth="50px"),e.columnGroups&&(e.columnResize=!1,e.columnSizeMode="default"),e.formulas&&(e._formulaParser=new Smart.FormulaParser(e)),e._setupPagingAndFiltering(),e._localize(),e._selectedIds=e.selected.slice(0),e._dataBind(),e.editing||e.$.tableContainer.setAttribute("aria-readonly",!0),e.autoLoadState&&e.loadState(),e.autoSaveState&&window.localStorage.setItem("smartTable"+e.id,e._stringifyState())}_initColumns(e){const t=this,a=t.columns;if(!t.isRendered&&t.dataSource.length>0&&(!a||Array.isArray(a)&&0===a.length)&&(t.columns=t.dataSource.dataFields.map(e=>({label:e.name,dataField:e.name,dataType:e.dataType}))),t._filterInfo.stringDataFields=[],t._columns=[],t.columnByDataField={},t.columns.canNotify=!1,t.columns instanceof Smart.ObservableArray){const e=[];for(let a=0;a<t.columns.length;a++){let i=t.columns[a],l={};for(let e in i)l[e]=i[e];e.push(l)}t.columns=e}for(let a=0;a<t.columns.length;a++){let i=t.columns[a];if("string"==typeof i&&t.dataSource.dataFields){const e=t.dataSource.dataFields.find(e=>{if(e.name===i)return e});i={label:i,dataField:i,dataType:e&&e.dataType||"string"}}void 0===i.label&&void 0===i.dataField||(void 0===i.label&&(i.label=i.dataField),void 0===i.dataField&&(i.dataField=i.label),i.dataType||(i.dataType="string"),"string"!==i.dataType&&"number"!==i.dataType||!1===i.allowFilter||!i.dataField||t._filterInfo.stringDataFields.push(i.dataField),t._transformColumnDataField(i,e),i.thHierarchy=[],t._columns.push(i),t.columnByDataField[i.dataField]=i)}t.columns=new Smart.ObservableArray(t._columns),t._updateState("columns"),t.columns.notify((function(e){if(!t.columns.canNotify)return;if("length"===e.action||"update"===e.action&&-1!==["allowGroup","allowSort","sortOrder"].indexOf(e.propertyName))return void t._updateState("columns");const a=e.target;if("update"===e.action){const i=a.dataField;if("allowEdit"===e.propertyName)return Array.from(t.$.tableContainer.querySelectorAll(`td[data-field="${i}"]`)).forEach(t=>{t.classList.toggle("no-edit",!1===e.newValue),!1===e.newValue?t.setAttribute("aria-readonly",!0):t.removeAttribute("aria-readonly")}),void t._updateState("columns");if("allowFilter"===e.propertyName)return"string"!==a.dataType&&"number"!==a.dataType||!i||(!1===e.newValue?t._filterInfo.stringDataFields=t._filterInfo.stringDataFields.filter(e=>e!==i):!1===e.oldValue&&t._filterInfo.stringDataFields.push(i)),t.filterRow&&t.$.tableContainer.querySelector(`.smart-table-filter-row td[filter-for="${i}"]`).classList.toggle("no-filter",!1===e.newValue),"smart-pivot-table"===t.nodeName.toLowerCase()&&t._columnNotify(e),void t._updateState("columns");if("transform"===e.propertyName)a.sortOrder&&t.sortBy(a.dataField,null),t._transformColumnDataField(a,!0);else{if(-1!==["allowPivot","allowRowGroup","pivot","rowGroup","summary"].indexOf(e.propertyName)&&"smart-pivot-table"===t.nodeName.toLowerCase())return t._columnNotify(e),void t._updateState("columns");if("hidden"===e.propertyName){const e=t._expandedRowDetailIds,a=t.$.tableContainer;let i;return t.filterRow&&(i=a.querySelector(".smart-table-filter-row"),i&&i.remove()),e&&e.length&&!t._columns.some(e=>!e.hidden)&&e.forEach(e=>t._toggleRowDetail(a.querySelector(`[row-id="${e}"]`),e)),t.$.tableContainer.setAttribute("aria-colcount",t._columns.filter(e=>!e.hidden).length+ +t.selection),t.refresh(),void t._updateState("columns")}}}t._columns=t.columns._array,t.columnByDataField=[],t._columns.forEach(e=>{t.columnByDataField[e.dataField]=e,e.originalDataField&&(t.columnByDataField[e.originalDataField]=e)}),t.refresh(!0),t._updateState("columns")})),t.$.tableContainer.setAttribute("aria-colcount",t._columns.filter(e=>!e.hidden).length+ +t.selection)}_transformColumnDataField(e,t){const a=this;if("function"==typeof e.transform){if(!a.isRendered||t){const i=a.dataSource,l=a.columns.canNotify;l&&(a.columns.canNotify=!1),t&&e.originalDataField&&(delete a.columnByDataField[e.dataField],e.dataField=e.originalDataField);const r=e.dataField,n=r+"Transformed";a.columnByDataField[r]=e,e.originalDataField=r,e.dataField=n,i.canNotify=!1;for(let t=0;t<i.length;t++){const a=i[t];a[n]=e.transform(a[r])}l&&(a.columns.canNotify=!0),i.canNotify=!0}}else e.transform&&(e.transform=void 0)}_initRows(){const e=this,t=e.dataSource,a=e.context;if(e.context=e,e.rows=[],e.rowById=[],t.virtualDataSource)return e._initRowsVirtualDataSource(),void(e.context=a);if(t.boundHierarchy)return e.$.tableContainer.setAttribute("role","treegrid"),e.setAttribute("hierarchy",""),e._initHierarchicalRows(),void(e.context=a);e.$.tableContainer.setAttribute("role","grid");let i=0,l=t.length,r=!1;if(e.removeAttribute("hierarchy"),e.paging){const a=e.pageSize;if(e._filterInfo.query||e._filterInfo.rowFilters||e._filterInfo.appliedFilters){let e=0;for(let a=0;a<l;a++)!1!==t[a].$.filtered&&e++;l=e,r=!0}const n=Math.max(Math.ceil(l/a),1);e.$.pager.pagesCount=n,e.$.pager.totalRecords=l,e.pageIndex=Math.max(Math.min(e.pageIndex,n-1),0),i=e.pageIndex*a,l=i+a}if(r){let a=-1;for(let r=0;r<t.length;r++){const n=t[r];if(n&&!1!==n.$.filtered){if(a++,a<i)continue;if(a>=l)break;e._addNewRow(n,r)}}}else for(let a=i;a<l;a++){const i=t[a];i&&!1!==i.$.filtered&&e._addNewRow(i,a)}e._observeRows(),e.context=a}_initRowsVirtualDataSource(){const e=this,t=e.dataSource;if(t.boundHierarchy)e.$.tableContainer.setAttribute("role","treegrid"),e.setAttribute("hierarchy",""),e._processHierarchy(t.boundHierarchy,0,t.boundHierarchy.length);else for(let a=0;a<t._dataSource.length;a++){const i=t[a];i&&!1!==i.$.filtered&&e._addNewRow(i,a)}if(e.paging){const a=t.length,i=e.pageSize,l=Math.max(Math.ceil(a/i),1),r=e.$.pager.pagesCount;if(e.$.pager.pagesCount=l,e.$.pager.totalRecords=a,e.pageIndex=Math.max(Math.min(e.pageIndex,l-1),0),null!==r&&r!==l)return void e._fullRefresh()}e._observeRows()}_initHierarchicalRows(){const e=this,t=e.dataSource.boundHierarchy;let a=0,i=t.length,l=!1;if(e.paging){const r=e.pageSize;if(e._filterInfo.query||e._filterInfo.rowFilters||e._filterInfo.appliedFilters){let e=0;for(let a=0;a<i;a++)!1!==t[a].$.filtered&&e++;i=e,l=!0}const n=Math.max(Math.ceil(i/r),1);e.$.pager.pagesCount=n,e.$.pager.totalRecords=i,e.pageIndex=Math.max(Math.min(e.pageIndex,n-1),0),a=e.pageIndex*r,i=a+r}if(l){let l=-1;for(let r=0;r<t.length;r++){const n=t[r];if(n&&!1!==n.$.filtered){if(l++,l<a)continue;if(l>=i)break;e._processHierarchy(t,r,r+1)}}}else e._processHierarchy(t,a,i);e._observeRows()}_processHierarchy(e,t,a){const i=this;for(let l=t;l<a;l++){const t=e[l];if(!t)break;t.leaf?t&&!1!==t.$.filtered&&i._addNewRow(t,l):(-1!==i._expandedIds.indexOf(t.$.id)?t.expanded=!0:void 0===t.expanded&&(t.expanded=!1),i._addNewRow(t,l),t.children.length&&!1!==t.$.filtered&&i._processHierarchy(t.children,0,t.children.length))}}_observeRows(){const e=this;e.rows=new Smart.ObservableArray(e.rows),e.rows.notify((function(t){if(!e.rows.canNotify||t.path||!e.dataSource)return;e.rows.canNotify=!1;const a=t.action,i=e._selectedIds.slice(0);switch(e.dataSource.canNotify=!1,a){case"add":{const a={};e.dataSource.dataFields.forEach(e=>a[e.name]="");const i=Object.assign(a,e.rows[t.index]);e.dataSource.add(e.rows[t.index]),e._editing={row:{data:i}};break}case"update":e.dataSource.update(t.index,e.rows[t.index]),e._editing={row:{data:e.rows[t.index]}};break;case"remove":{const a=t.removed[0].data,i=a.$.id,l=e._selectedIds.indexOf(i);e.dataSource.removeAt(a.$.index),delete e.rowById[i],-1!==l&&e._selectedIds.splice(l,1),e._editing={row:t.removed[0]};break}}e._fullRefresh(a,i,a),delete e._editing,e.dataSource.canNotify=!0,e.rows.canNotify=!0}))}_addNewRow(e,t){const a=this,i=e.$.id,l=new Smart.Observable({data:e,boundIndex:t});-1!==a._disabledSelection.indexOf(i)&&(l.allowSelect=!1),l.canNotify=!0,l.notify((function(t){if(a._editing||a._hierarchyChange)return;const l=a.selection;if("allowSelect"===t.propertyName){const r=a._disabledSelection.indexOf(i);if(a._hierarchyChange=!0,t.newValue||-1!==r)t.newValue&&-1!==r&&function e(t){const i=t.$.id,r=a.$.tableContainer.querySelector(`[row-id="${i}"]:not([unused])`),n=a.rowById[i];if(t.parent&&-1!==a._disabledSelection.indexOf(t.parent.$.id))n.allowSelect=!1;else if(a._disabledSelection.splice(a._disabledSelection.indexOf(i),1),r&&(r.classList.remove("disable-select"),l&&(r.setAttribute("aria-selected",!1),r.firstElementChild.firstElementChild.removeAttribute("aria-disabled"))),n&&(n.allowSelect=!0),t.children)for(let a=0;a<t.children.length;a++)e(t.children[a])}(e);else{const t=[];!function e(t,i){const r=t.$.id,n=a.$.tableContainer.querySelector(`[row-id="${r}"]:not([unused])`),o=a.rowById[r];if(i.push(r),n&&(n.removeAttribute("aria-selected"),n.classList.add("disable-select"),l&&n.firstElementChild.firstElementChild.setAttribute("aria-disabled",!0)),o&&(o.allowSelect=!1),t.children)for(let a=0;a<t.children.length;a++)e(t.children[a],i)}(e,t),a._disabledSelection=a._disabledSelection.concat(t),a.unselect(t)}delete a._hierarchyChange}})),a.rowById[i]=l,a.rows.push(l)}refresh(){const e=this,t=e._columns.filter(e=>!e.hidden),a=e.$.tableContainer,i=a.querySelector(".smart-table-filter-row"),l=a.querySelector("tfoot"),r=document.createElement("tbody"),n=e._getFractionOfMax(),o=e.$.tableContainer.parentElement,s={top:o.scrollTop,left:o.scrollLeft};for(e.columns.canNotify=!1;a.childNodes.length>0;)a.childNodes[0].remove();e._createTableHeader(),e.isRendered||!e.onInit||e._loadingState||e.onInit(),e._createCustomHeaderRow(),e._createFooterRow(l),e._createDataRows(r),e._createFilterRow(i);const d=a.querySelectorAll("th[data-field]");for(let a=0;a<t.length;a++){const i=t[a];i.headerCellElement=d[a],i.headerCellElement.onclick=function(){const t=this.dataField;e.$.fireEvent("columnClick",{dataField:t}),"none"===e.sortMode||!1===i.allowSort||e._preventClickSort||(e._addSortIconContainer(this),this.headerCellElement.sortIconContainerElement.classList.contains("asc")?e.sortBy(t,"desc"):this.headerCellElement.sortIconContainerElement.classList.contains("desc")?e.sortBy(t,null):e.sortBy(t,"asc"))}.bind(i)}if(e._sortColumns&&e._sortColumns.length>0)for(let t=0;t<e._sortColumns.length;t++){const a=e._sortColumns[t],i=e.columnByDataField[a.dataField];e._addSortIconContainer(i,a.direction,t+1)}e._handleAutoSizeMode(),e._handleFrozenColumnPositions(),e._refreshHorizontalScrollbar(),e.isRendered&&(e.selection&&e._updateSelectAllState(),e._setFractionOfMax(n)),[o.scrollTop,o.scrollLeft]=[s.top,s.left],e.columns.canNotify=!0}_createTableHeader(){const e=this,t=e.selection,a=document.createElement("thead"),i=e._columns.filter(e=>!e.hidden),l=e._getColumnHeaderStructure(),r=window.innerWidth,n={};for(let o=0;o<l;o++){const s=document.createElement("tr"),d=document.createDocumentFragment();t&&(s.innerHTML=o<l-1?'<th class="empty"></th>':'<th class="smart-table-select-all freeze-near" scope="col" aria-colindex="1"><div role="checkbox" aria-checked="false" aria-label="Toggle selection of all rows"></div></th>'),o<l-1&&s.classList.add("column-groups-header");for(let a=0;a<i.length;a++){const s=i[a];if(0===o&&(s.width&&(s.width=parseFloat(s.width),isNaN(s.width)&&delete s.width),s.responsivePriority&&("number"!=typeof s.responsivePriority&&(s.responsivePriority=1),s.responsivePriority=Math.max(Math.min(Math.round(s.responsivePriority),5),1),l>1&&(n[a]=e._isColumnHidden(s.responsivePriority,r)))),o<l-1){if(n[a])continue;const t=i[a],l=t.headerStructure[o];if(a>0){let n=a-1,s=i[n];for(;s&&e._isColumnHidden(s.responsivePriority,r);)n--,s=i[n];if(s){if(l===s.headerStructure[o]&&e._areColumnsWithSameFreezeSettings(t,s))continue}}const s=document.createElement("th");if(s.includes=[t],a<i.length-1){let n=1,d=a+1,c=i[d];for(;c;){if(!e._isColumnHidden(c.responsivePriority,r)){if(l!==c.headerStructure[o]||!e._areColumnsWithSameFreezeSettings(t,c))break;n++,s.includes.push(c)}d++,c=i[d]}s.colSpan=n}0!==o&&t.headerStructure[o-1]===l||(s.textContent=l),s.includes.forEach(e=>e.thHierarchy[o]=s),s.classList.add("column-header"),t.freeze&&s.classList.add("freeze-"+("far"===t.freeze?"far":"near")),d.appendChild(s)}else e._setupColumnHeaderCell(t,d,a,s)}s.appendChild(d),a.appendChild(s)}e.$.tableContainer.appendChild(a)}_getColumnHeaderStructure(){const e=this._columns,t=this.columnGroups;if(!t)return 1;let a=1;for(const i of e){let e=i.columnGroup;if(i.headerStructure=[],e&&(e=t.find(t=>t.name===e),e))for(i.headerStructure.push(e.label||e.name);e.parentGroup&&(e=t.find(t=>t.name===e.parentGroup),e);)i.headerStructure.unshift(e.label||e.name);i.headerStructure.push(i.label),a=Math.max(a,i.headerStructure.length)}for(const t of e){const e=t.headerStructure,i=e[0];for(;e.length<a;)e.unshift(i)}return a}_isColumnHidden(e,t){return!(!e||1===e||t>1280)&&(t<=640&&2===e||t<=800&&3===e||t<=1024&&4===e||t<=1280&&5===e)}_areColumnsWithSameFreezeSettings(e,t){return!e.freeze&&!t.freeze||e.freeze===t.freeze||!0===e.freeze&&"near"===t.freeze||"near"===e.freeze&&!0===t.freeze}_setupColumnHeaderCell(e,t,a,i){const l=this,r=document.createElement("th");r.setAttribute("aria-colindex",a+1+ +e),i.width?(r.style.width=i.width+"px",r.setAttribute("locked","")):i._manualWidth&&(r.style.width=i._manualWidth+"px"),1===l._columns.length&&r.setAttribute("locked",""),i.freeze&&r.classList.add("freeze-"+("far"===i.freeze?"far":"near")),i.responsivePriority&&r.classList.add("priority-"+i.responsivePriority),r.setAttribute("data-field",i.dataField),r.innerHTML=`<div class="wrapper" role="presentation"><div class="label">${i.label}</div></div>`,l.onColumnRender&&l.onColumnRender(i.dataField,r),t.appendChild(r)}_refreshDataRows(){const e=this.$.tableContainer.children[1],t=Array.from(e.querySelectorAll("tr:not(.smart-table-filter-row)"));for(let e=0;e<t.length;e++)t[e].remove();this._createDataRows(e),this._handleAutoSizeMode(),this._handleFrozenColumnPositions(),this._refreshHorizontalScrollbar()}_createDataRows(e){const t=this;if(t.virtualization)return void t._createVirtualDataRows(e);const a=t.rowDetailTemplate,i=t.selection,l=document.createDocumentFragment(),r=t.hasAttribute("hierarchy");for(let e=0;e<t.rows.length;e++){const n=t.rows[e],o=n.data;o.groupDataField?t._createGroupHeader(o,l):t._createDataRow(n,l,{hierarchical:r,rowDetailTemplate:a,selection:i,virtualization:!1})}l.appendChild(t._createLastRow()),e.appendChild(l),t._updateState("expanded"),e.parentElement||t.$.tableContainer.insertBefore(e,t.$.tableContainer.querySelector("tfoot")),t.getRootNode().activeElement===t.$.tableContainer&&t._tableContainerFocusHandler()}_createDataRow(e,t,a){const i=this,l=i._columns.filter(e=>!e.hidden),r=e.data,n=r.$.id,o=document.createElement("tr"),s={row:o,detail:null};let d=0;o.setAttribute("aria-rowindex",r.$.index+1),i._processAndRenderSelection(r,o,a.hierarchical),a.selection&&d++;for(let t=0;t<l.length;t++){const s=document.createElement("td"),c=l[t];s.setAttribute("data-field",c.dataField),s.setAttribute("aria-colindex",t+1+ +a.selection);let u,f=i._formatCellValue(e,c,s);if(c.freeze&&s.classList.add("freeze-"+("far"===c.freeze?"far":"near")),c.responsivePriority&&s.classList.add("priority-"+c.responsivePriority),!1===c.allowEdit&&(s.classList.add("no-edit"),s.setAttribute("aria-readonly",!0)),0===t&&a.hierarchical){const e=i._areChildrenFiltered(r);r.leaf||(s.classList.add("tree-cell"),u=e),r.level&&(s.classList.add("outline-level-"+Math.min(r.level,10)),!r.leaf&&e||s.classList.add("tree-leaf"))}a.virtualization&&c.templateElement?(s.innerHTML=c.templateElement,c.templateElementSettings&&c.templateElementSettings(r[c.dataField],n,s.firstElementChild)):i._setCellContent(s,f,u),i.onCellRender&&i.onCellRender(r,c.dataField,r[c.dataField],s),i._applyConditionalFormattingToCell(s,c.dataField,r.$.index),o.appendChild(s),d++}if(o.data=r,o.setAttribute("row-id",n),-1!==i._disabledSelection.indexOf(n)&&(o.removeAttribute("aria-selected"),o.classList.add("disable-select"),a.selection&&o.firstElementChild.firstElementChild.setAttribute("aria-disabled",!0)),r.expanded&&(-1===i._expandedIds.indexOf(n)&&i._expandedIds.push(n),o.setAttribute("aria-expanded",!0),o.classList.add("expanded")),r.level&&i._isCollapsed(r)&&(o.setAttribute("aria-hidden",!0),o.classList.add("collapsed","smart-hidden")),t.appendChild(o),a.rowDetailTemplate){const l=document.createElement("tr");if(-1===i._expandedRowDetailIds.indexOf(n)){if(a.virtualization)return s;l.setAttribute("aria-hidden",!0),l.classList.add("collapsed")}else s.detail=l;l.data=Object.assign(r,{detail:!0}),l.classList.add("smart-table-row-detail"),l.innerHTML=`<td colspan="${d}"><div class="smart-table-detail-container">${i._applyRowDetailTemplate(e)}</div></td>`,t.appendChild(l)}return s}_processAndRenderSelection(e,t,a,i){const l=this,r=e.$.id,n=l._getChildCheckState(e).state;if(a){const e=l._selectedIds.indexOf(r);!0===n&&-1===e?l._selectedIds.push(r):n||-1===e||l._selectedIds.splice(e,1)}if(!l.selection)return;let o,s;i?(o=t.firstElementChild,s=o.firstElementChild):(o=document.createElement("td"),s=document.createElement("div")),s.className="selection-checkbox",s.setAttribute("role","checkbox"),s.setAttribute("aria-checked",!!n||null===n&&"mixed"),s.setAttribute("aria-label","Toggle row selection"),o.className=`smart-table-select-row freeze-near${n?" selected":null===n?" indeterminate":""}`,o.setAttribute("aria-colindex",1),i||(o.appendChild(s),t.appendChild(o)),t.setAttribute("aria-selected",!0===n)}_applyConditionalFormattingToCell(e,t,a){const i=this;if(i._conditionalFormatting&&i._conditionalFormatting[t]){const l=i._conditionalFormatting[t][a];l&&(e.style.backgroundColor=l.background,e.style.color=l.color,e.style.fontFamily=l.fontFamily,e.style.fontSize=l.fontSize)}}_createLastRow(){const e=document.createElement("tr");e.setAttribute("aria-hidden",!0),e.classList.add("last-visible");try{new ResizeObserver(t=>{try{e.classList.toggle("sized",t[0].contentRect.height>0&&null!==e.previousSibling)}catch(e){}}).observe(e)}catch(e){}return e}_createGroupHeader(e,t,a){const i=this;i.columnByDataField[e.groupDataField]||console.error(i.localize("grouping"));const l=i.columnByDataField[e.groupDataField]?i.columnByDataField[e.groupDataField].label:`${i.localize("EMPTY")}`,r=a||document.createElement("tr"),n=document.createElement("td"),o=document.createElement("div"),s=document.createElement("div"),d=document.createElement("div");let c=e.label;if(""!==c&&c||(c=`<em class="placeholder">${i.localize("EMPTY")}</em>`),r.data=e,s.classList.add("hierarchy-arrow","smart-arrow","smart-arrow-down"),s.setAttribute("role","button"),s.setAttribute("aria-label","Toggle row"),d.classList.add("group-label"),d.innerHTML=`<span class="group-label-name">${l}: </span>\n                            <span class="group-label-value">${c}</span>\n                            <span class="group-label-count">(${i._getLeafCount(e)})</span>`,n.colSpan=i._columns.filter(e=>!e.hidden).length,n.classList.add("group-header"),e.level&&(n.classList.add("outline-level-"+Math.min(e.level,10)),i._isCollapsed(e)&&(r.setAttribute("aria-hidden",!0),r.classList.add("collapsed","smart-hidden"))),r.setAttribute("row-id",e.$.id),o.appendChild(s),o.appendChild(d),n.appendChild(o),i._processAndRenderSelection(e,r,!0),r.appendChild(n),i.groupFormatFunction){const t={value:c,row:e.$.id,column:e.groupDataField,data:e,template:null};i.groupFormatFunction(t),c!==t.value&&(d.innerHTML=`<span class="group-label-name">${l}: </span>\n                <span class="group-label-value">${t.value}</span>\n                <span class="group-label-count">(${i._getLeafCount(e)})</span>`),t.template instanceof HTMLElement&&(d.innerHTML="",d.appendChild(t.template));const a=t.template;let r="";if(a&&a.startsWith("#")){const e=document.querySelector(a);let t=c;if(e&&e instanceof HTMLTemplateElement){const a=e.content.cloneNode(!0),i=document.createElement("div");i.appendChild(a),t=t.toString(),t=t.replace(/'/gi,"\\'"),t=t.replace(/"/gi,'\\"'),r=i.innerHTML.replace(/{{value}}/gi,t),r.indexOf("{{value=")>=0&&(t?(r=r.substring(0,r.indexOf("{{value="))+t+r.substring(r.indexOf("}")),r=r.replace(/}/gi,""),r=r.replace(/{/gi,"")):(r=r.replace(/{{value=/gi,""),r=r.replace(/}}/gi,""))),d.innerHTML=r}}else a&&"string"==typeof a&&(r=a.replace(/{{value}}/gi,c),d.innerHTML=r)}return a||t.appendChild(r),r}_getLeafCount(e){let t=0;return function e(a){for(const i of a)i.leaf?t++:i.children&&i.children.length>0&&e(i.children)}(e.children),t}_isCollapsed(e){let t=e.parent;for(;t;){if(!t.expanded)return!0;t=t.parent}return!1}_areChildrenFiltered(e){if(!e.leaf){if(0===e.children.length&&this.dataSource.virtualDataSource)return!0;for(let t=0;t<e.children.length;t++)if(!1!==e.children[t].$.filtered)return!0;return!1}}_applyRowDetailTemplate(e){const t=this,a=t.dataSource.dataFields;let i=t.rowDetailTemplate;for(let l=0;l<a.length;l++){const r=a[l].name,n=new RegExp(`{{${r}}}`,"g");let o=t.columnByDataField[r]||{dataField:r};if(n.test(i)){let a=t._formatCellValue(e,o,document.createElement("td"));"string"!=typeof a&&(a=e.data[o.dataField]),i=i.replace(n,a)}}return i}_handleFrozenColumnPositions(){const e=this,t=e.rightToLeft,a=e._columns.filter(e=>!e.hidden);let i=[],l=[],r=0;function n(t,i,l,n,o){const s=a[i-r],d=[s.headerCellElement];for(const e of s.thHierarchy)e.includes[0].dataField===s.dataField&&d.push(e);Array.from(e.$.tableContainer.querySelectorAll(`td:nth-child(${i+1})`)).concat(d).forEach(e=>{e.style[t]=l+"px",o&&(e.style.zIndex=2+n)})}e.selection&&(t?l.push(0):i.push(0),r=1);for(let e=0+r;e<a.length+r;e++){const n=a[e-r];n.freeze&&(!t&&"far"===n.freeze||t&&"far"!==n.freeze?l.push(e):i.push(e))}if(i.length<2&&l.length<2)return;const o=[];for(const e of a)o.push(e.headerCellElement.offsetWidth);if(t){for(let e=0;e<i.length-1;e++){const t=i[e];let a=0;for(let e=t+1;e<o.length;e++)-1!==i.indexOf(e)&&(a+=o[e]);n("left",t,a,e,!0)}for(let e=1;e<l.length;e++){const t=l[e];let a=0;for(let e=0;e<t;e++)-1!==l.indexOf(e)&&(a+=o[e]);n("right",t,a,e,!1)}}else{for(let e=1;e<i.length;e++){const t=i[e];let a=0;for(let e=0;e<t;e++)-1!==i.indexOf(e)&&(a+=o[e]);n("left",t,a,e,!1)}for(let e=0;e<l.length-1;e++){const t=l[e];let a=0;for(let e=t+1;e<o.length;e++)-1!==l.indexOf(e)&&(a+=o[e]);n("right",t,a,e,!0)}}}_formatCellValue(e,t,a,i){const l=this;let r=e&&e.data?e.data.$.id:e;if(void 0===i&&(i=e.data[t.dataField]),/<.+?>/.test(i)&&i.replace&&(i=i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;")),l._cellsWithFormulas){const e=t.dataField+":"+r;if("string"==typeof i&&/=.+/.test(i)){const t=l._formulaParser;l._cellsWithFormulas[e]=!0,t&&(i=t.parse(i.slice(1)))}else delete l._cellsWithFormulas[e]}if(t.formatFunction){const l={value:i,row:r,column:t.dataField,data:e.data,cell:a,template:null};if(t.formatFunction(l),i=l.value,l.template instanceof HTMLElement)return l.template;if(null===l.template||"string"!=typeof l.template)return i;const n=l.template;let o="";if(n.startsWith("#")){const e=document.querySelector(n);if(e&&e instanceof HTMLTemplateElement){const t=e.content.cloneNode(!0),a=document.createElement("div");return a.appendChild(t),i=(i=(i=i.toString()).replace(/'/gi,"\\'")).replace(/"/gi,'\\"'),o=a.innerHTML.replace(/{{value}}/gi,i),o.indexOf("{{value=")>=0&&(i?(o=o.substring(0,o.indexOf("{{value="))+i+o.substring(o.indexOf("}")),o=o.replace(/}/gi,""),o=o.replace(/{/gi,"")):(o=o.replace(/{{value=/gi,""),o=o.replace(/}}/gi,""))),o}}return o=n.replace(/{{value}}/gi,i),o}return"date"===t.dataType&&i instanceof Date?i.toLocaleDateString():i}_setCellContent(e,t,a){if(t instanceof HTMLElement==!0){for(;e.childNodes.length>0;)e.childNodes[0].remove();if(a){const a=document.createElement("div");a.innerHTML='<div class="hierarchy-arrow smart-arrow smart-arrow-down" role="button" aria-label="Toggle row"></div><div></div>',a.children[1].appendChild(t),e.appendChild(a)}else e.appendChild(t)}else a?e.innerHTML=t=`<div>\n                                                <div class="hierarchy-arrow smart-arrow smart-arrow-down" role="button" aria-label="Toggle row"></div>\n                                                <div>${t}</div>\n                                            </div>`:/<.+?>/.test(t)||/&\S+;/.test(t)?e.innerHTML=t:e.textContent=t}_dataBind(e){const t=this;if(t._cellsWithFormulas={},t.dataSource){if(t.dataSource instanceof Smart.DataAdapter==!1){const e=t.dataSource;if(Array.isArray(e)){const a=t.columns;let i;if(e.length>0){const t=e[0];i=[];for(let e in t){const a=t[e];"number"==typeof a?i.push({name:e,dataType:"number"}):"boolean"==typeof a?i.push({name:e,dataType:"boolean"}):a instanceof Date?i.push({name:e,dataType:"date"}):i.push({name:e,dataType:"string"})}}a&&a.length>0&&(i=i||[],a.forEach(e=>{if(e.dataType){const t=i.find(t=>t.name===e.dataField);t&&(t.dataType=e.dataType)}})),t.dataSourceSettings.dataFields&&t.dataSourceSettings.dataFields.length>0?t.dataSource=new Smart.DataAdapter({dataSource:t.dataSource,dataSourceType:t.dataSourceSettings.dataSourceType,dataFields:t.dataSourceSettings.dataFields,keyDataField:t.dataSourceSettings.keyDataField,parentDataField:t.dataSourceSettings.parentDataField,childrenDataField:t.dataSourceSettings.childrenDataField,groupBy:t.dataSourceSettings.groupBy,mapChar:t.dataSourceSettings.mapChar,root:t.dataSourceSettings.root,record:t.dataSourceSettings.record,autoGenerateColumns:t.autoGenerateColumns,id:t.dataSourceSettings.id||t.dataRowId,virtualDataSource:t.dataSourceSettings.virtualDataSource,virtualDataSourceOnExpand:t.dataSourceSettings.virtualDataSourceOnExpand}):t.dataSource=new Smart.DataAdapter({dataSource:t.dataSource,dataFields:i,id:t.dataRowId||t.dataSourceSettings.id,dataSourceType:t.dataSourceSettings.dataSourceType,keyDataField:t.dataSourceSettings.keyDataField,parentDataField:t.dataSourceSettings.parentDataField,childrenDataField:t.dataSourceSettings.childrenDataField,groupBy:t.dataSourceSettings.groupBy,mapChar:t.dataSourceSettings.mapChar,root:t.dataSourceSettings.root,record:t.dataSourceSettings.record,autoGenerateColumns:t.autoGenerateColumns,virtualDataSource:t.dataSourceSettings.virtualDataSource,virtualDataSourceOnExpand:t.dataSourceSettings.virtualDataSourceOnExpand})}else t.dataSource=new Smart.DataAdapter({dataSource:[],id:t.dataRowId})}}else{if(t.dataFields=[],!t.columns||Array.isArray(t.columns)&&0===t.columns.length){t.columns=[];const e=t.querySelectorAll("th");for(let a=0;a<e.length;a++){const i=e[a].innerHTML.trim();let l={label:i,dataField:i,dataType:"string"};t.columns.push(l),t.dataFields.push(i)}}else for(let e=0;e<t.columns.length;e++){const a=t.columns[e];"string"==typeof a?t.dataFields.push(a):"object"==typeof a&&t.dataFields.push(a.dataField+(a.dataType?": "+a.dataType:""))}let e=[];if(!t.rows){const a=t.querySelectorAll("tr");for(let i=0;i<a.length;i++){const l={},r=a[i].querySelectorAll("td");if(r.length>0){for(let e=0;e<t.columns.length;e++){l[t.columns[e].dataField]=r[e].innerHTML.trim()}e.push(l)}}t.dataSource=new Smart.DataAdapter({dataSource:e,dataFields:t.dataFields,id:t.dataRowId})}const a=t.$.container.querySelectorAll("table");a.length>1&&a[a.length-1].parentNode.removeChild(a[a.length-1])}t._transformDataSource(),t._applyInitialConditionalFormatting(t.dataSource),t._initColumns(e),t._initRows(),t.dataSource.notify((function(e){if(t.dataSource._updating)return void delete t.dataSource._updating;if(t._editing)return;const a=e.data,i=t._selectedIds.slice(0);let l=e.action;switch(t.rows.canNotify=!1,e.action){case"add":if(a.length)for(let e=0;e<a.length;e++)t._addNewRow(a[e],t.dataSource.length-a.length+e);else t._addNewRow(a,t.dataSource.length-1);break;case"update":if(a.length)for(let i=0;i<a.length;i++){const l=e.index[i];t.rows[l].data=a[i]}break;case"insert":t._addNewRow(a,e.index);for(let e=0;e<t.rows.length;e++){t.rows[e].dataIndex=e}break;case"remove":case"removeLast":l="remove",function(e){const a=e.$.id,i=t._selectedIds.indexOf(a);delete t.rowById[a],t.rows.splice(e.$.index,1),-1!==i&&t._selectedIds.splice(i,1)}(a)}t.rows.canNotify=!0,this.refreshHierarchy(),t._fullRefresh(void 0,i,l)})),t.refresh(),t.dataSource.virtualDataSource&&(t.paging=!0,t._requestVirtualDataSource("dataBind")),t.$.tableContainer.setAttribute("aria-rowcount",t.dataSource.length)}_requestVirtualDataSource(e,t,a=null){const i=this,l=i.pageSize,r=Math.max(i.pageIndex*l,0),n=r+l,o=[],s=[],d={};let c=null;if(i.dataSource._updating=!0,i._sortColumns&&(i._sortColumns.forEach((e,t)=>o[e.dataField]={sortOrder:e.direction,sortIndex:t}),o.length=i._sortColumns.length),i._filterInfo.appliedFilters){for(let e in i._filterInfo.appliedFilters)s[e]=i._filterInfo.appliedFilters[e];s.length=Object.keys(i._filterInfo.appliedFilters).length,c="and"}else{const e=i._filterInfo.inputFilters||i._filterInfo.rowFilters;e&&(e.forEach(e=>s[e[0]]=e[1]),s.length=e.length),c=i._filterInfo.inputFilters?"or":"and"}i._editing&&(d.row=i._editing.row.data),i.$.loadingIndicatorContainer.classList.remove("smart-hidden"),i.setAttribute("loading",""),i.dataSource.onVirtualDataSourceRequested((function(l){let r=!0;-1!==["add","update","remove"].indexOf(e)&&t&&(r=t(l.result)),i.$.loadingIndicatorContainer.classList.add("smart-hidden"),i.removeAttribute("loading"),r&&(a&&(a.expanded=!0),i._initRows(),i._refreshDataRows())}),{first:r,last:n,sorting:o,filtering:s,filterOperator:c,grouping:[],edit:d,row:a,action:e})}sortBy(e,t){const a=this.columnByDataField[e];if(a){if(!1===a.allowSort)return;e=a.dataField}this._sortBy({column:a,columnDataField:e,sortOrder:t,dataFields:this.dataSource.dataFields,columnByDataField:"columnByDataField"})}_sortBy(e){const t=this,a=e.column,i=e.columnDataField,l=e.sortOrder,r=e.dataFields,n=e.columnByDataField,o=[],s=[],d=[],c=function(e){t._addSortIconContainer(e),e.headerCellElement.sortIconContainerElement.classList.remove("desc"),e.headerCellElement.sortIconContainerElement.classList.remove("asc"),e.sortOrder=null},u=function(){if(t._sortColumns&&t._sortColumns.length>0)for(let e=0;e<t._sortColumns.length;e++){const a=t._sortColumns[e],i=t[n][a.dataField];c(i)}t._sortColumns=[]};if(null==a)return void(t._sortColumns&&t._sortColumns.length>0&&(u(),t._sortCallback(o,s,d)));if("none"===t.sortMode||!t.dataSource)return;if(l&&a.sortOrder===l)return;let f=l||"asc";c(a),t._sortColumns||(t._sortColumns=[]);let h="string";for(let e=0;e<r.length;e++){const t=r[e];if(t.name===i){h=t.dataType,"any"===h&&(h="number");break}}let m=!0;for(let e=0;e<t._sortColumns.length;e++){const l=t._sortColumns[e];if(l.dataField===i)if(m=!1,"asc"===l.direction)l.direction="desc",f="desc";else if("desc"===l.direction){t._sortColumns.splice(e,1),c(a),f=null;break}}m&&("one"===t.sortMode&&u(),t._sortColumns.push({dataField:i,direction:f,dataType:h})),t._addSortIconContainer(a),null!==f?(a.headerCellElement.sortIconContainerElement.classList.remove("asc"),a.headerCellElement.sortIconContainerElement.classList.remove("desc"),a.sortOrder=f,"desc"===f?(a.headerCellElement.sortIconContainerElement.classList.add("desc"),a.headerCellElement.setAttribute("aria-sort","descending")):(a.headerCellElement.sortIconContainerElement.classList.add("asc"),a.headerCellElement.setAttribute("aria-sort","ascending"))):(a.headerCellElement.sortIconContainerElement.classList.remove("asc"),a.headerCellElement.sortIconContainerElement.classList.remove("desc"),a.headerCellElement.removeAttribute("aria-sort"));for(let e=0;e<t._sortColumns.length;e++){const a=t._sortColumns[e],i=t[n][a.dataField];o.push(a.dataField),s.push(a.direction),d.push(a.dataType),i.headerCellElement.sortIconContainerElement.setAttribute("order",e+1)}t._sortCallback(o,s,d),t._updateState("sorted"),t._doNotFireEvent||t.$.fireEvent("sort",{columns:t._sortColumns})}_addSortIconContainer(e,t,a){const i=e.headerCellElement;if(!i.sortIconContainerElement){const e=document.createElement("div");e.classList.add("sort-by"),e.setAttribute("aria-hidden",!0),t&&e.classList.add(t),i.firstElementChild.appendChild(e),i.sortIconContainerElement=e,void 0!==a&&e.setAttribute("order",a)}}_sortCallback(e,t,a){const i=this,l=i.dataSource;l.virtualDataSource||(l._sort(i.dataSource.boundSource,e,t,a,i.sort),l.refreshHierarchy()),i._fullRefresh("sort")}clearSort(){this.sortBy(null)}_fullRefresh(e,t,a,i){const l=this;if(l.dataSource.virtualDataSource)return void l._requestVirtualDataSource(e,i);const r=l._getFractionOfMax();t||(t=l._selectedIds.slice(0)),t=JSON.stringify(t.sort()),l._initRows(),l._refreshDataRows(),l._setFractionOfMax(r),"filter"===e&&(l._updateSelectAllState(),a||(a="filter")),t!==JSON.stringify(l._selectedIds.slice(0).sort())&&("filter"!==e&&l._updateSelectAllState(),l._updateState("selected"),l.$.fireEvent("change",{type:a})),"string"==typeof e&&-1!==e.indexOf("page")&&l._fixFrozenHeaderFirefox()}_pagerChangeHandler(e){(this.isInShadowDOM?e.composedPath()[0]:e.target)===this.$.pager&&(this.pageIndex=e.detail.index,this._fullRefresh("pageIndexChange"),this.$.fireEvent("page",{action:"pageIndexChange"}))}_pagerPageSizeChanged(e){this.pageSize=e.detail.value,this._fullRefresh("pageSizeChange"),this.$.fireEvent("page",{action:"pageSizeChange"})}_filterInputKeyupHandler(){const e=this;clearTimeout(e._filterInputTimeout),e._filterInputTimeout=setTimeout((function(){if(e._filterInfo&&e.$.filterInput.value!==e._filterInfo.query){const t=e.context;e.context=e,e._filterByAll(e.$.filterInput.value),e.context=t}}),500)}_filterByAll(e){const t=this;if(t._filterInfo.query=e,""===e)return void t.clearFilters();const a=[];t._clearRowFilters(),delete t._filterInfo.appliedFilters,t._filterInfo.stringDataFields.forEach(t=>{const i=new Smart.Utilities.FilterGroup,l=i.createFilter("string",e,"CONTAINS");i.addFilter("or",l),a.push([t,i])}),t.dataSource.virtualDataSource||t.dataSource._filter(a,"or"),t._filterInfo.inputFilters=a,t._fullRefresh("filter"),t._updateState("filtered"),t._doNotFireEvent||t.$.fireEvent("filter",{action:"add",filters:a})}_setupPagingAndFiltering(){this.$.pager.$.pageSizeSelector.classList.add("underlined"),this.$.pager.$.pageSizeSelector.dropDownAppendTo="body",this._filterInfo={query:""},this._applyFilterTemplate(),this.$.header.classList.toggle("smart-hidden",(!this.filtering||this.filterRow)&&!this.conditionalFormattingButton)}_applyFilterTemplate(){const e=this,t=e.filterTemplate;if(e.$.filterTemplateContainer.innerHTML="",!t)return e.$.filterInput.classList.remove("smart-hidden"),e.$.filterTemplateContainer.classList.add("smart-hidden"),void(e.filterTemplate=null);const a=document.getElementById(t);if(a&&a instanceof HTMLTemplateElement){const t=document.importNode(a.content,!0);e.$.filterInput.classList.add("smart-hidden"),e.$.filterTemplateContainer.classList.remove("smart-hidden"),e.$.filterTemplateContainer.appendChild(t)}else e.filterTemplate=null,e.$.filterInput.classList.remove("smart-hidden"),e.$.filterTemplateContainer.classList.add("smart-hidden")}_refreshFilters(e){const t=this,a=[];for(let e in t._filterInfo.appliedFilters){let i=t._filterInfo.appliedFilters[e];a.push([e,i])}0!==a.length?(t._clearFilterInput(),t._clearRowFilters(),t.dataSource.virtualDataSource||t.dataSource._filter(a,"or"),t._fullRefresh("filter"),t._updateState("filtered"),e&&!t._doNotFireEvent&&t.$.fireEvent("filter",{action:e,filters:a})):t.clearFilters()}_localize(){const e=this,t=e.$.pager;t.messages[e.locale]||(t.messages[e.locale]={}),t.messages[e.locale].pageSizeLabel=e.localize("itemsPerPage"),t.messages[e.locale].summaryPrefix=e.localize("summaryPrefix"),t.messages[e.locale].summarySuffix="",t.$.firstButton.setAttribute("tooltip",e.localize("firstButton")),t.$.previousButton.setAttribute("tooltip",e.localize("previousButton")),t.$.nextButton.setAttribute("tooltip",e.localize("nextButton")),t.$.lastButton.setAttribute("tooltip",e.localize("lastButton")),e.$.filterInput.placeholder=e.localize("filterPlaceholder"),e.$.conditionalFormattingButton.setAttribute("tooltip",e.localize("conditionalFormatting")),e._filterInfo.stringConditions=[{value:"EMPTY",label:e.localize("EMPTY")},{value:"NOT_EMPTY",label:e.localize("NOT_EMPTY")},{value:"CONTAINS",label:e.localize("CONTAINS")},{value:"CONTAINS_CASE_SENSITIVE",label:e.localize("CONTAINS_CASE_SENSITIVE")},{value:"DOES_NOT_CONTAIN",label:e.localize("DOES_NOT_CONTAIN")},{value:"DOES_NOT_CONTAIN_CASE_SENSITIVE",label:e.localize("DOES_NOT_CONTAIN_CASE_SENSITIVE")},{value:"STARTS_WITH",label:e.localize("STARTS_WITH")},{value:"STARTS_WITH_CASE_SENSITIVE",label:e.localize("STARTS_WITH_CASE_SENSITIVE")},{value:"ENDS_WITH",label:e.localize("ENDS_WITH")},{value:"ENDS_WITH_CASE_SENSITIVE",label:e.localize("ENDS_WITH_CASE_SENSITIVE")},{value:"EQUAL",label:e.localize("EQUAL")},{value:"EQUAL_CASE_SENSITIVE",label:e.localize("EQUAL_CASE_SENSITIVE")},{value:"NULL",label:e.localize("NULL")},{value:"NOT_NULL",label:e.localize("NOT_NULL")}],e._filterInfo.numberAndDateConditions=[{value:"EQUAL",label:e.localize("EQUAL")},{value:"NOT_EQUAL",label:e.localize("NOT_EQUAL")},{value:"LESS_THAN",label:e.localize("LESS_THAN")},{value:"LESS_THAN_OR_EQUAL",label:e.localize("LESS_THAN_OR_EQUAL")},{value:"GREATER_THAN",label:e.localize("GREATER_THAN")},{value:"GREATER_THAN_OR_EQUAL",label:e.localize("GREATER_THAN_OR_EQUAL")},{value:"NULL",label:e.localize("NULL")},{value:"NOT_NULL",label:e.localize("NOT_NULL")}]}_createFilterRow(e){const t=this;if(!t.filtering||!t.filterRow)return;if(e)return void t.$.tableContainer.children[1].insertBefore(e,t.$.tableContainer.children[1].firstElementChild);const a=document.createElement("tr"),i=` animation="${t.animation}" `,l=t.rightToLeft?" right-to-left":"",r=t._columns.filter(e=>!e.hidden);let n="";a.className="smart-table-filter-row",t.selection&&(n+="<td></td>");for(let e=0;e<r.length;e++){const a=r[e],o=[];let s,d,c,u;"string"===a.dataType?(s=t._filterInfo.stringConditions,d="string",c="string-filter",u=t.localize("CONTAINS")):(s=t._filterInfo.numberAndDateConditions,d=a.dataType,c="num-date-filter",u=t.localize("EQUAL")),a.freeze&&o.push("freeze-"+("far"===a.freeze?"far":"near")),a.responsivePriority&&o.push("priority-"+a.responsivePriority),!1===a.allowFilter&&o.push("no-filter"),n+=`<td${o.length?' class="'+o.join(" ")+'"':""} filter-for="${a.dataField}">\n                            <div>\n                                <input type="${d}" class="filter-value" aria-label="Filter value" />\n                                <smart-input class="${c}${i}data-source='${JSON.stringify(s)}' drop-down-button-position="right" drop-down-width="auto" readonly${l} value="${u}" title="${t.localize("filterCondition")}" aria-label="Filter condition"></smart-input>\n                                <smart-button class="smart-hidden" title="${t.localize("clearFilter")}"${i}${l} aria-label="Clear filter"></smart-button>\n                            </div>\n                        </td>`}a.innerHTML=n,t.$.tableContainer.children[1].insertBefore(a,t.$.tableContainer.children[1].firstElementChild)}_tableContainerChangeHandler(e){const t=this,a=t.isInShadowDOM?e.composedPath()[0]:e.target;a.classList.contains("filter-value")&&("date"===a.type||a instanceof Smart.Input&&(""!==a.previousElementSibling.value||-1!==["EMPTY","NOT_EMPTY","NULL","NOT_NULL"].indexOf(e.detail.value)))&&t._applyRowFilters()}_tableContainerClickHandler(e){const t=this;if(t._editing)return;const a=t.isInShadowDOM?e.composedPath()[0]:e.target;if(!t.$.tableContainer.contains(a))return;const i=a.closest("tbody tr[row-id], tfoot tr.grand-total");if(i){const l=a.closest("td");if(a.classList.contains("hierarchy-arrow"))return void t._hierarchyArrowClickHandler(i,l);const r=i.getAttribute("row-id");let n=t.rowById?t.rowById[r].data:t.rows.dataItemById[r];const o=n?n.$.id:void 0,s=l?l.getAttribute("data-field"):void 0;if(!n&&i.classList.contains("grand-total")&&(n=i.data),void 0!==s&&t.$.fireEvent("cellClick",{id:r,row:n,dataField:s,value:n[s],originalEvent:e}),t._toggleSelection(i,n,e,a),t.editing||t.drillDown){if(!s||l.classList.contains("no-edit"))return;clearTimeout(t._dblclickObject.timeout),t._dblclickObject.numberOfClicks++,2===t._dblclickObject.numberOfClicks?(t._dblclickObject.numberOfClicks=0,t._beginEdit({rowElement:i,cell:l,dataField:s})):t._dblclickObject.timeout=setTimeout((function(){t._dblclickObject.numberOfClicks=0}),300)}return void(t.rowDetailTemplate&&t._toggleRowDetail(i,o))}const l=a.closest(".smart-table-select-all");if(l)return void t._selectAllCheckboxClickHandler(l);const r=a.closest(".smart-table-filter-row smart-button");if(r){const e=r.parentElement.firstElementChild,a=r.parentElement.children[1];return e.value="",-1!==["EMPTY","NOT_EMPTY","NULL","NOT_NULL"].indexOf(a.$.input.dataValue)&&(a.value=t.localize("text"===e.type?"CONTAINS":"EQUAL"),delete a.$.input.dataValue),void t._applyRowFilters()}}_toggleSelection(e,t,a,i){const l=this;if(!l.selection||"cell"===l.selectionMode||e.classList.contains("disable-select")||e.classList.contains("grand-total"))return;function r(){l._selectedIds=[],Array.from(l.$.tableContainer.querySelectorAll(".smart-table-select-row.selected")).forEach(e=>{e.parentElement.classList.contains("disable-select")||e.parentElement.setAttribute("aria-selected",!1),e.classList.remove("selected","indeterminate"),e.firstElementChild.setAttribute("aria-checked",!1)})}const n=t.$.id;let o=-1!==l._selectedIds.indexOf(n);if(l._interaction=!0,"many"===l.selectionMode)if(o)l.unselect(n);else{if(l._disabledSelection.length>0&&t.children&&t.children.length>0){let e=0,a=0,i=[];if(t.children.forEach(t=>{const r=t.$.id;-1===l._selectedIds.indexOf(r)?e++:i.push(r),-1!==l._disabledSelection.indexOf(r)&&a++}),e===a)return l.unselect(i),void delete l._interaction}l.select(n),l._selectionStart={data:t,element:e}}else{if(l._selectionStart&&a.shiftKey){let t,a,i;if(l.virtualization?(t=l.rows,a=t.findIndex(e=>e.data.$.id===n),i=t.findIndex(e=>e.data.$.id===l._selectionStart.data.$.id)):(t=Array.from(l.$.tableContainer.querySelectorAll("tr[row-id]:not([unused])")),a=t.indexOf(e),i=t.indexOf(l._selectionStart.element)),a!==i){const e=JSON.stringify(l._selectedIds.slice(0).sort()),n=Math.min(a,i),o=Math.max(a,i);r();const s=[];for(let e=n;e<=o;e++){const a=t[e];s.push(a.data.$.id)}return l._changeSelectionOfMultiple(s,"select","interaction",e),getSelection().removeAllRanges(),void delete l._interaction}if(1===l._selectedIds.length)return void delete l._interaction}const s=!!i&&i.classList.contains("selection-checkbox");let d=!1;if(1===l._selectedIds.length)d=!0;else if(l.hasAttribute("hierarchy")){const e=[];!function e(t,a){const i=t.$.id;-1!==l._selectedIds.indexOf(i)&&a.push(i),t.children&&t.children.forEach(t=>e(t,a))}(t,e),l._selectedIds.length===e.length&&(d=!0),o=l._getChildCheckState(t).maxSelected}if(o&&(s||d||a.ctrlKey||a.metaKey))return delete l._selectionStart,l.unselect(n),void delete l._interaction;s||a.ctrlKey||a.metaKey||r(),l.select(n),l._selectionStart={data:t,element:e}}delete l._interaction}_selectAllCheckboxClickHandler(e,t){const a=this;if(void 0===t){const i=a._filterInfo;if(i.inputFilters||i.rowFilters||i.appliedFilters)return void a._selectAllCheckboxClickHandlerFiltering(e);if(t=a.dataSource,a.hasAttribute("hierarchy")&&a._disabledSelection.length>0){const e=t.boundHierarchy,i=a._getChildCheckState({children:e}).maxSelected;return void a._changeSelectionOfMultiple(e.map(e=>e.$.id),i?"unselect":"select","interaction")}}const i=t.length,l=a._selectedIds.length===i-a._disabledSelection.length+a._selectableGroupRecords.length,r=a._selectedIds.slice(0);if(a._selectedIds=[],l)a._updateCSSOnUnselectAll(e);else{let l,r=0;for(let e=0;e<i;e++){const i=t[e].$.id;-1===a._disabledSelection.indexOf(i)&&(a._selectedIds.push(i),r++)}r===i?l=!0:0===r&&(l=!1),a._updateCSSOnSelectAll(e,l),a._selectableGroupRecords.length>0&&(a._selectedIds=a._selectedIds.concat(a._selectableGroupRecords))}r.length!==a._selectedIds.length&&(a._updateState("selected"),a.$.fireEvent("change",{type:"interaction"}))}_selectAllCheckboxClickHandlerFiltering(e){const t=this,a=t.dataSource,i=t._selectedIds.slice(0),l=[],r=[];let n=0;for(let e=0;e<a.length;e++){const o=a[e];if(!1===o.$.filtered)continue;const s=o.$.id;n++,-1!==i.indexOf(s)&&l.push(s),-1===t._disabledSelection.indexOf(s)&&r.push(s)}const o=l.length===r.length;if(t._selectedIds=t._selectedIds.filter(e=>-1===r.indexOf(e)),o)t._updateCSSOnUnselectAll(e);else{let a;t._selectedIds=t._selectedIds.concat(r),r.length===n?a=!0:0===r.length&&(a=!1),t._updateCSSOnSelectAll(e,a)}i.length!==t._selectedIds.length&&(t._updateState("selected"),t.$.fireEvent("change",{type:"interaction"}))}_updateCSSOnUnselectAll(e){e.classList.remove("indeterminate","selected"),e.firstElementChild.setAttribute("aria-checked",!1),Array.from(this.$.tableContainer.querySelectorAll(".smart-table-select-row")).forEach(e=>{e.parentElement.classList.contains("disable-select")||e.parentElement.setAttribute("aria-selected",!1),e.classList.remove("selected","indeterminate"),e.firstElementChild.setAttribute("aria-checked",!1)})}_updateCSSOnSelectAll(e,t){t?(e.classList.remove("indeterminate"),e.classList.add("selected"),e.firstElementChild.setAttribute("aria-checked",!0)):!1===t?(e.classList.remove("indeterminate","selected"),e.firstElementChild.setAttribute("aria-checked",!1)):(e.classList.remove("selected"),e.classList.add("indeterminate"),e.firstElementChild.setAttribute("aria-checked","mixed")),Array.from(this.$.tableContainer.querySelectorAll(".smart-table-select-row")).forEach(e=>{e.parentElement.classList.contains("disable-select")||(e.parentElement.setAttribute("aria-selected",!0),e.classList.remove("indeterminate"),e.classList.add("selected"),e.firstElementChild.setAttribute("aria-checked",!0))})}_beginEdit(e){const t=this,a=t.editMode,i=e.dataField;let l=e.rowId,r=e.rowElement,n=e.rowObject,o=e.cell,s=[],d=[];if(t.editing){r||(r=t.$.tableContainer.querySelector(`tr[row-id="${l}"]:not([unused])`)),n||(l=r.getAttribute("row-id"),n=t.rowById[l],l=n.data.$.id),"row"===a?(s=r.querySelectorAll("td[data-field]"),d=t._columns.filter(e=>!e.hidden).map(e=>e.dataField),o||(o=i?r.querySelector(`td[data-field="${i}"`):s[0])):(o||(o=r.querySelector(`td[data-field="${i}"`)),s=[o],d=[i]),t._editing={row:n,cells:[]};for(let e=0;e<d.length;e++){const a=s[e];let i=d[e];const r=t.columnByDataField[i];if(!1===r.allowEdit)continue;r.transform&&(i=r.originalDataField);const c=n.data[i],u=t._initEditor(r,l,i,c);let f=u instanceof HTMLInputElement&&"date"===u.type;if(r.editor&&r.editor.template)r.editor.onRender&&r.editor.onRender(l,i,u,c);else if(f)if(c instanceof Date&&!isNaN(c.getTime())){const e=(c.getMonth()+1).toString(),t=c.getDate().toString();u.value=`${c.getFullYear()}-${"0".repeat(2-e.length)}${e}-${"0".repeat(2-t.length)}${t}`}else u.value="";else u.value=void 0===c?"":c;a.classList.add("editing"),a.innerHTML="",a.appendChild(u),a===o&&u.focus&&(u.focus(),r.editor&&r.editor.template||f||!u.select||u.select()),t._editing.cells.push({dataField:i,editor:u,element:a}),t.$.fireEvent("cellBeginEdit",{row:n.data,value:n.data[i],dataField:i})}"row"===a&&t.$.fireEvent("rowBeginEdit",{row:n.data})}}_initEditor(e,t,a,i){let l=this._editors[a];if(l)return l;if(e.editor&&e.editor.template){const r=document.createElement("div");return r.innerHTML=e.editor.template,l=r.firstElementChild,l.className="smart-table-editor",e.editor.onInit&&e.editor.onInit(t,a,l,i),l}return l=document.createElement("input"),l.className="smart-table-editor standard","number"===e.dataType?l.type="number":"date"===e.dataType?l.type="date":l.type="text",this._editors[a]=l,l}_toggleRowDetail(e,t){const a=this;if(a.virtualization)return void a._toggleRowDetailVirtualization(e,t);const i=e.nextElementSibling;i.classList.toggle("collapsed"),i.classList.contains("collapsed")?(i.setAttribute("aria-hidden",!0),a._expandedRowDetailIds=a._expandedRowDetailIds.filter(e=>e!==t)):(i.removeAttribute("aria-hidden"),a._expandedRowDetailIds.push(t))}_toggleRowDetailVirtualization(e,t){const a=this,i=a.animation;let l=e.nextElementSibling;function r(){let e=a.$.virtualizationContainer.$.verticalScrollBar,t=a.$.virtualizationContainer.$.verticalScrollBar.value;a._ignoreVerticalChange=!0,a._refreshDataRows(),t=Math.min(e.max,t),e.value=t,delete a._ignoreVerticalChange,a._onVerticalChange({detail:{value:t}},!0)}if(l&&l.classList.contains("smart-table-row-detail")&&!l.classList.contains("collapsed"))return"none"!==i?(l.ontransitionend=function(){l.ontransitionend=null,l.remove(),r()},l.classList.add("collapsed")):(l.classList.add("collapsed"),l.remove(),r()),l.setAttribute("aria-hidden",!0),void(a._expandedRowDetailIds=a._expandedRowDetailIds.filter(e=>e!==t));const n=e.data;l=document.createElement("tr"),l.classList.add("collapsed"),a._createRowDetailOnDemand(l,{data:n},n),e.parentElement.insertBefore(l,e.nextElementSibling),a._expandedRowDetailIds.push(t),"none"!==i?(l.ontransitionend=function(){l.ontransitionend=null,r()},requestAnimationFrame(()=>requestAnimationFrame(()=>l.classList.remove("collapsed")))):(l.classList.remove("collapsed"),r())}_setFocusable(){const e=this,t="smart-table"===e.nodeName.toLowerCase();if(!e.keyboardNavigation||e.disabled||e.unfocusable||e.hasAttribute("modal"))return e.$.tableContainer.removeAttribute("tabindex"),t&&(e.$.filterInput.unfocusable=!0,e.$.pager.unfocusable=!0),void(e.$.conditionalFormattingButton.unfocusable=!0);const a=e.$.tableContainer.getAttribute("tabindex");(null===a||a<0)&&e.$.tableContainer.setAttribute("tabindex",0),t&&(e.$.filterInput.unfocusable=!1,e.$.pager.unfocusable=!1),e.$.conditionalFormattingButton.unfocusable=!1}_tableContainerFocusHandler(){const e=this;e._focusedCell&&e.$.tableContainer.contains(e._focusedCell)||e._focusCell(e.$.tableContainer.children[1].querySelector("tr:not([unused]) td[data-field], tr:not([unused]) td.group-header"))}_tableContainerDownHandler(e){const t=this.isInShadowDOM?e.originalEvent.composedPath()[0]:e.originalEvent.target;this._focusCell(t.closest("td[data-field], td.group-header")),e.stopPropagation()}_focusCell(e,t){const a=this;if(!e||!e.hasAttribute("data-field")&&!e.classList.contains("group-header")||e.parentElement.classList.contains("grand-total"))return!1;if(a._focusedCell){if(a._focusedCell===e)return!1;a._focusedCell.removeAttribute("focus")}if(a._focusedCell=e,e.setAttribute("focus",""),!t)return;const i=a.$.tableContainer.parentElement,l=a.$.header.offsetHeight,r=a.freezeHeader?a.$.tableContainer.firstElementChild.offsetHeight:0,n=i.scrollTop;let o=e.offsetTop-l-r;if(o<n)i.scrollTop=o;else{const t=a.footerRow&&a.freezeFooter?a.$.tableContainer.lastElementChild.offsetHeight:0,s=a.$.pager.offsetHeight,d=i.clientHeight-(l+r+t+s);o+=e.offsetHeight,o>n+d&&(i.scrollTop=o-d)}if(e.classList.contains("freeze-near")||e.classList.contains("freeze-far"))return;const s=i.scrollLeft,d=a.$.tableContainer.querySelector("tr[row-id]:not([unused])");let c,u=0;if(Array.from(d.children).forEach(e=>{e.classList.contains("freeze-near")&&(u+=e.offsetWidth)}),a.rightToLeft){let t=e.previousElementSibling;for(c=0;t;)t.classList.contains("freeze-near")||(c-=t.offsetWidth),t=t.previousElementSibling;if(c>s)i.scrollLeft=c;else{const t=i.clientWidth;c-=e.offsetWidth,c<s-t&&(i.scrollLeft=c+t-u)}}else if(c=e.offsetLeft-u,c<s)i.scrollLeft=c;else{const t=i.clientWidth;c+=e.offsetWidth+u,c>s+t&&(i.scrollLeft=c-t)}}_tableContainerKeydownHandler(e){const t=this,a=t.isInShadowDOM?e.composedPath()[0]:e.target,i=e.key;if("Shift"===i)return void("extended"===t.selectionMode&&t.$.tableContainer.classList.add("smart-unselectable"));if(!t.contains(a))return;if(a&&"INPUT"===a.nodeName&&!t._editing)return;const l=t._focusedCell;if(!l)return;const r=t.virtualization,n=l.classList.contains("group-header");if(n&&-1!==["ArrowRight","ArrowLeft","Home","End","Escape","F2"].indexOf(i))return void e.preventDefault();if(t._editing){switch(i){case"Enter":t.endEdit();break;case"Escape":t.cancelEdit();break;default:return}return t.$.tableContainer.focus(),void e.preventDefault()}const o=l.parentElement;if(r&&o){const e=t.$.virtualizationContainer.$.verticalScrollBar,a=e.value,l=o.data.$.id;if("ArrowUp"===i&&0===a&&l===t._rowsVirtual[0].data.$.id||"ArrowDown"===i&&a===e.max&&l===t._rowsVirtual[t._rowsVirtual.length-1].data.$.id)return}let s="ArrowRight",d="ArrowLeft";switch(t.rightToLeft&&(s="ArrowLeft",d="ArrowRight"),i){case s:case d:{const a=i===s?"nextElementSibling":"previousElementSibling";let n=l[a];for(;n&&n.classList.contains("smart-hidden");)n=n[a];t._focusCell(n,!r,e),t._scrollToVirtualization(i===s?"nextArrow":"prevArrow",n);break}case"ArrowUp":case"ArrowDown":{const a="ArrowUp"===i?"previousElementSibling":"nextElementSibling";let s=o[a];for(;s&&(s.classList.contains("smart-table-row-detail")||s.classList.contains("collapsed"));)s=s[a];s&&(n?t._focusCell(s.querySelector("td[data-field], .group-header"),!r,e):t._focusCell(s.querySelector(`td[data-field="${l.getAttribute("data-field")}"], .group-header`),!r,e),t._scrollToVirtualization(i,s));break}case"Home":t._focusCell(o.querySelector("td[data-field]"),!r,e),t._scrollToVirtualization(i);break;case"End":{const a=o.querySelectorAll("td[data-field]");let l=a.length-1,n=a[l];for(;n.classList.contains("smart-hidden");)l--,n=a[l];t._focusCell(n,!r,e),t._scrollToVirtualization(i);break}case"PageDown":t._pageDownHandler(l,e);break;case"PageUp":t._pageUpHandler(l,e);break;case"Enter":{const a=o.data;t.dataSource.boundHierarchy&&t._areChildrenFiltered(a)?t._hierarchyArrowClickHandler(o,l,e):t.rowDetailTemplate&&t._toggleRowDetail(o,a.$.id);break}case" ":t._toggleSelection(o,o.data,e);break;case"F2":t.beginEdit(o.data.$.id,l.getAttribute("data-field"));break;default:return}e.preventDefault()}_pageDownHandler(e,t){const a=this,i=a.paging;if(!i&&e.parentElement===e.parentElement.parentElement.lastElementChild)return;const l=a.virtualization,r=a.$.tableContainer,n=r.parentElement,o=l?a.$.virtualizationContainer:n;let s=e.getAttribute("data-field");function d(){const e=r.querySelectorAll("tr[row-id]:not([unused])");let t=l?0:a.$.header.offsetHeight+a.$.pager.offsetHeight;a.footerRow&&a.freezeFooter&&(t+=r.lastElementChild.offsetHeight);for(let a=e.length-1;a>=0;a--){const i=e[a];if(!i.classList.contains("collapsed")&&i.offsetTop+i.offsetHeight<=(l?-n.offsetTop:n.scrollTop)+o.clientHeight-t)return i.querySelector(`td[data-field${s}], .group-header`)}}s=s?`="${s}"`:"";let c=d();if(c)if(e===c){const u=(a.freezeHeader?r.firstElementChild.offsetHeight:0)+a._rowHeight;let f;if(l?(f=o.$.verticalScrollBar.value,o.$.verticalScrollBar.value+=o.clientHeight-u):n.scrollTop+=n.clientHeight-u,c=d(),i&&(l&&f===o.$.verticalScrollBar.value||!l&&e===c)){const e=a.pageIndex;a.navigateTo(a.pageIndex+1),a.pageIndex!==e&&(l&&(o.$.verticalScrollBar.value=0),a._focusCell(r.querySelector(`tr[row-id]:not([unused]) td[data-field${s}], tr[row-id]:not([unused]) .group-header`),!l,t))}else a._focusCell(c,void 0,t)}else a._focusCell(c,void 0,t)}_pageUpHandler(e,t){const a=this,i=a.virtualization,l=a.$.tableContainer,r=l.parentElement,n=i?a.$.virtualizationContainer:r;let o=e.getAttribute("data-field");function s(){const e=l.querySelectorAll("tr[row-id]:not([unused])");let t=0;a.freezeHeader&&(t=l.firstElementChild.offsetHeight);for(let a=0;a<e.length;a++){const l=e[a];if(!l.classList.contains("collapsed")&&l.offsetTop>=(i?-r.offsetTop:r.scrollTop)+t)return l.querySelector(`td[data-field${o}], .group-header`)}}o=o?`="${o}"`:"";let d=s();if(d)if(e===d){const c=(a.freezeHeader?l.firstElementChild.offsetHeight:0)+a._rowHeight;let u;if(i?(u=n.$.verticalScrollBar.value,n.$.verticalScrollBar.value-=n.clientHeight-c):r.scrollTop-=r.clientHeight-c,d=s(),a.paging&&(i&&u===n.$.verticalScrollBar.value||!i&&e===d)){const e=a.pageIndex;if(a.navigateTo(a.pageIndex-1),a.pageIndex!==e){i&&(n.$.verticalScrollBar.value=n.$.verticalScrollBar.max);const e=l.querySelectorAll(`tr[row-id]:not([aria-hidden="true"]) td[data-field${o}], tr[row-id]:not([aria-hidden="true"]) .group-header`);a._focusCell(e[e.length-1],!i,t)}}else a._focusCell(d,void 0,t)}else a._focusCell(d,void 0,t)}_tableContainerKeyupHandler(e){const t=this,a=t.isInShadowDOM?e.composedPath()[0]:e.target;if("Shift"===e.key&&"extended"===t.selectionMode&&t.$.tableContainer.classList.remove("smart-unselectable"),t.contains(a))return a.classList.contains("filter-value")&&"date"!==a.type?(clearTimeout(t._filterRowTimeout),void(t._filterRowTimeout=setTimeout((function(){const e=t.context;t.context=t,t._applyRowFilters(),t.context=e}),500))):void 0}_tableContainerPointeroverHandler(e){if(!this.tooltip)return;const t=(this.isInShadowDOM?e.composedPath()[0]:e.target).closest("tbody td[data-field], thead th[data-field]");if(!t)return;const a=this.$.tableContainer.querySelector(".tooltip");if(a&&(a.classList.remove("tooltip"),a.removeAttribute("title")),"th"!==t.tagName.toLowerCase())(t.classList.contains("tree-cell")&&t.firstElementChild.children[1].scrollWidth>t.firstElementChild.children[1].offsetWidth||t.scrollWidth>t.offsetWidth)&&(t.classList.add("tooltip"),t.title=t.innerText);else{const e=t.querySelector(".label");e.scrollWidth>e.offsetWidth&&(t.classList.add("tooltip"),t.title=e.innerText)}}_documentDownHandler(e){const t=this,a=t.isInShadowDOM?e.originalEvent.composedPath()[0]:e.originalEvent.target;function i(){"default"!==t.columnSizeMode&&(t._preventClickSort=!0,clearTimeout(t._dblclickObject.timeout),t._dblclickObject.numberOfClicks++,2===t._dblclickObject.numberOfClicks?(t._dblclickObject.numberOfClicks=0,t._autoResizeColumnOnDblclick()):t._dblclickObject.timeout=setTimeout((function(){t._dblclickObject.numberOfClicks=0}),300))}if(delete t._preventClickSort,t._editing&&!a.closest(".smart-table-editor")){const e=a.closest(".smart-drop-down")||a.closest(".smart-input-drop-down-menu");if(!e)return void t.endEdit();const i=e.ownerElement;if(!i)return void t.endEdit();if(t.$.container.contains(i)&&i.classList.contains("smart-table-editor"))return;return void t.endEdit()}const l=t.columnReorder,r=t.columnResize;if(l&&!t.columnTotals||r){const n=a.closest("th[data-field]:not(.smart-pivot-table-total-header)");if(n&&t.$.tableContainer.contains(n)){if(t.$.tableContainer.classList.add("smart-unselectable"),r&&t._columns.length>1&&!t.hasAttribute("resize-max-reached")){const a=t.rightToLeft,l=n.getBoundingClientRect();if(!a&&e.clientX<=l.left+5||a&&e.clientX>=l.right-5){const l=n.previousElementSibling;if(l&&l.hasAttribute("data-field")){if(l.hasAttribute("locked"))return;const r=l.getBoundingClientRect();return t._resizeDetails={FeedbackShown:!1,Item:l,ItemStart:r[a?"right":"left"]+window.scrollX,Min:t._getNumericMinWidth(),StartPosition:{left:e.pageX,top:e.pageY},StartTime:new Date},t._resizeDetails.Max=t._getCurrentResizeMax(),void i()}}if(!a&&e.clientX>=l.right-5||a&&e.clientX<=l.left+5){if(n.hasAttribute("locked"))return;return t._resizeDetails={FeedbackShown:!1,Item:n,ItemStart:l[a?"right":"left"]+window.scrollX,Min:t._getNumericMinWidth(),StartPosition:{left:e.pageX,top:e.pageY},StartTime:new Date},t._resizeDetails.Max=t._getCurrentResizeMax(),void i()}}l&&(t._dragDetails={FeedbackShown:!1,Item:n,StartPosition:{left:e.pageX,top:e.pageY},StartTime:new Date})}}}_documentMoveHandler(e){const t=this,a=t._dragDetails;if(!a)return void(t._resizeDetails&&t._handleResizeOnMove(e));if(!a.FeedbackShown){const i=(new Date).getTime()-a.StartTime.getTime()>500,l=Math.abs(a.StartPosition.left-e.pageX)>5||Math.abs(a.StartPosition.top-e.pageY)>5;if(!l||!(!t._isMobile||t._isMobile&&i))return void(t._isMobile&&l&&!i&&(delete t._dragDetails,t.$.tableContainer.classList.remove("smart-unselectable")));t._hideBodyOverflow(),a.Feedback=t._addDragFeedback(),a.FeedbackShown=!0,a.Item.classList.add("dragged"),t.classList.add("smart-unselectable")}const i=t.$.tableContainer.parentElement;a.Feedback.style.left=e.pageX+10+"px",a.Feedback.style.top=e.pageY+10+"px",a.HoveredItem&&(a.HoveredItem.classList.remove("drop-column","left","right"),delete a.HoveredItem),i.offsetWidth<i.scrollWidth&&(clearInterval(t._dragInterval),t._dragInterval=setInterval((function(){const a=i.getBoundingClientRect();a.left<=e.clientX&&a.left+a.width>=e.clientX?e.clientX>=a.left&&e.clientX<=a.left+25?i.scrollLeft-=t._autoScrollCoefficient:e.clientX>=a.left+a.width-25&&e.clientX<=a.left+a.width?i.scrollLeft+=t._autoScrollCoefficient:clearInterval(t._dragInterval):clearInterval(t._dragInterval)}),10));const l=t._getClosestThToHover(e);l&&(l.classList.add("drop-column"),a.HoveredItem=l)}_hideBodyOverflow(){const e=(document.scrollingElement||document.documentElement).scrollHeight>document.documentElement.clientHeight,t=(document.scrollingElement||document.documentElement).scrollWidth>document.documentElement.clientWidth;this._originalBodyOverflow={overflowX:document.body.style.overflowX,overflowY:document.body.style.overflowY,overflow:document.body.style.overflow},document.body.classList.add("smart-dragging"),document.body.style.overflow=document.body.style.overflowX=document.body.style.overflowY="",e&&!t?document.body.style.overflowX="hidden":t&&!e?document.body.style.overflowY="hidden":t||e||(document.body.style.overflow="hidden")}_addDragFeedback(){const e=this,t=e._dragDetails.Item,a=document.createElement("div");return a.className="smart-table-feedback",a.setAttribute("parent-table-id",e.id),a.innerHTML=e.columnByDataField[t.getAttribute("data-field")].label,e.theme&&a.setAttribute("theme",e.theme),document.body.appendChild(a),a}_getClosestThToHover(e){const t=e.clientX,a=Array.from(this.$.tableContainer.querySelectorAll("th[data-field]:not(.smart-pivot-table-total-header)"));let i,l,r;for(let e=0;e<a.length;e++){const n=a[e];if(!n||this._dragDetails.Item===n)continue;const o=n.getBoundingClientRect(),s=Math.abs(t-o.left),d=Math.abs(t-o.right),c=Math.min(s,d);if(!(void 0===l||c<l))break;i=n,l=c,r=s<d?"left":"right"}return i&&i.classList.add(r),i}_handleResizeOnMove(e){const t=this,a=t._resizeDetails;if(!a.FeedbackShown){const i=(new Date).getTime()-a.StartTime.getTime()>500,l=Math.abs(a.StartPosition.left-e.pageX)>=1||Math.abs(a.StartPosition.top-e.pageY)>=1;if(!l||!(!t._isMobile||t._isMobile&&i))return void(t._isMobile&&l&&!i&&(delete t._resizeDetails,t.$.tableContainer.classList.remove("smart-unselectable","resizing"),document.body.style.cursor=null));a.Feedback=t._addResizeFeedbacks(),a.FeedbackShown=!0,t.classList.add("smart-unselectable","resizing"),document.body.style.cursor="col-resize"}const i=a.Feedback,l=a.ItemStart;let r;t.rightToLeft?(r=Math.min(a.Max,Math.max(a.Min,Math.round(l-e.pageX))),i.style.left=l-r+"px"):(r=Math.min(a.Max,Math.max(a.Min,Math.round(e.pageX-l))),i.style.left=l+r+"px"),i.classList.toggle("min",r===a.Min),i.classList.toggle("max",r===a.Max),t.columnResizeFeedback&&(i.innerHTML=r+"px"),a.Width=r}_addResizeFeedbacks(){const e=this,t=e._resizeDetails,a=e.$.container.getBoundingClientRect(),i=a.top+window.scrollY+"px",l=a.height+"px",r=document.createElement("div"),n=document.createElement("div");return n.className="smart-table-resize-feedback static",n.setAttribute("parent-table-id",e.id),n.style.top=i,n.style.left=t.ItemStart+"px",n.style.height=l,e._resizeDetails.StaticFeedback=n,r.className="smart-table-resize-feedback",r.setAttribute("parent-table-id",e.id),r.style.top=i,r.style.height=l,e.theme&&(n.setAttribute("theme",e.theme),r.setAttribute("theme",e.theme)),document.body.appendChild(r),document.body.appendChild(n),r}_resolveResize(e){const t=this._resizeDetails;if(delete this._resizeDetails,this.$.tableContainer.classList.remove("smart-unselectable","resizing"),e){if(!t.FeedbackShown)return;t.StaticFeedback.remove(),t.Feedback.remove()}const a=this._columns.find(e=>e.headerCellElement===t.Item);this.classList.remove("smart-unselectable","resizing"),document.body.style.cursor=null,a._manualWidth=t.Width,t.Item.style.width=t.Width+"px",this._handleAutoSizeMode(a),this._handleFrozenColumnPositions(),this._refreshHorizontalScrollbar(),this.$.fireEvent("columnResize",{dataField:a.dataField,headerCellElement:t.Item,width:t.Width})}_documentUpHandler(){const e=this,t=e._dragDetails;if(e._selectDrag)return e.$.main.classList.remove("prevent-scroll"),void delete e._selectDrag;if(!t)return void(e._resizeDetails&&e._resolveResize(!0));if(delete e._dragDetails,e.$.tableContainer.classList.remove("smart-unselectable"),!t.FeedbackShown)return;const a=t.HoveredItem;document.body.classList.remove("smart-dragging"),document.body.style.overflow=e._originalBodyOverflow.overflow,document.body.style.eoverflowX=e._originalBodyOverflow.overflowX,document.body.style.overflowY=e._originalBodyOverflow.overflowY,delete e._originalBodyOverflow,e.classList.remove("smart-unselectable"),t.Item.classList.remove("dragged"),document.body.removeChild(t.Feedback),clearInterval(e._dragInterval),delete e._dragInterval,a&&e._applyColumnReorder(t,a),e._preventClickSort=!0,requestAnimationFrame(()=>delete e._preventClickSort)}_applyColumnReorder(e,t){const a=this.rightToLeft,i=this._columns,l=e.Item.getAttribute("data-field"),r=i.find(e=>e.dataField===l),n=t.getAttribute("data-field"),o=t.classList.contains("right"),s=this._columns.filter(e=>e.dataField!==l),d=s.findIndex(e=>e.dataField===n);t.classList.remove("drop-column","left","right"),o&&!a||!o&&a?s.splice(d+1,0,r):s.splice(d,0,r),i.map(e=>e.dataField).join(",")!==s.map(e=>e.dataField).join(",")&&(this.columns=s,this._initColumns(),this.refresh())}_applyRowFilters(){const e=this;if(!e.filtering||!e.filterRow)return;const t=e.$.tableContainer.querySelector(".smart-table-filter-row"),a=Number(e.selection),i=e._columns.filter(e=>!e.hidden),l=[],r=[];for(let n=0;n<i.length;n++){const o=i[n].dataField,s=i[n].dataType,d=t.children[n+a].firstElementChild,c=d.children[2];let u=d.firstElementChild.value,f=d.children[1].value;"string"===s?f=e._filterInfo.stringConditions.find(e=>e.label===f).value:(f=e._filterInfo.numberAndDateConditions.find(e=>e.label===f).value,""!==u&&("number"===s?(u=parseFloat(u),isNaN(u)&&(d.firstElementChild.value="",u="")):"date"===s&&(u=new Date(u),u.setHours(0,0,0))));const h=-1!==["EMPTY","NOT_EMPTY","NULL","NOT_NULL"].indexOf(f);if(""!==u||h){const e=new Smart.Utilities.FilterGroup,t=e.createFilter(s,u,f);e.addFilter("or",t),l.push([o,e]),c.classList.remove("smart-hidden"),r.push({condition:f,value:u})}else c.classList.add("smart-hidden"),r.push(null);h?d.firstElementChild.setAttribute("disabled",!0):d.firstElementChild.removeAttribute("disabled")}l.length>0?(e.dataSource.virtualDataSource||e.dataSource._filter(l,"and"),e._filterInfo.rowFilters=l,e._filterInfo.filterRowValues=r,delete e._filterInfo.appliedFilters,e._fullRefresh("filter"),e._updateState("filtered"),e._doNotFireEvent||e.$.fireEvent("filter",{action:"add",filters:l})):e._filterInfo.rowFilters&&e.clearFilters()}_clearFilterInput(){this._filterInfo.query="",delete this._filterInfo.inputFilters,this.$.filterInput.value=""}_clearRowFilters(){if(!this._filterInfo.rowFilters)return;const e=this.$.tableContainer.querySelector(".smart-table-filter-row"),t=this._columns.filter(e=>!e.hidden),a=this.selection?1:0;for(let i=0;i<t.length;i++){const t=e.children[i+a].firstElementChild;t.firstElementChild.value="",t.children[2].classList.add("smart-hidden")}delete this._filterInfo.rowFilters}_createFooterRow(e){const t=this,a=t.footerRow;if(!a)return;if(e)return void t.$.tableContainer.appendChild(e);const i=document.getElementById(a);if(i&&i instanceof HTMLTemplateElement){const e=document.createElement("tfoot"),a=document.importNode(i.content,!0);e.appendChild(a),t.$.tableContainer.appendChild(e)}else t.footerRow=null}_createCustomHeaderRow(){const e=this,t=e.headerRow;if(!t)return;const a=document.getElementById(t);if(a&&a instanceof HTMLTemplateElement){const t=document.importNode(a.content,!0);e.$.tableContainer.firstElementChild.appendChild(t)}else e.headerRow=null}_updateSelectAllState(e){const t=this;if(!t.selection||"cell"===t.selectionMode)return;const a=t.$.tableContainer.querySelector(".smart-table-select-all");let i;if(void 0===e){const a=t.dataSource,l=t._filterInfo;if(l.inputFilters||l.rowFilters||l.appliedFilters){const l=t._selectedIds;e=0,i=0;for(let t=0;t<a.length;t++){const r=a[t];if(!1===r.$.filtered)continue;const n=r.$.id;e++,-1!==l.indexOf(n)&&i++}}else e=t.dataSource.length}void 0===i&&(i=t._selectedIds.length),0===i?(a.classList.remove("selected","indeterminate"),a.firstElementChild.setAttribute("aria-checked",!1)):i===e+t._selectableGroupRecords.length?(a.classList.remove("indeterminate"),a.classList.add("selected"),a.firstElementChild.setAttribute("aria-checked",!0)):(a.classList.remove("selected"),a.classList.add("indeterminate"),a.firstElementChild.setAttribute("aria-checked","mixed"))}_resizeHandler(){const e=this;clearTimeout(e._resizeTimeout),e._resizeTimeout=setTimeout((function(){if(e.columnGroups&&e._columns.some(e=>e.responsivePriority&&e.responsivePriority>1))return void e.refresh();const t=e.offsetWidth,a=e.offsetHeight;if(e.virtualization&&e._cachedHeight!==a){const i=e._getFractionOfMax();return e._refreshDataRows(),e._setFractionOfMax(i),e._cachedWidth=t,void(e._cachedHeight=a)}e._handleAutoSizeMode(),e._handleFrozenColumnPositions(),e._refreshHorizontalScrollbar(),e._cachedWidth=t,e._cachedHeight=a}),75)}_hierarchyArrowClickHandler(e,t){const a=this,i=!a.grouping,l=e.data;if(i&&a.dataSource.virtualDataSource&&!l.expanded&&l.children&&0===l.children.length)return a._requestVirtualDataSource("expand",void 0,l),void a.$.fireEvent("expand",{record:l});if(a.virtualization)return void a._hierarchyArrowClickHandlerVirtualization(e,t);const r=a.$.tableContainer,n=l.$.id;l.expanded?function e(t){t.forEach(t=>{a._collapseSingleChildRow(r.querySelector(`tr[row-id="${t.$.id}"]:not([unused])`)),t.children&&e(t.children)})}(l.children):requestAnimationFrame(()=>function e(t){t.forEach(t=>{a._expandSingleChildRow(r.querySelector(`tr[row-id="${t.$.id}"]:not([unused])`)),t.children&&t.expanded&&requestAnimationFrame(()=>e(t.children))})}(l.children)),l.expanded=!l.expanded,e.setAttribute("aria-expanded",l.expanded),e.classList.toggle("expanded",l.expanded),i?(l.expanded?(-1===a._expandedIds.indexOf(n)&&a._expandedIds.push(n),a.$.fireEvent("expand",{record:l})):(a._expandedIds=a._expandedIds.filter(e=>e!==n),a.$.fireEvent("collapse",{record:l})),a._updateState("expanded")):!0!==t&&(l.expanded?a.$.fireEvent("group",{action:"expand",dataField:l.groupDataField,label:l.label}):a.$.fireEvent("group",{action:"collapse",dataField:l.groupDataField,label:l.label}))}_expandSingleChildRow(e,t=[]){e&&(t.push(!1),"none"!==this.animation?(e.classList.remove("smart-hidden"),requestAnimationFrame(()=>{e.classList.add("no-height"),e.ontransitionend=function(){e.classList.remove("no-height"),e.ontransitionend=null,t.pop()},e.removeAttribute("aria-hidden"),e.classList.remove("collapsed")})):(e.removeAttribute("aria-hidden"),e.classList.remove("collapsed","smart-hidden"),t.pop()))}_collapseSingleChildRow(e,t=[]){e&&(t.push(!1),"none"!==this.animation?e.ontransitionend=function(){e.classList.add("smart-hidden"),e.ontransitionend=null,t.pop()}:(e.classList.add("smart-hidden"),t.pop()),e.setAttribute("aria-hidden",!0),e.classList.add("collapsed"))}_getGroupByIndex(e){"number"==typeof e&&(e=e.toString());const t=this.dataSource.boundHierarchy,a=e.split(".");let i=t[a[0]];if(i){for(let e=1;e<a.length;e++)if(i=i.children[a[e]],!i||i.leaf)return;return i}}_createDialog(){const e=document.createElement("smart-window"),t=document.createElement("template"),a=` animation=${this.animation} theme="${this.theme}"${this.rightToLeft?" right-to-left":""}${!this.keyboardNavigation||this.unfocusable?" unfocusable":""}`;t.innerHTML=`<smart-button class="ok primary"${a}>${this.localize("ok")}</smart-button>\n<smart-button class="cancel"${a}>${this.localize("cancel")}</smart-button>`,e.animation=this.animation,e.footerTemplate=t,e.headerButtons=["close"],e.rightToLeft=this.rightToLeft,e.theme=this.theme,e.unfocusable=!this.keyboardNavigation||this.unfocusable,e.className="smart-table-window",e.ownerElement=this,this._dialog=e,this._addDialogHandlers(),this.getShadowRootOrBody().appendChild(e),this.setAttribute("aria-owns",e.id)}_addDialogHandlers(){const e=this._dialog;e.addEventListener("close",this._dialogEventHandler),e.addEventListener("click",this._dialogEventHandler)}_dialogEventHandler(e){const t=this,a=t.ownerElement,i=t.isInShadowDOM?e.composedPath()[0]:e.target,l=e.type,r=a.context;if(a.context=a,"close"===l){if(i!==t)return void(a.context=r);const e=t.classList.contains("conditional-formatting"),l=t.classList.contains("fields");t.ok?(e&&a._applyConditionalFormatting(),delete t.ok):e&&JSON.stringify(a._formattingPanel.items)!==JSON.stringify(a._formattingPanel.getItems())&&(a._formattingPanel.$.itemsContainer.innerHTML="",a._formattingPanel._addDefaultItems()),t.content.innerHTML="",t.classList.remove("conditional-formatting","drill-down","fields"),!a.keyboardNavigation||a.disabled||a.unfocusable||(a.$.tableContainer.setAttribute("tabindex",0),"smart-table"===a.nodeName.toLowerCase()&&(a.$.filterInput.unfocusable=!1,a.$.pager.unfocusable=!1),a.$.conditionalFormattingButton.unfocusable=!1),a.removeAttribute("modal"),e?a.$.conditionalFormattingButton.focus():l&&a.$.fieldsButton?a.$.fieldsButton.focus():a.$.tableContainer.focus()}else"click"===l&&t.$.footer.contains(i)&&(i.closest(".ok")?(t.ok=!0,t.close()):i.closest(".cancel")&&t.close());a.context=r}_openDialog(e,t,a){const i=this;i._dialog||i._createDialog();const l=i._dialog;l.label=e,l.classList.add(a),l.appendChild(t),i.$.tableContainer.removeAttribute("tabindex"),"smart-table"===i.nodeName.toLowerCase()&&(i.$.filterInput.unfocusable=!0,i.$.pager.unfocusable=!0),"drill-down"!==a?l.setAttribute("aria-controls",i.$.tableContainer.id):l.removeAttribute("aria-controls"),i.$.conditionalFormattingButton.unfocusable=!0,i.setAttribute("modal",""),l.open()}_conditionalFormattingButtonClickHandler(e,t,a){const i=this;let l;i._formattingPanel?l=i._formattingPanel:(l=document.createElement("smart-formatting-panel"),l.animation=i.animation,l.columns=t||i._columns,l.dataSource=a||i.dataSource,l.locale=i.locale,l.messages=i.messages,l.rightToLeft=i.rightToLeft,l.theme=i.theme,l.unfocusable=!i.keyboardNavigation||i.unfocusable,l.ownerElement=i,i._formattingPanel=l),i.conditionalFormatting&&(l.items=i.conditionalFormatting.slice(0)),i._openDialog(i.localize("conditionalFormatting"),l,"conditional-formatting")}_transformDataSource(){const e=this;if(!e.isRendered&&e.dataTransform){const t=e.dataSource;for(let a=0;a<t.length;a++)e.dataTransform(t[a])}}_applyInitialConditionalFormatting(e){const t=this,a=t.conditionalFormatting;if(!a||0===a.length)return void(t._conditionalFormatting=null);const i=t._defaults,l=new Smart.Utilities.ConditionalFormatter(e),r=[];let n;if("smart-pivot-table"===t.nodeName.toLowerCase()){const e=t._dynamicColumns;n=function(t){return"all"===t?e.map(e=>e.id):e.filter(e=>e.dataFields[e.dataFields.length-1].dataField===t).map(e=>e.id)}}else n=function(e){return"all"===e?t._columns.map(e=>e.value):[e]};for(let e=0;e<a.length;e++){a[e]=Object.assign({column:"all",condition:"lessThan",firstValue:0,secondValue:1,fontFamily:i.fontFamily,fontSize:i.fontSize,text:i.text,highlight:i.highlight},a[e]);const t=a[e],o=n(t.column),s=t.condition;l.color=t.highlight,l.comparator=t.firstValue,l.min=t.firstValue,l.max=t.secondValue;const d=l.format(s,o);for(let e in d){const a=d[e];for(let e in a){const i=a[e];i.color=t.text,i.fontFamily=t.fontFamily,i.fontSize=t.fontSize}}r.push(d)}if(t._formattingPanel&&(t._formattingPanel.items=a.slice(0)),0===r.length)return r[0];const o={};for(let e=0;e<r.length;e++){const t=r[e];for(let e in t){const a=t[e];o[e]||(o[e]={});for(let t in a)o[e][t]=Object.assign({},o[e][t],a[t])}}t._conditionalFormatting=o}_toHex(e){if(-1!==e.indexOf("#"))return e;const t=/rgb\((\d+), (\d+), (\d+)\)/g.exec(e);return t?"#"+(parseFloat(t[1]).toString(16).padStart(2,"0")+parseFloat(t[2]).toString(16).padStart(2,"0")+parseFloat(t[3]).toString(16).padStart(2,"0")).toUpperCase():"#FFFFFF"}_applyConditionalFormatting(){const e=this,t=e._conditionalFormatting;e._conditionalFormatting=e._formattingPanel.apply(),e.conditionalFormatting=e._formattingPanel.getItems(),e._conditionalFormatting!==t&&e._refreshDataRows()}_updateState(e,t){const a=this;let i;if("selected"===e&&(i=a.getSelection(),a.selected=i),-1===a.stateSettings.indexOf(e))return;const l=a._state;switch(e){case"columns":l.columns=a._columns;break;case"expanded":l.expanded=a._expandedIds;break;case"filtered":l.filtered=a._filterInfo;break;case"grouped":l.grouped=a.dataSource.groupBy._array.slice(0);break;case"selected":l.selected=i;break;case"sorted":l.sorted=a._sortColumns||[]}a.autoSaveState&&a.isRendered&&!1!==t&&window.localStorage.setItem("smartTable"+a.id,a._stringifyState())}_stringifyState(){return JSON.stringify(this._state,(function(e,t){if(!("function"==typeof t||t instanceof HTMLElement||"sortOrder"===e||"thHierarchy"===e))return t}))}_handleAutoSizeMode(e){const t=this;if("default"===t.columnSizeMode)return;const a=t._columns.filter(e=>!e.hidden),i=t._getNumericMinWidth(),l=a.indexOf(e);let r,n;a.forEach((t,a)=>{t.width||(e&&(t._manualWidth&&a>l?delete t._manualWidth:!t._manualWidth&&a<l&&(t._manualWidth=t.headerCellElement.offsetWidth,t.headerCellElement.style.width=t._manualWidth+"px")),t._manualWidth||(r||(r=t),n=t,t.headerCellElement.style.width=null))});const o=t.$.tableContainer.offsetWidth-(t.selection?t.$.tableContainer.querySelector(".smart-table-select-all").offsetWidth:0);let s=new Map,d=0,c=0,u=0;t.removeAttribute("resize-max-reached"),t.setAttribute("auto-size",""),r&&(r.headerCellElement.style.width="100%");for(let e=0;e<a.length;e++){const t=a[e];if(t===r){u++;continue}const l=t.headerCellElement;let n,o;t.width?(n=t.width,o=t.width):t._manualWidth?(n=t._manualWidth,o=i):(n=Math.max(l.offsetWidth,i),o=i,u++),s.set(t,{width:n,minWidth:o}),d+=n,c+=o}function f(){r.headerCellElement.style.width=null;const e=Math.max(r.headerCellElement.offsetWidth,i),t=i;s.set(r,{width:e,minWidth:t}),d+=e,c+=t}if(r)if(r!==n)n.headerCellElement.style.width="100%",f(),n.headerCellElement.style.width=null;else if(a.length>1){const e=a.find(e=>e!==r);e.headerCellElement.style.width="100%",f(),e.headerCellElement.style.width=s.get(e).width+"px"}else f();if(o<=c||0===u)a.forEach(e=>{e.headerCellElement.style.width=(e._manualWidth?e._manualWidth:s.get(e).minWidth)+"px"}),o<=c&&t.setAttribute("resize-max-reached","");else if(o>c)if(o<d){const e=[];let t,i=d-o,l=u;for(;i>0&&l>0;)t=Math.ceil(i/l),a.forEach(a=>{if(a.width||a._manualWidth||-1!==e.indexOf(a))return;const r=s.get(a);let n=Math.max(r.width-t,r.minWidth);const o=r.width-n;i-=o,n===r.minWidth&&(l--,e.push(a)),r.width=n});a.forEach(e=>e.headerCellElement.style.width=s.get(e).width+"px")}else o===d?a.forEach(e=>e.headerCellElement.style.width=s.get(e).width+"px"):a.forEach(e=>{const t=s.get(e).width;e.headerCellElement.style.width=e===r?o-d+t+"px":t+"px"});t.removeAttribute("auto-size")}_getNumericMinWidth(){const e=this,t=e.columnMinWidth;if("string"==typeof t&&-1!==t.indexOf("%")){return e.offsetWidth*(parseFloat(t)/100)}return parseFloat(t)}_getCurrentResizeMax(){const e=this;if("default"===e.columnSizeMode)return 1/0;const t=e._resizeDetails,a=e._columns,i=a.find(e=>e.headerCellElement===t.Item),l=a.indexOf(i);if(l===a.length-1)return t.Item.offsetWidth;let r,n=0;for(let i=l+1;i<a.length;i++){const l=a[i];if(n+=l.width?l.width:t.Min,i===a.length-1){r=l.headerCellElement.getBoundingClientRect()[e.rightToLeft?"left":"right"]+window.scrollX}}return r-t.ItemStart-n}_autoResizeColumnOnDblclick(){const e=this._resizeDetails,t=e.Item,a=this._columns.find(e=>e.headerCellElement!==t).headerCellElement,i=a.style.width;this.setAttribute("auto-size",""),t.style.width=null,a.style.width="100%";let l=t.offsetWidth;a.style.width=i,this.removeAttribute("auto-size",""),l=Math.min(e.Max,Math.max(e.Min,l)),e.Width=l,this._resolveResize()}_isExpandCollapseForbidden(){return(!this.hasAttribute("hierarchy")||this.grouping)&&"smart-pivot-table"!==this.nodeName.toLowerCase()}_selectSingle(e){const t=this.rowById?this.rowById[e]||this.dataSource.dataItemById[e]:this.rows.dataItemById[e];if(!t)return;const a=t.data?t.data.$.id:t.$.id;if(-1!==this._selectedIds.indexOf(a)||-1!==this._disabledSelection.indexOf(a))return;const i=this.$.tableContainer.querySelector(`tr[row-id="${a}"]:not([unused])`);if(this._selectedIds.push(a),i){const e=i.firstElementChild;e.classList.remove("indeterminate"),e.classList.add("selected"),e.firstElementChild.setAttribute("aria-checked",!0),i.setAttribute("aria-selected",!0)}return this._handleHierarchicalSelection(t,!0),!0}_unselectSingle(e){const t=this,a=t.rowById?t.rowById[e]||t.dataSource.dataItemById[e]:t.rows.dataItemById[e];if(!a)return;const i=a.data?a.data.$.id:a.$.id,l=t._selectedIds.indexOf(i),r=t.$.tableContainer.querySelector(`tr[row-id="${i}"]:not([unused])`);if(-1!==l&&t._selectedIds.splice(l,1),r){const e=r.firstElementChild;e.classList.remove("selected","indeterminate"),e.firstElementChild.setAttribute("aria-checked",!1),r.setAttribute("aria-selected",!1)}return t._handleHierarchicalSelection(a,!1),!0}_changeSelectionOfMultiple(e,t,a="programmatic",i){const l=this;i||(i=JSON.stringify(l._selectedIds.slice(0).sort()));for(let a=0;a<e.length;a++)l[`_${t}Single`](e[a]);i!==JSON.stringify(l._selectedIds.slice(0).sort())&&(l._updateSelectAllState(),l._updateState("selected"),l.$.fireEvent("change",{type:a}))}_handleHierarchicalSelection(e,t){const a=this;if(!a.hasAttribute("hierarchy"))return;const i=e.data;let l=i;for(i.children&&function e(t,i){const l=t.children;let r=0;for(let t=0;t<l.length;t++){const n=l[t];if(!1===n.$.filtered)continue;let o=a._setThreeStateCheckbox(n,i);n.children&&n.children.length>0&&(o=e(n,i)),i&&!1===o&&r++}if(i&&r>0)return a._setThreeStateCheckbox(t,r!==l.length&&null)}(i,t);l.parent;){const e=l.parent,t=a._getChildCheckState(e).state;a._setThreeStateCheckbox(e,t),l=e}}_getChildCheckState(e){const t=this,a=t._selectedIds,i=t._disabledSelection,l=e.children;if(!l||0===l.length){const t=e.$.id,l=-1!==a.indexOf(t);return{state:l,maxSelected:!!l||-1!==i.indexOf(t)}}let r=!0,n=0,o=0,s=0;for(let e=0;e<l.length;e++){const a=l[e];if(!1===a.$.filtered)continue;const i=t._getChildCheckState(a);n++,i.state?o++:null===i.state?s++:!1===i.maxSelected&&(r=!1)}return o===n?{state:!0,maxSelected:!0}:0===o&&0===s?{state:!1,maxSelected:r}:{state:null,maxSelected:r}}_setThreeStateCheckbox(e,t){const a=this,i=e.$.id,l=a._selectedIds,r=l.indexOf(i);t&&(-1!==a._disabledSelection.indexOf(i)?t=!1:-1===r&&l.push(i)),t||-1===r||l.splice(r,1);const n=a.$.tableContainer.querySelector(`tr[row-id="${i}"]:not([unused])`);if(!n)return t;const o=n.firstElementChild,s=o.firstElementChild;return t?(o.classList.remove("indeterminate"),o.classList.add("selected"),s.setAttribute("aria-checked",!0),n.setAttribute("aria-selected",!0)):!1===t?(o.classList.remove("selected","indeterminate"),s.setAttribute("aria-checked",!1),n.setAttribute("aria-selected",!1)):(o.classList.remove("selected"),o.classList.add("indeterminate"),s.setAttribute("aria-checked","mixed"),n.setAttribute("aria-selected",!1)),t}_getSelectableGroupRecords(){const e=this,t=e.dataSource,a=t.boundHierarchy;e._selectableGroupRecords=[],a?(!function t(a){a.forEach(a=>{a.groupDataField&&(e._selectableGroupRecords.push(a.$.id),t(a.children))})}(a),e._selectedIds=e._selectedIds.filter(a=>void 0!==t.dataItemById[a]||-1!==e._selectableGroupRecords.indexOf(a))):e._selectedIds=e._selectedIds.filter(e=>void 0!==t.dataItemById[e])}_clearSelection(e){const t=this;if(0===t._selectedIds.length)return;const a=t.$.tableContainer.querySelector(".smart-table-select-all");Array.from(t.$.tableContainer.querySelectorAll(".smart-table-select-row")).forEach(e=>{e.parentElement.classList.contains("disable-select")||e.parentElement.setAttribute("aria-selected",!1),e.classList.remove("selected","indeterminate"),e.firstElementChild.setAttribute("aria-checked",!1)}),a&&(a.classList.remove("indeterminate","selected"),a.firstElementChild.setAttribute("aria-checked",!1)),t._selectedIds=[],e&&(t._updateState("selected"),t.$.fireEvent("change",{type:"programmatic"}))}_updateCellsWithFormulas(e){const t=this,a=t.formulas,i=t._cellsWithFormulas;if(a||e)for(let e in i){const a=/(.+):(.+)/.exec(e),i=t.columnByDataField[a[1]],l=t.rowById[a[2]];if(!i||!l)continue;const r=t.$.tableContainer.querySelector(`tr[row-id="${l.data.$.id}"]:not([unused]) td[data-field="${i.dataField}"]`);r&&t._setCellContent(r,t._formatCellValue(l,i,r),r.classList.contains("tree-cell"))}}_createVirtualDataRows(e){const t=this,a=t.rowDetailTemplate,i=t.selection,l=t.hasAttribute("hierarchy"),r=document.createDocumentFragment(),n=t.$.virtualizationContainer,o=t.$.tableContainer,s=t._rowHeight;t.isRendered&&(n.scrollWidth=0,n.scrollHeight=0,n.$.scrollViewerContainer.classList.remove("hscroll","vscroll"));const d=n.$.scrollViewerContainer.offsetHeight-o.firstElementChild.offsetHeight-(t.filtering&&t.filterRow?s:0)-(t.footerRow?o.lastElementChild.offsetHeight:0),c=d<5,u=t._getVirtualRecords(l,c),f=u.length;let h=l?2*d:d+3*s,m=s*f,p=0;t._rowsVirtual=u,t._rowsInDOM=[];for(let e=0;e<f;e++){const n=u[e],o=n.data;if(!n.detail){if(o.groupDataField)t._rowsInDOM.push(t._createGroupHeader(o,r));else{const e=t._createDataRow(n,r,{hierarchical:l,rowDetailTemplate:a,selection:i,virtualization:!0});t._rowsInDOM.push(e.row),e.detail&&(t._rowsInDOM.push(e.detail),p+=t._rowDetailHeight,h+=t._rowDetailHeight)}if(p+=s,!c&&p>h)break}}if(e.appendChild(r),t._updateState("expanded"),e.parentElement||t.$.tableContainer.insertBefore(e,t.$.tableContainer.querySelector("tfoot")),n.refresh(),a){m+=t._expandedRowDetailIds.length*(t._rowDetailHeight-s)}let g=Math.max(0,m-d);g>0&&n.computedHorizontalScrollBarVisibility&&(g+=n.$.horizontalScrollBar.offsetHeight),n.$.scrollViewerContentContainer.style.top=0,n.$.verticalScrollBar.max=g,t._scrollHeight=m,t._start={view:0,data:0},!c&&t._rowsInDOM.length>0&&n.$.scrollViewerContentContainer.offsetHeight<n.$.scrollViewerContainer.offsetHeight&&t._rowsInDOM[t._rowsInDOM.length-1].classList.add("last-row"),t._focusEquivalentCell()}_getVirtualRecords(e,t){const a=this,i=e&&!t?a.rows.filter(e=>0===e.data.level||!a._isCollapsed(e.data)):a.rows;if(e||!a.rowDetailTemplate)return i;const l=[];return i.forEach(e=>{l.push(e),-1!==a._expandedRowDetailIds.indexOf(e.data.$.id)&&l.push({detail:!0,data:e.data})}),l}_onVerticalChange(e,t){const a=this;if(a._ignoreVerticalChange)return;const i=a.rows,l=a._rowHeight,r=a.$.virtualizationContainer;let n,o,s=e.detail.value;if(a.setAttribute("ignore-detail-animation",""),a._rowsInDOM.length===i.length||0===r.$.verticalScrollBar.max){const e=Math.floor(s/l);return a._start={view:e,data:e},r.$.scrollViewerContentContainer.style.top=-s+"px",void requestAnimationFrame(()=>a.removeAttribute("ignore-detail-animation"))}if(a._expandedRowDetailIds.length>0){let e,t=0;n=1;for(let i=0;i<a._rowsVirtual.length;i++){const l=t;if(a._rowsVirtual[i].detail?t+=a._rowDetailHeight:t+=a._rowHeight,void 0===o&&s<=t){o=i,e=s-l;break}}r.computedVerticalScrollBarVisibility?s=e+a._rowHeight:n=0}else{for(s=s%(2*l)+l,s<l&&(s+=l);s+r.$.scrollViewerContainer.offsetHeight>a.$.tableContainer.offsetHeight;)s-=l;n=Math.floor(s/l),o=Math.floor(e.detail.value/l),n<0&&(o-=n,n=0)}r.$.scrollViewerContentContainer.style.top=-s+"px",a._updateVisibleRows(n,o,t||a._expandedRowDetailIds.length>0),a._fixFrozenHeaderFirefox(),requestAnimationFrame(()=>a.removeAttribute("ignore-detail-animation"))}_fixFrozenHeaderFirefox(){const e=this;Smart.Utilities.Core.Browser.Firefox&&e.virtualization&&(e.$.tableContainer.firstElementChild.style.top=0,requestAnimationFrame(()=>e.$.tableContainer.firstElementChild.style.top=null))}_focusEquivalentCell(e){const t=this,a=t._focusedCell;if(!e&&!a)return;let i;if(!e){if(!a.parentElement)return;e={rowId:a.parentElement.data.$.id,dataField:a.getAttribute("data-field")}}i=e.dataField?t.$.tableContainer.querySelector(`tr[row-id="${e.rowId}"]:not([unused]) td[data-field="${e.dataField}"]`):t.$.tableContainer.querySelector(`tr[row-id="${e.rowId}"]:not([unused]) td.group-header`),t._focusCell(i)}_updateVisibleRows(e,t,a){const i=this,l=t-e,r=i._rowsVirtual.length,n={hierarchical:i.hasAttribute("hierarchy"),selection:i.selection};let o;if(a=a&&(n.hierarchical||!!i.rowDetailTemplate),i._focusedCell){const e=i._focusedCell.parentElement;e&&(o={rowId:e.data.$.id,dataField:i._focusedCell.getAttribute("data-field")})}for(let t=0;t<e;t++){const e=i._rowsInDOM[t];let r=l+t;r>=0&&(a||e.data.$.index!==r||e.data.detail)&&i._updateVisibleRow(e,r,n),e.setAttribute("unused",""),e.setAttribute("aria-hidden",!0),e.classList.remove("smart-table-row-detail")}for(let t=e;t<i._rowsInDOM.length;t++){const e=i._rowsInDOM[t],o=l+t;o<r?(e.removeAttribute("unused"),e.removeAttribute("aria-hidden"),(a||e.data.$.index!==o)&&i._updateVisibleRow(e,o,n)):e.setAttribute("aria-hidden",!0)}i._start={view:e,data:t},i._focusEquivalentCell(o)}_updateVisibleRow(e,t,a){const i=this,l=i._columns.filter(e=>!e.hidden);if(!l.length)return;const r=i._rowsVirtual[t],n=r.data,o=n.$.id,s=Number(a.selection),d=!n.groupDataField&&!e.firstElementChild.classList.contains("group-header")&&!r.detail&&!e.classList.contains("smart-table-row-detail")&&e.childElementCount>1;if(e.className="",d){const t=e.attributes;for(;t.length>0;)e.removeAttribute(t[0].name)}else for(;e.childNodes.length>0;)e.childNodes[0].remove();if(n.groupDataField)i._createGroupHeader(n,void 0,e);else if(r.detail)i._createRowDetailOnDemand(e,r,n);else{e.setAttribute("aria-rowindex",n.$.index+1),i._processAndRenderSelection(n,e,a.hierarchical,d);for(let t=0;t<l.length;t++){const c=l[t],u=d?e.children[t+s]:document.createElement("td");d&&(u.className=""),u.setAttribute("data-field",c.dataField),u.setAttribute("aria-colindex",t+1+s);let f,h=i._formatCellValue(r,c,u);if(c.freeze&&u.classList.add("freeze-"+("far"===c.freeze?"far":"near")),c.responsivePriority&&u.classList.add("priority-"+c.responsivePriority),!1===c.allowEdit?(u.classList.add("no-edit"),u.setAttribute("aria-readonly",!0)):u.removeAttribute("aria-readonly"),0===t&&a.hierarchical){const e=i._areChildrenFiltered(n);n.leaf||(u.classList.add("tree-cell"),f=e),n.level&&(u.classList.add("outline-level-"+Math.min(n.level,10)),!n.leaf&&e||u.classList.add("tree-leaf"))}c.templateElement?(d||(u.innerHTML=c.templateElement),c.templateElementSettings&&c.templateElementSettings(n[c.dataField],o,u.firstElementChild)):i._setCellContent(u,h,f),i.onCellRender&&i.onCellRender(n,c.dataField,n[c.dataField],u),i._applyConditionalFormattingToCell(u,c.dataField,n.$.index),d||e.appendChild(u)}e.data=n,e.setAttribute("row-id",o),-1!==i._disabledSelection.indexOf(o)&&(e.removeAttribute("aria-selected"),e.classList.add("disable-select"),a.selection&&e.firstElementChild.firstElementChild.setAttribute("aria-disabled",!0)),n.expanded&&(-1===i._expandedIds.indexOf(o)&&i._expandedIds.push(o),e.setAttribute("aria-expanded",!0),e.classList.add("expanded")),n.level&&i._isCollapsed(n)&&(e.setAttribute("aria-hidden",!0),e.classList.add("collapsed","smart-hidden"))}}_createRowDetailOnDemand(e,t,a){const i=Number(this.selection)+this._columns.filter(e=>!e.hidden).length;e.data=Object.assign(a,{detail:!0}),e.classList.add("smart-table-row-detail"),e.removeAttribute("aria-rowindex"),e.removeAttribute("row-id"),e.innerHTML=`<td colspan="${i}"><div class="smart-table-detail-container">${this._applyRowDetailTemplate(t)}</div></td>`}_hierarchyArrowClickHandlerVirtualization(e,t){const a=this,i=!a.grouping,l=a.$.tableContainer,r={nextRow:e.nextElementSibling,tbody:l.children[1]},n=e.data,o=[],s=[],d=Math.ceil((a.$.virtualizationContainer.$.scrollViewerContainer.offsetHeight-l.firstElementChild.offsetHeight)/a._rowHeight);function c(){0===o.length?function(){a._ignoreVerticalChange=!0,n.expanded=!n.expanded,i?(n.expanded?(-1===a._expandedIds.indexOf(n.$.id)&&a._expandedIds.push(n.$.id),a.$.fireEvent("expand",{record:n})):(a._expandedIds=a._expandedIds.filter(e=>e!==n.$.id),a.$.fireEvent("collapse",{record:n})),a._updateState("expanded")):!0!==t&&(n.expanded?a.$.fireEvent("group",{action:"expand",dataField:n.groupDataField,label:n.label}):a.$.fireEvent("group",{action:"collapse",dataField:n.groupDataField,label:n.label}));for(const e of s)e.remove();let e=a.$.virtualizationContainer.$.verticalScrollBar,l=a.$.virtualizationContainer.$.verticalScrollBar.value;a._refreshDataRows(),l=Math.min(e.max,l),e.value=l,delete a._ignoreVerticalChange,a._onVerticalChange({detail:{value:l}},!0)}():requestAnimationFrame(()=>c())}n.expanded?function e(t){t.forEach(t=>{a._collapseSingleChildRow(l.querySelector(`tr[row-id="${t.$.id}"]:not([unused])`),o),t.children&&e(t.children)})}(n.children):requestAnimationFrame(()=>function e(t){for(const i of t){if(s.length>=d)break;!1!==i.$.filtered&&(s.push(a._expandSingleChildRowVirtualization(i,r,o)),i.children&&i.expanded&&requestAnimationFrame(()=>e(i.children)))}}(n.children)),e.setAttribute("aria-expanded",!n.expanded),e.classList.toggle("expanded",!n.expanded),requestAnimationFrame(()=>c())}_expandSingleChildRowVirtualization(e,t,a){const i=this,l=i.rowById[e.$.id],r=document.createDocumentFragment();let n;return n=l.data.groupDataField?i._createGroupHeader(l.data,r):i._createDataRow(l,r,{hierarchical:!0,selection:i.selection}).row,t.tbody.insertBefore(r,t.nextRow),i._expandSingleChildRow(n,a),n}_getFractionOfMax(){const e=this;if(!e.isRendered||!e.virtualization)return null;return{vertical:function(){const t=e.$.virtualizationContainer.$.verticalScrollBar,a=t.max;return 0===a?0:t.value/a}(),horizontal:function(){const t=e.$.virtualizationContainer.$.horizontalScrollBar,a=t.max;return 0===a?0:t.value/a}()}}_setFractionOfMax(e){if(!this.virtualization||null===e)return;const t=this.$.virtualizationContainer,a=t.$.verticalScrollBar,i=t.$.horizontalScrollBar;a.value=a.max*e.vertical,i.value=i.max*e.horizontal}_refreshHorizontalScrollbar(){const e=this.$.virtualizationContainer;if(!e)return;const t=e.$.scrollViewerContainer,a=e.$.horizontalScrollBar,i=e.$.verticalScrollBar,l=e.$.scrollViewerContentContainer.offsetWidth-t.offsetWidth;let r,n;l>0&&!t.classList.contains("hscroll")?(t.classList.add("hscroll"),r="add"):l<=0&&t.classList.contains("hscroll")&&(n=a.offsetHeight,t.classList.remove("hscroll"),r="subtract"),e.scrollWidth!==l&&(e.scrollWidth=l),e.computedVerticalScrollBarVisibility&&("add"===r?(n=a.offsetHeight,i.max+=n):"subtract"===r&&(i.max-=n))}_scrollToVirtualization(e,t){const a=this;if(!a.virtualization)return;const i=a.$.virtualizationContainer,l=i.$.scrollViewerContentContainer,r=i.$.verticalScrollBar,n=i.$.horizontalScrollBar,o=a.$.tableContainer,s=l.offsetLeft,d=l.offsetTop,c=r.value;let u,f;switch(t&&(u=t.offsetLeft,f=t.offsetTop),e){case"nextArrow":{if(!t||!i.computedHorizontalScrollBarVisibility)return;const e=s+u+t.offsetWidth-i.offsetWidth;e>0&&(n.value+=e+r.offsetWidth);break}case"prevArrow":if(!t||!i.computedHorizontalScrollBarVisibility||u>=-s)return;n.value=u-s-n.value;break;case"ArrowUp":{const e=o.firstElementChild.offsetHeight-d-f;if(e<=0)return;let t;if(a._focusedCell){const e=a._focusedCell.parentElement;e&&(t={rowId:e.data.$.id,dataField:a._focusedCell.getAttribute("data-field")})}const i=Math.max(0,c-e);i!==c&&(r.value=i,a._focusEquivalentCell(t));break}case"ArrowDown":{const e=d+f+t.offsetHeight-i.offsetHeight;if(e<=0)return;const a=Math.min(r.max,c+e);a!==c&&(r.value=a);break}case"Home":case"End":if(!i.computedHorizontalScrollBarVisibility)return;n.value="Home"===e?0:n.max}}_getExpandedGroups(e){const t=this,a=[];return function e(i){i.forEach(i=>{i.expanded&&a.push({groupDataField:i.groupDataField,label:i.label,ancestorSignature:t._getGroupAncestorSignature(i)}),i.children&&i.children.length>0&&!1===i.children[0].leaf&&e(i.children)})}(e),a}_getGroupAncestorSignature(e){const t=[];let a=e.parent;for(;a;)t.push({groupDataField:a.groupDataField,label:a.label}),a=a.parent;return JSON.stringify(t)}_restoreExpandedGroups(e){if(0===e.length)return;const t=this,a=t.dataSource,i=[];!function a(l){l.forEach(l=>{if(e.some(e=>e.groupDataField===l.groupDataField&&e.label===l.label&&e.ancestorSignature===t._getGroupAncestorSignature(l))){let e=l.$.id;"string"==typeof e&&(e=e.replace("Item","").replace(/_/g,".")),i.push(e)}l.children&&l.children.length>0&&!1===l.children[0].leaf&&a(l.children)})}(a.boundHierarchy),i.forEach(e=>t.expandGroup(e))}})}});