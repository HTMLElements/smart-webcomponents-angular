
/* Smart UI v9.0.0 (2020-Dec) 
Copyright (c) 2011-2021 jQWidgets. 
License: https://htmlelements.com/license/ */ //

!function(e){var t={};function i(a){if(t[a])return t[a].exports;var l=t[a]={i:a,l:!1,exports:{}};return e[a].call(l.exports,l,l.exports,i),l.l=!0,l.exports}i.m=e,i.c=t,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var l in e)i.d(a,l,function(t){return e[t]}.bind(null,l));return a},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=43)}({43:function(e,t){Smart("smart-filter-builder",class extends Smart.BaseElement{static get properties(){return{customOperations:{value:[],type:"array",reflectToAttribute:!1},disableContextMenu:{value:!1,type:"boolean"},fields:{value:null,type:"array?",reflectToAttribute:!1},formatStringDate:{value:"dd-MMM-yy",type:"string"},formatStringDateTime:{value:"dd-MMM-yy HH:mm:ss",type:"string"},hint:{value:null,type:"string?"},icons:{value:{"=":"=","<>":"≠",">":">",">=":"≥","<":"<","<=":"≤",startswith:"a|bc",endswith:"ab|c",contains:"abc",notcontains:"!abc",isblank:"○",isnotblank:"●"},type:"object",reflectToAttribute:!1},maxConditions:{value:null,type:"number?",validator:"_maxValidator"},maxConditionsPerGroup:{value:null,type:"number?",validator:"_maxValidator"},maxLevel:{value:null,type:"number?",validator:"_maxValidator"},messages:{value:{en:{add:"Add",addCondition:"Add Condition",addGroup:"Add Group",and:"And",notand:"Not And",or:"Or",notor:"Not Or","=":"Equals","<>":"Does not equal",">":"Greater than",">=":"Greater than or equal to","<":"Less than","<=":"Less than or equal to",startswith:"Starts with",endswith:"Ends with",contains:"Contains",notcontains:"Does not contain",isblank:"Is blank",isnotblank:"Is not blank",wrongParentGroupIndex:'{{elementType}}: Wrong parent group index in "{{method}}" method.',missingFields:'{{elementType}}: Fields are required for proper condition\'s adding. Set "fields" source and then conditions will be added as expected.',wrongElementNode:'{{elementType}}: Incorect node / node Id in "{{method}}" method.',invalidDataStructure:"{{elementType}}: Used invalid data structure in updateCondition/updateGroup method.",dateTabLabel:"DATE",timeTabLabel:"TIME"}},type:"object",extend:!0},restrictedMode:{value:!1,type:"boolean"},showIcons:{value:!1,type:"boolean"},value:{value:["or"],type:"array?",reflectToAttribute:!1},valueFormatFunction:{value:null,type:"function?",reflectToAttribute:!1},valuePlaceholder:{value:"&lt;enter a value&gt;",type:"string"}}}static get requires(){return{"Smart.Button":"smart.button.js","Smart.CheckBox":"smart.checkbox.js","Smart.ScrollBar":"smart.scrollbar.js","Smart.ListBox":"smart.listbox.js","Smart.DropDownList":"smart.dropdownlist.js","Smart.ComboBox":"smart.combobox.js","Smart.Calendar":"smart.calendar.js","Smart.TimePicker":"smart.timepicker.js","Smart.Tooltip":"smart.tooltip.js","Smart.Utilities.DateTime":"smart.date.js","Smart.DateTimePicker":"smart.datetimepicker.js","Smart.Menu":"smart.menu.js"}}static get listeners(){return{down:"_downHandler","document.click":"_documentClickHandler","conditionsMenu.itemClick":"_menuItemClickHandler","container.change":"_containerChangeHandler","scrollableContainer.wheel":"_scrollViewerWheelHandler","scrollableOuterContainer.resize":"_resizeHandler","innerContainer.keydown":"_innerContainerKeydownHandler"}}static get styleUrls(){return["smart.filterbuilder.css"]}template(){return'<div id="container" title="[[hint]]">\n                    <div id="innerContainer" class="smart-inner-container">\n                            <div id="scrollableOuterContainer" class="smart-scrollable-outer-container">\n                                <smart-scroll-viewer id="scrollableContainer" class="smart-scrollable-container" animation="[[animation]]">\n                                    <div id="contentContainer" class="smart-content-container"></div>\n                                </smart-scroll-viewer>\n                            </div>\n                            <div id="editorsContainer" class="smart-editors-container">\n                                <div id="customEditor" class="smart-custom-editor smart-hidden"></div>\n                            </div>\n                    </div>\n                    <smart-menu id="conditionsMenu" mode="dropDown" class="smart-conditions-menu" theme="[[theme]]" animation="[[animation]]"></smart-menu>\n            </div>'}propertyChangedHandler(e,t,i){const a=this,l=["textBoxEditor","numericTextBoxEditor","comboBoxEditor","dateTimePickerEditor","checkBoxEditor"];switch(super.propertyChangedHandler(e,t,i),e){case"animation":case"theme":l.forEach(t=>a.$[t]&&(a.$[t][e]=i));break;case"customOperations":a._handleCustomOperations(),a._refresh();break;case"fields":a._mapFieldsToMenu(),a._refresh();break;case"formatStringDate":case"formatStringDateTime":case"showIcons":case"valueFormatFunction":a._refresh();break;case"locale":case"messages":a._localizeInitialValues(),a._refresh(),a._handleCustomOperations(),a.$.dateTimePickerEditor&&(a.$.dateTimePickerEditor.messages[a.locale]||(a.$.dateTimePickerEditor.messages[a.locale]={}),a.$.dateTimePickerEditor.messages[a.locale].dateTabLabel=a.localize("dateTabLabel"),a.$.dateTimePickerEditor.messages[a.locale].timeTabLabel=a.localize("timeTabLabel"),"locale"===e?a.$.dateTimePickerEditor.locale=a.locale:"messages"===e&&(a.$.dateTimePickerEditor.$.selectDate.innerHTML=a.$.dateTimePickerEditor.messages[a.locale].dateTabLabel,a.$.dateTimePickerEditor.$.selectTime.innerHTML=a.$.dateTimePickerEditor.messages[a.locale].timeTabLabel));break;case"maxConditions":case"maxConditionsPerGroup":case"maxLevel":case"value":{a._totalConditions=0,a._validateValue(),a._emptyElementsStructure(!0),a._convertValueToFlat(a.value),a._getFieldsFromValue(),a._mapFieldsToMenu(),a._generateHTMLStructureFromFlatValue(),a.$.scrollableContainer.refresh();const e=JSON.stringify(a.value);a._oldValueAsString!==e&&(a._oldValueAsString=e,a.$.fireEvent("change",{value:JSON.parse(e)}));break}case"valuePlaceholder":a._updatePlaceholder()}}_maxValidator(e,t){return"number"!=typeof t?t:Math.max(1,t)}ready(){super.ready();this._validateValue(),this._setInitialValues(),this._handleCustomOperations(),this._emptyElementsStructure(!0),this._totalConditions=0,this._convertValueToFlat(this.value),this._getFieldsFromValue(),this._generateHTMLStructureFromFlatValue(),this.$.conditionsMenu._noAutoFocus=!0,this._oldValueAsString=JSON.stringify(this.value),this.$.scrollableContainer.refresh()}addCondition(e,t){this._checkFieldsExistence(),this._addElement("condition",e,t)}addGroup(e,t){this._addElement("group",e,t)}removeCondition(e){this._validateNode(e,"removeCondition"),this._deleteElement(e,"condition"),this._refresh()}removeGroup(e){this._validateNode(e,"removeGroup"),this._deleteElement(e,"group"),this._refresh()}toString(e){const t=this;if(!e)return JSON.stringify(t.value);let i=[],a=[];for(let e=0;e<t._valueFlat.length;e++){const a=t._valueFlat[e];let l={};if("condition"===a.type){const e=t._getFieldByFieldName(a.data[0]),i=e.dataType,o="["+(e.label||e.value)+"]",n=t.localize(a.data[1]),r=-1!==["boolean","number"].indexOf(i)?a.data[2]+"":"'"+a.data[2]+"'";l.data=o+" "+n+" "+r}else l.data=a.data;l.nodeId=a.nodeId,l.parentId=a.parentId,l.type=a.type,i.push(l)}for(let e=0;e<i.length;e++){const l=i[e];let o={};if("group"===l.type){const e=i.filter(e=>e.parentId===l.nodeId&&"condition"===e.type);if(e.length>0){let i=e.map(e=>e.data),n="",r="",s=l.data;-1!==["notand","notor"].indexOf(s)&&(n="Not (",r=")",s=s.substring(3)),o.nodeId=l.nodeId,o.parentId=l.parentId,o.data=l.data,o.structure=n+i.join(" "+t.localize(s)+" ")+r,a.push(o)}}}a=a.filter(e=>e.structure.length>1),a.sort((function(e,t){return t.nodeId.split(".").length-e.nodeId.split(".").length}));for(let e=0;e<a.length;e++){const i=a[e],l=a.filter(e=>e.nodeId===i.parentId)[0];if(l&&l.structure){let e=l.data;-1!==["notand","notor"].indexOf(e)?(e=e.substring(3),l.structure=l.structure.slice(0,l.structure.length-1)+" "+t.localize(e)+" ("+i.structure+"))"):l.structure=l.structure+" "+t.localize(e)+" ("+i.structure+")"}}return a[a.length-1].structure}updateCondition(e,t){const i=this._validateNode(e,"updateCondition");this._validateUserData(t,!0),i.data=t,this._refresh()}updateGroup(e,t){const i=this._validateNode(e,"updateGroup");this._validateUserData(t),i.data=t,this._refresh()}_addElement(e,t,i){t=t||"0";const a=this,l=a._valueFlat.filter(e=>e.nodeId===t&&"group"===e.type),o=l.length>0&&l[0],n=a._valueFlat.filter(e=>e.parentId===t);let r=0,s="";if(o||a.error(a.localize("wrongParentGroupIndex",{elementType:a.nodeName.toLowerCase(),method:"addGroup/addCondition"})),"group"===e)i=i||"or";else{if(n.filter(e=>"condition"===e.type).length===a.maxConditionsPerGroup||a._totalConditions===a.maxConditions)return;const e=a.fields&&a.fields.length>0?a.fields[0].dataField:a._valueFields[0].dataField;a._totalConditions++,(i=i||[])[0]=i[0]||e,i[1]=i[1]||"=",i[2]=void 0!==typeof i[2]?i[2]:null}if(n){let e=n.map(e=>{const t=e.nodeId.split(".");return parseInt(t[t.length-1])});e=0===e.length?[0]:e,r=e.reduce((function(e,t){return Math.max(e,t)}))+1}t&&t.length>0&&(s=".");const d={nodeId:t+s+r,parentId:t,type:e,data:i,htmlNode:null};a._valueFlat.push(d),a._refresh()}_clearConditionsValue(e,t){const i=this,a=(i.shadowRoot||i).querySelector('[node-id="'+(e||0)+'"]').querySelector(".smart-value-container");for(let a=0;a<i._valueFlat.length;a++)if(i._valueFlat[a].nodeId===e){const e=i._valueFlat[a],l=t?i.fields.find(e=>e.dataField===t).dataType:i.fields.find(t=>t.dataField===e.data[0]).dataType;e.data[2]=i._defaultValueByType(l)}a.innerHTML=i.valuePlaceholder,a.closest(".smart-filter-value").setAttribute("placeholder","")}_convertValueToFlat(e,t){const i=this,a=/^(and|or|notAnd|notOr)$/i;if(!e)return;const l=e.filter(e=>"string"==typeof e&&e.match(a)),o=l?l[0]:null,n=e.filter(e=>Array.isArray(e)&&3===e.length&&0===e.filter(e=>"string"==typeof e&&e.match(a)).length),r=e.filter(e=>!n.includes(e)&&e!==o);if(!l)return;const s=i._lastProcessedItemInCurrentGroup.parentId?".":"",d=(i._lastProcessedItemInCurrentGroup.parentId||"")+s+(t||0);if(i._isMaxLevelExceeded(d))return;const c={nodeId:d,parentId:i._lastProcessedItemInCurrentGroup.parentId,type:"group",data:o,htmlNode:null};i._valueFlat.push(c),i._lastProcessedItemInCurrentGroup.position=0;for(let e=0;e<n.length&&n[e];e++){const t=d+"."+(i._lastProcessedItemInCurrentGroup.position||0);if(i._isMaxLevelExceeded(t))break;const a={nodeId:t,parentId:d,type:"condition",data:n[e],htmlNode:null};i._totalConditions++,i._valueFlat.push(a),i._lastProcessedItemInCurrentGroup.position++}for(let e=0;e<r.length;e++)i._lastProcessedItemInCurrentGroup.parentId=d,i._convertValueToFlat(r[e],n.length+e),i._lastProcessedItemInCurrentGroup.position++}_isMaxLevelExceeded(e){const t=this,i=t._valueFlat;if(!(null===t.maxLevel||i.length<1)){if(e)return e.split(".").length-2>=t.maxLevel;for(let e=0;e<i.length;e++){if(i[e].nodeId.split(".").length-2>t.maxLevel)return!0}}}_clickHandler(e){const t=this,i=t.shadowRoot||t.isInShadowDOM?e.composedPath()[0]:e.target,a=i?i.closest(".smart-filter-group-condition"):null,l=a?a.getAttribute("node-id"):null,o=i?i.closest(".smart-filter-group"):null,n=o?o.getAttribute("node-id"):null,r=i.closest(".smart-filter-add-btn"),s=i.closest(".smart-filter-delete-btn"),d=i.closest(".filter-builder-item"),c=l||n,u=t._getItemById(c);let m;if(t.disabled)return;if((d||s||r)&&(m=d?d.classList.contains("smart-filter-field-name")?"fieldButton":d.classList.contains("smart-filter-operation")?"operationButton":d.classList.contains("smart-filter-value")?"valueButton":"groupOperationButton":r?"addButton":"deleteButton",t.$.fireEvent("itemClick",{id:u.nodeId,type:u.type,component:m,data:u.data})),s){const e=i.closest(".smart-filter-group-operator"),a=i.closest(".smart-filter-group-condition");return void t._clickHandlerDeleteButton(e,a,o)}if(r)return t._closeEditor(),t._contextMenuOptions=t._addOptions,void t._handleContextMenu(i);if(d){const e=d.classList;return void t._clickHandlerFilterButton(e,c,i)}t.$.conditionsMenu.opened&&(t.$.fireEvent("menuClosing"),t.$.conditionsMenu.close(),t.$.fireEvent("menuClose"));const p=i.closest(".smart-drop-down"),h=t._editor&&t._editor.contains(i)||p&&p.ownerElement===t._editor||i.closest(".smart-custom-editor");t._editorIsOpen&&t._editor&&!h&&(t._scrollBarDown?delete t._scrollBarDown:t._closeEditor())}_clickHandlerDeleteButton(e,t,i){const a=this;a.$.conditionsMenu.opened&&(a.$.fireEvent("menuClosing"),a.$.conditionsMenu.close(),a.$.fireEvent("menuClose")),a._closeEditor(),e?(a._deleteElement(i,"group"),a._generateValue()):t&&(a._deleteElement(t),a._generateValue()),a.$.scrollableContainer.refresh()}_clickHandlerFilterButton(e,t,i){const a=this;if(!i.closest(".smart-editors-container")&&(a._closeEditor(),a._editedItem=a._getItemById(t),e.contains("smart-filter-field-name")||a._editedItem.data&&a._editedItem.data.length))if(e.contains("smart-filter-group-operation"))l(i,a._groupOperationDescriptions,a._editedItem.data);else if(e.contains("smart-filter-add-btn"))l(i,a._groupOperationDescriptions);else{if(e.contains("smart-filter-field-name"))return a._fields||a._mapFieldsToMenu(),void l(i,a._fields,a._editedItem.data[0]);if(e.contains("smart-filter-operation")){const e=a._getFieldByFieldName(a._editedItem.data[0]);if(!e)return;let t=a._filterOperationDescriptions.slice();if(e&&e.filterOperations)t=a._filterOperationDescriptions.filter(t=>e.filterOperations.indexOf(t.value)>-1);else{let i;switch(e.dataType){case"number":case"date":case"dateTime":i=["=","<>","<",">","<=",">=","isblank","isnotblank"];break;case"boolean":i=["=","<>","isblank","isnotblank"];break;case"object":i=["isblank","isnotblank"];break;case"string":i=["contains","notcontains","startswith","endswith","=","<>","isblank","isnotblank"];break;default:i=["contains","notcontains","startswith","endswith","=","<>","<",">","<=",">=","isblank","isnotblank"]}t=a._filterOperationDescriptions.filter(e=>i.indexOf(e.value)>-1)}return a.showIcons&&(t=t.map(e=>(e.label='<div class="smart-filter-builder-icon">'+a.icons[e.value]+'</div><div class="smart-filter-builder-menu-item">'+a.localize(e.value)+"</div>",e))),void l(i,t.slice(),a._editedItem.data[1])}a._openEditor(i)}function l(e,t,i){!function(){const e=a.$.conditionsMenu.querySelector(".smart-selected-menu-item");e&&e.classList.remove("smart-selected-menu-item")}(),a._contextMenuOptions=0===t.length?a._defaultFilterOperationDescriptions:t,a._handleContextMenu(e);const l=i,o=a.$.conditionsMenu.querySelector('smart-menu-item[value="'+l+'"]');a.$.conditionsMenu.opened&&o&&o.classList.add("smart-selected-menu-item")}}_closeEditor(e){const t=this;let i;if(!t._editedItem||!t._editorIsOpen)return;if(t._editor===t.$.dateTimePickerEditor)t._editor._inputChangeHandler(),i=t._editor.value,i&&(i=i.toDate());else if(t._editor===t.$.checkBoxEditor)i=t._editor.checked;else if(t._editor===t.$.customEditor)i=t._selectedCustomCondition.handleValue(t._editor);else if(t._editor===t.$.numericTextBoxEditor)t._editor._inputBlurHandler(),i=t._editor.value;else{const e=t._getFieldByFieldName(t._editedItem.data[0]);i="array"===e.dataType?t._editor.value.split(","):"object"===e.dataType?JSON.parse(t._editor.value):t._editor.value}const a=t._editedItem,l=a.htmlNode,o=a.nodeId,n=t._getFieldByFieldName(a.data[0]).dataType,r=l.querySelector(".smart-filter-value"),s=l.querySelector(".smart-value-container"),d={value:i,valueType:n||"string",editedItem:a};if(t.$.fireEvent("editorClosing",d),t._updateValueInFlatArray(o,i,"value",n||"string"),t._generateValue(e),r.removeAttribute("edited"),t.$.editorsContainer.removeAttribute("open"),t._editor===t.$.checkBoxEditor)s.innerHTML=t._editor.checked?"true":"false";else if(t._editor===t.$.customEditor){const e=t._selectedCustomCondition.valueTemplate(t._editor);s.innerHTML=e}else s.innerHTML=t._formatValueStringRepresentation(t._editor.value,t._editedItem.data[0]);t._editor.classList.add("smart-hidden"),t._editorIsOpen=t._enterIsPressedInEditor=!1,t.$.fireEvent("editorClose",d),t.$.scrollableContainer.refresh()}_defaultValueByType(e){let t;switch(e){case"number":t=0;break;case"date":case"dateTime":t=new Date,t.setHours(0,0,0);break;case"boolean":t=!1;break;case"object":t=null;break;default:t=""}return t}_deleteElement(e,t){const i=this,a=e instanceof HTMLElement?e:i._valueFlat.find(t=>t.nodeId===e).htmlNode,l="string"==typeof e?e:e.getAttribute("node-id");if(l&&1!==l.length){"group"===t?function e(t){const a=i._valueFlat.filter(e=>t===e.nodeId),l=a?a[0]:null;for(let a=0;a<i._valueFlat.length;a++){const l=i._valueFlat[a],n=l.nodeId;l.parentId===t&&("group"===l.type?e(n):o(n))}i._valueFlat.indexOf(l)>-1&&i._valueFlat.splice(i._valueFlat.indexOf(l),1)}(l):o(l);for(let e=i._valueFlat.length-1;e>=0;e--){0===i._valueFlat.filter(t=>i._valueFlat[e].parentId===t.nodeId).length&&"0"!==i._valueFlat[e].nodeId&&(i._valueFlat.splice(e,1),i._totalConditions--)}i._generateValue(),a.parentElement.removeChild(a),function e(t,a){t.forEach((t,l)=>{const o=i._valueFlat.find(e=>e.htmlNode===t),n=a+"."+l;t.setAttribute("node-id",n),o.parentId=a,o.nodeId=n,t.classList.contains("smart-filter-group")&&e(Array.from(t.children[1].children),n)})}(Array.from(i.$.contentContainer.firstElementChild.children[1].children),"0")}function o(e){const t=i._valueFlat.filter(t=>e===t.nodeId);let a=t?t[0]:null;i._valueFlat.splice(i._valueFlat.indexOf(a),1),i._totalConditions--}}_documentClickHandler(e){const t=this;(t.isInShadowDOM?e.composedPath()[0]:e.target).closest("smart-filter-builder")?t._clickHandler(e):(t._editorIsOpen&&!t._scrollBarDown&&t._closeEditor(),delete t._scrollBarDown)}_downHandler(e){const t=this;(t.shadowRoot||t.isInShadowDOM?e.composedPath()[0]:e.target).closest("smart-scroll-bar")?t._scrollBarDown=!0:delete t._scrollBarDown}_containerChangeHandler(e){e.stopPropagation()}_emptyElementsStructure(e){const t=this.$.contentContainer;for(;t.firstChild;)t.removeChild(t.firstChild);this._valueFlat=e?[]:this._valueFlat,this._lastProcessedItemInCurrentGroup={parentId:null,id:null,position:null}}_filterGroupRow(e){e=this.localize(e||"or");let t=document.createElement("div"),i=`<span class="smart-filter-delete-btn"></span>\n                <span class="filter-builder-item smart-filter-group-operation">${e}</span>\n                <span class="smart-filter-add-btn"></span>`;return t.className="smart-filter-group-operator",t.innerHTML=i,t.data=e||"or",t}_formatValueStringRepresentation(e,t){const i=this,a=i._getFieldByFieldName(t);let l;if(!a)return e;if((!e||0===e.length)&&"boolean"!==a.dataType&&"number"===a.dataType&&null===e||"string"===a.dataType&&(!e||0===e.length))return i.valuePlaceholder;switch(a.dataType){case"date":case"dateTime":e?((e=function(e){return 0===e||"number"==typeof e||"string"==typeof e||!0===e||""===e||"0"===e||Array.isArray(e)||"object"==typeof e&&e.constructor===Date?new Smart.Utilities.DateTime(e):e}(e)).calendar.days=i._localizedDays,e.calendar.months=i._localizedMonths,e.calendar.locale=i.locale,Smart.Utilities.DateTime.cache=[],l=e.toString("date"===a.dataType?i.formatStringDate:i.formatStringDateTime)):l=i.valuePlaceholder;break;case"array":l="string"==typeof e?e.split(","):e;break;case"object":l="string"==typeof e?e:JSON.stringify(e);break;case"number":l=e;break;case"boolean":l=!1===e?"false":"true";break;default:l=e+""}if(!i.valueFormatFunction)return l;return i.valueFormatFunction(l,t,a.dataType||"string")}_generateHTMLStructureFromFlatValue(){const e=this,t=document.createDocumentFragment();if(e._valueFlat&&0!==e._valueFlat.length)for(let i=0;i<e._valueFlat.length;i++){const a=e._valueFlat[i],l=!!e.customOperations&&e.customOperations.find(e=>e.name===a.data[1]),o=a.parentId?(e.shadowRoot||e).querySelector('[node-id="'+a.parentId+'"]').querySelector(".smart-filter-group-condition-container"):e.$.contentContainer;if("group"===a.type){const l=document.createElement("div"),o=e._filterGroupRow(a.data),n=document.createElement("div");l.className="smart-filter-group",n.className="smart-filter-group-condition-container",l.appendChild(o),l.appendChild(n),t.appendChild(l),l.setAttribute("node-id",a.nodeId),e._valueFlat[i].htmlNode=l,e._isMaxLevelExceeded(a.nodeId+".0")&&l.setAttribute("max-level","")}else{const o=e._newFilterConditionRow(a.data);o.setAttribute("node-id",a.nodeId),t.appendChild(o),e._valueFlat[i].htmlNode=o,(-1!==["isblank","isnotblank"].indexOf(a.data[1])||l&&l.hideValue)&&o.children[3].classList.add("smart-hidden")}o.appendChild(t)}}_generateValue(){const e=this;let t=[];!function(e){for(let i=0;i<e.length;i++){const a=e[i];let l={};"group"===a.type&&(l.nodeId=a.nodeId,l.parentId=a.parentId,l.structure=[a.data||"or"],t.push(l))}for(let i=0;i<t.length;i++){const a=t[i],l=e.filter(e=>e.parentId===a.nodeId&&"condition"===e.type);for(let e=0;e<l.length;e++)0===e?a.structure.unshift(l[e].data):a.structure.push(l[e].data)}t=t.filter(e=>e.structure.length>1),t.sort((function(e,t){return t.nodeId.split(".").length-e.nodeId.split(".").length}));for(let e=0;e<t.length;e++){const i=t[e],a=t.filter(e=>e.nodeId===i.parentId)[0];a&&a.structure&&a.structure.push(i.structure)}}(e._valueFlat.slice()),t.length>0?e.value=e._valueFlat.length>1?t[t.length-1].structure:t:e.value=[e._getItemById("0").data];const i=JSON.stringify(e.value);e._oldValueAsString!==i&&(e._oldValueAsString=i,e.$.fireEvent("change",{value:JSON.parse(i)}))}_getFieldByFieldName(e){return(this.fields?this.fields.filter(t=>t.dataField===e):this._valueFields.filter(t=>t.dataField===e))[0]||null}_getFieldsFromValue(){const e=this._valueFlat,t=[],i=[];for(let a=0;a<e.length;a++)if("condition"===e[a].type){const l=e[a].data[0];if(-1===t.indexOf(l)){const e={label:l,dataField:l,dataType:"string",format:null};t.push(l),i.push(e)}}this._valueFields=i}_getItemById(e,t){const i=this._valueFlat.filter(i=>t?i.parentId===e:i.nodeId===e);return i.length>0?i[0]:null}_handleContextMenu(e){const t=this;if(t._selectedElement===e&&t.$.conditionsMenu.opened)return;const i=e.getBoundingClientRect(),a=t.getBoundingClientRect(),l=i.height,o=i.left+t.$.contentContainer.scrollLeft-a.left,n=i.top+t.$.contentContainer.scrollTop-a.top+l;if(e.closest(".smart-filter-add-btn")&&t.restrictedMode){t._checkFieldsExistence();const e=t.fields?t.fields[0]:t._valueFields[0],i=e.filterOperations&&e.filterOperations.length>0?e.filterOperations[0]:"=";t._addElement("condition",0,[e.dataField,i,t._defaultValueByType(e.dataType)])}else t._closeEditor(),t.disableContextMenu?t._selectedElement=e:(t.$.conditionsMenu.dataSource=t._contextMenuOptions,t.$.conditionsMenu.open(o,n),t._selectedElement=e,t.$.scrollableContainer.refresh())}_handleCustomOperations(){const e=this;e._filterOperationDescriptions=e._defaultFilterOperationDescriptions;for(let t=0;t<e.customOperations.length;t++){const i=e.customOperations[t];e._filterOperationDescriptions.push({label:i.label,value:i.name,custom:!0,index:t,editorTemplate:i.editorTemplate,valueTemplate:i.valueTemplate,handleValue:i.handleValue})}}_initializeEditor(e){const t=this,i="smart-"+Smart.Utilities.Core.toDash(e),a=document.createElement(i);"numericTextBox"===e?(a.spinButtons=!0,a.inputFormat="floatingPoint"):"dateTimePicker"===e&&(a.calendarButton=!0,a.dropDownDisplayMode="auto",a.enableMouseWheelAction=!0,a.locale=t.locale,a.messages[t.locale]||(a.messages[t.locale]={}),a.messages[t.locale].dateTabLabel=t.localize("dateTabLabel"),a.messages[t.locale].timeTabLabel=t.localize("timeTabLabel")),a.tabIndex="1",a.theme=t.theme,a.animation=t.animation,t.$[e+"Editor"]=a,a.$=Smart.Utilities.Extend(a),a.className=i+"-editor smart-hidden",t.$.editorsContainer.appendChild(a),t["_"+e+"Initialized"]=!0}_innerContainerKeydownHandler(e){"Escape"!==e.key&&"Enter"!==e.key||!this._editorIsOpen||this._closeEditor()}_inputBlurHandler(){const e=this;let t;if(e._editor===e.$.dateTimePickerEditor)t=e._editor.value,t&&(t=t.toDate());else if(e._editor===e.$.checkBoxEditor)t=e._editor.checked;else if(e._editor===e.$.customEditor)t=e._selectedCustomCondition.handleValue(e._editor);else{const i=e._getFieldByFieldName(e._editedItem.data[0]);t="array"===i.dataType?e._editor.value.split(","):"object"===i.dataType?JSON.parse(e._editor.value):e._editor.value}const i=e._editedItem,a=i.nodeId,l=e._getFieldByFieldName(i.data[0]).dataType;e._updateValueInFlatArray(a,t,"value",l||"string"),e._generateValue()}_localizeInitialValues(){const e=Smart.Utilities.DateTime.getLocalizedNames(this.locale);this._addOptions=[{label:this.localize("addCondition"),value:"addCondition"},{label:this.localize("addGroup"),value:"addGroup"}],this._groupOperationDescriptions=[{label:this.localize("and"),value:"and"},{label:this.localize("notand"),value:"notand"},{label:this.localize("or"),value:"or"},{label:this.localize("notor"),value:"notor"}],this._defaultFilterOperationDescriptions=this._filterOperationDescriptions=[{label:this.localize("="),value:"=",custom:!1},{label:this.localize("<>"),value:"<>",custom:!1},{label:this.localize(">"),value:">",custom:!1},{label:this.localize(">="),value:">=",custom:!1},{label:this.localize("<"),value:"<",custom:!1},{label:this.localize("<="),value:"<=",custom:!1},{label:this.localize("startswith"),value:"startswith",custom:!1},{label:this.localize("endswith"),value:"endswith",custom:!1},{label:this.localize("contains"),value:"contains",custom:!1},{label:this.localize("notcontains"),value:"notcontains",custom:!1},{label:this.localize("isblank"),value:"isblank",custom:!1},{label:this.localize("isnotblank"),value:"isnotblank",custom:!1}],this._localizedDays=e.days,this._localizedMonths=e.months}_mapFieldsToMenu(){(this.fields||this._valueFields)&&(this._fields=(this.fields||this._valueFields).map(e=>{let t={};return t.label=e.label,t.value=e.dataField,t.dataType=e.dataType,t}))}_menuItemClickHandler(e){const t=this,i=t._selectedElement.closest(".filter-builder-item"),a=e.detail,l=a.value,o=t.localize(l)||a.label;if(i){const e=i.closest(".smart-filter-group-condition"),a=i.closest(".smart-filter-group"),n=e?e.getAttribute("node-id"):a.getAttribute("node-id");let r=2;if(i.innerHTML=o,i.value=l,t._editedItem&&i.classList.contains("smart-filter-field-name")&&t._editedItem.data[0]!==l){const e=i.parentNode.querySelector(".smart-filter-value"),a=t.customOperations.map(e=>{if(e.hideValue)return e.name}).filter(e=>e).concat(["isblank","isnotblank"]);t._clearConditionsValue(n,l),t._setInitialFilterOperation(n,l),a.indexOf(l)>-1?e.classList.add("smart-hidden"):e.classList.remove("smart-hidden")}if(i.classList.contains("smart-filter-field-name"))r=0;else if(i.classList.contains("smart-filter-operation")){const e=i.parentNode.querySelector(".smart-filter-value");let a;if(t.customOperations){const e=t.customOperations.filter(e=>e.name===l);e.length>0&&(a=e[0])}["isblank","isnotblank"].indexOf(l)>-1||a&&a.hideValue?(t._clearConditionsValue(n),e.classList.add("smart-hidden")):e.classList.remove("smart-hidden"),r=1}else if(i.classList.contains("smart-filter-group-operation")){for(let e=0;e<t._valueFlat.length;e++)t._valueFlat[e].nodeId===n&&(t._valueFlat[e].data=i.value);return t._generateValue(),void t.$.scrollableContainer.refresh()}for(let e=0;e<t._valueFlat.length;e++)t._valueFlat[e].nodeId===n&&(t._valueFlat[e].data[r]=i.value);return t._generateValue(),void t.$.scrollableContainer.refresh()}const n=t._selectedElement.closest(".smart-filter-group").getAttribute("node-id");if(!t._isMaxLevelExceeded(n+".0")){if("addCondition"===l&&(t.maxConditions&&t._totalConditions<t.maxConditions||!t.maxConditions)){t._checkFieldsExistence();const e=t.fields?t.fields[0]:t._valueFields[0],i=e.filterOperations&&e.filterOperations.length>0?e.filterOperations[0]:"=";t._addElement("condition",n,[e.dataField,i,t._defaultValueByType(e.dataType)])}else"addGroup"===l&&t._addElement("group",n,"and");t.$.scrollableContainer.refresh()}}_setInitialFilterOperation(e,t){const i=this,a=i.fields.find(e=>e.dataField===t),l=i._valueFlat.find(t=>t.nodeId===e),o=l.htmlNode.getElementsByClassName("smart-filter-operation")[0],n=a&&a.filterOperations&&a.filterOperations.length>0?a.filterOperations[0]:"=";let r=i.localize(n);r||(r=i.customOperations.find(e=>e.name===n).label),l.data[1]=n,o.innerHTML=r}_checkFieldsExistence(){const e=this;e.fields&&0!==e.fields.length||e._valueFields&&0!==e._valueFields.length||e.error(e.localize("missingFields",{elementType:e.nodeName.toLowerCase()}))}_newFilterConditionRow(e){const t=this,i=(e=e||[])[0]?e[0]:t.fields[0].dataField,a=t._formatValueStringRepresentation(e[2],e[0]),l=t.fields?t.fields.filter(e=>e.dataField===i):t._valueFields.filter(e=>e.dataField===i),o=l.length>0?l[0].label:e[0];let n=t.localize(e[1]);!n&&t.customOperations&&t.customOperations.length>0&&(n=t.customOperations.find(t=>t.name===e[1]).label);let r=document.createElement("div"),s=`<span class="smart-filter-delete-btn"></span>\n                <span class="filter-builder-item smart-filter-field-name">${o}</span>\n                <span class="filter-builder-item smart-filter-operation">${n||""}</span>\n                <span class="filter-builder-item smart-filter-value"><span class="smart-value-container">${a}</span></span>`;return r.className="smart-filter-group-condition",r.innerHTML=s,r}_openEditor(e){const t=this,i=e&&e.closest(".smart-filter-group-condition")?e.closest(".smart-filter-group-condition").getAttribute("node-id"):null,a=e.closest(".smart-filter-value"),l=t._getItemById(i),o=l.data[0]||t.fields[0].dataField||t._valueFields[0].dataField,n=t._getFieldByFieldName(o);let r;if(l?(r=l.data[2],void 0===r&&(r="")):r="",!n)return;t._editorIsOpen&&t._closeEditor(),t.$.conditionsMenu.opened&&t.$.conditionsMenu.close(),a.setAttribute("edited",""),t._editedItem=l;const s=(t.fields||t._valueFields).filter(e=>e.dataField===o),d=t._filterOperationDescriptions.filter(e=>e.value===l.data[1]&&e.custom),c=s.length>0?s[0]:null,u=n.lookup&&n.lookup.dataSource?"lookup":c.dataType;0!==d.length&&d[0].editorTemplate?(t._selectedCustomCondition=d[0],t._openCustomEditor(u,r,n)):t._openEditorByFieldType(u,r,n),t.$.fireEvent("editorOpening",{value:r,type:u,editedItem:l}),setTimeout((function(){t._editor.focus(),t._editor!==t.$.numericTextBoxEditor&&t._editor!==t.$.textBoxEditor||(t.$.scrollableContainer.scrollLeft=t.$.scrollableContainer.$.scrollViewerContainer.scrollLeft,t.$.scrollableContainer.scrollTop=t.$.scrollableContainer.$.scrollViewerContainer.oldTop,t.$.scrollableContainer.$.scrollViewerContainer.scrollLeft=0,t.$.scrollableContainer.$.scrollViewerContainer.scrollTop=0,t._editor.$.input.selectionStart=t._editor.$.input.selectionEnd=t._editor.$.input.value.length),t.$.scrollableContainer.refresh(),t.$.fireEvent("editorOpen",{value:r,type:u,editedItem:l})}),0),t._editor.classList.remove("smart-hidden"),t._editorIsOpen=!0,t.$.editorsContainer.setAttribute("open",""),a.appendChild(t.$.editorsContainer),t.$.scrollableContainer.refresh()}_openEditorByFieldType(e,t,i){const a=this;switch(e){case"lookup":a._comboBoxInitialized||a._initializeEditor("comboBox"),a._editor=a.$.comboBoxEditor,a._editor.dataSource=i.lookup.dataSource,a._editor.dropDownAppendTo=a.$.container,a._editor.selectedValues=[t];break;case"boolean":a._checkBoxInitialized||a._initializeEditor("checkBox"),a._editor=a.$.checkBoxEditor,a._editor.checked=!!t;break;case"dateTime":a._dateTimePickerInitialized||a._initializeEditor("dateTimePicker"),a._editor=a.$.dateTimePickerEditor,a._editor.formatString=a.formatStringDateTime,a._editor.dropDownAppendTo=a.$.container,a._editor.value=t;break;case"date":a._dateTimePickerInitialized||a._initializeEditor("dateTimePicker"),a._editor=a.$.dateTimePickerEditor,a._editor.formatString=a.formatStringDate,a._editor.dropDownAppendTo=a.$.container,a._editor.value=t;break;case"number":a._numericTextBoxInitialized||a._initializeEditor("numericTextBox"),t=t||0,a._editor=a.$.numericTextBoxEditor,a._editor.value=t;break;case"array":a._textBoxInitialized||a._initializeEditor("textBox"),a._editor=a.$.textBoxEditor,a._editor.value=t.toString();break;case"object":a._textBoxInitialized||a._initializeEditor("textBox"),t=t||{},a._editor=a.$.textBoxEditor,a._editor.value=JSON.stringify(t);break;default:a._textBoxInitialized||a._initializeEditor("textBox"),a._editor=a.$.textBoxEditor,a._editor.value=t+""}}_openCustomEditor(e,t,i){const a=this,l=a.customOperations[a._selectedCustomCondition.index].editorTemplate(e,t,i);a.$.customEditor.innerHTML="",l&&a.$.customEditor.appendChild(l),a._editor=a.$.customEditor}_refresh(){this._generateValue(),this._emptyElementsStructure(),this._generateHTMLStructureFromFlatValue(),this.$.scrollableContainer.refresh()}refresh(){this._refresh()}_resizeHandler(){this.$.scrollableContainer.refresh()}_scrollViewerWheelHandler(e){"wheel"===e.type&&this.$.scrollableContainer.scrollHeight&&(e.stopPropagation(),e.preventDefault())}_setInitialValues(){this._mapFieldsToMenu(),this._localizeInitialValues(),this.$.conditionsMenu.dropDownAppendTo=this.$.container,this.$.conditionsMenu.dataSource=this._groupOperationDescriptions,this._valueFlat=[],this._lastProcessedItemInCurrentGroup={parentId:null,id:null,position:null}}_updatePlaceholder(){const e=this;for(let t=0;t<e._valueFlat.length;t++){const i=e._valueFlat[t];"condition"!==i.type||null!==i.data[2]&&""!==i.data[2]||(i.htmlNode.querySelector(".smart-value-container").innerHTML=e.valuePlaceholder)}e.$.textBoxEditor&&(e.$.textBoxEditor.placeholder=e.valuePlaceholder)}_updateValueInFlatArray(e,t,i,a){const l=this;if(e&&!l.disabled){if(a=a||"string",i=i||"value",null!==t)switch(a){case"number":t=parseFloat(t);break;case"boolean":t=!!t;break;case"string":t+=""}for(let a=0;a<l._valueFlat.length;a++)if(l._valueFlat[a].nodeId===e)switch(i){case"column":l._valueFlat[a].data[0]=t;break;case"filterCondition":l._valueFlat[a].data[1]=t;break;case"value":l._valueFlat[a].data[2]=t;break;case"groupCondition":l._valueFlat[a].data=t}}}_validateNode(e,t){const i=this;let a;return e instanceof HTMLElement?a=i._getItemById(e.getAttribute("node-id")):"string"==typeof e?a=i._getItemById(e):i.error(i.localize("wrongElementNode",{elementType:i.nodeName.toLowerCase(),method:t})),a||i.error(i.localize("wrongElementNode",{elementType:i.nodeName.toLowerCase(),method:t})),a}_validateUserData(e,t){const i=this;if(t)(!Array.isArray(e)||e.length<3)&&i.error(i.localize("invalidDataStructure",{elementType:i.nodeName.toLowerCase()}));else{const t=/^(and|or|notAnd|notOr)$/i;"string"==typeof e&&e.match(t)||i.error(i.localize("invalidDataStructure",{elementType:i.nodeName.toLowerCase()}))}}_validateValue(){const e=this.maxConditions,t=this.maxConditionsPerGroup,i=this.maxLevel;let a=0;if(null===e&&null===t&&null===i)return;const l=[];!function l(o,n,r){let s=0;o.forEach(o=>{if(Array.isArray(o))if(function(e){return 3===e.length&&"string"==typeof e[0]&&"string"==typeof e[1]}(o)){if(null!==e&&e===a||null!==t&&t===s)return;r.push(o),s++,a++}else{if(null!==i&&i===n+1)return;const e=[];r.push(e),l(o,n+1,e)}else r.push(o)})}(this.value,0,l),this.value=l}}),Smart("smart-query-builder",class extends Smart.BaseElement{static get properties(){return{allowDrag:{value:!1,type:"boolean"},applyMode:{allowValues:["immediately","change"],value:"change",type:"string"},customOperations:{value:[],type:"array",reflectToAttribute:!1},customOperators:{value:{},type:"object",reflectToAttribute:!1},dropDownWidth:{type:"any",value:"100%"},fields:{value:null,type:"array?",reflectToAttribute:!1},fieldsMode:{value:"dynamic",allowedValues:["dynamic","static"],type:"string"},formatStringDate:{value:"dd-MMM-yy",type:"string"},formatStringDateTime:{value:"dd-MMM-yy HH:mm:ss",type:"string"},getDynamicField:{value:null,type:"function?"},icons:{value:{"=":"equals","<>":"notequals",">":"greaterthan",">=":"greaterthanorequal","<":"lessthan","<=":"lessthanorequal",startswith:"startswith",endswith:"endswith",contains:"contains",notcontains:"notcontains",isblank:"isblank",isnotblank:"isnotblank"},type:"object",reflectToAttribute:!1},messages:{value:{en:{add:"Add",addCondition:"Add Condition",addGroup:"Add Group",and:"And",notand:"Not And",or:"Or",notor:"Not Or","=":"Equals","<>":"Does not equal",">":"Greater than",">=":"Greater than or equal to","<":"Less than","<=":"Less than or equal to",startswith:"Starts with",endswith:"Ends with",contains:"Contains",notcontains:"Does not contain",isblank:"Is blank",isnotblank:"Is not blank",wrongParentGroupIndex:'{{elementType}}: Wrong parent group index in "{{method}}" method.',wrongElementNode:'{{elementType}}: Incorect node / node Id in "{{method}}" method.',invalidDataStructure:"{{elementType}}: Used invalid data structure in updateCondition/updateGroup method.",dateTabLabel:"DATE",timeTabLabel:"TIME",queryLabel:"Query"}},type:"object",extend:!0},operatorPlaceholder:{value:"Operator",type:"string"},propertyPlaceholder:{value:"Property",type:"string"},showIcons:{value:!1,type:"boolean"},value:{value:[],type:"any",reflectToAttribute:!1},valueFormatFunction:{value:null,type:"function?",reflectToAttribute:!1},valuePlaceholder:{value:"Value",type:"string"}}}static get requires(){const e={"Smart.Button":"smart.button.js","Smart.Calendar":"smart.calendar.js","Smart.CheckBox":"smart.checkbox.js","Smart.DateTimePicker":"smart.datetimepicker.js","Smart.DropDownList":"smart.dropdownlist.js","Smart.Input":"smart.input.js","Smart.ListBox":"smart.listbox.js","Smart.Menu":"smart.menu.js","Smart.NumericTextBox":"smart.numerictextbox.js","Smart.ScrollBar":"smart.scrollbar.js","Smart.TimePicker":"smart.timepicker.js","Smart.Tooltip":"smart.tooltip.js","Smart.Utilities.BigNumber":"smart.math.js","Smart.Utilities.DateTime":"smart.date.js","Smart.Utilities.Draw":"smart.draw.js","Smart.Utilities.NumericProcessor":"smart.numeric.js"};return window.NIComplex||(e["Smart.Utilities.Complex"]="smart.complex.js"),e}static get listeners(){return{down:"_downHandler",resize:"_resizeHandler","editorsContainer.keydown":"_innerContainerKeydownHandler","conditionsMenu.close":"_menuCloseHandler","conditionsMenu.closing":"_menuClosingHandler","conditionsMenu.itemClick":"_menuItemClickHandler","contentContainer.change":"_contentContainerChangeHandler","scrollableContainer.touchmove":"_scrollableContainerTouchmoveHandler","document.down":"_documentDownHandler","document.move":"_documentMoveHandler","document.up":"_documentUpHandler"}}static get styleUrls(){return["smart.querybuilder.css"]}template(){return'<div id="container" role="presentation">\n                    <smart-scroll-viewer id="scrollableContainer" class="smart-scrollable-container" animation="[[animation]]" right-to-left="[[rightToLeft]]">\n                        <div id="queryLabel" class="smart-query-builder-label smart-unselectable"></div>\n                        <div id="contentContainer" class="smart-content-container"></div>\n                    </smart-scroll-viewer>\n                    <div id="editorsContainer" class="smart-editors-container" role="presentation">\n                        <div id="customEditor" class="smart-custom-editor smart-hidden"></div>\n                    </div>\n                    <smart-menu id="conditionsMenu" mode="dropDown" class="smart-conditions-menu" theme="[[theme]]" animation="[[animation]]" right-to-left="[[rightToLeft]]"></smart-menu>\n                </div>'}propertyChangedHandler(e,t,i){super.propertyChangedHandler(e,t,i);const a=this;switch(e){case"animation":case"theme":["textBoxEditor","numericTextBoxEditor","comboBoxEditor","dateTimePickerEditor","checkBoxEditor"].forEach(t=>a.$[t]&&(a.$[t][e]=i));break;case"formatStringDate":case"formatStringDateTime":case"valueFormatFunction":a._refresh();break;case"operatorPlaceholder":Array.from((a.shadowRoot||a).querySelectorAll(".smart-filter-operation[placeholder]")).forEach(e=>e.firstElementChild.innerHTML=i);break;case"propertyPlaceholder":Array.from((a.shadowRoot||a).querySelectorAll(".smart-filter-field-name[placeholder]")).forEach(e=>e.firstElementChild.innerHTML=i);break;case"showIcons":a._closeEditor(),i?a._filterOperationDescriptions.map(e=>e.icon=a.icons[e.value]):a._filterOperationDescriptions.map(e=>delete e.icon);break;case"customOperations":case"fields":case"value":{const t=JSON.stringify(a._validValue);"customOperations"===e?a._handleCustomOperations():""===e&&a._mapFieldsToMenu(),a._applyValue(),a._oldValueAsString!==t&&(a._oldValueAsString=t,a.$.fireEvent("change",{value:JSON.parse(t),linq:a._parseQueryToLinq(a._validValue)}));break}case"valuePlaceholder":Array.from((a.shadowRoot||a).querySelectorAll(".smart-filter-value[placeholder]")).forEach(e=>e.firstElementChild.innerHTML=i);break;case"locale":case"messages":a._localizeInitialValues(),a._refresh(),a._handleCustomOperations(),a.$.dateTimePickerEditor&&(a.$.dateTimePickerEditor.messages[a.locale]||(a.$.dateTimePickerEditor.messages[a.locale]={}),a.$.dateTimePickerEditor.messages[a.locale].dateTabLabel=a.localize("dateTabLabel"),a.$.dateTimePickerEditor.messages[a.locale].timeTabLabel=a.localize("timeTabLabel"),"locale"===e?a.$.dateTimePickerEditor.locale=a.locale:"messages"===e&&(a.$.dateTimePickerEditor.$.selectDate.innerHTML=a.$.dateTimePickerEditor.messages[a.locale].dateTabLabel,a.$.dateTimePickerEditor.$.selectTime.innerHTML=a.$.dateTimePickerEditor.messages[a.locale].timeTabLabel));break;case"icons":a._closeEditor()}}ready(){super.ready();const e=this;e.$.queryLabel.id||(e.$.queryLabel.id=e.id+"Label"),e.setAttribute("role","dialog"),e.setAttribute("aria-labelledby",e.$.queryLabel.id),-1!==navigator.platform.toLowerCase().lastIndexOf("mac")&&e.$.contentContainer.classList.add("mac"),e._setInitialValues(),e._handleCustomOperations(),e._applyValue(),Object.defineProperty(e,"value",{get:function(){return e.context===e?e.properties.value.value:e._validValue},set(t){e.updateProperty(e,e._properties.value,t)}})}getLinq(){if(this._validValue)return this._parseQueryToLinq(this._validValue)}_setInitialValues(){this._autoScrollCoefficient=Smart.Utilities.Core.Browser.Firefox?4:Smart.Utilities.Core.Browser.Edge?8:2,this._isMobile=Smart.Utilities.Core.isMobile,this._manuallyAddedFields=[],this._localizeInitialValues(),this.$.conditionsMenu.dropDownAppendTo=this.$.container,this.$.conditionsMenu.dataSource=this._groupOperationDescriptions,this._valueFlat=[],this._lastProcessedItemInCurrentGroup={parentId:null,id:null,position:null}}_applyValue(){this._emptyElementsStructure(!0),this._validateValue(),this._convertValueToFlat(this.value),this._getFieldsFromValue(),this._mapFieldsToMenu(),this._validateValueByType(),this._generateHTMLStructureFromFlatValue(!0),this._restrictNesting(),this._validValue=this._getValidValue(),this._oldValueAsString=JSON.stringify(this._validValue)}_validateValueByType(){const e=this;if(!e._valueFlat||!e._valueFlat.length)return;const t=e._valueFlat;for(let i=0;i<t.length;i++){const a=t[i];if("condition"!==a.type)continue;const l=a.data[0];!l||a.data.length<3||(a.data[2]=e._validateStoredValue(a.data[2],l))}e._generateValue(!0)}_setRequiredFields(){const e=this;if(!e.requiredFields||!e.requiredFields.length)return;const t=e.value;let i=[];for(let a=0;a<e.requiredFields.length;a++){const l=e.requiredFields[a],o=e.fields.find(e=>e.dataField===l);if(o){let e=[];if(t){let i=0;for(;i<t.length;){const a=t[i];if(Array.isArray(a)){let t=0;for(;t<a.length;){let i=a[t];i&&i[0]===o.dataField?(e.push(i),a.splice(t>0?t-1:t,2)):t++}}a.length?i++:t.splice(i,2)}}if(e)for(let t=0;t<e.length;t++)i.push(e[t]),i.push("and");else i.push([l]),i.push("and")}}"string"==typeof i[i.length-1]&&i.pop(),e.value.unshift(i,"and")}_contentContainerChangeHandler(e){const t=this;e.stopPropagation(),"immediately"===t.applyMode&&t._editorIsOpen&&t._editor&&(t._editor.closest(".filter-builder-item").classList.contains("smart-filter-value")||t._closeEditor())}_mapFieldsToMenu(){(this.fields||this._valueFields)&&(this._fields=(this.fields||this._valueFields).concat(this._manuallyAddedFields).map(e=>({label:e.label,value:e.dataField,dataType:e.dataType,filterOperations:e.filterOperations,lookup:e.lookup})))}_localizeInitialValues(){this.$.queryLabel.innerHTML=this.localize("queryLabel"),this._addOptions=[{label:this.localize("addCondition"),value:"addCondition"},{label:this.localize("addGroup"),value:"addGroup"}],this._groupOperationDescriptions=[{label:this.localize("and"),value:"and"},{label:this.localize("or"),value:"or"}],this._defaultFilterOperationDescriptions=this._filterOperationDescriptions=[{label:this.localize("="),value:"=",custom:!1},{label:this.localize("<>"),value:"<>",custom:!1},{label:this.localize(">"),value:">",custom:!1},{label:this.localize(">="),value:">=",custom:!1},{label:this.localize("<"),value:"<",custom:!1},{label:this.localize("<="),value:"<=",custom:!1},{label:this.localize("startswith"),value:"startswith",custom:!1},{label:this.localize("endswith"),value:"endswith",custom:!1},{label:this.localize("contains"),value:"contains",custom:!1},{label:this.localize("notcontains"),value:"notcontains",custom:!1},{label:this.localize("isblank"),value:"isblank",custom:!1},{label:this.localize("isnotblank"),value:"isnotblank",custom:!1}];const e=Smart.Utilities.DateTime.getLocalizedNames(this.locale);this._localizedDays=e.days,this._localizedMonths=e.months}_handleCustomOperations(){const e=this;e._filterOperationDescriptions=e._defaultFilterOperationDescriptions.slice(0);for(let t=0;t<e.customOperations.length;t++){let i=e.customOperations[t],a=e._filterOperationDescriptions.findIndex(e=>e.value===i.name),l={label:i.label,value:i.name,custom:!0,index:t,editorTemplate:i.editorTemplate,valueTemplate:i.valueTemplate,handleValue:i.handleValue,hideValue:i.hideValue};a>-1?e._filterOperationDescriptions[a]=l:e._filterOperationDescriptions.push(l)}}_innerContainerKeydownHandler(e){const t=this;!t._editorIsOpen||"Escape"!==e.key&&"Enter"!==e.key||t._closeEditor()}_documentDownHandler(e){const t=this,i=t.shadowRoot||t.isInShadowDOM?e.originalEvent.composedPath()[0]:e.originalEvent.target;if(i.shadowParent&&i.shadowParent.closest(".smart-input-drop-down-menu")||i.closest(".smart-input-drop-down-menu")||t.$.conditionsMenu.contains(i))return;const a=i.closest(".smart-drop-down");if(i.getRootNode().host===t||i.closest("smart-query-builder")===t||a&&t.contains(a.ownerElement))if(t._isMobile){const i=t.$.scrollableContainer.scrollTop,a=t.getBoundingClientRect().top;setTimeout((function(){if(t.$.scrollableContainer.scrollTop===i&&t.getBoundingClientRect().top===a){const i=t.context;t.context=t,t._clickHandler(e.originalEvent),t.context=i}}),250)}else t._clickHandler(e.originalEvent);else t._editorIsOpen&&!t._scrollBarDown&&t._closeEditor(),delete t._scrollBarDown}_emptyElementsStructure(e){const t=this.$.contentContainer;for(;t.firstChild;)t.removeChild(t.firstChild);this._valueFlat=e?[]:this._valueFlat,this._lastProcessedItemInCurrentGroup={parentId:null,id:null,position:null}}_resizeHandler(){this.$.scrollableContainer.refresh()}_getTotalConditions(){return this.getElementsByClassName("smart-filter-group-condition").length}_getQueryFromExpression(e){const t=this,i=t.fields;let a=[],l=e;const o=function(e){let l=[];const o=t.customOperations.filter(e=>e.expressionTemplate);o.sort((e,t)=>t.expressionTemplate.length-e.expressionTemplate.length);for(let t=0;t<o.length;t++){const i=o[t],a=new RegExp(i.expressionTemplate.replace(/\(/gm,"\\(").replace(/\)/gm,"\\)").replace(/\[/gm,"\\[").replace(/\]/gm,"\\]").replace(/"{\d+}"/gm,'\\W*"([^"]*)[^a-zA-Z0-9-\\s\\)]+').replace(/{\d+}/gm,"([@|$]*\\w+[.]*\\w+(?!\\s)*)\\s{0}").replace(/ /gm,"\\s"),"gm");if(a.test(e)){a.lastIndex=0;let t,o,n=a.exec(e);if(n=n.filter((e,t)=>n.indexOf(e)===t),i.expressionReaderCallback){let e=i.expressionReaderCallback(n[0],n.slice(1));e&&(t=e.fieldName,o=e.value)}void 0===t&&(t=n[1]||""),void 0===o&&(o=n[2]||""),l.push({operator:i.name,field:t,value:o,query:n[0]})}else;}const n=l.find(e=>i.find(t=>t.filterOperations.indexOf(e.operator)>-1&&t.dataField===e.field));if(n)return a.push({expr:n.query,query:[n.field,n.operator,n.value]}),n.query};if(l){for(;l.length;){l&&(l=l.trim(),"("===l[0]&&")"===l[l.length-1]&&(l=l.trim().replace(/^\(|\)$/gm,"")),l=l.replace(/^&{2}|^\|{2}|&{2}$|\|{2}$/gm,"").trim());const e=o(l);if(!e)break;l=l.replace(e,"").trim()}return t._constructValueFromQueries(e,a)}}_constructValueFromQueries(e,t){let i=[];t.sort((t,i)=>e.indexOf(t.expr)-e.indexOf(i.expr));for(let a=0;a<t.length;a++){let l=t[a-1];if(l){const o=e.substring(e.indexOf(l.expr)+l.expr.length,e.indexOf(t[a].expr)).trim();i.push("||"===o?"or":"and")}t[a].outher?t[a].query.forEach(e=>i.push(Array.isArray(e)?[e]:e)):i.push(t[a].query)}return i}_parseLinqToValue(){const e=this,t=e.value;let i,a=0,l=[];for(let e=0;e<t.length;e++)if("("===t[e])a++,void 0===i&&(i=e);else if(")"===t[e]&&a>0&&(a--,0===a)){let a=t.substring(i,e+1).trim();a.length&&(a.includes("&&")||a.includes("||"))&&l.push({expr:a}),i=void 0}let o,n=[];if(l.length)for(let i=0;i<l.length;i++){let a;l[i].query=e._getQueryFromExpression(l[i].expr),a=o?t.substring(t.indexOf(o)+o.length,t.indexOf(l[i].expr)).trim():t.substring(0,t.indexOf(l[i].expr)).trim(),a&&n.push(a),o=l[i].expr}o?n.push(t.substring(t.indexOf(o)+o.length).trim()):n.push(t.trim());for(let t=0;t<n.length;t++){const i=n[t].replace(/^&{2}|^\|{2}|&{2}$|\|{2}$/gm,"").trim();i.length&&l.push({expr:i,query:e._getQueryFromExpression(i),outher:!0})}e.set("value",e._constructValueFromQueries(t,l))}_getExpressionFromQuery(e){const t=e[0],i=e[1];let a=e[2];const l=this.customOperations.find(e=>e.name===i);return l&&l.expressionTemplate?("string"==typeof a&&a.includes('"')&&l.expressionTemplate.includes('"')&&(a=JSON.stringify(a).slice(1,-1)),l.expressionBuilderCallback?l.expressionBuilderCallback(t,i,a):l.expressionTemplate.replace("{0}",t).replace("{1}",a)):""}_parseQueryToLinq(e){const t=this,i={and:"&&",or:"||"};let a="";for(let l=0;l<e.length;l++){const o=e[l];if(Array.isArray(o))if(o.indexOf("and")>-1||o.indexOf("or")>-1||1===o.length&&Array.isArray(o[0])){const e=t._parseQueryToLinq(o);e?a+=o.length>1?"("+e+")":e:/\s(&|\|){2}\s$/gm.test(a)&&(a=a.replace(/\s(&|\|){2}\s$/gm,""))}else a+=t._getExpressionFromQuery(o)||"";else a&&(a+=" "+i[o]+" ")}return a}_validateValue(){const e=this;"string"==typeof e.value&&e._parseLinqToValue();const t=e.value;if(Array.isArray(t)&&""!==JSON.stringify(t).replace(/[\[\]]/g,"")){for(3===t.length&&"string"==typeof t[0]&&(e.value=[[t]]),Array.isArray(t[0])&&3===t[0].length&&"string"==typeof t[0][0]&&(e.value=[t]);"string"==typeof t[0];)t.shift();for(;"string"==typeof t[t.length-1];)t.pop();e.value.forEach(e=>{Array.isArray(e)&&0===e.length&&e.push([])})}else e.value=[[[]]]}_convertValueToFlat(e){const t=this,i=["and","or","notAnd","notOr"];if(!e)return;let a=0,l=0;t._valueFlat=[],function e(o,n){let r;for(let s=0;s<o.length;s++){const d=o[s];let c={htmlNode:null};if("string"==typeof d&&(i.indexOf(d)>-1||t.customOperators[d]))r=(t.customOperators[d]||d).trim();else if(r=r||"and",Array.isArray(d)){let i=t._valueFlat.filter(e=>e.parentId+""==n+"").length;if(d.find(e=>Array.isArray(e)))c.nodeId=(l+=1)+"",c.type="group",c.data=r,t._valueFlat.push(c),e(d,c.nodeId),r="";else{if(t.maxConditions&&a>=t.maxConditions||t.maxConditionsPerGroup&&i>=t.maxConditionsPerGroup)continue;0!==s&&(t._valueFlat.push({nodeId:n+"."+i,type:"operator",data:r,parentId:n+""}),r="",i++),c.nodeId=n+"."+i,c.parentId=n+"",c.type="condition",c.data=d,a++,t._valueFlat.push(c)}}}}(e,0),delete t._totalGroups}_getFieldsFromValue(){const e=this._valueFlat,t=[],i=[];for(let l=0;l<e.length;l++){const o=e[l];if("condition"===o.type){const e=o.data[0];if(e&&-1===t.indexOf(e)){const l={label:e,dataField:e,dataType:(a=o.data[2],"boolean"==typeof a?"boolean":a instanceof Date?a.getHours()>0||a.getMinutes()>0||a.getSeconds()>0?"dateTime":"date":isNaN(a)?"string":"number"),format:null};t.push(e),i.push(l)}}}var a;this._valueFields=i}_addElement(e,t,i,a){const l=this,o=l._valueFlat.filter(e=>e.parentId===t);let n=0,r="";if(i=i||("group"===e?"or":[]),o.length){let e=o.map(e=>{const t=e.nodeId.split(".");return parseInt(t[t.length-1])});e=0===e.length?[0]:e,n=e.reduce((e,t)=>Math.max(e,t))+1}t&&t.length>0&&(r=".");let s=(t||"")+r+("group"===e?l._valueFlat.filter(e=>"group"===e.type).length+1:n),d=o[0];if(o.length)for(let e=0;e<o.length;e++){const t=o[e],i=t.nodeId.split(".").pop();parseInt(i)>parseInt(d.nodeId.split(".").pop())&&(d=t)}else d=l._valueFlat.find(e=>e.nodeId===t);let c=d?l._valueFlat.indexOf(d)+1:l._valueFlat.length;"condition"===e&&o.length>0&&(l._valueFlat.splice(c,0,{nodeId:s,parentId:t,type:"operator",data:["and"],htmlNode:null}),s=(t||"")+r+(n+1),c++);const u={nodeId:s,parentId:t,type:e,data:i,htmlNode:null};l._valueFlat.splice(c,0,u),"group"===e&&l._addElement("condition",s,[],!0),a||l._refresh()}_deleteElement(e,t){const i=this,a="string"==typeof e?e:e.getAttribute("node-id");if(a&&1!==a.length&&("group"===t?n(a):o(a),!t||"condition"===t)){let e=a.split(".");if(e.pop(),e=e.join("."),!i._valueFlat.filter(t=>t.parentId===e).length&&(i._valueFlat.filter(e=>"group"===e.type).length>1&&n(e),"0"===e)){const e=i._valueFlat.find(e=>"group"===e.type),t=e.nodeId;e.nodeId="0",e.htmlNode.setAttribute("node-id","0");const a=i._valueFlat.filter(e=>e.parentId===t);for(let e=0;e<a.length;e++){const t=a[e];t.parentId="0",t.nodeId="0."+e,t.htmlNode.setAttribute("node-id",t.nodeId)}}i._generateValue()}function l(e){const t=i._valueFlat[e];if(t&&"operator"===t.type)return i._valueFlat.splice(e,1),t.htmlNode.parentElement.removeChild(t.htmlNode),!0}function o(e){let t,a=0,o=e.split(".");o.pop(),o=o.join(".");for(let l=0;l<i._valueFlat.length;l++){const n=i._valueFlat[l];if("condition"===n.type){if(n.nodeId===e){t=n;break}n.parentId===o&&a++}}const n=i._valueFlat.indexOf(t);i._valueFlat.splice(n,1),t.htmlNode.parentElement.removeChild(t.htmlNode);const r=l(n-1);a||l(n-(r?1:0));const s=i._valueFlat.filter(e=>e.nodeId===o)[0].htmlNode;s.children[1].childElementCount>0&&s.children[2].hasAttribute("limit-selection")&&!s.children[1].lastElementChild.hasAttribute("limit-selection")&&s.children[2].removeAttribute("limit-selection")}function n(e){const t=i._valueFlat.filter(t=>e===t.nodeId&&"group"===t.type)[0];for(let t=0;t<i._valueFlat.length;t++){const a=i._valueFlat[t],l=a.nodeId;a.parentId===e&&("group"===a.type?n(l):o(l))}i._valueFlat.indexOf(t)>-1&&i._valueFlat.splice(i._valueFlat.indexOf(t),1),t.htmlNode.parentElement.removeChild(t.htmlNode)}}_generateHTMLStructureFromFlatValue(e){const t=this,i=document.createDocumentFragment();if(t._valueFlat&&0!==t._valueFlat.length){for(let e=0;e<t._valueFlat.length;e++){const a=t._valueFlat[e],l=!!t.customOperations&&t.customOperations.find(e=>e.name===a.data[1]),o=a.parentId?(t.shadowRoot||t).querySelector('[node-id="'+a.parentId+'"]').querySelector(".smart-filter-group-condition-container"):t.$.contentContainer;if("group"===a.type){const l=document.createElement("div"),o=t.localize(a.data)||"";l.className="smart-filter-group",l.innerHTML='<div class="smart-filter-group-operator" role="button" aria-expanded="false" aria-haspopup="menu">'+o+'</div><div class="smart-filter-group-condition-container" role="group"></div><div class="smart-filter-add-condition-btn" role="button" aria-label="Add condition"><div>'+t.localize("add")+'</div></div><div class="smart-filter-add-btn" role="button" aria-expanded="false" aria-haspopup="menu" aria-label="Add group"></div>',l.firstElementChild.data=o,i.appendChild(l),l.setAttribute("node-id",a.nodeId),t._valueFlat[e].htmlNode=l}else if("condition"===a.type){const o=t._newFilterConditionRow(a.data);if(o.setAttribute("node-id",a.nodeId),i.appendChild(o),t._valueFlat[e].htmlNode=o,void 0!==a.data[0]&&void 0===a.data[1]){const e=t._getFilterOperations(t._fields.find(e=>e.value===a.data[0]));t._handleOnlyOperation(e,a.data,o)}else(-1!==["isblank","isnotblank"].indexOf(a.data[1])||l&&l.hideValue)&&(a.data.splice(2,1),o.children[2].classList.add("smart-visibility-hidden"))}else{const l=document.createElement("div");l.className="smart-filter-nested-operator",l.setAttribute("node-id",a.nodeId),l.setAttribute("role","button"),l.setAttribute("aria-expanded",!1),l.setAttribute("aria-haspopup","menu"),l.innerHTML=t.localize(a.data),i.appendChild(l),t._valueFlat[e].htmlNode=l}o.appendChild(i)}e&&t._validateValueAdvanced(),t.$.scrollableContainer.refresh()}}_validateValueAdvanced(){const e=this,t=e.value;let i=!1,a=!1,l=0;for(let e=0;e<t.length;e++){const o=t[e];if("string"!=typeof o)for(let e=o.length-1;e>=0;e--){let t=o[e];if(Array.isArray(t)&&0===t.length&&e!==o.length-1)o.splice(e,1),0===e&&o.splice(0,1),i=!0;else if("string"==typeof t){t=t.toLowerCase(),l++,(l>1||"and"!==t&&"or"!==t)&&(a=!0);continue}l=0}}i&&(e._emptyElementsStructure(!0),e._convertValueToFlat(e.value),e._generateHTMLStructureFromFlatValue()),a&&e._generateValue(!0)}_restrictNesting(){Array.from(this.getElementsByClassName("smart-filter-add-condition-btn")).forEach(e=>{const t=e.previousElementSibling.lastElementChild;t&&t.hasAttribute("limit-selection")&&e.setAttribute("limit-selection","")})}_clickHandler(e){const t=this,i=t.shadowRoot||t.isInShadowDOM?e.composedPath()[0]:e.target;if(t.disabled||!i||!i.closest||!t._isMobile&&0!==e.button)return;if(t._scrollBarDown)return void delete t._scrollBarDown;const a=i.closest(".smart-drop-down"),l=t._editor&&t._editor.contains(i)||a&&(t._editor.contains(a.ownerElement)||t._editor===a.ownerElement)||i.closest(".smart-custom-editor");t._editor&&t._editorIsOpen&&!l&&t._closeEditor();const o=i.closest(".smart-filter-group-condition")||i.closest(".smart-filter-nested-operator")||i.closest(".smart-filter-group");if(!o)return;const n=t._getItemById(o.getAttribute("node-id"));if(!n)return;if(t.$.fireEvent("itemClick",{id:n.nodeId,type:n.type,data:n.data}),i.closest(".smart-filter-delete-btn"))return void t._clickHandlerDeleteButton(n.htmlNode);const r=i.closest(".smart-filter-add-btn")||i.closest(".smart-filter-add-condition-btn");if(r){const e=r.closest(".smart-filter-group").getAttribute("node-id");return void(r.classList.contains("smart-filter-add-condition-btn")&&(t.maxConditions&&t._getTotalConditions()<t.maxConditions||!t.maxConditions)?t._addElement("condition",e,[]):t._clickHandlerFilterButton(r.classList,n.nodeId,i))}const s=i.closest(".filter-builder-item")||i.closest(".smart-filter-group-operator")||i.closest(".smart-filter-nested-operator");if(s){const e=s.classList;t._clickHandlerFilterButton(e,n.nodeId,i)}}_downHandler(e){const t=this;if(!e.originalEvent||!t._isMobile&&0!==e.button)return;const i=t.shadowRoot||t.isInShadowDOM?e.originalEvent.composedPath()[0]:e.originalEvent.target,a=t.rightToLeft?e.pageX>i.getBoundingClientRect().right:e.pageX<i.getBoundingClientRect().left;if(t.allowDrag&&i.classList.contains("smart-filter-group-condition")&&a){const a=t._valueFlat.filter(e=>"condition"===e.type);if(1===a.length||2===a.length&&a[0].parentId===a[1].parentId&&a[1].htmlNode.hasAttribute("limit-selection"))return;return t._dragDetails={coords:{x:e.pageX,y:e.pageY},item:i,originalEvent:e},t.$.scrollableContainer._scrollView.disableSwipeScroll=!0,t._hoveredCondition=i,void window.getSelection().removeAllRanges()}this._scrollBarDown=i.closest("smart-scroll-bar"),e.stopPropagation(),e.preventDefault()}_scrollableContainerTouchmoveHandler(e){this._dragDetails&&e.cancelable&&(e.preventDefault(),e.stopPropagation())}_documentMoveHandler(e){const t=this,i=t._dragDetails;if(!i)return;const a=i.item;if(!i.feedbackShown){if(!(Math.abs(i.coords.x-e.pageX)>5||Math.abs(i.coords.y-e.pageY)>5))return;{const l=t._valueFlat.filter(e=>e.htmlNode===a)[0];if(t.$.fireEvent("dragStart",{data:l.data,item:a,originalEvent:e}).defaultPrevented)return delete t._dragDetails,delete t._hoveredCondition,void(t.$.scrollableContainer._scrollView.disableSwipeScroll=!1);i.allConditions=Array.from((t.shadowRoot||t).querySelectorAll(".smart-filter-group-condition")),i.data=l,i.feedback=t._addDragFeedback(),i.feedbackShown=!0,a.classList.add("dragged")}}const l=e.clientY;let o,n=t.shadowRoot||t.isInShadowDOM?e.originalEvent.composedPath()[0]:e.originalEvent.target;if(t.$.fireEvent("dragging",{data:i.data,item:a,originalEvent:e}),t.setAttribute("dragging",""),i.feedback.style.left=e.pageX+10+"px",i.feedback.style.top=e.pageY+10+"px",t._isMobile){const i=t._hoveredCondition;i&&(i.classList.remove("drop-target","top","bottom"),delete t._hoveredCondition);const a=document.elementFromPoint(e.clientX,l);a&&(n=a)}let r,s=n.closest(".smart-filter-group-condition");if(s){o=s;const e=o.getBoundingClientRect(),t=Math.abs(l-e.top),i=Math.abs(l-e.bottom);r=t<i?"top":"bottom"}else{let e,t;i.allConditions.forEach(i=>{const a=i.getBoundingClientRect(),o=Math.abs(l-a.top),n=Math.abs(l-a.bottom),s=Math.min(o,n);(void 0===t||s<t)&&(e=i,t=s,r=o<n?"top":"bottom")}),s=e}if(s===a||s.hasAttribute("limit-selection")&&"bottom"===r)s=void 0;else{const e=Array.from(s.parentElement.getElementsByClassName("smart-filter-group-condition")),t=e.indexOf(a);-1!==t&&("top"===r&&s===e[t+1]||"bottom"===r&&s===e[t-1])&&(s=void 0)}if(o=s,i.side=r,clearInterval(t._dragInterval),t._dragInterval=setInterval((function(){const i=t.getBoundingClientRect();t.$.scrollableContainer.scrollHeight>0&&i.left<=e.clientX&&i.left+i.width>=e.clientX?l>=i.top&&l<=i.top+36?t.$.scrollableContainer.scrollTop-=t._autoScrollCoefficient:l>=i.top+i.height-36&&l<=i.top+i.height?t.$.scrollableContainer.scrollTop+=t._autoScrollCoefficient:clearInterval(t._dragInterval):clearInterval(t._dragInterval)}),1),o){t._hoveredCondition&&o!==t._hoveredCondition&&t._hoveredCondition.classList.remove("drop-target","top","bottom");const e=o.closest(".smart-filter-group");if(e&&e.hasAttribute("restricted"))return void(t._hoveredCondition=void 0);t._hoveredCondition=o,o.classList.remove("top","bottom"),o.classList.add(r,"drop-target")}else t._hoveredCondition&&(t._hoveredCondition.classList.remove("drop-target","top","bottom"),delete t._hoveredCondition)}_addDragFeedback(){const e=this,t=document.createElement("div");return e.rightToLeft?t.setAttribute("right-to-left",""):t.removeAttribute("right-to-left"),t.className="smart-query-builder-drag-feedback",e.theme&&t.setAttribute("theme",e.theme),document.body.appendChild(t),t}_documentUpHandler(e){const t=this,i=t._dragDetails;if(!i)return void(t.$.conditionsMenu.opened&&t._selectedElement&&!t._selectedElement.classList.contains("smart-filter-add-btn")&&t.$.conditionsMenu._hoverViaKeyboard(t.$.conditionsMenu.querySelector('smart-menu-item[value="'+t._editedItem.data+'"]')));const a=i.item,l=i.data,o=t._hoveredCondition;if(delete t._dragDetails,delete t._hoveredCondition,t.$.scrollableContainer._scrollView.disableSwipeScroll=!1,!t.hasAttribute("dragging"))return;if(clearInterval(t._dragInterval),window.getSelection().removeAllRanges(),t.removeAttribute("dragging"),a.classList.remove("dragged"),i.feedback.remove(),!o)return void t.$.fireEvent("dragEnd",{data:l.data,item:a,originalEvent:e,target:null,targetData:null,targetSide:null});const n=t._valueFlat.filter(e=>e.htmlNode===o)[0],r=t.$.fireEvent("dragEnd",{data:l.data,item:a,originalEvent:e,target:o,targetData:n.data,targetSide:i.side});if(o.classList.remove("drop-target","top","bottom"),r.defaultPrevented)return;const s=t.value,d=l.nodeId.split(".").map(e=>parseFloat(e)),c=s[2*(d[0]-1)],u=n.nodeId.split(".").map(e=>parseFloat(e)),m=s[2*(u[0]-1)];let p="and";c.length>1&&(0===d[1]?(p=c[1],c[1]="!remove!"):(p=c[d[1]-1],c[d[1]-1]="!remove!")),c[d[1]]="!remove!","top"===i.side?m.splice(u[1],0,l.data,p):m.splice(u[1]+1,0,p,l.data);for(let e=0;e<s.length;e++)Array.isArray(s[e])&&(s[e]=s[e].filter(e=>"!remove!"!==e));for(let e=s.length-1;e>=0;e--)Array.isArray(s[e])&&0===s[e].length&&(0===e?s.splice(0,2):(s.splice(e-1,2),e--));t._emptyElementsStructure(!0),t._convertValueToFlat(s),t._generateHTMLStructureFromFlatValue(),t._validValue=t._getValidValue();const h=JSON.stringify(t._validValue);t._oldValueAsString!==h&&(t._oldValueAsString=h,t.$.fireEvent("change",{value:JSON.parse(h),linq:t._parseQueryToLinq(t._validValue)}))}_clickHandlerDeleteButton(e,t){const i=this;if(e&&e.classList)if(i._closeEditor(),1!==i.getElementsByClassName("smart-filter-group-condition").length){if(e.classList.contains("smart-filter-group")){if(t&&i._valueFlat.filter(t=>t.parentId===e.getAttribute("node-id")).length>0)return;i._deleteElement(e,"group")}else i._deleteElement(e);i._generateValue(),i.$.scrollableContainer.refresh(),Array.from(i.$.contentContainer.children).forEach((e,t)=>{const a=(t+1).toString();e.setAttribute("node-id",a),i._valueFlat.filter(t=>t.htmlNode===e)[0].nodeId=a,Array.from(e.children[1].children).forEach((e,t)=>{const l=i._valueFlat.filter(t=>t.htmlNode===e)[0],o=a+"."+t;e.setAttribute("node-id",o),l.parentId=a,l.nodeId=o})})}else{const e=i._valueFlat[1].htmlNode.children;i.value=[[[]]],i._validValue=i._getValidValue(),i._valueFlat[1].data=[],i._valueFlat[1].htmlNode.setAttribute("limit-selection",""),e[0].setAttribute("placeholder",""),e[1].setAttribute("placeholder",""),e[2].setAttribute("placeholder",""),e[0].firstElementChild.innerHTML=i.propertyPlaceholder,e[1].firstElementChild.innerHTML=i.operatorPlaceholder,e[2].firstElementChild.innerHTML=i.valuePlaceholder;const t=JSON.stringify(i._validValue);i._oldValueAsString!==t&&(i._oldValueAsString=t,i.$.fireEvent("change",{value:JSON.parse(t),linq:i._parseQueryToLinq(i._validValue)}))}}_menuCloseHandler(){const e=this.$.conditionsMenu.controlledBy;e.setAttribute("aria-expanded",!1),e.removeAttribute("aria-controls"),delete this.$.conditionsMenu.controlledBy}_menuClosingHandler(e){const t=e.detail;"interaction"===t.trigger&&this._selectedElement===t.target&&e.preventDefault()}_menuItemClickHandler(e){const t=this,i=t._selectedElement.closest(".smart-filter-group-operator, .smart-filter-nested-operator"),a=e.detail,l=a.value;let o;if(i){i.innerHTML=t.localize(l)||a.label,i.value=l,o=i.classList.contains("smart-filter-nested-operator")?i.getAttribute("node-id"):i.parentElement.getAttribute("node-id");for(let e=0;e<t._valueFlat.length;e++)if(t._valueFlat[e].nodeId===o){t._valueFlat[e].data=i.value;break}t._generateValue()}else o=t._selectedElement.parentElement.getAttribute("node-id"),t._addElement("group",null,l);t.$.scrollableContainer.refresh()}_newFilterConditionRow(e=[]){const t=this,i=e[0];let a,l=t._fields.find(e=>e.value===i),o=l?l.label:void 0;if(void 0===i||!o&&"static"===t.fieldsMode)e.length=0;else{o||(l=t._getDynamicFieldInfo(i),o=l.label,e[0]=l.dataField),a=t._getFilterOperations(l).find(t=>t.value===e[1]),a?a=a.label:e.splice(1,2)}const n=t._formatValueStringRepresentation(e[2],e[0],e[1]);let r=document.createElement("div"),s="condition"+Math.floor(65536*(1+Math.random())).toString(16).substring(1),d='<div class="filter-builder-item smart-filter-field-name" id="'+s+'Field" '+(o?'><div class="smart-value-container" role="presentation">'+o:'placeholder><div class="smart-value-container" role="presentation">'+t.propertyPlaceholder)+'</div></div><div class="filter-builder-item smart-filter-operation" id="'+s+'Operation" '+(a?'><div class="smart-value-container" role="presentation">'+a:'placeholder><div class="smart-value-container" role="presentation">'+t.operatorPlaceholder)+'</div></div><div class="filter-builder-item smart-filter-value" id="'+s+'Value" '+(void 0!==e[2]?'><div class="smart-value-container" role="presentation">'+n:'placeholder><div class="smart-value-container" role="presentation">'+t.valuePlaceholder)+'</div></div><div class="smart-filter-delete-btn" role="button" aria-label="Close"></div>';return r.className="smart-filter-group-condition",r.setAttribute("role","group"),r.innerHTML=d,t._setAriaLabel(r),e.length||r.setAttribute("limit-selection",""),r}_setAriaLabel(e){const t=[];for(let i=0;i<e.children.length-1;i++){const a=e.children[i];a.classList.contains("smart-visibility-hidden")||a.hasAttribute("placeholder")||t.push(e.children[i].innerText)}0!==t.length?e.setAttribute("aria-label",t.join(" ")):e.setAttribute("aria-label","Empty condition row")}_formatValueStringRepresentation(e,t,i){const a=this,l=a._getFieldByFieldName(t);let o;if(!l)return e;if(null==e)return a.valuePlaceholder;if(void 0!==i&&a.customOperations&&a.customOperations.length>0&&(i=a.customOperations.find(e=>e.name===i))&&i.valueTemplate)return"<span>"+i.valueTemplate(a._editor,e)+"</span>";switch(l.dataType.toLowerCase()){case"date":case"datetime":(e=e instanceof Date||"string"==typeof e||"number"==typeof e&&!isNaN(e)?new Smart.Utilities.DateTime(e):e).calendar.days=a._localizedDays,e.calendar.months=a._localizedMonths,e.calendar.locale=a.locale,o=e.toString("date"===l.dataType?a.formatStringDate:a.formatStringDateTime);break;case"array":o="string"==typeof e?e.split(","):e;break;case"object":o="string"==typeof e?e:JSON.stringify(e);break;case"number":o=e;break;case"boolean":o=!!e;break;default:o=e+""}return a.valueFormatFunction?"<span>"+a.valueFormatFunction(o,t,l.dataType||"string")+"</span>":"<span>"+o+"</span>"}_getFieldByFieldName(e){return Object.assign({},this._fields.find(t=>t.value===e))}_refresh(){this._generateValue(),this._emptyElementsStructure(),this._generateHTMLStructureFromFlatValue(),this._restrictNesting()}_generateValue(e){const t=this;let i=[],a=t._valueFlat.slice(0),l=[];for(let e=0;e<a.length;e++){const t=a[e];let l={};"group"===t.type&&(l.nodeId=t.nodeId,l.parentId=t.parentId,l.data=t.data,l.structure=[],i.push(l))}for(let e=0;e<i.length;e++){const t=i[e];for(let e=0;e<a.length;e++){const i=a[e];if(i.parentId===t.nodeId&&"condition"===i.type){const l=a[e-1];l&&l.parentId===t.nodeId&&"operator"===l.type&&t.structure.push(l.data.toString()),t.structure.push(i.data)}}}i=i.filter(e=>e.structure.length>0),i.sort((function(e,t){return t.nodeId.split(".").length-e.nodeId.split(".").length}));for(let e=0;e<i.length;e++){const t=i[e],a=i.filter(e=>e.nodeId===t.parentId)[0];a&&a.structure?a.structure.push(t.structure):"0"!==t.nodeId?t.data&&(e>0&&l.push(t.data),l.push(t.structure)):l=l.concat(t.structure)}if(t.value=l,t._validateValue(),t._validValue=t._getValidValue(),!e){const e=JSON.stringify(t._validValue);t._oldValueAsString!==e&&(t._oldValueAsString=e,t.$.fireEvent("change",{value:JSON.parse(e),linq:t._parseQueryToLinq(t._validValue)}))}}_getItemById(e,t){const i=this._valueFlat.filter(i=>t?i.parentId===e:i.nodeId===e);return i.length>0?i[0]:null}_validateStoredValue(e,t){const i=this;if(!t&&!i._editedItem)return e;if(!t&&!(t=i._editedItem.data[0]))return e;const a=i._getFieldByFieldName(t).dataType;if(void 0===a)return e+"";switch(a.toLowerCase()){case"date":case"datetime":e=new Smart.Utilities.DateTime(e).toDate();break;case"number":"number"!=typeof e&&(e=parseFloat(e));break;case"boolean":"boolean"!=typeof e&&(e=!!e);break;case"object":"object"!=typeof e&&(e={});break;case"array":Array.isArray(e)||(e=[e]);break;default:"string"!=typeof e&&(e+="")}return e}_closeEditor(e){const t=this;let i;if(!t._editedItem||!t._editorIsOpen)return;const a=t._editedItem,l=t._editor.closest(".filter-builder-item"),o=l.querySelector(".smart-value-container"),n=l.parentElement,r=n.children[2];if(t._editor===t.$.dateTimePickerEditor)t._editor._inputChangeHandler(),i=t._editor.value,i&&(i=i.toDate());else if(t._editor===t.$.checkBoxEditor)i=t._editor.checked;else if(t._editor===t.$.customEditor){if(t._editor){Array.from(t._editor.getElementsByTagName("smart-numeric-text-box")).forEach(e=>e._inputBlurHandler())}i=t._validateStoredValue(t._selectedCustomCondition.handleValue(t._editor))}else if(t._editor===t.$.numericTextBoxEditor)t._editor._inputBlurHandler(),i=t._editor.value;else if(l.classList.contains("smart-filter-value")){const e=t._getFieldByFieldName(t._editedItem.data[0]);if("array"===e.dataType)i=t._editor.value.split(",");else if("object"===e.dataType)i=JSON.parse(t._editor.value);else{const a=t._editor.value;i=e.lookup&&e.lookup.dataSource?{label:a,value:t._editor.dataset.value||a}:a}}else i=t._editor.value;if(l.classList.contains("smart-filter-field-name")){if(""===i.trim())return void t._hideEditor(l,void 0===a.data[0]);n.hasAttribute("limit-selection")&&(n.removeAttribute("limit-selection"),n.parentElement.nextElementSibling.removeAttribute("limit-selection"));const e=t._fields.find(e=>e.label===i),s=a.data[0];if(e)a.data[0]=e.value;else{if("dynamic"!==t.fieldsMode)return o.innerHTML=t._fields.find(e=>e.value===s).label,void t._hideEditor(l);{const e=t._getDynamicFieldInfo(i);i=e.label,a.data[0]=e.dataField}}o.innerHTML=i,t._handleFieldChange([s,a.data[0]],[r,a,n])}else if(l.classList.contains("smart-filter-operation"))t._handleOperationChange([a,i,t._editor.$.input.dataValue],[o,r]);else{let e,l;"object"==typeof i?(e=i.label,l=i.value):e=l=i,a.data[2]=l,o.innerHTML=t._formatValueStringRepresentation(e,t._editedItem.data[0],t._editedItem.data[1])}t._generateValue(e),t._hideEditor(l)}_getDynamicFieldInfo(e){const t=this,i={label:e,dataField:e,dataType:"string"};if(t.getDynamicField){const a=t.getDynamicField(e);a.label&&(i.label=a.label),a.dataField&&(i.dataField=a.dataField),a.dataType&&(i.dataType=a.dataType),a.filterOperations&&Array.isArray(a.filterOperations)&&a.filterOperations.length>0&&(i.filterOperations=a.filterOperations),a.lookup&&(i.lookup=a.lookup)}return t._manuallyAddedFields.push(i),t._mapFieldsToMenu(),i}_handleFieldChange(e,t){const i=this,a=e[0],l=t[1],o=t[2],n=t[0],r=i._fields.find(t=>t.value===e[1]),s=i._getFilterOperations(r),d=function(){r.value!==a&&i.$.fireEvent("propertySelected",{label:r.label,value:r.value})};if(!a||void 0===l.data[1])return i._handleOnlyOperation(s,l.data,o),void d();const c=i._fields.find(e=>e.value===a),u=c.dataType,m=r.dataType;if(r!==c&&(m!==u||r.filterOperations||c.filterOperations)){if(!!s.find(e=>e.value===l.data[1])){if(m===u)return;return"date"===m&&"dateTime"===u||"dateTime"===m&&"date"===u?(n.firstElementChild.innerHTML=i._formatValueStringRepresentation(l.data[2],l.data[0],l.data[1]),void d()):(l.data.splice(2,1),n.setAttribute("placeholder",""),n.firstElementChild.innerHTML=i.valuePlaceholder,void d())}l.data.splice(1,2),o.children[1].setAttribute("placeholder",""),o.children[1].firstElementChild.innerHTML=i.operatorPlaceholder,n.setAttribute("placeholder",""),n.firstElementChild.innerHTML=i.valuePlaceholder,n.classList.remove("smart-visibility-hidden"),i._handleOnlyOperation(s,l.data,o),d()}}_handleOnlyOperation(e,t,i){if(1===e.length){const a=e[0];t[1]=a.value,i.children[1].removeAttribute("placeholder",""),i.children[1].firstElementChild.innerHTML=e[0].label,("isblank"===a.value||"isnotblank"===a.value||a.custom&&a.hideValue)&&(t.splice(2,1),i.children[2].classList.add("smart-visibility-hidden"))}}_handleOperationChange(e,t){const i=this,a=e[0],l=e[1],o=e[2],n=t[0],r=t[1],s=void 0!==a.data[1]?i._filterOperationDescriptions.find(e=>e.value===a.data[1]):void 0,d=i._filterOperationDescriptions.find(e=>e.value===o),c=d.value;if(d===s)return;const u=a.data[0],m=a.data[1],p=a.data[2];if(a.data[1]=c,n.innerHTML=l,"isblank"===c||"isnotblank"===c||d.custom&&d.hideValue)a.data.splice(2,1),r.classList.add("smart-visibility-hidden");else if(r.classList.contains("smart-visibility-hidden"))r.setAttribute("placeholder",""),r.classList.remove("smart-visibility-hidden"),r.firstElementChild.innerHTML=i.valuePlaceholder;else if(d.custom){const e=i._getFieldByFieldName(u);if(d.editorTemplate){const t=d.editorTemplate(e.dataType,m,e);t&&(i.$.customEditor.innerHTML="",i.$.customEditor.appendChild(t))}r.firstElementChild.innerHTML=d.valueTemplate?d.valueTemplate(i.$.customEditor,p):p}else void 0===p?(a.data.splice(2,1),r.setAttribute("placeholder",""),r.firstElementChild.innerHTML=i.valuePlaceholder):d.custom||(r.firstElementChild.innerHTML=i._formatValueStringRepresentation(p,u,m))}_hideEditor(e,t){const i=this;t&&e.setAttribute("placeholder",""),e.removeAttribute("edited"),i.$.editorsContainer.removeAttribute("open"),i._editor.close&&i._editor.close(),i._editor.classList.add("smart-hidden"),i._editorIsOpen=i._enterIsPressedInEditor=!1,i.$.scrollableContainer.refresh(),i._setAriaLabel(e.parentElement)}_clickHandlerFilterButton(e,t,i){const a=this;function l(e,t,i){a._contextMenuOptions=0===t.length?a._defaultFilterOperationDescriptions:t,a._handleContextMenu(e),a.$.conditionsMenu.opened&&(a.$.conditionsMenu._discardKeyboardHover(),a.$.conditionsMenu._hoverViaKeyboard(a.$.conditionsMenu.querySelector('smart-menu-item[value="'+i+'"]')))}if(!i.closest(".smart-editors-container"))if(a._closeEditor(),a._editedItem=a._getItemById(t),e.contains("smart-filter-add-btn"))l(i,a._groupOperationDescriptions);else if(e.contains("smart-filter-field-name")||a._editedItem.data&&a._editedItem.data.length)if(e.contains("smart-filter-group-operator")||e.contains("smart-filter-nested-operator"))l(i,a._groupOperationDescriptions,a._editedItem.data);else{i.closest(".filter-builder-item").removeAttribute("placeholder"),a._openEditor(i)}}_handleContextMenu(e){const t=this;if(t._selectedElement===e&&t.$.conditionsMenu.opened)return void t.$.conditionsMenu.close();if(t._closeEditor(),t.disableContextMenu)return void(t._selectedElement=e);const i=e.getBoundingClientRect(),a=t.getBoundingClientRect(),l=i.left+t.$.contentContainer.scrollLeft-a.left,o=i.top+t.$.contentContainer.scrollTop-a.top+i.height;e.hasAttribute("aria-haspopup")&&(t.$.conditionsMenu.controlledBy&&(t.$.conditionsMenu.controlledBy.setAttribute("aria-expanded",!1),t.$.conditionsMenu.controlledBy.removeAttribute("aria-controls")),e.setAttribute("aria-controls",t.$.conditionsMenu.id),e.setAttribute("aria-expanded",!0),t.$.conditionsMenu.controlledBy=e),t.$.conditionsMenu.dataSource=t._contextMenuOptions,t.$.conditionsMenu.open(l,o+3),t._selectedElement=e,t.$.scrollableContainer.refresh()}_openEditor(e){const t=this,i=e&&e.closest(".smart-filter-group-condition")?e.closest(".smart-filter-group-condition").getAttribute("node-id"):null,a=e.closest(".filter-builder-item"),l=t._getItemById(i);let o="";void 0!==l.data[0]?o=l.data[0]:t._fields.length&&(o=t._fields[0].value);let n,r,s=t._getFieldByFieldName(o),d="";if(a.classList.contains("smart-filter-field-name"))r=0,t._fields||t._mapFieldsToMenu(),s.lookup={dataSource:t._fields.slice(),readonly:!1},d=s.label||"",n=s.value;else if(a.classList.contains("smart-filter-operation")){r=1;let e=t._getFilterOperations(s);s.lookup={dataSource:e,readonly:!0};let i=e.find(e=>e.value===l.data[r])||e[0];d=i.label,n=i.value}else r=2,d=l.data[r],void 0===d&&(d="");t._editorIsOpen&&t._closeEditor(),a.setAttribute("edited",""),t._editedItem=l;const c=t._fields.filter(e=>e.value===o),u=t._filterOperationDescriptions.filter(e=>e.value===l.data[1]&&e.custom),m=c.length>0?c[0]:null,p=s.lookup&&s.lookup.dataSource?"lookup":m.dataType;2===r&&0!==u.length&&u[0].editorTemplate?(t._selectedCustomCondition=u[0],t._openCustomEditor(p,d,s)):t._openEditorByFieldType(p,d,s,n),t._editor.classList.remove("smart-hidden"),t._editorIsOpen=!0,t.$.editorsContainer.setAttribute("open",""),a.appendChild(t.$.editorsContainer),t.$.scrollableContainer.refresh(),t._editor.classList.contains("smart-custom-editor")||requestAnimationFrame(()=>t._editor.focus()),s.lookup&&s.lookup.readonly&&t._editor.open()}_getFilterOperations(e){const t=this;let i=t._filterOperationDescriptions.slice();if(e.filterOperations)i=t._filterOperationDescriptions.filter(t=>e.filterOperations.indexOf(t.value)>-1);else{let a;switch(e.dataType){case"date":case"dateTime":case"number":a=["=","<>","<",">","<=",">=","isblank","isnotblank"];break;case"boolean":a=["=","<>","isblank","isnotblank"];break;case"object":a=["isblank","isnotblank"];break;case"string":a=["contains","notcontains","startswith","endswith","=","<>","isblank","isnotblank"];break;default:a=["contains","notcontains","startswith","endswith","=","<>","<",">","<=",">=","isblank","isnotblank"]}i=t._filterOperationDescriptions.filter(e=>a.indexOf(e.value)>-1)}return t.showIcons&&i.map(e=>e.icon=t.icons[e.value]),i}_openCustomEditor(e,t,i){const a=this,l=a.customOperations[a._selectedCustomCondition.index].editorTemplate(e,t,i);a.$.customEditor.innerHTML="",l&&a.$.customEditor.appendChild(l),a._editor=a.$.customEditor}_openEditorByFieldType(e,t,i,a){const l=this;if(e)switch(e.toLowerCase()){case"boolean":return l._initializeEditor("checkBox"),void(l._editor.checked=!!t);case"date":case"datetime":return l._initializeEditor("dateTimePicker"),l._editor.formatString="date"===e?l.formatStringDate:l.formatStringDateTime,void(l._editor.value=t);case"number":return l._initializeEditor("numericTextBox"),void(l._editor.value=t||0)}if(l._initializeEditor("input"),l._editor.dropDownWidth=l.dropDownWidth,"lookup"===e){const a=i.lookup.minLength,o=i.lookup.dataSource;if(l._editor.autoCompleteDelay=i.lookup.autoCompleteDelay||100,l._editor.dropDownAppendTo=l.$.container,l._editor.dropDownButtonPosition=l.rightToLeft?"left":"right",l._editor.minLength=isNaN(a)||null===a?1:a,l._editor.readonly=!!i.lookup.readonly,"object"===e)t=JSON.stringify(t||{});else if(""===t&&l._editor.readonly){const e=l._editor.dataSource;if(Array.isArray(e)){const i=e[0];t=i&&i.label||""}else t=""}"function"==typeof o?l._editor.dataSource=o:o instanceof Promise?o.then(e=>{if(!(l._editor instanceof Smart.Input))return;const i=l._editor.opened;l._editor.dataSource=e,i&&(l._editor.open(),""===t&&l._editor.readonly&&e.length&&(l._editor.value=e[0].label||e[0]))}):l._editor.dataSource=o}else l._editor.dataSource=[],l._editor.dropDownButtonPosition="none",l._editor.readonly=!1;l._editor.value=t+"","object"!==e&&a&&l._editor.$&&l._editor.$.input&&(l._editor.$.input.dataValue=a)}_initializeEditor(e){const t=this;if(t.$[e+"Editor"])return void(t._editor=t.$[e+"Editor"]);const i=document.createElement("smart-"+Smart.Utilities.Core.toDash(e));"numericTextBox"===e?(i.spinButtons=!0,i.inputFormat="floatingPoint"):"dateTimePicker"===e&&(i.dropDownAppendTo=t.$.container,i.calendarButton=!0,i.dropDownDisplayMode="auto",i.enableMouseWheelAction=!0,i.locale=t.locale,i.messages[t.locale]||(i.messages[t.locale]={}),i.messages[t.locale].dateTabLabel=t.localize("dateTabLabel"),i.messages[t.locale].timeTabLabel=t.localize("timeTabLabel")),i.rightToLeft=t.rightToLeft,i.theme=t.theme,i.animation=t.animation,i.$.addClass("smart-hidden underlined"),t.$.editorsContainer.appendChild(i),t._editor=t.$[e+"Editor"]=i}_getValidValue(){const e=this,t=e.properties.value.value,i=[];let a=!1;return t.forEach(t=>{if(Array.isArray(t)){let l=!1,o=!1;const n=[];t.forEach(t=>{if(Array.isArray(t)){const i=t[0],a=t[1],r=t[2];if(void 0===i||void 0===a)return void(o=!0);if(void 0!==r||"isblank"===a||"isnotblank"===a)return l=!0,void n.push(t);const s=e._filterOperationDescriptions.find(e=>e.value===a);s.custom&&s.hideValue?(l=!0,n.push(t)):o=!0}else o?o=!1:n.push(t)}),l?("string"==typeof n[n.length-1]&&n.pop(),i.push(n)):a=!0}else a?a=!1:i.push(t)}),"string"==typeof i[i.length-1]&&i.pop(),i}})}});